<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Metabolomics | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</title>
  <meta name="description" content="2 Metabolomics | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Metabolomics | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Metabolomics | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  
  
  

<meta name="author" content="Karin Steffen" />


<meta name="date" content="2020-07-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="microbiota.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SUPPLEMENTARY MATERIAL</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Content</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#experimental-setup"><i class="fa fa-check"></i><b>1.1</b> Experimental setup</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#map"><i class="fa fa-check"></i><b>1.1.1</b> Map</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#water-masses"><i class="fa fa-check"></i><b>1.1.2</b> Water masses</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#sponges"><i class="fa fa-check"></i><b>1.1.3</b> Sponges</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#sample-metadata-analysis"><i class="fa fa-check"></i><b>1.2</b> Sample metadata analysis</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#index_cor_vif"><i class="fa fa-check"></i><b>1.2.1</b> Correlations, visual inspection and variance inflation factors (VIF) across all samples</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#correlations-visual-inspection-and-variance-inflation-factors-vif-across-g.-barretti-samples"><i class="fa fa-check"></i><b>1.2.2</b> Correlations, visual inspection and variance inflation factors (VIF) across <em>G. barretti</em> samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="metabolomics.html"><a href="metabolomics.html"><i class="fa fa-check"></i><b>2</b> Metabolomics</a><ul>
<li class="chapter" data-level="2.1" data-path="metabolomics.html"><a href="metabolomics.html#experimental-methods-and-detailed-description"><i class="fa fa-check"></i><b>2.1</b> Experimental methods and detailed description</a></li>
<li class="chapter" data-level="2.2" data-path="metabolomics.html"><a href="metabolomics.html#data-processing"><i class="fa fa-check"></i><b>2.2</b> Data processing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="metabolomics.html"><a href="metabolomics.html#peak-picking-with-xcms-and-annotation-with-camera"><i class="fa fa-check"></i><b>2.2.1</b> Peak picking with XCMS and annotation with CAMERA</a></li>
<li class="chapter" data-level="2.2.2" data-path="metabolomics.html"><a href="metabolomics.html#hilic-hydrophilic-interaction-chromatography-column-with-positive-esi-electron-spray-ionisation"><i class="fa fa-check"></i><b>2.2.2</b> HILIC (Hydrophilic interaction chromatography) column with positive ESI (electron spray ionisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="metabolomics.html"><a href="metabolomics.html#hilic-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.3</b> HILIC Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.4" data-path="metabolomics.html"><a href="metabolomics.html#rp-reversed-phase-chromatography-with-positive-esi"><i class="fa fa-check"></i><b>2.2.4</b> RP (Reversed phase) Chromatography with positive ESI</a></li>
<li class="chapter" data-level="2.2.5" data-path="metabolomics.html"><a href="metabolomics.html#rp-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.5</b> RP Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.6" data-path="metabolomics.html"><a href="metabolomics.html#filtering-of-the-raw-data-set"><i class="fa fa-check"></i><b>2.2.6</b> Filtering of the raw data set</a></li>
<li class="chapter" data-level="2.2.7" data-path="metabolomics.html"><a href="metabolomics.html#data-quality-control"><i class="fa fa-check"></i><b>2.2.7</b> Data quality control</a></li>
<li class="chapter" data-level="2.2.8" data-path="metabolomics.html"><a href="metabolomics.html#summary-of-data-processing"><i class="fa fa-check"></i><b>2.2.8</b> Summary of data processing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="metabolomics.html"><a href="metabolomics.html#chromatorgrams"><i class="fa fa-check"></i><b>2.3</b> Chromatorgrams</a></li>
<li class="chapter" data-level="2.4" data-path="metabolomics.html"><a href="metabolomics.html#multivariate-analyses"><i class="fa fa-check"></i><b>2.4</b> Multivariate analyses</a></li>
<li class="chapter" data-level="2.5" data-path="metabolomics.html"><a href="metabolomics.html#vips"><i class="fa fa-check"></i><b>2.5</b> VIPS</a></li>
<li class="chapter" data-level="2.6" data-path="metabolomics.html"><a href="metabolomics.html#metabolites-and-correlations"><i class="fa fa-check"></i><b>2.6</b> Metabolites and correlations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="microbiota.html"><a href="microbiota.html"><i class="fa fa-check"></i><b>3</b> Microbiota</a><ul>
<li class="chapter" data-level="3.1" data-path="microbiota.html"><a href="microbiota.html#otu-table-overview"><i class="fa fa-check"></i><b>3.1</b> OTU table overview</a></li>
<li class="chapter" data-level="3.2" data-path="microbiota.html"><a href="microbiota.html#alpha-diversity"><i class="fa fa-check"></i><b>3.2</b> Alpha diversity</a></li>
<li class="chapter" data-level="3.3" data-path="microbiota.html"><a href="microbiota.html#beta-diversity"><i class="fa fa-check"></i><b>3.3</b> Beta diversity</a></li>
<li class="chapter" data-level="3.4" data-path="microbiota.html"><a href="microbiota.html#EnvMod"><i class="fa fa-check"></i><b>3.4</b> Environmental modelling</a><ul>
<li class="chapter" data-level="3.4.1" data-path="microbiota.html"><a href="microbiota.html#constrained"><i class="fa fa-check"></i><b>3.4.1</b> Constrained modelling approach Automatic stepwise model building</a></li>
<li class="chapter" data-level="3.4.2" data-path="microbiota.html"><a href="microbiota.html#unconstrained"><i class="fa fa-check"></i><b>3.4.2</b> Unconstrained modelling approach</a></li>
<li class="chapter" data-level="3.4.3" data-path="microbiota.html"><a href="microbiota.html#Hclust"><i class="fa fa-check"></i><b>3.4.3</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="3.4.4" data-path="microbiota.html"><a href="microbiota.html#watermasses"><i class="fa fa-check"></i><b>3.4.4</b> Oceanographic setting: water masses</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="microbiota.html"><a href="microbiota.html#relative-abundances"><i class="fa fa-check"></i><b>3.5</b> Relative abundances</a><ul>
<li class="chapter" data-level="3.5.1" data-path="microbiota.html"><a href="microbiota.html#bar-plots"><i class="fa fa-check"></i><b>3.5.1</b> Bar plots</a></li>
<li class="chapter" data-level="3.5.2" data-path="microbiota.html"><a href="microbiota.html#tabular-overview"><i class="fa fa-check"></i><b>3.5.2</b> Tabular overview</a></li>
<li class="chapter" data-level="3.5.3" data-path="microbiota.html"><a href="microbiota.html#statistical-comparison-at-phylum-and-class-level"><i class="fa fa-check"></i><b>3.5.3</b> Statistical comparison at phylum and class level</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="microbiota.html"><a href="microbiota.html#depth-response-otu-perspective"><i class="fa fa-check"></i><b>3.6</b> Depth response: OTU perspective</a></li>
<li class="chapter" data-level="3.7" data-path="microbiota.html"><a href="microbiota.html#sequence-similarity"><i class="fa fa-check"></i><b>3.7</b> Sequence similarity</a></li>
<li class="chapter" data-level="3.8" data-path="microbiota.html"><a href="microbiota.html#annotated-phylogeny"><i class="fa fa-check"></i><b>3.8</b> Annotated phylogeny</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inter-omics.html"><a href="inter-omics.html"><i class="fa fa-check"></i><b>4</b> Inter-omics</a><ul>
<li class="chapter" data-level="4.1" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-and-procrustes-rotations"><i class="fa fa-check"></i><b>4.1</b> Mantel test and procrustes rotations</a><ul>
<li class="chapter" data-level="4.1.1" data-path="inter-omics.html"><a href="inter-omics.html#libraries-and-functions"><i class="fa fa-check"></i><b>4.1.1</b> Libraries and functions</a></li>
<li class="chapter" data-level="4.1.2" data-path="inter-omics.html"><a href="inter-omics.html#data-sets"><i class="fa fa-check"></i><b>4.1.2</b> Data sets</a></li>
<li class="chapter" data-level="4.1.3" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.3</b> Mantel test code and tabular output</a></li>
<li class="chapter" data-level="4.1.4" data-path="inter-omics.html"><a href="inter-omics.html#procrustes-rotation-and-protest-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.4</b> Procrustes rotation and protest code and tabular output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inter-omics.html"><a href="inter-omics.html#correlating-barettin-and-prokaryotic-relative-abundance"><i class="fa fa-check"></i><b>4.2</b> Correlating barettin and prokaryotic relative abundance</a></li>
<li class="chapter" data-level="4.3" data-path="inter-omics.html"><a href="inter-omics.html#microbial-interaction-network"><i class="fa fa-check"></i><b>4.3</b> Microbial interaction network</a><ul>
<li class="chapter" data-level="4.3.1" data-path="inter-omics.html"><a href="inter-omics.html#generating-network-based-on-different-algorithms"><i class="fa fa-check"></i><b>4.3.1</b> Generating network based on different algorithms</a></li>
<li class="chapter" data-level="4.3.2" data-path="inter-omics.html"><a href="inter-omics.html#consolidation-of-the-different-networks"><i class="fa fa-check"></i><b>4.3.2</b> Consolidation of the different networks</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="inter-omics.html"><a href="inter-omics.html#shortlist"><i class="fa fa-check"></i><b>4.4</b> Shortlist</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="funding-disclaimer.html"><a href="funding-disclaimer.html"><i class="fa fa-check"></i><b>5</b> Funding disclaimer</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="metabolomics" class="section level1">
<h1><span class="header-section-number">2</span> Metabolomics</h1>
<div id="experimental-methods-and-detailed-description" class="section level2">
<h2><span class="header-section-number">2.1</span> Experimental methods and detailed description</h2>
<p><strong>Additional sampling notes</strong></p>
<p>During the sampling on the Pâmiut cruises, the sponges remained on deck or in the laboratory for approximately 30–45 min before they were frozen to -20°C. The outside temperature usually oscillated around 4–5°C, and the sorting area was approximately 10°C. The sample consisted of both choanosome and coretx.</p>
<p><strong>Laboratory methods and data acquisition</strong></p>
<p>Metabolites were separated in connection to downstream mass spectrometry (HRMS) analysis using two different chromatographic columns (UPLC): a hydrophilic interaction liquid chromatography (HILIC) column that retains polar compounds, and a reversed-phase (RP) column that favours retention of non-polar compounds. All samples were processed in randomized using glass instruments during the extraction to avoid chemical contamination.</p>
<p><strong>Mass spectrometry analysis</strong></p>
<p>Dried extracts in glass vials were dissolved in 200 µL solvent (HILIC: 50 µL H<sub>2</sub>O and 175 µL acetonitrile AcN; RP: 140 µL H<sub>2</sub>O and 10 µL AcN). Upon addition of the organic solvent for HILIC chromatography, all samples separated into two immiscible layers. The vials were centrifuged for 3 min at 2000 x g to yield an even separation. Only the top layer (approximately 150 µL) was transferred to a Chromacol 03-FISV MS-vial (Thermo Scientific, Waltham, Massachusetts, USA) for MS analyses. For RP chromatography, no layers were observed, and the entire volume of the dissolved sample was used. A five µL aliquot from each individual MS-vial for HILIC and RP, respectively, was combined to produce a quality control (QC) sample.</p>
<p><strong>High resolution MS analysis system and settings</strong></p>
<p>The extracts were analyzed back-to-back in positive and negative ionization mode on an Acquity I-Class Ultra Performance Liquid Chromatography UPLC coupled to a G2S Synapt Q-TOF with an electrospray ionization (ESI) ion source (all Waters Corp., Milford, MA, USA).</p>
<p>Chromatographic separation in HILIC mode was performed on an Acquity UPLC BEH Amide column (1.7 µm, 2.1 mm inner diameter × 50 mm, Waters Corp.). Mobile phase A consisted of 95:5 acetonitrile/MQ water with 5 mM ammonium formate and 0.1 % formic acid (FA), and mobile phase B consisted of 40:60 acetonitrile/MQ water with 5 mM ammonium formate and 0.1 % FA. The gradient elution profile was as follows: mobile phase A was decreased non-linearly (slope factor 8, MassLynx) from 100 % A to 100 % B over 14 min, 100 % B was held for 2 min and then decreased back to 100 % A over 1 min. The column was re-equilibrated at 100 % A for 6 min for a total runtime of 23 min.</p>
<p>Chromatographic separation in RP was performed on an Acquity UPLC BEH C18 column (1.7 µ m, 2.1 mm inner diameter × 50 mm, Waters). Mobile phase A consisted of MQ water with 0.1 % FA, and mobile phase B was AcN with 0.1 % FA. The gradient elution profile started at 95 % A, was decreased linearly over 14 min to 5 % A, and 5 % A was held for 2 min before the column was re-equilibrated at 95 % A for 4 min. The flow rate was set to 0.4 mL/min, the column temperature was set to 40°C, the samples were kept at 8°C and the injection volume was 5 µL in all experiments.</p>
<p><strong>Data acquisition</strong></p>
<p>Data acquisition was performed using MS<sup>E</sup> mode, and lock mass correction was applied using a solution of leucine enkephalin in both positive and negative mode. Ionization parameters were set as follows in positive/negative mode; the capillary voltage was 1kV/1.5 kV, the cone voltage was 30 V/25 V, the source offset was 50/60 and the source temperature was set to 120°C. Nitrogen was used as desolvation and cone gas with gas flows of 800 l/h and 50 l/h, respectively, and desolvation temperature was set to 500°C/450°C. For MS<sup>E</sup> acquisition a collision energy ramp from 20–45 eV was used with argon as collision gas. The instrument was calibrated in the <em>m/z</em> range 50–1500 using sodium formate prior to each analysis.
All study samples were analysed in both RP and HILIC, in positive and negative ionization mode, resulting in four metabolite datasets per sponge specimen. The column and sample cone was cleaned in between each analysis mode. Prior to each analysis ten QC injections were made to condition the column, and to ensure stable retention times and signal intensities. The study samples were analysed in randomized with QC injections interspaced every 6<sup>th</sup> injection.</p>
<p><strong>MS data processing</strong></p>
<p>Raw files were converted to netCDF files by Databridge (part of MassLynx, Waters Corporation, Milford, Massachusetts, USA). The netCDF files with the chromatographic spectra were sorted into folders according to species and processed with XCMS in R. Peak picking was performed using the centWave function with parameters ppm=8, peakwidth set to c(5,45) and the noise parameter set to 2000. Retention time alignment was performed with the obiwarp function and the response factor set to 10, grouping was performed with the “group” function and the “fillPeaks” function was used to impute a signal in cases where no matching pseudospectra were detected.</p>
<p>The data set was curated to remove features eluting in the void (retention time less than 45 s). A raw data set as well as two normalized data sets (Log<sub>10</sub>-transformed and median fold change normalized) were produced and filtered to only retain features with a coefficient of variation &lt; 30% in the QC samples. After subsequent evaluation, raw data sets were used in subsequent statistics and modelling.</p>
<p>An overview of the number of features and PC groups annotated by CAMERA, as well as their exclusion is given in a table at the end of this document.</p>
</div>
<div id="data-processing" class="section level2">
<h2><span class="header-section-number">2.2</span> Data processing</h2>
<div id="peak-picking-with-xcms-and-annotation-with-camera" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Peak picking with XCMS and annotation with CAMERA</h3>
<p>We processed samples from all three sponnge species in random with interspersed injection of a combined QC sample to monitor stability of the UPLC-HRMS run. The acquired signals/spectra were converted to netCDF format using the Program DataBridge, and thereafter sorted into four folders, three for the sponge species (Gb, Sf, Wb) and one for the QC samples (QC). Peak picking and combination of pseudospectra is performed with the R package xcms, the subsequent annotation of adducts and isotopes with the R package CAMERA.</p>
</div>
<div id="hilic-hydrophilic-interaction-chromatography-column-with-positive-esi-electron-spray-ionisation" class="section level3">
<h3><span class="header-section-number">2.2.2</span> HILIC (Hydrophilic interaction chromatography) column with positive ESI (electron spray ionisation)</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="metabolomics.html#cb20-1"></a><span class="co"># HILIC POS ALWAYS CHECK DATE, CHROMATOGRAPHIC CLOUMN (HILIC, RP) AND ESI-MODE (naming, CAMERA: pos, neg)</span></span>
<span id="cb20-2"><a href="metabolomics.html#cb20-2"></a></span>
<span id="cb20-3"><a href="metabolomics.html#cb20-3"></a><span class="co"># setwd() # work in directory containing the sorted CDF files. getwd()</span></span>
<span id="cb20-4"><a href="metabolomics.html#cb20-4"></a><span class="kw">library</span>(xcms)</span>
<span id="cb20-5"><a href="metabolomics.html#cb20-5"></a>xset &lt;-<span class="st"> </span><span class="kw">xcmsSet</span>(<span class="dt">method =</span> <span class="st">&quot;centWave&quot;</span>, <span class="dt">ppm =</span> <span class="dv">8</span>, <span class="dt">peakwidth =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">45</span>), <span class="dt">noise =</span> <span class="dv">2000</span>)</span>
<span id="cb20-6"><a href="metabolomics.html#cb20-6"></a><span class="kw">save</span>(xset, <span class="dt">file =</span> <span class="st">&quot;HILIC_pos_xset_20190417.Rda&quot;</span>)</span>
<span id="cb20-7"><a href="metabolomics.html#cb20-7"></a><span class="co"># load(file=&#39;HILIC_pos_xset_20190417.Rda&#39;) #When resuming after a break</span></span>
<span id="cb20-8"><a href="metabolomics.html#cb20-8"></a>xset &lt;-<span class="st"> </span><span class="kw">group</span>(xset)</span>
<span id="cb20-9"><a href="metabolomics.html#cb20-9"></a>xset2 &lt;-<span class="st"> </span><span class="kw">retcor</span>(xset, <span class="dt">method =</span> <span class="st">&quot;obiwarp&quot;</span>, <span class="dt">response =</span> <span class="dv">10</span>, <span class="dt">plottype =</span> <span class="st">&quot;deviation&quot;</span>)</span>
<span id="cb20-10"><a href="metabolomics.html#cb20-10"></a>xset2 &lt;-<span class="st"> </span><span class="kw">group</span>(xset2)</span>
<span id="cb20-11"><a href="metabolomics.html#cb20-11"></a>xset3 &lt;-<span class="st"> </span><span class="kw">fillPeaks</span>(xset2)</span>
<span id="cb20-12"><a href="metabolomics.html#cb20-12"></a><span class="kw">save</span>(xset3, <span class="dt">file =</span> <span class="st">&quot;HILIC_pos_xset3_20190417.Rda&quot;</span>)</span>
<span id="cb20-13"><a href="metabolomics.html#cb20-13"></a>reporttab &lt;-<span class="st"> </span><span class="kw">diffreport</span>(xset3, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Gb_Sf_HILIC_pos_20190417&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb20-14"><a href="metabolomics.html#cb20-14"></a></span>
<span id="cb20-15"><a href="metabolomics.html#cb20-15"></a><span class="kw">library</span>(CAMERA)</span>
<span id="cb20-16"><a href="metabolomics.html#cb20-16"></a>xsa &lt;-<span class="st"> </span><span class="kw">xsAnnotate</span>(xset3)</span>
<span id="cb20-17"><a href="metabolomics.html#cb20-17"></a>xsaF &lt;-<span class="st"> </span><span class="kw">groupFWHM</span>(xsa, <span class="dt">perfwhm =</span> <span class="fl">0.3</span>)</span>
<span id="cb20-18"><a href="metabolomics.html#cb20-18"></a>xsaC &lt;-<span class="st"> </span><span class="kw">groupCorr</span>(xsaF, <span class="dt">cor_eic_th =</span> <span class="fl">0.7</span>)</span>
<span id="cb20-19"><a href="metabolomics.html#cb20-19"></a>xsaFI &lt;-<span class="st"> </span><span class="kw">findIsotopes</span>(xsaC)</span>
<span id="cb20-20"><a href="metabolomics.html#cb20-20"></a>rules &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/rules_jan_pos.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb20-21"><a href="metabolomics.html#cb20-21"></a>xsaFA &lt;-<span class="st"> </span><span class="kw">findAdducts</span>(xsaFI, <span class="dt">polarity =</span> <span class="st">&quot;positive&quot;</span>, <span class="dt">rules =</span> rules)</span>
<span id="cb20-22"><a href="metabolomics.html#cb20-22"></a><span class="co"># write.csv(getPeaklist(xsaFA), file=&#39;HILIC_pos_20190417.csv&#39;)</span></span></code></pre></div>
<p>The other data experiments, HILIC with negative ESI and RP with positive and negative ESI are processed accordingly.</p>
</div>
<div id="hilic-chromatography-with-negative-esi" class="section level3">
<h3><span class="header-section-number">2.2.3</span> HILIC Chromatography with negative ESI</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="metabolomics.html#cb21-1"></a><span class="co"># HILIC NEG 20190421</span></span>
<span id="cb21-2"><a href="metabolomics.html#cb21-2"></a></span>
<span id="cb21-3"><a href="metabolomics.html#cb21-3"></a><span class="co"># setwd() # work in directory containing the sorted CDF files. getwd()</span></span>
<span id="cb21-4"><a href="metabolomics.html#cb21-4"></a><span class="kw">library</span>(xcms)</span>
<span id="cb21-5"><a href="metabolomics.html#cb21-5"></a>xset &lt;-<span class="st"> </span><span class="kw">xcmsSet</span>(<span class="dt">method =</span> <span class="st">&quot;centWave&quot;</span>, <span class="dt">ppm =</span> <span class="dv">8</span>, <span class="dt">peakwidth =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">45</span>), <span class="dt">noise =</span> <span class="dv">2000</span>)</span>
<span id="cb21-6"><a href="metabolomics.html#cb21-6"></a><span class="kw">save</span>(xset, <span class="dt">file =</span> <span class="st">&quot;HILIC_neg_xset_20190421.Rda&quot;</span>)</span>
<span id="cb21-7"><a href="metabolomics.html#cb21-7"></a><span class="co"># load(file=&#39;HILIC_neg_xset_20190421.Rda&#39;) #When resuming after a break</span></span>
<span id="cb21-8"><a href="metabolomics.html#cb21-8"></a>xset &lt;-<span class="st"> </span><span class="kw">group</span>(xset)</span>
<span id="cb21-9"><a href="metabolomics.html#cb21-9"></a>xset2 &lt;-<span class="st"> </span><span class="kw">retcor</span>(xset, <span class="dt">method =</span> <span class="st">&quot;obiwarp&quot;</span>, <span class="dt">response =</span> <span class="dv">10</span>, <span class="dt">plottype =</span> <span class="st">&quot;deviation&quot;</span>)</span>
<span id="cb21-10"><a href="metabolomics.html#cb21-10"></a>xset2 &lt;-<span class="st"> </span><span class="kw">group</span>(xset2)</span>
<span id="cb21-11"><a href="metabolomics.html#cb21-11"></a>xset3 &lt;-<span class="st"> </span><span class="kw">fillPeaks</span>(xset2)</span>
<span id="cb21-12"><a href="metabolomics.html#cb21-12"></a><span class="kw">save</span>(xset3, <span class="dt">file =</span> <span class="st">&quot;HILIC_neg_xset3_20190421.Rda&quot;</span>)</span>
<span id="cb21-13"><a href="metabolomics.html#cb21-13"></a>reporttab &lt;-<span class="st"> </span><span class="kw">diffreport</span>(xset3, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Gb_Sf_HILIC_neg_20190421&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb21-14"><a href="metabolomics.html#cb21-14"></a></span>
<span id="cb21-15"><a href="metabolomics.html#cb21-15"></a><span class="kw">library</span>(CAMERA)</span>
<span id="cb21-16"><a href="metabolomics.html#cb21-16"></a>xsa &lt;-<span class="st"> </span><span class="kw">xsAnnotate</span>(xset3)</span>
<span id="cb21-17"><a href="metabolomics.html#cb21-17"></a>xsaF &lt;-<span class="st"> </span><span class="kw">groupFWHM</span>(xsa, <span class="dt">perfwhm =</span> <span class="fl">0.3</span>)</span>
<span id="cb21-18"><a href="metabolomics.html#cb21-18"></a>xsaC &lt;-<span class="st"> </span><span class="kw">groupCorr</span>(xsaF, <span class="dt">cor_eic_th =</span> <span class="fl">0.7</span>)</span>
<span id="cb21-19"><a href="metabolomics.html#cb21-19"></a>xsaFI &lt;-<span class="st"> </span><span class="kw">findIsotopes</span>(xsaC)</span>
<span id="cb21-20"><a href="metabolomics.html#cb21-20"></a>rules &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/rules_jan_neg.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb21-21"><a href="metabolomics.html#cb21-21"></a>xsaFA &lt;-<span class="st"> </span><span class="kw">findAdducts</span>(xsaFI, <span class="dt">polarity =</span> <span class="st">&quot;negative&quot;</span>, <span class="dt">rules =</span> rules)</span>
<span id="cb21-22"><a href="metabolomics.html#cb21-22"></a><span class="co"># write.csv(getPeaklist(xsaFA), file=&#39;HILIC_neg_20190421.csv&#39;)</span></span></code></pre></div>
</div>
<div id="rp-reversed-phase-chromatography-with-positive-esi" class="section level3">
<h3><span class="header-section-number">2.2.4</span> RP (Reversed phase) Chromatography with positive ESI</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="metabolomics.html#cb22-1"></a><span class="co"># RP POS 20190421</span></span>
<span id="cb22-2"><a href="metabolomics.html#cb22-2"></a></span>
<span id="cb22-3"><a href="metabolomics.html#cb22-3"></a><span class="co"># setwd() # work in directory containing the sorted CDF files. getwd()</span></span>
<span id="cb22-4"><a href="metabolomics.html#cb22-4"></a><span class="kw">library</span>(xcms)</span>
<span id="cb22-5"><a href="metabolomics.html#cb22-5"></a>xset &lt;-<span class="st"> </span><span class="kw">xcmsSet</span>(<span class="dt">method =</span> <span class="st">&quot;centWave&quot;</span>, <span class="dt">ppm =</span> <span class="dv">8</span>, <span class="dt">peakwidth =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">45</span>), <span class="dt">noise =</span> <span class="dv">2000</span>)</span>
<span id="cb22-6"><a href="metabolomics.html#cb22-6"></a><span class="kw">save</span>(xset, <span class="dt">file =</span> <span class="st">&quot;RP_pos_xset_20190421.Rda&quot;</span>)</span>
<span id="cb22-7"><a href="metabolomics.html#cb22-7"></a><span class="co"># load(file=&#39;RP_pos_xset_20190421.Rda&#39;) #When resuming after a break</span></span>
<span id="cb22-8"><a href="metabolomics.html#cb22-8"></a>xset &lt;-<span class="st"> </span><span class="kw">group</span>(xset)</span>
<span id="cb22-9"><a href="metabolomics.html#cb22-9"></a>xset2 &lt;-<span class="st"> </span><span class="kw">retcor</span>(xset, <span class="dt">method =</span> <span class="st">&quot;obiwarp&quot;</span>, <span class="dt">response =</span> <span class="dv">10</span>, <span class="dt">plottype =</span> <span class="st">&quot;deviation&quot;</span>)</span>
<span id="cb22-10"><a href="metabolomics.html#cb22-10"></a>xset2 &lt;-<span class="st"> </span><span class="kw">group</span>(xset2)</span>
<span id="cb22-11"><a href="metabolomics.html#cb22-11"></a>xset3 &lt;-<span class="st"> </span><span class="kw">fillPeaks</span>(xset2)</span>
<span id="cb22-12"><a href="metabolomics.html#cb22-12"></a><span class="kw">save</span>(xset3, <span class="dt">file =</span> <span class="st">&quot;RP_pos_xset3_20190421.Rda&quot;</span>)</span>
<span id="cb22-13"><a href="metabolomics.html#cb22-13"></a>reporttab &lt;-<span class="st"> </span><span class="kw">diffreport</span>(xset3, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Gb_Sf_RP_pos_20190421&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb22-14"><a href="metabolomics.html#cb22-14"></a></span>
<span id="cb22-15"><a href="metabolomics.html#cb22-15"></a><span class="kw">library</span>(CAMERA)</span>
<span id="cb22-16"><a href="metabolomics.html#cb22-16"></a>xsa &lt;-<span class="st"> </span><span class="kw">xsAnnotate</span>(xset3)</span>
<span id="cb22-17"><a href="metabolomics.html#cb22-17"></a>xsaF &lt;-<span class="st"> </span><span class="kw">groupFWHM</span>(xsa, <span class="dt">perfwhm =</span> <span class="fl">0.3</span>)</span>
<span id="cb22-18"><a href="metabolomics.html#cb22-18"></a>xsaC &lt;-<span class="st"> </span><span class="kw">groupCorr</span>(xsaF, <span class="dt">cor_eic_th =</span> <span class="fl">0.7</span>)</span>
<span id="cb22-19"><a href="metabolomics.html#cb22-19"></a>xsaFI &lt;-<span class="st"> </span><span class="kw">findIsotopes</span>(xsaC)</span>
<span id="cb22-20"><a href="metabolomics.html#cb22-20"></a>rules &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/rules_jan_pos.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb22-21"><a href="metabolomics.html#cb22-21"></a>xsaFA &lt;-<span class="st"> </span><span class="kw">findAdducts</span>(xsaFI, <span class="dt">polarity =</span> <span class="st">&quot;positive&quot;</span>, <span class="dt">rules =</span> rules)</span>
<span id="cb22-22"><a href="metabolomics.html#cb22-22"></a><span class="co"># write.csv(getPeaklist(xsaFA), file=&#39;RP_pos_20190421.csv&#39;)</span></span></code></pre></div>
</div>
<div id="rp-chromatography-with-negative-esi" class="section level3">
<h3><span class="header-section-number">2.2.5</span> RP Chromatography with negative ESI</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="metabolomics.html#cb23-1"></a><span class="co"># RP NEG 20190422</span></span>
<span id="cb23-2"><a href="metabolomics.html#cb23-2"></a></span>
<span id="cb23-3"><a href="metabolomics.html#cb23-3"></a><span class="co"># setwd() # work in directory containing the sorted CDF files. getwd()</span></span>
<span id="cb23-4"><a href="metabolomics.html#cb23-4"></a><span class="kw">library</span>(xcms)</span>
<span id="cb23-5"><a href="metabolomics.html#cb23-5"></a>xset &lt;-<span class="st"> </span><span class="kw">xcmsSet</span>(<span class="dt">method =</span> <span class="st">&quot;centWave&quot;</span>, <span class="dt">ppm =</span> <span class="dv">8</span>, <span class="dt">peakwidth =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">45</span>), <span class="dt">noise =</span> <span class="dv">2000</span>)</span>
<span id="cb23-6"><a href="metabolomics.html#cb23-6"></a><span class="kw">save</span>(xset, <span class="dt">file =</span> <span class="st">&quot;RP_neg_xset_20190422.Rda&quot;</span>)</span>
<span id="cb23-7"><a href="metabolomics.html#cb23-7"></a><span class="co"># load(file=&#39;RP_neg_xset_20190422.Rda&#39;) #When resuming after a break</span></span>
<span id="cb23-8"><a href="metabolomics.html#cb23-8"></a>xset &lt;-<span class="st"> </span><span class="kw">group</span>(xset)</span>
<span id="cb23-9"><a href="metabolomics.html#cb23-9"></a>xset2 &lt;-<span class="st"> </span><span class="kw">retcor</span>(xset, <span class="dt">method =</span> <span class="st">&quot;obiwarp&quot;</span>, <span class="dt">response =</span> <span class="dv">10</span>, <span class="dt">plottype =</span> <span class="st">&quot;deviation&quot;</span>)</span>
<span id="cb23-10"><a href="metabolomics.html#cb23-10"></a>xset2 &lt;-<span class="st"> </span><span class="kw">group</span>(xset2)</span>
<span id="cb23-11"><a href="metabolomics.html#cb23-11"></a>xset3 &lt;-<span class="st"> </span><span class="kw">fillPeaks</span>(xset2)</span>
<span id="cb23-12"><a href="metabolomics.html#cb23-12"></a><span class="kw">save</span>(xset3, <span class="dt">file =</span> <span class="st">&quot;RP_neg_xset3_20190422.Rda&quot;</span>)</span>
<span id="cb23-13"><a href="metabolomics.html#cb23-13"></a>reporttab &lt;-<span class="st"> </span><span class="kw">diffreport</span>(xset3, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Gb_Sf_RP_neg_20190422&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb23-14"><a href="metabolomics.html#cb23-14"></a></span>
<span id="cb23-15"><a href="metabolomics.html#cb23-15"></a><span class="kw">library</span>(CAMERA)</span>
<span id="cb23-16"><a href="metabolomics.html#cb23-16"></a>xsa &lt;-<span class="st"> </span><span class="kw">xsAnnotate</span>(xset3)</span>
<span id="cb23-17"><a href="metabolomics.html#cb23-17"></a>xsaF &lt;-<span class="st"> </span><span class="kw">groupFWHM</span>(xsa, <span class="dt">perfwhm =</span> <span class="fl">0.3</span>)</span>
<span id="cb23-18"><a href="metabolomics.html#cb23-18"></a>xsaC &lt;-<span class="st"> </span><span class="kw">groupCorr</span>(xsaF, <span class="dt">cor_eic_th =</span> <span class="fl">0.7</span>)</span>
<span id="cb23-19"><a href="metabolomics.html#cb23-19"></a>xsaFI &lt;-<span class="st"> </span><span class="kw">findIsotopes</span>(xsaC)</span>
<span id="cb23-20"><a href="metabolomics.html#cb23-20"></a>rules &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/rules_jan_neg.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb23-21"><a href="metabolomics.html#cb23-21"></a>xsaFA &lt;-<span class="st"> </span><span class="kw">findAdducts</span>(xsaFI, <span class="dt">polarity =</span> <span class="st">&quot;negative&quot;</span>, <span class="dt">rules =</span> rules)</span>
<span id="cb23-22"><a href="metabolomics.html#cb23-22"></a><span class="co"># write.csv(getPeaklist(xsaFA), file=&#39;RP_neg_20190422.csv&#39;)</span></span></code></pre></div>
</div>
<div id="filtering-of-the-raw-data-set" class="section level3">
<h3><span class="header-section-number">2.2.6</span> Filtering of the raw data set</h3>
<p>Features with following properties were removed:</p>
<ul>
<li>Eluting in the void (RT &lt; 45 s)</li>
<li>CV&gt;30 % in QC samples</li>
<li>Adducts as annotated by CAMERA</li>
</ul>
<p>As the presence of the same parent feature in the the form of isotopes and adducts distorts downstream global metabolome analyses, we generated two versions of curated or selective feature tables. In both, void and unstably measured features are removed (“cleaned”). One retains only the feature with the largest signal per pc group (“cleaned_pcgroup”), the other is more stringent and only contains explicitly annotated parent ions (“cleaned_MH”), i.e. [M+H]+ for positive ESI and [M-H]- for negative ESI acquired data.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="metabolomics.html#cb24-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb24-2"><a href="metabolomics.html#cb24-2"></a></span>
<span id="cb24-3"><a href="metabolomics.html#cb24-3"></a><span class="co"># ================================ HILIC pos ===================================</span></span>
<span id="cb24-4"><a href="metabolomics.html#cb24-4"></a>raw_peaks &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_pos_20190417.csv&quot;</span>)</span>
<span id="cb24-5"><a href="metabolomics.html#cb24-5"></a>hp_dim1 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-6"><a href="metabolomics.html#cb24-6"></a>hp_pcg1 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-7"><a href="metabolomics.html#cb24-7"></a></span>
<span id="cb24-8"><a href="metabolomics.html#cb24-8"></a><span class="co"># Removing features eluting in the void</span></span>
<span id="cb24-9"><a href="metabolomics.html#cb24-9"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>rt <span class="op">&gt;</span><span class="st"> </span><span class="dv">45</span>, ]</span>
<span id="cb24-10"><a href="metabolomics.html#cb24-10"></a>hp_dim2 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-11"><a href="metabolomics.html#cb24-11"></a>hp_pcg2 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-12"><a href="metabolomics.html#cb24-12"></a></span>
<span id="cb24-13"><a href="metabolomics.html#cb24-13"></a><span class="co"># Removing features with a CV &lt; 30%</span></span>
<span id="cb24-14"><a href="metabolomics.html#cb24-14"></a>f &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20170918_02001&quot;</span>)  <span class="co"># first QC HILIC pos</span></span>
<span id="cb24-15"><a href="metabolomics.html#cb24-15"></a>l &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20170918_07601&quot;</span>)  <span class="co"># last QC HILIC pos</span></span>
<span id="cb24-16"><a href="metabolomics.html#cb24-16"></a>raw_peaks[<span class="st">&quot;SD&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, sd)</span>
<span id="cb24-17"><a href="metabolomics.html#cb24-17"></a>raw_peaks[<span class="st">&quot;MEAN&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, mean)</span>
<span id="cb24-18"><a href="metabolomics.html#cb24-18"></a>raw_peaks[<span class="st">&quot;CV&quot;</span>] &lt;-<span class="st"> </span>raw_peaks<span class="op">$</span>SD<span class="op">/</span>raw_peaks<span class="op">$</span>MEAN</span>
<span id="cb24-19"><a href="metabolomics.html#cb24-19"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>CV <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.3</span>, ]</span>
<span id="cb24-20"><a href="metabolomics.html#cb24-20"></a>hp_dim3 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-21"><a href="metabolomics.html#cb24-21"></a>hp_pcg3 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-22"><a href="metabolomics.html#cb24-22"></a><span class="co"># write.csv(raw_peaks, &#39;HILIC_pos_20190417_cleaned.csv&#39;)</span></span>
<span id="cb24-23"><a href="metabolomics.html#cb24-23"></a></span>
<span id="cb24-24"><a href="metabolomics.html#cb24-24"></a><span class="co"># Keep only the feature with the greatest sum of signal per pc group</span></span>
<span id="cb24-25"><a href="metabolomics.html#cb24-25"></a>l &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">6</span></span>
<span id="cb24-26"><a href="metabolomics.html#cb24-26"></a>raw_peaks[<span class="st">&quot;fss&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, <span class="dv">13</span><span class="op">:</span>l], <span class="dv">1</span>, sum)  <span class="co">#feature signal sum</span></span>
<span id="cb24-27"><a href="metabolomics.html#cb24-27"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[<span class="kw">order</span>(raw_peaks<span class="op">$</span>pcgroup, <span class="op">-</span>raw_peaks<span class="op">$</span>fss), ]</span>
<span id="cb24-28"><a href="metabolomics.html#cb24-28"></a><span class="co"># for every pc group, the first line has the strongest signal. The function distinct() [dplyr package] can be used to keep only unique/distinct rows from a</span></span>
<span id="cb24-29"><a href="metabolomics.html#cb24-29"></a><span class="co"># data frame. If there are duplicate rows, _only the first row_ is preserved.</span></span>
<span id="cb24-30"><a href="metabolomics.html#cb24-30"></a>selected_peaks &lt;-<span class="st"> </span><span class="kw">distinct</span>(raw_peaks, raw_peaks<span class="op">$</span>pcgroup, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-31"><a href="metabolomics.html#cb24-31"></a>hp_dim4 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-32"><a href="metabolomics.html#cb24-32"></a>hp_pcg4 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-33"><a href="metabolomics.html#cb24-33"></a><span class="co"># write.csv(selected_peaks, &#39;HILIC_pos_20190417_cleaned_pcgroup.csv&#39;)</span></span>
<span id="cb24-34"><a href="metabolomics.html#cb24-34"></a><span class="kw">rm</span>(selected_peaks)</span>
<span id="cb24-35"><a href="metabolomics.html#cb24-35"></a></span>
<span id="cb24-36"><a href="metabolomics.html#cb24-36"></a><span class="co"># Keep only features with explicit annotations of [M+H]+</span></span>
<span id="cb24-37"><a href="metabolomics.html#cb24-37"></a><span class="kw">library</span>(stringr)</span>
<span id="cb24-38"><a href="metabolomics.html#cb24-38"></a>raw_peaks[<span class="st">&quot;[M+H]+&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb24-39"><a href="metabolomics.html#cb24-39"></a>pattern &lt;-<span class="st"> &quot;[M+H]+&quot;</span></span>
<span id="cb24-40"><a href="metabolomics.html#cb24-40"></a>raw_peaks[<span class="st">&quot;[M+H]+&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_detect</span>(raw_peaks<span class="op">$</span>adduct, <span class="kw">paste0</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">Q&quot;</span>, pattern, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">E&quot;</span>))</span>
<span id="cb24-41"><a href="metabolomics.html#cb24-41"></a>selected_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span><span class="st">`</span><span class="dt">[M+H]+</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>, ]</span>
<span id="cb24-42"><a href="metabolomics.html#cb24-42"></a>hp_dim5 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-43"><a href="metabolomics.html#cb24-43"></a>hp_pcg5 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-44"><a href="metabolomics.html#cb24-44"></a><span class="co"># write.csv(selected_peaks, &#39;HILIC_pos_20190417_cleaned_MH.csv&#39;)</span></span>
<span id="cb24-45"><a href="metabolomics.html#cb24-45"></a></span>
<span id="cb24-46"><a href="metabolomics.html#cb24-46"></a>hilic_pos &lt;-<span class="st"> </span>raw_peaks</span>
<span id="cb24-47"><a href="metabolomics.html#cb24-47"></a><span class="kw">rm</span>(f, l, raw_peaks, selected_peaks)</span>
<span id="cb24-48"><a href="metabolomics.html#cb24-48"></a></span>
<span id="cb24-49"><a href="metabolomics.html#cb24-49"></a><span class="co"># ================================ HILIC neg ===================================</span></span>
<span id="cb24-50"><a href="metabolomics.html#cb24-50"></a>raw_peaks &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_neg_20190421.csv&quot;</span>)</span>
<span id="cb24-51"><a href="metabolomics.html#cb24-51"></a>hn_dim1 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-52"><a href="metabolomics.html#cb24-52"></a>hn_pcg1 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-53"><a href="metabolomics.html#cb24-53"></a></span>
<span id="cb24-54"><a href="metabolomics.html#cb24-54"></a><span class="co"># Removing features eluting in the void</span></span>
<span id="cb24-55"><a href="metabolomics.html#cb24-55"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>rt <span class="op">&gt;</span><span class="st"> </span><span class="dv">45</span>, ]</span>
<span id="cb24-56"><a href="metabolomics.html#cb24-56"></a>hn_dim2 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-57"><a href="metabolomics.html#cb24-57"></a>hn_pcg2 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-58"><a href="metabolomics.html#cb24-58"></a></span>
<span id="cb24-59"><a href="metabolomics.html#cb24-59"></a><span class="co"># Removing features with a CV &lt; 30%</span></span>
<span id="cb24-60"><a href="metabolomics.html#cb24-60"></a>f &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20170919_01301&quot;</span>)  <span class="co"># first QC HILIC neg</span></span>
<span id="cb24-61"><a href="metabolomics.html#cb24-61"></a>l &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20170919_06901&quot;</span>)  <span class="co"># last QC HILIC neg</span></span>
<span id="cb24-62"><a href="metabolomics.html#cb24-62"></a>raw_peaks[<span class="st">&quot;SD&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, sd)</span>
<span id="cb24-63"><a href="metabolomics.html#cb24-63"></a>raw_peaks[<span class="st">&quot;MEAN&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, mean)</span>
<span id="cb24-64"><a href="metabolomics.html#cb24-64"></a>raw_peaks[<span class="st">&quot;CV&quot;</span>] &lt;-<span class="st"> </span>raw_peaks<span class="op">$</span>SD<span class="op">/</span>raw_peaks<span class="op">$</span>MEAN</span>
<span id="cb24-65"><a href="metabolomics.html#cb24-65"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>CV <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.3</span>, ]</span>
<span id="cb24-66"><a href="metabolomics.html#cb24-66"></a>hn_dim3 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-67"><a href="metabolomics.html#cb24-67"></a>hn_pcg3 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-68"><a href="metabolomics.html#cb24-68"></a><span class="co"># write.csv(raw_peaks, &#39;HILIC_neg_20190421_cleaned.csv&#39;)</span></span>
<span id="cb24-69"><a href="metabolomics.html#cb24-69"></a></span>
<span id="cb24-70"><a href="metabolomics.html#cb24-70"></a><span class="co"># Keep only the feature with the greatest sum of signal per pc group</span></span>
<span id="cb24-71"><a href="metabolomics.html#cb24-71"></a>l &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">6</span></span>
<span id="cb24-72"><a href="metabolomics.html#cb24-72"></a>raw_peaks[<span class="st">&quot;fss&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, <span class="dv">13</span><span class="op">:</span>l], <span class="dv">1</span>, sum)  <span class="co">#feature signal sum</span></span>
<span id="cb24-73"><a href="metabolomics.html#cb24-73"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[<span class="kw">order</span>(raw_peaks<span class="op">$</span>pcgroup, <span class="op">-</span>raw_peaks<span class="op">$</span>fss), ]</span>
<span id="cb24-74"><a href="metabolomics.html#cb24-74"></a>selected_peaks &lt;-<span class="st"> </span><span class="kw">distinct</span>(raw_peaks, raw_peaks<span class="op">$</span>pcgroup, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-75"><a href="metabolomics.html#cb24-75"></a>hn_dim4 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-76"><a href="metabolomics.html#cb24-76"></a>hn_pcg4 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-77"><a href="metabolomics.html#cb24-77"></a><span class="co"># write.csv(selected_peaks, &#39;HILIC_neg_20190421_cleaned_pcgroup.csv&#39;)</span></span>
<span id="cb24-78"><a href="metabolomics.html#cb24-78"></a><span class="kw">rm</span>(selected_peaks)</span>
<span id="cb24-79"><a href="metabolomics.html#cb24-79"></a></span>
<span id="cb24-80"><a href="metabolomics.html#cb24-80"></a><span class="co"># Keep only features with explicit annotations of [M-H]-</span></span>
<span id="cb24-81"><a href="metabolomics.html#cb24-81"></a><span class="kw">library</span>(stringr)</span>
<span id="cb24-82"><a href="metabolomics.html#cb24-82"></a>raw_peaks[<span class="st">&quot;[M-H]-&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb24-83"><a href="metabolomics.html#cb24-83"></a>pattern &lt;-<span class="st"> &quot;[M-H]-&quot;</span></span>
<span id="cb24-84"><a href="metabolomics.html#cb24-84"></a>raw_peaks[<span class="st">&quot;[M-H]-&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_detect</span>(raw_peaks<span class="op">$</span>adduct, <span class="kw">paste0</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">Q&quot;</span>, pattern, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">E&quot;</span>))</span>
<span id="cb24-85"><a href="metabolomics.html#cb24-85"></a>selected_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span><span class="st">`</span><span class="dt">[M-H]-</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>, ]</span>
<span id="cb24-86"><a href="metabolomics.html#cb24-86"></a>hn_dim5 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-87"><a href="metabolomics.html#cb24-87"></a>hn_pcg5 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-88"><a href="metabolomics.html#cb24-88"></a><span class="co"># write.csv(selected_peaks, &#39;HILIC_neg_20190421_cleaned_MH.csv&#39;)</span></span>
<span id="cb24-89"><a href="metabolomics.html#cb24-89"></a></span>
<span id="cb24-90"><a href="metabolomics.html#cb24-90"></a>hilic_neg &lt;-<span class="st"> </span>raw_peaks</span>
<span id="cb24-91"><a href="metabolomics.html#cb24-91"></a><span class="kw">rm</span>(f, l, raw_peaks)</span>
<span id="cb24-92"><a href="metabolomics.html#cb24-92"></a></span>
<span id="cb24-93"><a href="metabolomics.html#cb24-93"></a><span class="co"># ================================== RP pos ====================================</span></span>
<span id="cb24-94"><a href="metabolomics.html#cb24-94"></a>raw_peaks &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_pos_20190421.csv&quot;</span>)</span>
<span id="cb24-95"><a href="metabolomics.html#cb24-95"></a>rp_dim1 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-96"><a href="metabolomics.html#cb24-96"></a>rp_pcg1 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-97"><a href="metabolomics.html#cb24-97"></a></span>
<span id="cb24-98"><a href="metabolomics.html#cb24-98"></a><span class="co"># Removing features eluting in the void</span></span>
<span id="cb24-99"><a href="metabolomics.html#cb24-99"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>rt <span class="op">&gt;</span><span class="st"> </span><span class="dv">45</span>, ]</span>
<span id="cb24-100"><a href="metabolomics.html#cb24-100"></a>rp_dim2 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-101"><a href="metabolomics.html#cb24-101"></a>rp_pcg2 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-102"><a href="metabolomics.html#cb24-102"></a></span>
<span id="cb24-103"><a href="metabolomics.html#cb24-103"></a><span class="co"># Removing features with a CV &lt; 30%</span></span>
<span id="cb24-104"><a href="metabolomics.html#cb24-104"></a>f &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20171002_01401&quot;</span>)  <span class="co"># first QC RP neg</span></span>
<span id="cb24-105"><a href="metabolomics.html#cb24-105"></a>l &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20171002_07201&quot;</span>)  <span class="co"># last QC RP neg</span></span>
<span id="cb24-106"><a href="metabolomics.html#cb24-106"></a>raw_peaks[<span class="st">&quot;SD&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, sd)</span>
<span id="cb24-107"><a href="metabolomics.html#cb24-107"></a>raw_peaks[<span class="st">&quot;MEAN&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, mean)</span>
<span id="cb24-108"><a href="metabolomics.html#cb24-108"></a>raw_peaks[<span class="st">&quot;CV&quot;</span>] &lt;-<span class="st"> </span>raw_peaks<span class="op">$</span>SD<span class="op">/</span>raw_peaks<span class="op">$</span>MEAN</span>
<span id="cb24-109"><a href="metabolomics.html#cb24-109"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>CV <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.3</span>, ]</span>
<span id="cb24-110"><a href="metabolomics.html#cb24-110"></a>rp_dim3 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-111"><a href="metabolomics.html#cb24-111"></a>rp_pcg3 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-112"><a href="metabolomics.html#cb24-112"></a><span class="co"># write.csv(raw_peaks, &#39;RP_pos_20190421_cleaned.csv&#39;)</span></span>
<span id="cb24-113"><a href="metabolomics.html#cb24-113"></a></span>
<span id="cb24-114"><a href="metabolomics.html#cb24-114"></a><span class="co"># Keep only the feature with the greatest sum of signal per pc group</span></span>
<span id="cb24-115"><a href="metabolomics.html#cb24-115"></a>l &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">6</span></span>
<span id="cb24-116"><a href="metabolomics.html#cb24-116"></a>raw_peaks[<span class="st">&quot;fss&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, <span class="dv">13</span><span class="op">:</span>l], <span class="dv">1</span>, sum)  <span class="co">#feature signal sum</span></span>
<span id="cb24-117"><a href="metabolomics.html#cb24-117"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[<span class="kw">order</span>(raw_peaks<span class="op">$</span>pcgroup, <span class="op">-</span>raw_peaks<span class="op">$</span>fss), ]</span>
<span id="cb24-118"><a href="metabolomics.html#cb24-118"></a>selected_peaks &lt;-<span class="st"> </span><span class="kw">distinct</span>(raw_peaks, raw_peaks<span class="op">$</span>pcgroup, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-119"><a href="metabolomics.html#cb24-119"></a>rp_dim4 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-120"><a href="metabolomics.html#cb24-120"></a>rp_pcg4 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-121"><a href="metabolomics.html#cb24-121"></a><span class="co"># write.csv(selected_peaks, &#39;RP_pos_20190421_cleaned_pcgroup.csv&#39;)</span></span>
<span id="cb24-122"><a href="metabolomics.html#cb24-122"></a><span class="kw">rm</span>(selected_peaks)</span>
<span id="cb24-123"><a href="metabolomics.html#cb24-123"></a></span>
<span id="cb24-124"><a href="metabolomics.html#cb24-124"></a><span class="co"># Keep only features with explicit annotations of [M+H]+</span></span>
<span id="cb24-125"><a href="metabolomics.html#cb24-125"></a><span class="kw">library</span>(stringr)</span>
<span id="cb24-126"><a href="metabolomics.html#cb24-126"></a>raw_peaks[<span class="st">&quot;[M+H]+&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb24-127"><a href="metabolomics.html#cb24-127"></a>pattern &lt;-<span class="st"> &quot;[M+H]+&quot;</span></span>
<span id="cb24-128"><a href="metabolomics.html#cb24-128"></a>raw_peaks[<span class="st">&quot;[M+H]+&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_detect</span>(raw_peaks<span class="op">$</span>adduct, <span class="kw">paste0</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">Q&quot;</span>, pattern, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">E&quot;</span>))</span>
<span id="cb24-129"><a href="metabolomics.html#cb24-129"></a>selected_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span><span class="st">`</span><span class="dt">[M+H]+</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>, ]</span>
<span id="cb24-130"><a href="metabolomics.html#cb24-130"></a>rp_dim5 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-131"><a href="metabolomics.html#cb24-131"></a>rp_pcg5 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-132"><a href="metabolomics.html#cb24-132"></a><span class="co"># write.csv(selected_peaks, &#39;RP_pos_20190421_cleaned_MH.csv&#39;)</span></span>
<span id="cb24-133"><a href="metabolomics.html#cb24-133"></a></span>
<span id="cb24-134"><a href="metabolomics.html#cb24-134"></a>rp_pos &lt;-<span class="st"> </span>raw_peaks</span>
<span id="cb24-135"><a href="metabolomics.html#cb24-135"></a><span class="kw">rm</span>(f, l, raw_peaks, selected_peaks)</span>
<span id="cb24-136"><a href="metabolomics.html#cb24-136"></a></span>
<span id="cb24-137"><a href="metabolomics.html#cb24-137"></a><span class="co"># ================================== RP neg ====================================</span></span>
<span id="cb24-138"><a href="metabolomics.html#cb24-138"></a>raw_peaks &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_neg_20190422.csv&quot;</span>)</span>
<span id="cb24-139"><a href="metabolomics.html#cb24-139"></a>rn_dim1 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-140"><a href="metabolomics.html#cb24-140"></a>rn_pcg1 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-141"><a href="metabolomics.html#cb24-141"></a></span>
<span id="cb24-142"><a href="metabolomics.html#cb24-142"></a><span class="co"># Removing features eluting in the void</span></span>
<span id="cb24-143"><a href="metabolomics.html#cb24-143"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>rt <span class="op">&gt;</span><span class="st"> </span><span class="dv">45</span>, ]</span>
<span id="cb24-144"><a href="metabolomics.html#cb24-144"></a>rn_dim2 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-145"><a href="metabolomics.html#cb24-145"></a>rn_pcg2 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-146"><a href="metabolomics.html#cb24-146"></a></span>
<span id="cb24-147"><a href="metabolomics.html#cb24-147"></a><span class="co"># Removing features with a CV &lt; 30%</span></span>
<span id="cb24-148"><a href="metabolomics.html#cb24-148"></a>f &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20171003_01301&quot;</span>)  <span class="co"># first QC RP neg</span></span>
<span id="cb24-149"><a href="metabolomics.html#cb24-149"></a>l &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(raw_peaks) <span class="op">==</span><span class="st"> &quot;IE_20171003_05701&quot;</span>)  <span class="co"># 3rd last QC RP neg; QC empty after this injection</span></span>
<span id="cb24-150"><a href="metabolomics.html#cb24-150"></a>raw_peaks[<span class="st">&quot;SD&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, sd)</span>
<span id="cb24-151"><a href="metabolomics.html#cb24-151"></a>raw_peaks[<span class="st">&quot;MEAN&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, f<span class="op">:</span>l], <span class="dv">1</span>, mean)</span>
<span id="cb24-152"><a href="metabolomics.html#cb24-152"></a>raw_peaks[<span class="st">&quot;CV&quot;</span>] &lt;-<span class="st"> </span>raw_peaks<span class="op">$</span>SD<span class="op">/</span>raw_peaks<span class="op">$</span>MEAN</span>
<span id="cb24-153"><a href="metabolomics.html#cb24-153"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span>CV <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.3</span>, ]</span>
<span id="cb24-154"><a href="metabolomics.html#cb24-154"></a>rn_dim3 &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-155"><a href="metabolomics.html#cb24-155"></a>rn_pcg3 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(raw_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-156"><a href="metabolomics.html#cb24-156"></a><span class="co"># write.csv(raw_peaks, &#39;RP_neg_20190422_cleaned.csv&#39;)</span></span>
<span id="cb24-157"><a href="metabolomics.html#cb24-157"></a></span>
<span id="cb24-158"><a href="metabolomics.html#cb24-158"></a><span class="co"># Keep only the feature with the greatest sum of signal per pc group</span></span>
<span id="cb24-159"><a href="metabolomics.html#cb24-159"></a>l &lt;-<span class="st"> </span><span class="kw">dim</span>(raw_peaks)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">6</span></span>
<span id="cb24-160"><a href="metabolomics.html#cb24-160"></a>raw_peaks[<span class="st">&quot;fss&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(raw_peaks[, <span class="dv">13</span><span class="op">:</span>l], <span class="dv">1</span>, sum)  <span class="co">#feature signal sum</span></span>
<span id="cb24-161"><a href="metabolomics.html#cb24-161"></a>raw_peaks &lt;-<span class="st"> </span>raw_peaks[<span class="kw">order</span>(raw_peaks<span class="op">$</span>pcgroup, <span class="op">-</span>raw_peaks<span class="op">$</span>fss), ]</span>
<span id="cb24-162"><a href="metabolomics.html#cb24-162"></a>selected_peaks &lt;-<span class="st"> </span><span class="kw">distinct</span>(raw_peaks, raw_peaks<span class="op">$</span>pcgroup, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-163"><a href="metabolomics.html#cb24-163"></a>rn_dim4 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-164"><a href="metabolomics.html#cb24-164"></a>rn_pcg4 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-165"><a href="metabolomics.html#cb24-165"></a><span class="co"># write.csv(selected_peaks, &#39;RP_neg_20190422_cleaned_pcgroup.csv&#39;)</span></span>
<span id="cb24-166"><a href="metabolomics.html#cb24-166"></a><span class="kw">rm</span>(selected_peaks)</span>
<span id="cb24-167"><a href="metabolomics.html#cb24-167"></a></span>
<span id="cb24-168"><a href="metabolomics.html#cb24-168"></a><span class="co"># Keep only features with explicit annotations of [M-H]-</span></span>
<span id="cb24-169"><a href="metabolomics.html#cb24-169"></a><span class="kw">library</span>(stringr)</span>
<span id="cb24-170"><a href="metabolomics.html#cb24-170"></a>raw_peaks[<span class="st">&quot;[M-H]-&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb24-171"><a href="metabolomics.html#cb24-171"></a>pattern &lt;-<span class="st"> &quot;[M-H]-&quot;</span></span>
<span id="cb24-172"><a href="metabolomics.html#cb24-172"></a>raw_peaks[<span class="st">&quot;[M-H]-&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_detect</span>(raw_peaks<span class="op">$</span>adduct, <span class="kw">paste0</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">Q&quot;</span>, pattern, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">E&quot;</span>))</span>
<span id="cb24-173"><a href="metabolomics.html#cb24-173"></a>selected_peaks &lt;-<span class="st"> </span>raw_peaks[raw_peaks<span class="op">$</span><span class="st">`</span><span class="dt">[M-H]-</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>, ]</span>
<span id="cb24-174"><a href="metabolomics.html#cb24-174"></a>rn_dim5 &lt;-<span class="st"> </span><span class="kw">dim</span>(selected_peaks)[<span class="dv">1</span>]</span>
<span id="cb24-175"><a href="metabolomics.html#cb24-175"></a>rn_pcg5 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(selected_peaks<span class="op">$</span>pcgroup))</span>
<span id="cb24-176"><a href="metabolomics.html#cb24-176"></a><span class="co"># write.csv(selected_peaks, &#39;RP_neg_20190422_cleaned_MH.csv&#39;)</span></span>
<span id="cb24-177"><a href="metabolomics.html#cb24-177"></a></span>
<span id="cb24-178"><a href="metabolomics.html#cb24-178"></a>hilic_neg &lt;-<span class="st"> </span>raw_peaks</span>
<span id="cb24-179"><a href="metabolomics.html#cb24-179"></a><span class="kw">rm</span>(f, l, raw_peaks, selected_peaks)</span></code></pre></div>
</div>
<div id="data-quality-control" class="section level3">
<h3><span class="header-section-number">2.2.7</span> Data quality control</h3>
<p>To monitor the stability of the signal during the UPLC-HRMS run, we plot the total signal per sample by injection order.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="metabolomics.html#cb25-1"></a>hp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_pos_20190417.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb25-2"><a href="metabolomics.html#cb25-2"></a>hn &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_neg_20190421.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb25-3"><a href="metabolomics.html#cb25-3"></a>rp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_pos_20190421.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb25-4"><a href="metabolomics.html#cb25-4"></a>rn &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_neg_20190422.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb25-5"><a href="metabolomics.html#cb25-5"></a></span>
<span id="cb25-6"><a href="metabolomics.html#cb25-6"></a><span class="co"># subsetting, keep only sample data</span></span>
<span id="cb25-7"><a href="metabolomics.html#cb25-7"></a>hp &lt;-<span class="st"> </span>hp[, <span class="dv">13</span><span class="op">:</span>(<span class="kw">dim</span>(hp)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">3</span>)]  <span class="co">#14</span></span>
<span id="cb25-8"><a href="metabolomics.html#cb25-8"></a>hn &lt;-<span class="st"> </span>hn[, <span class="dv">13</span><span class="op">:</span>(<span class="kw">dim</span>(hn)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">3</span>)]</span>
<span id="cb25-9"><a href="metabolomics.html#cb25-9"></a>rp &lt;-<span class="st"> </span>rp[, <span class="dv">13</span><span class="op">:</span>(<span class="kw">dim</span>(rp)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">3</span>)]</span>
<span id="cb25-10"><a href="metabolomics.html#cb25-10"></a>rn &lt;-<span class="st"> </span>rn[, <span class="dv">13</span><span class="op">:</span>(<span class="kw">dim</span>(rn)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">3</span>)]</span>
<span id="cb25-11"><a href="metabolomics.html#cb25-11"></a></span>
<span id="cb25-12"><a href="metabolomics.html#cb25-12"></a><span class="co"># sum signal of columns, i.e. per sample</span></span>
<span id="cb25-13"><a href="metabolomics.html#cb25-13"></a>hp[<span class="kw">nrow</span>(hp) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, ] &lt;-<span class="st"> </span><span class="kw">apply</span>(hp, <span class="dv">2</span>, sum)</span>
<span id="cb25-14"><a href="metabolomics.html#cb25-14"></a>hn[<span class="kw">nrow</span>(hn) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, ] &lt;-<span class="st"> </span><span class="kw">apply</span>(hn, <span class="dv">2</span>, sum)</span>
<span id="cb25-15"><a href="metabolomics.html#cb25-15"></a>rp[<span class="kw">nrow</span>(rp) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, ] &lt;-<span class="st"> </span><span class="kw">apply</span>(rp, <span class="dv">2</span>, sum)</span>
<span id="cb25-16"><a href="metabolomics.html#cb25-16"></a>rn[<span class="kw">nrow</span>(rn) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, ] &lt;-<span class="st"> </span><span class="kw">apply</span>(rn, <span class="dv">2</span>, sum)</span>
<span id="cb25-17"><a href="metabolomics.html#cb25-17"></a></span>
<span id="cb25-18"><a href="metabolomics.html#cb25-18"></a><span class="co"># data frame gymnastics</span></span>
<span id="cb25-19"><a href="metabolomics.html#cb25-19"></a>hp_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>((hp[<span class="kw">dim</span>(hp)[<span class="dv">1</span>], ])))</span>
<span id="cb25-20"><a href="metabolomics.html#cb25-20"></a>hn_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>((hn[<span class="kw">dim</span>(hn)[<span class="dv">1</span>], ])))</span>
<span id="cb25-21"><a href="metabolomics.html#cb25-21"></a>rp_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>((rp[<span class="kw">dim</span>(rp)[<span class="dv">1</span>], ])))</span>
<span id="cb25-22"><a href="metabolomics.html#cb25-22"></a>rn_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>((rn[<span class="kw">dim</span>(rn)[<span class="dv">1</span>], ])))</span>
<span id="cb25-23"><a href="metabolomics.html#cb25-23"></a></span>
<span id="cb25-24"><a href="metabolomics.html#cb25-24"></a><span class="kw">colnames</span>(hp_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum_hp&quot;</span>)</span>
<span id="cb25-25"><a href="metabolomics.html#cb25-25"></a>hp_df[<span class="st">&quot;id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(hp_df)</span>
<span id="cb25-26"><a href="metabolomics.html#cb25-26"></a><span class="kw">colnames</span>(hn_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum_hn&quot;</span>)</span>
<span id="cb25-27"><a href="metabolomics.html#cb25-27"></a>hn_df[<span class="st">&quot;id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(hn_df)</span>
<span id="cb25-28"><a href="metabolomics.html#cb25-28"></a><span class="kw">colnames</span>(rp_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum_rp&quot;</span>)</span>
<span id="cb25-29"><a href="metabolomics.html#cb25-29"></a>rp_df[<span class="st">&quot;id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rp_df)</span>
<span id="cb25-30"><a href="metabolomics.html#cb25-30"></a><span class="kw">colnames</span>(rn_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum_rn&quot;</span>)</span>
<span id="cb25-31"><a href="metabolomics.html#cb25-31"></a>rn_df[<span class="st">&quot;id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rn_df)</span>
<span id="cb25-32"><a href="metabolomics.html#cb25-32"></a></span>
<span id="cb25-33"><a href="metabolomics.html#cb25-33"></a><span class="kw">library</span>(stringr)</span>
<span id="cb25-34"><a href="metabolomics.html#cb25-34"></a>hp_df[<span class="st">&quot;hp_io&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">str_sub</span>(hp_df<span class="op">$</span>id, <span class="dv">-4</span>, <span class="dv">-3</span>))</span>
<span id="cb25-35"><a href="metabolomics.html#cb25-35"></a>hn_df[<span class="st">&quot;hn_io&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">str_sub</span>(hn_df<span class="op">$</span>id, <span class="dv">-4</span>, <span class="dv">-3</span>))</span>
<span id="cb25-36"><a href="metabolomics.html#cb25-36"></a>rp_df[<span class="st">&quot;rp_io&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">str_sub</span>(rp_df<span class="op">$</span>id, <span class="dv">-4</span>, <span class="dv">-3</span>))</span>
<span id="cb25-37"><a href="metabolomics.html#cb25-37"></a>rn_df[<span class="st">&quot;rn_io&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">str_sub</span>(rn_df<span class="op">$</span>id, <span class="dv">-4</span>, <span class="dv">-3</span>))</span>
<span id="cb25-38"><a href="metabolomics.html#cb25-38"></a></span>
<span id="cb25-39"><a href="metabolomics.html#cb25-39"></a>hp_df &lt;-<span class="st"> </span>hp_df[<span class="kw">order</span>(hp_df<span class="op">$</span>hp_io), ]</span>
<span id="cb25-40"><a href="metabolomics.html#cb25-40"></a>hp_df[<span class="st">&quot;n&quot;</span>] &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">nrow</span>(hp_df))</span>
<span id="cb25-41"><a href="metabolomics.html#cb25-41"></a>hp_df[<span class="st">&quot;experiment&quot;</span>] &lt;-<span class="st"> &quot;HILIC pos.&quot;</span></span>
<span id="cb25-42"><a href="metabolomics.html#cb25-42"></a></span>
<span id="cb25-43"><a href="metabolomics.html#cb25-43"></a>hn_df &lt;-<span class="st"> </span>hn_df[<span class="kw">order</span>(hn_df<span class="op">$</span>hn_io), ]</span>
<span id="cb25-44"><a href="metabolomics.html#cb25-44"></a>hn_df[<span class="st">&quot;n&quot;</span>] &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">nrow</span>(hn_df))</span>
<span id="cb25-45"><a href="metabolomics.html#cb25-45"></a>hn_df[<span class="st">&quot;experiment&quot;</span>] &lt;-<span class="st"> &quot;HILIC neg.&quot;</span></span>
<span id="cb25-46"><a href="metabolomics.html#cb25-46"></a></span>
<span id="cb25-47"><a href="metabolomics.html#cb25-47"></a>rp_df &lt;-<span class="st"> </span>rp_df[<span class="kw">order</span>(rp_df<span class="op">$</span>rp_io), ]</span>
<span id="cb25-48"><a href="metabolomics.html#cb25-48"></a>rp_df[<span class="st">&quot;n&quot;</span>] &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">nrow</span>(rp_df))</span>
<span id="cb25-49"><a href="metabolomics.html#cb25-49"></a>rp_df[<span class="st">&quot;experiment&quot;</span>] &lt;-<span class="st"> &quot;RP pos.&quot;</span></span>
<span id="cb25-50"><a href="metabolomics.html#cb25-50"></a></span>
<span id="cb25-51"><a href="metabolomics.html#cb25-51"></a>rn_df &lt;-<span class="st"> </span>rn_df[<span class="kw">order</span>(rn_df<span class="op">$</span>rn_io), ]</span>
<span id="cb25-52"><a href="metabolomics.html#cb25-52"></a>rn_df[<span class="st">&quot;n&quot;</span>] &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">nrow</span>(rn_df))</span>
<span id="cb25-53"><a href="metabolomics.html#cb25-53"></a>rn_df[<span class="st">&quot;experiment&quot;</span>] &lt;-<span class="st"> &quot;RP neg.&quot;</span></span>
<span id="cb25-54"><a href="metabolomics.html#cb25-54"></a></span>
<span id="cb25-55"><a href="metabolomics.html#cb25-55"></a><span class="kw">colnames</span>(hp_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;io&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;experiment&quot;</span>)</span>
<span id="cb25-56"><a href="metabolomics.html#cb25-56"></a><span class="kw">colnames</span>(hn_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;io&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;experiment&quot;</span>)</span>
<span id="cb25-57"><a href="metabolomics.html#cb25-57"></a><span class="kw">colnames</span>(rp_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;io&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;experiment&quot;</span>)</span>
<span id="cb25-58"><a href="metabolomics.html#cb25-58"></a><span class="kw">colnames</span>(rn_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;colsum&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;io&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;experiment&quot;</span>)</span>
<span id="cb25-59"><a href="metabolomics.html#cb25-59"></a></span>
<span id="cb25-60"><a href="metabolomics.html#cb25-60"></a>stability &lt;-<span class="st"> </span><span class="kw">rbind</span>(hp_df, hn_df, rp_df, rn_df)</span>
<span id="cb25-61"><a href="metabolomics.html#cb25-61"></a></span>
<span id="cb25-62"><a href="metabolomics.html#cb25-62"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb25-63"><a href="metabolomics.html#cb25-63"></a><span class="kw">ggplot</span>(stability, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> colsum, <span class="dt">color =</span> experiment)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Signal intensity during UPLC-HRMS experiments&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;sample injection order&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-64"><a href="metabolomics.html#cb25-64"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;total signal intensity per sample&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;Experiment&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(experiment <span class="op">~</span><span class="st"> </span></span>
<span id="cb25-65"><a href="metabolomics.html#cb25-65"></a><span class="st">    </span>., <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:ms-run-stability"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/ms-run-stability-1.png" alt="Cummulative signal intensity across all samples and chromatographic experiments shows only a minor effect of injection order." width="672" />
<p class="caption">
Figure 2.1: Cummulative signal intensity across all samples and chromatographic experiments shows only a minor effect of injection order.
</p>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="metabolomics.html#cb26-1"></a><span class="kw">rm</span>(hp, hp_df, hn, hn_df, rp, rp_df, rn, rn_df, stability)</span></code></pre></div>
<p>We see that while signal intensity in all experimental data seems fairly stable, the HILIC positive data set has the highest intensity and virtually no changes at all throughout data acquisition. Therefore, we mostly rely on analyses of the HILIC pos data set.</p>
</div>
<div id="summary-of-data-processing" class="section level3">
<h3><span class="header-section-number">2.2.8</span> Summary of data processing</h3>
<p>Below we outline the number of features removed in every step as shown in the table and corresponding figure. “CV&gt;30%” is the data set subsequently labelled “cleaned”, “repr. feat.” are the PC-group data set and “ion”" are sometimes also labelled “MH”.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="metabolomics.html#cb27-1"></a>initial_f &lt;-<span class="st"> </span><span class="kw">c</span>(hp_dim1, hn_dim1, rp_dim1, rn_dim1)</span>
<span id="cb27-2"><a href="metabolomics.html#cb27-2"></a>rt_f &lt;-<span class="st"> </span><span class="kw">c</span>(hp_dim2, hn_dim2, rp_dim2, rn_dim2)</span>
<span id="cb27-3"><a href="metabolomics.html#cb27-3"></a>cv_f &lt;-<span class="st"> </span><span class="kw">c</span>(hp_dim3, hn_dim3, rp_dim3, rn_dim3)</span>
<span id="cb27-4"><a href="metabolomics.html#cb27-4"></a>representative_f &lt;-<span class="st"> </span><span class="kw">c</span>(hp_dim4, hn_dim4, rp_dim4, rn_dim4)</span>
<span id="cb27-5"><a href="metabolomics.html#cb27-5"></a>ion_f &lt;-<span class="st"> </span><span class="kw">c</span>(hp_dim5, hn_dim5, rp_dim5, rn_dim5)</span>
<span id="cb27-6"><a href="metabolomics.html#cb27-6"></a></span>
<span id="cb27-7"><a href="metabolomics.html#cb27-7"></a>initial_p &lt;-<span class="st"> </span><span class="kw">c</span>(hp_pcg1, hn_pcg1, rp_pcg1, rn_pcg1)</span>
<span id="cb27-8"><a href="metabolomics.html#cb27-8"></a>rt_p &lt;-<span class="st"> </span><span class="kw">c</span>(hp_pcg2, hn_pcg2, rp_pcg2, rn_pcg2)</span>
<span id="cb27-9"><a href="metabolomics.html#cb27-9"></a>cv_p &lt;-<span class="st"> </span><span class="kw">c</span>(hp_pcg3, hn_pcg3, rp_pcg3, rn_pcg3)</span>
<span id="cb27-10"><a href="metabolomics.html#cb27-10"></a>representative_p &lt;-<span class="st"> </span><span class="kw">c</span>(hp_pcg4, hn_pcg4, rp_pcg4, rn_pcg4)</span>
<span id="cb27-11"><a href="metabolomics.html#cb27-11"></a>ion_p &lt;-<span class="st"> </span><span class="kw">c</span>(hp_pcg5, hn_pcg5, rp_pcg5, rn_pcg5)</span>
<span id="cb27-12"><a href="metabolomics.html#cb27-12"></a></span>
<span id="cb27-13"><a href="metabolomics.html#cb27-13"></a>df &lt;-<span class="st"> </span><span class="kw">cbind</span>(initial_f, rt_f, cv_f, representative_f, ion_f, initial_p, rt_p, cv_p, representative_p, ion_p)</span>
<span id="cb27-14"><a href="metabolomics.html#cb27-14"></a><span class="kw">rownames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HILIC pos&quot;</span>, <span class="st">&quot;HILIC neg&quot;</span>, <span class="st">&quot;RP pos&quot;</span>, <span class="st">&quot;RP neg&quot;</span>)</span>
<span id="cb27-15"><a href="metabolomics.html#cb27-15"></a></span>
<span id="cb27-16"><a href="metabolomics.html#cb27-16"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb27-17"><a href="metabolomics.html#cb27-17"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb27-18"><a href="metabolomics.html#cb27-18"></a><span class="kw">kable</span>(df, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;initial&quot;</span>, <span class="st">&quot;RT &gt;45 s&quot;</span>, <span class="st">&quot;CV &lt;30%&quot;</span>, <span class="st">&quot;repr. feat.&quot;</span>, <span class="st">&quot;ion&quot;</span>, <span class="st">&quot;initial&quot;</span>, <span class="st">&quot;RT &gt;45 s&quot;</span>, <span class="st">&quot;CV &lt;30%&quot;</span>, <span class="st">&quot;repr. feat.&quot;</span>, <span class="st">&quot;ion&quot;</span>), <span class="dt">longtable =</span> T, <span class="dt">booktabs =</span> T, </span>
<span id="cb27-19"><a href="metabolomics.html#cb27-19"></a>    <span class="dt">caption =</span> <span class="st">&quot;Number of features and pc groups </span></span>
<span id="cb27-20"><a href="metabolomics.html#cb27-20"></a><span class="st">      remaining after each filtering step.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="dt">features =</span> <span class="dv">5</span>, <span class="st">`</span><span class="dt">pc groups</span><span class="st">`</span> =<span class="st"> </span><span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb27-21"><a href="metabolomics.html#cb27-21"></a><span class="st">    </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">initial</th>
<th align="right">RT &gt;45 s</th>
<th align="right">CV &lt;30%</th>
<th align="right">repr. feat.</th>
<th align="right">ion</th>
<th align="right">initial</th>
<th align="right">RT &gt;45 s</th>
<th align="right">CV &lt;30%</th>
<th align="right">repr. feat.</th>
<th align="right">ion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">HILIC pos</td>
<td align="right">5113</td>
<td align="right">4389</td>
<td align="right">3507</td>
<td align="right">2212</td>
<td align="right">105</td>
<td align="right">3298</td>
<td align="right">2781</td>
<td align="right">2212</td>
<td align="right">2212</td>
<td align="right">79</td>
</tr>
<tr class="even">
<td align="left">HILIC neg</td>
<td align="right">4049</td>
<td align="right">3081</td>
<td align="right">2808</td>
<td align="right">1351</td>
<td align="right">123</td>
<td align="right">2044</td>
<td align="right">1495</td>
<td align="right">1351</td>
<td align="right">1351</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">RP pos</td>
<td align="right">5821</td>
<td align="right">5588</td>
<td align="right">4673</td>
<td align="right">2736</td>
<td align="right">171</td>
<td align="right">3420</td>
<td align="right">3277</td>
<td align="right">2736</td>
<td align="right">2736</td>
<td align="right">128</td>
</tr>
<tr class="even">
<td align="left">RP neg</td>
<td align="right">3867</td>
<td align="right">3621</td>
<td align="right">3166</td>
<td align="right">1678</td>
<td align="right">105</td>
<td align="right">2069</td>
<td align="right">1918</td>
<td align="right">1678</td>
<td align="right">1678</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="metabolomics.html#cb28-1"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb28-2"><a href="metabolomics.html#cb28-2"></a>df &lt;-<span class="st"> </span><span class="kw">melt</span>(df)</span>
<span id="cb28-3"><a href="metabolomics.html#cb28-3"></a>df[<span class="st">&quot;filter&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>((<span class="st">&quot;initial&quot;</span>), <span class="dv">4</span>), <span class="kw">rep</span>((<span class="st">&quot;RT &gt;45 s&quot;</span>), <span class="dv">4</span>), <span class="kw">rep</span>((<span class="st">&quot;CV &lt;30%&quot;</span>), <span class="dv">4</span>), <span class="kw">rep</span>((<span class="st">&quot;rep&quot;</span>), <span class="dv">4</span>), <span class="kw">rep</span>((<span class="st">&quot;ion&quot;</span>), <span class="dv">4</span>))</span>
<span id="cb28-4"><a href="metabolomics.html#cb28-4"></a>df<span class="op">$</span>filter &lt;-<span class="st"> </span><span class="kw">factor</span>(df<span class="op">$</span>filter, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;initial&quot;</span>, <span class="st">&quot;RT &gt;45 s&quot;</span>, <span class="st">&quot;CV &lt;30%&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;ion&quot;</span>))</span>
<span id="cb28-5"><a href="metabolomics.html#cb28-5"></a>df[<span class="st">&quot;category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>((<span class="st">&quot;feature&quot;</span>), <span class="dv">20</span>), <span class="kw">rep</span>((<span class="st">&quot;pc group&quot;</span>), <span class="dv">20</span>))</span>
<span id="cb28-6"><a href="metabolomics.html#cb28-6"></a>df<span class="op">$</span>Var2 &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb28-7"><a href="metabolomics.html#cb28-7"></a><span class="kw">colnames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;acquisition&quot;</span>, <span class="st">&quot;value&quot;</span>, <span class="st">&quot;filter&quot;</span>, <span class="st">&quot;category&quot;</span>)</span>
<span id="cb28-8"><a href="metabolomics.html#cb28-8"></a><span class="kw">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    40 obs. of  4 variables:
##  $ acquisition: Factor w/ 4 levels &quot;HILIC pos&quot;,&quot;HILIC neg&quot;,..: 1 2 3 4 1 2 3 4 1 2 ...
##  $ value      : int  5113 4049 5821 3867 4389 3081 5588 3621 3507 2808 ...
##  $ filter     : Factor w/ 5 levels &quot;initial&quot;,&quot;RT &gt;45 s&quot;,..: 1 1 1 1 2 2 2 2 3 3 ...
##  $ category   : chr  &quot;feature&quot; &quot;feature&quot; &quot;feature&quot; &quot;feature&quot; ...</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="metabolomics.html#cb30-1"></a><span class="co"># library(ggplot2) ggplot(df, aes(fill=filter, x=acquisition, y=value))+ geom_bar(position=&#39;dodge&#39;, stat = &#39;identity&#39;)+ facet_grid(.~category)+ xlab(&#39;Data</span></span>
<span id="cb30-2"><a href="metabolomics.html#cb30-2"></a><span class="co"># acquisition mode&#39;)+ylab(&#39;Count&#39;)+labs(fill=&#39;Filtering step&#39;)+ theme_bw()+ scale_fill_grey()+ scale_y_continuous(breaks=seq(0,6000,1000))+ theme(axis.text.x</span></span>
<span id="cb30-3"><a href="metabolomics.html#cb30-3"></a><span class="co"># = element_text(angle = 45, vjust = 0.5, hjust = 0.5), legend.position=&#39;bottom&#39;)</span></span></code></pre></div>
<p>After preliminary analyses of metabolomics data, a few outliers were re-identified by P. Cárdenas, and one specimen was removed from the data set as it originated from another species.</p>
</div>
</div>
<div id="chromatorgrams" class="section level2">
<h2><span class="header-section-number">2.3</span> Chromatorgrams</h2>
<p>In <em>G. barretti</em> barettin and 8,9-dihydrobarettin are major compounds with distinct peaks in the chromatogram. We wanted to see whether <em>S. fortis</em> and <em>W. bursa</em> also had major compounds and whether differences in sample depth would be directly reflected in the chromatograms.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="metabolomics.html#cb31-1"></a>gb_chrom &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Gb_all_chromatograms.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb31-2"><a href="metabolomics.html#cb31-2"></a><span class="co"># differences in RT negligible/insignificant between the different chromatograms/samples</span></span>
<span id="cb31-3"><a href="metabolomics.html#cb31-3"></a></span>
<span id="cb31-4"><a href="metabolomics.html#cb31-4"></a>gb_chrom[, <span class="kw">c</span>(<span class="st">&quot;Gb10_RT&quot;</span>, <span class="st">&quot;Gb12_RT&quot;</span>, <span class="st">&quot;Gb13_RT&quot;</span>, <span class="st">&quot;Gb14_RT&quot;</span>, <span class="st">&quot;Gb15_RT&quot;</span>, <span class="st">&quot;Gb16_RT&quot;</span>, <span class="st">&quot;Gb17_RT&quot;</span>, <span class="st">&quot;Gb18_RT&quot;</span>, <span class="st">&quot;Gb19_RT&quot;</span>, <span class="st">&quot;Gb2_RT&quot;</span>, <span class="st">&quot;Gb20_RT&quot;</span>, <span class="st">&quot;Gb21_RT&quot;</span>, <span class="st">&quot;Gb3_RT&quot;</span>, <span class="st">&quot;Gb7_RT&quot;</span>, </span>
<span id="cb31-5"><a href="metabolomics.html#cb31-5"></a>    <span class="st">&quot;Gb8_RT&quot;</span>, <span class="st">&quot;Gb9_RT&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb31-6"><a href="metabolomics.html#cb31-6"></a><span class="kw">colnames</span>(gb_chrom)[<span class="kw">colnames</span>(gb_chrom) <span class="op">==</span><span class="st"> &quot;Gb1_RT&quot;</span>] &lt;-<span class="st"> &quot;RT&quot;</span></span>
<span id="cb31-7"><a href="metabolomics.html#cb31-7"></a>gb_chrom &lt;-<span class="st"> </span>gb_chrom[gb_chrom<span class="op">$</span>RT <span class="op">&lt;=</span><span class="st"> </span><span class="dv">12</span>, ]  <span class="co"># removing tail w/o any signal, run ended at 12 min</span></span>
<span id="cb31-8"><a href="metabolomics.html#cb31-8"></a></span>
<span id="cb31-9"><a href="metabolomics.html#cb31-9"></a><span class="co"># ugly but works</span></span>
<span id="cb31-10"><a href="metabolomics.html#cb31-10"></a>p_gb_chrom &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gb_chrom, <span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="ot">NULL</span>, <span class="kw">aes</span>(<span class="dt">xmin =</span> <span class="fl">6.3</span>, <span class="dt">xmax =</span> <span class="fl">6.5</span>, <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>), </span>
<span id="cb31-11"><a href="metabolomics.html#cb31-11"></a>    <span class="dt">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="ot">NULL</span>, <span class="kw">aes</span>(<span class="dt">xmin =</span> <span class="fl">6.95</span>, <span class="dt">xmax =</span> <span class="fl">7.15</span>, <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>), <span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-12"><a href="metabolomics.html#cb31-12"></a>    <span class="dt">y =</span> Gb2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb3)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb7)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb8)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb9)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-13"><a href="metabolomics.html#cb31-13"></a>    <span class="dt">y =</span> Gb10)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb15)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb16)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb17)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb19)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-14"><a href="metabolomics.html#cb31-14"></a>    <span class="dt">y =</span> Gb21)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb12, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb13, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-15"><a href="metabolomics.html#cb31-15"></a>    <span class="dt">y =</span> Gb14, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb18, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Gb20, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb31-16"><a href="metabolomics.html#cb31-16"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;RT&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Signal intensity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Overlay chromatograms from G. barretti HILIC positive&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>(<span class="dt">base_size =</span> <span class="dv">7</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb31-17"><a href="metabolomics.html#cb31-17"></a></span>
<span id="cb31-18"><a href="metabolomics.html#cb31-18"></a>sf_chrom &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Sf_all_chromatograms.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb31-19"><a href="metabolomics.html#cb31-19"></a>sf_chrom[, <span class="kw">c</span>(<span class="st">&quot;Sf10_RT&quot;</span>, <span class="st">&quot;Sf11_RT&quot;</span>, <span class="st">&quot;Sf12_RT&quot;</span>, <span class="st">&quot;Sf13_RT&quot;</span>, <span class="st">&quot;Sf14_RT&quot;</span>, <span class="st">&quot;Sf15_RT&quot;</span>, <span class="st">&quot;Sf2_RT&quot;</span>, <span class="st">&quot;Sf3_RT&quot;</span>, <span class="st">&quot;Sf4_RT&quot;</span>, <span class="st">&quot;Sf5_RT&quot;</span>, <span class="st">&quot;Sf6_RT&quot;</span>, <span class="st">&quot;Sf7_RT&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb31-20"><a href="metabolomics.html#cb31-20"></a><span class="kw">colnames</span>(sf_chrom)[<span class="kw">colnames</span>(sf_chrom) <span class="op">==</span><span class="st"> &quot;Sf1_RT&quot;</span>] &lt;-<span class="st"> &quot;RT&quot;</span></span>
<span id="cb31-21"><a href="metabolomics.html#cb31-21"></a>sf_chrom &lt;-<span class="st"> </span>sf_chrom[sf_chrom<span class="op">$</span>RT <span class="op">&lt;=</span><span class="st"> </span><span class="dv">12</span>, ]</span>
<span id="cb31-22"><a href="metabolomics.html#cb31-22"></a></span>
<span id="cb31-23"><a href="metabolomics.html#cb31-23"></a></span>
<span id="cb31-24"><a href="metabolomics.html#cb31-24"></a>p_sf_chrom &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sf_chrom, <span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf3)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-25"><a href="metabolomics.html#cb31-25"></a>    <span class="dt">y =</span> Sf4)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf5)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf6)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf7)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf10, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb31-26"><a href="metabolomics.html#cb31-26"></a>    <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf11, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf12, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-27"><a href="metabolomics.html#cb31-27"></a>    <span class="dt">y =</span> Sf13, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf14, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Sf15, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb31-28"><a href="metabolomics.html#cb31-28"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;RT&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Signal intensity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Overlay chromatograms from S. fortis HILIC positive&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>(<span class="dt">base_size =</span> <span class="dv">7</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb31-29"><a href="metabolomics.html#cb31-29"></a></span>
<span id="cb31-30"><a href="metabolomics.html#cb31-30"></a>wb_chrom &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Wb_all_chromatograms.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb31-31"><a href="metabolomics.html#cb31-31"></a>wb_chrom[, <span class="kw">c</span>(<span class="st">&quot;Wb10_RT&quot;</span>, <span class="st">&quot;Wb11_RT&quot;</span>, <span class="st">&quot;Wb12_RT&quot;</span>, <span class="st">&quot;Wb13_RT&quot;</span>, <span class="st">&quot;Wb14_RT&quot;</span>, <span class="st">&quot;Wb15_RT&quot;</span>, <span class="st">&quot;Wb16_RT&quot;</span>, <span class="st">&quot;Wb17_RT&quot;</span>, <span class="st">&quot;Wb2_RT&quot;</span>, <span class="st">&quot;Wb3_RT&quot;</span>, <span class="st">&quot;Wb4_RT&quot;</span>, <span class="st">&quot;Wb5_RT&quot;</span>, <span class="st">&quot;Wb6_RT&quot;</span>, <span class="st">&quot;Wb7_RT&quot;</span>, </span>
<span id="cb31-32"><a href="metabolomics.html#cb31-32"></a>    <span class="st">&quot;Wb8_RT&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb31-33"><a href="metabolomics.html#cb31-33"></a><span class="kw">colnames</span>(wb_chrom)[<span class="kw">colnames</span>(wb_chrom) <span class="op">==</span><span class="st"> &quot;Wb1_RT&quot;</span>] &lt;-<span class="st"> &quot;RT&quot;</span></span>
<span id="cb31-34"><a href="metabolomics.html#cb31-34"></a>wb_chrom &lt;-<span class="st"> </span>wb_chrom[wb_chrom<span class="op">$</span>RT <span class="op">&lt;=</span><span class="st"> </span><span class="dv">12</span>, ]</span>
<span id="cb31-35"><a href="metabolomics.html#cb31-35"></a></span>
<span id="cb31-36"><a href="metabolomics.html#cb31-36"></a>p_wb_chrom &lt;-<span class="st"> </span><span class="kw">ggplot</span>(wb_chrom, <span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb3)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-37"><a href="metabolomics.html#cb31-37"></a>    <span class="dt">y =</span> Wb4)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb5)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb6)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb7)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb8)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-38"><a href="metabolomics.html#cb31-38"></a>    <span class="dt">y =</span> Wb10)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb11)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb12)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb13, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, </span>
<span id="cb31-39"><a href="metabolomics.html#cb31-39"></a>    <span class="dt">y =</span> Wb14, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb15, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb16, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb31-40"><a href="metabolomics.html#cb31-40"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RT, <span class="dt">y =</span> Wb17, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;RT&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Signal intensity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Overlay chromatograms from W. bursa HILIC positive&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb31-41"><a href="metabolomics.html#cb31-41"></a><span class="st">    </span><span class="kw">theme_classic</span>(<span class="dt">base_size =</span> <span class="dv">7</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb31-42"><a href="metabolomics.html#cb31-42"></a></span>
<span id="cb31-43"><a href="metabolomics.html#cb31-43"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb31-44"><a href="metabolomics.html#cb31-44"></a><span class="kw">grid.arrange</span>(p_gb_chrom, p_sf_chrom, p_wb_chrom, <span class="dt">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/chromatorgrams-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="metabolomics.html#cb32-1"></a><span class="co"># k &lt;- grid.arrange(p_gb_chrom, p_sf_chrom, p_wb_chrom, nrow=3) ggsave(&#39;chroms_20200701.pdf&#39;, plot=k, path=&#39;data/&#39;, device = &#39;pdf&#39;, units = &#39;mm&#39;, width = 175,</span></span>
<span id="cb32-2"><a href="metabolomics.html#cb32-2"></a><span class="co"># height = 90, useDingbats=FALSE)</span></span>
<span id="cb32-3"><a href="metabolomics.html#cb32-3"></a></span>
<span id="cb32-4"><a href="metabolomics.html#cb32-4"></a><span class="kw">rm</span>(p_gb_chrom, p_sf_chrom, p_wb_chrom, gb_chrom, sf_chrom, wb_chrom)</span></code></pre></div>
</div>
<div id="multivariate-analyses" class="section level2">
<h2><span class="header-section-number">2.4</span> Multivariate analyses</h2>
<p>We start by visualising all metabolomes with a PCA and a PERMANOVA to get a first impression of our data.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="metabolomics.html#cb33-1"></a><span class="kw">library</span>(ropls)</span>
<span id="cb33-2"><a href="metabolomics.html#cb33-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb33-3"><a href="metabolomics.html#cb33-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb33-4"><a href="metabolomics.html#cb33-4"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb33-5"><a href="metabolomics.html#cb33-5"></a><span class="kw">library</span>(vegan)</span>
<span id="cb33-6"><a href="metabolomics.html#cb33-6"></a></span>
<span id="cb33-7"><a href="metabolomics.html#cb33-7"></a><span class="co"># load data</span></span>
<span id="cb33-8"><a href="metabolomics.html#cb33-8"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_pos_20190417_cleaned.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb33-9"><a href="metabolomics.html#cb33-9"></a>hilic_neg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_neg_20190421_cleaned.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb33-10"><a href="metabolomics.html#cb33-10"></a>rp_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_pos_20190421_cleaned.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb33-11"><a href="metabolomics.html#cb33-11"></a>rp_neg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_neg_20190422_cleaned.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb33-12"><a href="metabolomics.html#cb33-12"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb33-13"><a href="metabolomics.html#cb33-13"></a></span>
<span id="cb33-14"><a href="metabolomics.html#cb33-14"></a>formatting &lt;-<span class="st"> </span><span class="cf">function</span>(metabolome, meta_data, r, my_colnames) {</span>
<span id="cb33-15"><a href="metabolomics.html#cb33-15"></a>    formatted &lt;-<span class="st"> </span>metabolome</span>
<span id="cb33-16"><a href="metabolomics.html#cb33-16"></a>    formatted &lt;-<span class="st"> </span>formatted[, <span class="dv">14</span><span class="op">:</span>(<span class="kw">dim</span>(formatted)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>r)]</span>
<span id="cb33-17"><a href="metabolomics.html#cb33-17"></a>    formatted &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(formatted))</span>
<span id="cb33-18"><a href="metabolomics.html#cb33-18"></a>    formatted[<span class="st">&quot;ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(formatted)</span>
<span id="cb33-19"><a href="metabolomics.html#cb33-19"></a>    formatted[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span>meta_data<span class="op">$</span>unified_ID[<span class="kw">match</span>(formatted<span class="op">$</span>ID, meta_data[[my_colnames]])]</span>
<span id="cb33-20"><a href="metabolomics.html#cb33-20"></a>    formatted[<span class="st">&quot;filter&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(formatted<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb33-21"><a href="metabolomics.html#cb33-21"></a>    formatted &lt;-<span class="st"> </span>formatted[<span class="op">!</span>formatted<span class="op">$</span>filter <span class="op">==</span><span class="st"> &quot;QC&quot;</span>, ]</span>
<span id="cb33-22"><a href="metabolomics.html#cb33-22"></a>    formatted &lt;-<span class="st"> </span><span class="kw">na.omit</span>(formatted)</span>
<span id="cb33-23"><a href="metabolomics.html#cb33-23"></a>    <span class="co"># formatted$filter &lt;- NULL</span></span>
<span id="cb33-24"><a href="metabolomics.html#cb33-24"></a>    formatted<span class="op">$</span>ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb33-25"><a href="metabolomics.html#cb33-25"></a>    formatted &lt;-<span class="st"> </span>formatted[<span class="kw">order</span>(formatted<span class="op">$</span>unified_ID), ]</span>
<span id="cb33-26"><a href="metabolomics.html#cb33-26"></a>    <span class="kw">rownames</span>(formatted) &lt;-<span class="st"> </span>formatted<span class="op">$</span>unified_ID</span>
<span id="cb33-27"><a href="metabolomics.html#cb33-27"></a>    <span class="kw">return</span>(formatted)</span>
<span id="cb33-28"><a href="metabolomics.html#cb33-28"></a>}</span>
<span id="cb33-29"><a href="metabolomics.html#cb33-29"></a></span>
<span id="cb33-30"><a href="metabolomics.html#cb33-30"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_pos, meta_data, <span class="dv">6</span>, <span class="st">&quot;LC.MS.HILIC.positive&quot;</span>)</span>
<span id="cb33-31"><a href="metabolomics.html#cb33-31"></a>hilic_neg &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_neg, meta_data, <span class="dv">6</span>, <span class="st">&quot;LC.MS.HILIC.negative&quot;</span>)</span>
<span id="cb33-32"><a href="metabolomics.html#cb33-32"></a>rp_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(rp_pos, meta_data, <span class="dv">6</span>, <span class="st">&quot;LC.MS.RP.positive&quot;</span>)</span>
<span id="cb33-33"><a href="metabolomics.html#cb33-33"></a>rp_neg &lt;-<span class="st"> </span><span class="kw">formatting</span>(rp_neg, meta_data, <span class="dv">6</span>, <span class="st">&quot;LC.MS.RP.negative&quot;</span>)</span>
<span id="cb33-34"><a href="metabolomics.html#cb33-34"></a></span>
<span id="cb33-35"><a href="metabolomics.html#cb33-35"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;YEAR&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)]</span>
<span id="cb33-36"><a href="metabolomics.html#cb33-36"></a></span>
<span id="cb33-37"><a href="metabolomics.html#cb33-37"></a><span class="co"># Overview PCA illustrating the metabolomes differ by sponge species</span></span>
<span id="cb33-38"><a href="metabolomics.html#cb33-38"></a></span>
<span id="cb33-39"><a href="metabolomics.html#cb33-39"></a>pca_wrapper &lt;-<span class="st"> </span><span class="cf">function</span>(metabolome, md, my_title) {</span>
<span id="cb33-40"><a href="metabolomics.html#cb33-40"></a>    metabolome<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb33-41"><a href="metabolomics.html#cb33-41"></a>    metabolome<span class="op">$</span>filter &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb33-42"><a href="metabolomics.html#cb33-42"></a>    metabolome &lt;-<span class="st"> </span><span class="kw">prcomp</span>(metabolome, <span class="dt">scale =</span> T)</span>
<span id="cb33-43"><a href="metabolomics.html#cb33-43"></a>    k &lt;-<span class="st"> </span><span class="kw">summary</span>(metabolome)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb33-44"><a href="metabolomics.html#cb33-44"></a>    metabolome_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(metabolome<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb33-45"><a href="metabolomics.html#cb33-45"></a>    metabolome_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(metabolome_df))</span>
<span id="cb33-46"><a href="metabolomics.html#cb33-46"></a>    x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb33-47"><a href="metabolomics.html#cb33-47"></a>    y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb33-48"><a href="metabolomics.html#cb33-48"></a>    metabolome_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(metabolome_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], md[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb33-49"><a href="metabolomics.html#cb33-49"></a>        <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb33-50"><a href="metabolomics.html#cb33-50"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(metabolome_df, <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="kw">aes</span>(<span class="dt">shape =</span> <span class="kw">factor</span>(Species))) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(x1) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(y1) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)  <span class="co">#+labs(shape=&#39;Species&#39;)</span></span>
<span id="cb33-51"><a href="metabolomics.html#cb33-51"></a>    <span class="kw">return</span>(p)</span>
<span id="cb33-52"><a href="metabolomics.html#cb33-52"></a>}</span>
<span id="cb33-53"><a href="metabolomics.html#cb33-53"></a></span>
<span id="cb33-54"><a href="metabolomics.html#cb33-54"></a>hp_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(hilic_pos, md, <span class="st">&quot;Hilic pos&quot;</span>)</span>
<span id="cb33-55"><a href="metabolomics.html#cb33-55"></a>hn_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(hilic_neg, md, <span class="st">&quot;Hilic neg&quot;</span>)</span>
<span id="cb33-56"><a href="metabolomics.html#cb33-56"></a>rp_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(rp_pos, md, <span class="st">&quot;RP pos&quot;</span>)</span>
<span id="cb33-57"><a href="metabolomics.html#cb33-57"></a>rn_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(rp_neg, md, <span class="st">&quot;RP neg&quot;</span>)</span>
<span id="cb33-58"><a href="metabolomics.html#cb33-58"></a></span>
<span id="cb33-59"><a href="metabolomics.html#cb33-59"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb33-60"><a href="metabolomics.html#cb33-60"></a><span class="kw">grid.arrange</span>(hp_pca, hn_pca, rp_pca, rn_pca, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:pca1"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/pca1-1.png" alt="PCA of the cleaned data sets. Dots are Gb samples, squares are Wb samples, traingles are Sf samples." width="672" />
<p class="caption">
Figure 2.2: PCA of the cleaned data sets. Dots are Gb samples, squares are Wb samples, traingles are Sf samples.
</p>
</div>
<p>For a general overview of the metabolomic data, Fig. @ is an OPLS model predicting variation as a function of depth versus orthogonal variation in all three sponge metabolomes combined. It is based on the HILIC positive cleaned data.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="metabolomics.html#cb34-1"></a><span class="kw">library</span>(ropls)</span>
<span id="cb34-2"><a href="metabolomics.html#cb34-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb34-3"><a href="metabolomics.html#cb34-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb34-4"><a href="metabolomics.html#cb34-4"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb34-5"><a href="metabolomics.html#cb34-5"></a><span class="kw">library</span>(vegan)</span>
<span id="cb34-6"><a href="metabolomics.html#cb34-6"></a></span>
<span id="cb34-7"><a href="metabolomics.html#cb34-7"></a><span class="co"># load data</span></span>
<span id="cb34-8"><a href="metabolomics.html#cb34-8"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_pos_20190417_cleaned.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb34-9"><a href="metabolomics.html#cb34-9"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb34-10"><a href="metabolomics.html#cb34-10"></a></span>
<span id="cb34-11"><a href="metabolomics.html#cb34-11"></a>formatting &lt;-<span class="st"> </span><span class="cf">function</span>(metabolome, meta_data, r, my_colnames) {</span>
<span id="cb34-12"><a href="metabolomics.html#cb34-12"></a>    formatted &lt;-<span class="st"> </span>metabolome</span>
<span id="cb34-13"><a href="metabolomics.html#cb34-13"></a>    formatted &lt;-<span class="st"> </span>formatted[, <span class="dv">14</span><span class="op">:</span>(<span class="kw">dim</span>(formatted)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>r)]</span>
<span id="cb34-14"><a href="metabolomics.html#cb34-14"></a>    formatted &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(formatted))</span>
<span id="cb34-15"><a href="metabolomics.html#cb34-15"></a>    formatted[<span class="st">&quot;ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(formatted)</span>
<span id="cb34-16"><a href="metabolomics.html#cb34-16"></a>    formatted[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span>meta_data<span class="op">$</span>unified_ID[<span class="kw">match</span>(formatted<span class="op">$</span>ID, meta_data[[my_colnames]])]</span>
<span id="cb34-17"><a href="metabolomics.html#cb34-17"></a>    formatted[<span class="st">&quot;filter&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(formatted<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb34-18"><a href="metabolomics.html#cb34-18"></a>    formatted &lt;-<span class="st"> </span>formatted[<span class="op">!</span>formatted<span class="op">$</span>filter <span class="op">==</span><span class="st"> &quot;QC&quot;</span>, ]</span>
<span id="cb34-19"><a href="metabolomics.html#cb34-19"></a>    formatted &lt;-<span class="st"> </span><span class="kw">na.omit</span>(formatted)</span>
<span id="cb34-20"><a href="metabolomics.html#cb34-20"></a>    <span class="co"># formatted$filter &lt;- NULL</span></span>
<span id="cb34-21"><a href="metabolomics.html#cb34-21"></a>    formatted<span class="op">$</span>ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb34-22"><a href="metabolomics.html#cb34-22"></a>    formatted &lt;-<span class="st"> </span>formatted[<span class="kw">order</span>(formatted<span class="op">$</span>unified_ID), ]</span>
<span id="cb34-23"><a href="metabolomics.html#cb34-23"></a>    <span class="kw">rownames</span>(formatted) &lt;-<span class="st"> </span>formatted<span class="op">$</span>unified_ID</span>
<span id="cb34-24"><a href="metabolomics.html#cb34-24"></a>    <span class="kw">return</span>(formatted)</span>
<span id="cb34-25"><a href="metabolomics.html#cb34-25"></a>}</span>
<span id="cb34-26"><a href="metabolomics.html#cb34-26"></a></span>
<span id="cb34-27"><a href="metabolomics.html#cb34-27"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_pos, meta_data, <span class="dv">6</span>, <span class="st">&quot;LC.MS.HILIC.positive&quot;</span>)</span>
<span id="cb34-28"><a href="metabolomics.html#cb34-28"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;YEAR&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)]</span>
<span id="cb34-29"><a href="metabolomics.html#cb34-29"></a>md &lt;-<span class="st"> </span>md[md<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(hilic_pos), ]</span>
<span id="cb34-30"><a href="metabolomics.html#cb34-30"></a>md &lt;-<span class="st"> </span>md[<span class="kw">order</span>(md<span class="op">$</span>unified_ID), ]</span>
<span id="cb34-31"><a href="metabolomics.html#cb34-31"></a><span class="kw">all</span>(<span class="kw">rownames</span>(hilic_pos) <span class="op">==</span><span class="st"> </span>md<span class="op">$</span>unified_ID)</span>
<span id="cb34-32"><a href="metabolomics.html#cb34-32"></a>hilic_pos[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;filter&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb34-33"><a href="metabolomics.html#cb34-33"></a>hilic.ropls.pca &lt;-<span class="st"> </span><span class="kw">opls</span>(hilic_pos, <span class="dt">plotL =</span> <span class="ot">FALSE</span>)</span>
<span id="cb34-34"><a href="metabolomics.html#cb34-34"></a>hilic.opls &lt;-<span class="st"> </span><span class="kw">opls</span>(hilic_pos, md[, <span class="st">&quot;Depth&quot;</span>], <span class="dt">permI =</span> <span class="dv">1000</span>, <span class="dt">orthoI =</span> <span class="ot">NA</span>, <span class="dt">scaleC =</span> <span class="st">&quot;pareto&quot;</span>, <span class="dt">plotL =</span> <span class="ot">FALSE</span>)</span>
<span id="cb34-35"><a href="metabolomics.html#cb34-35"></a>h.ortho.score &lt;-<span class="st"> </span><span class="kw">getScoreMN</span>(hilic.opls, <span class="dt">orthoL =</span> T)</span>
<span id="cb34-36"><a href="metabolomics.html#cb34-36"></a>h.pred.score &lt;-<span class="st"> </span><span class="kw">getScoreMN</span>(hilic.opls, <span class="dt">orthoL =</span> F)</span>
<span id="cb34-37"><a href="metabolomics.html#cb34-37"></a>h.df<span class="fl">.3</span>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(h.pred.score, h.ortho.score, md<span class="op">$</span>Depth, md<span class="op">$</span>unified_ID, md<span class="op">$</span>Species)</span>
<span id="cb34-38"><a href="metabolomics.html#cb34-38"></a><span class="co"># write.csv(h.df.3d, &#39;data/metabolome_opls_3d.csv&#39;) hilic.opls@summaryDF R2X(cum) R2Y(cum) Q2(cum) RMSEE pre ort pR2Y pQ2 Total 0.534 0.987 0.662 43.7 1 4</span></span>
<span id="cb34-39"><a href="metabolomics.html#cb34-39"></a><span class="co"># 0.001 0.001</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="metabolomics.html#cb35-1"></a><span class="kw">library</span>(plotly)</span>
<span id="cb35-2"><a href="metabolomics.html#cb35-2"></a>h.df<span class="fl">.3</span>d &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/metabolome_opls_3d.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb35-3"><a href="metabolomics.html#cb35-3"></a><span class="co"># format background and axes</span></span>
<span id="cb35-4"><a href="metabolomics.html#cb35-4"></a>axx &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;predicted&quot;</span>, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb35-5"><a href="metabolomics.html#cb35-5"></a></span>
<span id="cb35-6"><a href="metabolomics.html#cb35-6"></a>axy &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;orthogonal 1&quot;</span>, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb35-7"><a href="metabolomics.html#cb35-7"></a></span>
<span id="cb35-8"><a href="metabolomics.html#cb35-8"></a>axz &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;orthogonal 2&quot;</span>, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb35-9"><a href="metabolomics.html#cb35-9"></a>met3D &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(h.df<span class="fl">.3</span>d, <span class="dt">x =</span> <span class="op">~</span>h.df<span class="fl">.3</span>d<span class="op">$</span>p1, <span class="dt">y =</span> <span class="op">~</span>h.df<span class="fl">.3</span>d<span class="op">$</span>o1, <span class="dt">z =</span> <span class="op">~</span>h.df<span class="fl">.3</span>d<span class="op">$</span>o2, <span class="dt">symbol =</span> <span class="op">~</span>md.Species, <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;circle&quot;</span>), <span class="dt">color =</span> <span class="op">~</span>h.df<span class="fl">.3</span>d<span class="op">$</span>md.Depth) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-10"><a href="metabolomics.html#cb35-10"></a><span class="st">    </span><span class="kw">add_markers</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layout</span>(<span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> axx, <span class="dt">yaxis =</span> axy, <span class="dt">zaxis =</span> axz))</span>
<span id="cb35-11"><a href="metabolomics.html#cb35-11"></a>met3D</span></code></pre></div>
<div class="figure"><span id="fig:all-ropls-plot"></span>
<div id="htmlwidget-b551b315e0cee42147c2" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-b551b315e0cee42147c2">{"x":{"visdat":{"145c95c8c090":["function () ","plotlyVisDat"]},"cur_data":"145c95c8c090","attrs":{"145c95c8c090":{"x":{},"y":{},"z":{},"color":{},"symbol":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"symbols":["diamond","x","circle"],"type":"scatter3d","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"predicted","showbackground":true},"yaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"orthogonal 1","showbackground":true},"zaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"orthogonal 2","showbackground":true}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-6889.54837909101,-1573.34176511202,5980.89956750635,6946.33833983262,9304.86939365615,-4893.00721144922,-5566.38577336285,8472.64185052287,-3093.53154709166,-6040.89318423023,9614.78050008648,-4851.6657910829,-4505.30203345567,-2972.03479070885,-2323.61943411974,-1678.13776294842],"y":[7575.33573524436,6555.33011099704,1785.46212548229,472.365713370394,-1199.59265037934,6933.43254452376,7487.36513687159,44.025728546159,12961.1817578794,8824.97627320817,-2150.30506559214,7578.44821266592,7675.83324395767,6409.93295984824,7720.88884790847,7596.5659405992],"z":[-9422.31154067208,-12597.7647662586,-13500.561983723,-10270.845303496,-10296.1383874885,-11141.8368997238,-8169.69834932685,-11063.3506809117,-15264.8640529284,-9002.97767687437,-14150.0343719053,-12800.3607446998,-9026.72506006576,-12082.1576760671,-12502.5054609917,-13163.3667869221],"type":"scatter3d","mode":"markers","name":"Geodia barretti","marker":{"colorbar":{"title":"h.df.3d$md.Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1238,1332,1427,563,557,1370,542,440,1462,528,483,667,700,744],"symbol":"diamond","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1238,1332,1427,563,557,1370,542,440,1462,528,483,667,700,744]}},"frame":null},{"x":[-6276.50168717342,4654.9601856566,4825.50946783679,7450.23079158847,9547.63887733707,10549.6857350173,11013.3628270104,-3628.70002193729,-3419.15014834267,-1054.15395853377,-1125.1306578266,157.115512771321,931.315681319418],"y":[15976.6964601163,9518.65888738877,9439.27176460421,9691.86506288657,8075.62842507337,3993.81158467675,7827.36376481405,12195.3836634378,14196.2945133637,11643.6308753254,11891.2691218841,12695.3866163604,11649.342240399],"z":[14545.0808690175,9342.40230275808,10410.284759986,7949.11263180642,7504.75576744698,3725.08159875727,9704.16290761788,12400.8629033916,15314.5514308606,13522.0023233218,11050.242078961,13197.5249559914,11551.7015394406],"type":"scatter3d","mode":"markers","name":"Stryphnus fortis","marker":{"colorbar":{"title":"h.df.3d$md.Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887],"symbol":"x","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887]}},"frame":null},{"x":[-10232.2575772986,-613.19291686337,-697.684750981953,2076.07571781435,4799.63713321827,4155.19282541236,4076.80320646824,6877.27298254371,-3745.6717604236,-8908.66901480879,-6109.40491854402,-5552.02895623569,-5575.18229398772,-5164.44412483586,-2885.93175285137,-2058.75838230146],"y":[-9298.29390897714,-11650.5116372483,-12532.4317640723,-16576.5809215879,-19796.6671179785,-15788.7914567329,-21575.7743596275,-17202.42438071,-13878.8019473566,-9638.26971424233,-13561.9842754529,-16245.1479237821,-9931.73077895636,-15217.5554178651,-9970.34619632198,-12200.5377945499],"z":[3986.83320485544,2012.97721061062,2457.93147524211,450.4340086108,1946.07836543337,667.45653305372,3536.05165983109,-1501.94664474447,4280.40021488655,-894.264286978348,3865.01980039959,6290.14868992594,6418.95931395322,4831.91115489698,803.568502130281,5086.17447059137],"type":"scatter3d","mode":"markers","name":"Weberella bursa","marker":{"colorbar":{"title":"h.df.3d$md.Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,645,331,441,471,487,560,632,668],"symbol":"circle","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,645,331,441,471,487,560,632,668]}},"frame":null},{"x":[-10232.2575772986,11013.3628270104],"y":[-21575.7743596275,15976.6964601163],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"h.df.3d$md.Depth","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[244,1476],"line":{"color":"rgba(214,39,40,1)"}},"z":[-15264.8640529284,15314.5514308606],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 2.3: Multivariate analysis (OPLS) of all sponge metabolomes by depth. At this point, this is purely for overview. In depth methods and evaluation are provided in the section below.
</p>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="metabolomics.html#cb36-1"></a><span class="co"># for saving f&lt;- basename(tempfile(&#39;OPLS_metabolome_plotly&#39;, &#39;.&#39;, &#39;.html&#39;)) on.exit(unlink(f), add = TRUE) html &lt;- htmlwidgets::saveWidget(met3D, f)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="metabolomics.html#cb37-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb37-2"><a href="metabolomics.html#cb37-2"></a></span>
<span id="cb37-3"><a href="metabolomics.html#cb37-3"></a>permanova &lt;-<span class="st"> </span><span class="cf">function</span>(metabolome, md) {</span>
<span id="cb37-4"><a href="metabolomics.html#cb37-4"></a>    metabolome<span class="op">$</span>filter &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb37-5"><a href="metabolomics.html#cb37-5"></a>    md &lt;-<span class="st"> </span>md[md<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>metabolome<span class="op">$</span>unified_ID, ]</span>
<span id="cb37-6"><a href="metabolomics.html#cb37-6"></a>    metabolome &lt;-<span class="st"> </span>metabolome[<span class="kw">order</span>(metabolome<span class="op">$</span>unified_ID), ]</span>
<span id="cb37-7"><a href="metabolomics.html#cb37-7"></a>    md &lt;-<span class="st"> </span>md[<span class="kw">order</span>(md<span class="op">$</span>unified_ID), ]</span>
<span id="cb37-8"><a href="metabolomics.html#cb37-8"></a>    metabolome<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb37-9"><a href="metabolomics.html#cb37-9"></a>    m &lt;-<span class="st"> </span><span class="kw">adonis</span>(metabolome <span class="op">~</span><span class="st"> </span>Species, md)</span>
<span id="cb37-10"><a href="metabolomics.html#cb37-10"></a>    <span class="kw">return</span>(m)</span>
<span id="cb37-11"><a href="metabolomics.html#cb37-11"></a>}</span>
<span id="cb37-12"><a href="metabolomics.html#cb37-12"></a></span>
<span id="cb37-13"><a href="metabolomics.html#cb37-13"></a><span class="kw">permanova</span>(hilic_pos, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    5.6422 2.82112  34.302 0.62026  0.001 ***
## Residuals 42    3.4543 0.08224         0.37974           
## Total     44    9.0965                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="metabolomics.html#cb39-1"></a><span class="kw">permanova</span>(hilic_neg, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    2.0768 1.03838  26.046 0.55363  0.001 ***
## Residuals 42    1.6744 0.03987         0.44637           
## Total     44    3.7512                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="metabolomics.html#cb41-1"></a><span class="kw">permanova</span>(rp_pos, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model     R2 Pr(&gt;F)    
## Species    2    6.0969 3.04847  35.972 0.6314  0.001 ***
## Residuals 42    3.5593 0.08475         0.3686           
## Total     44    9.6563                 1.0000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="metabolomics.html#cb43-1"></a><span class="kw">permanova</span>(rp_neg, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    6.4179  3.2089  36.013 0.63725  0.001 ***
## Residuals 41    3.6533  0.0891         0.36275           
## Total     43   10.0712                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>From the PCA and the PERMANOVA (function <code>adonis</code>, Pr(&gt;F) is the <em>p-value</em>), we gather that the metabolomes regardless of how they were acquired are significatly different in the three sponge species. Therefore, we separate the metabolomes for investigating the effect of depth on them individually.</p>
<p>In order to investigate whether depth has an effect on the species-specific metabolomes, we use OPLS orthogonal projections of latent structures as multivariate analysis approach. This method allows to separate variations in the data based on e.g. depth and orthogonal, i.e. unrelated variation.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="metabolomics.html#cb45-1"></a><span class="co"># splitting df and adapting meta data</span></span>
<span id="cb45-2"><a href="metabolomics.html#cb45-2"></a>spl_ada &lt;-<span class="st"> </span><span class="cf">function</span>(metabolome, md) {</span>
<span id="cb45-3"><a href="metabolomics.html#cb45-3"></a>    metabolome_gb &lt;-<span class="st"> </span>metabolome[metabolome<span class="op">$</span>filter <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>, ]</span>
<span id="cb45-4"><a href="metabolomics.html#cb45-4"></a>    metabolome_sf &lt;-<span class="st"> </span>metabolome[metabolome<span class="op">$</span>filter <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>, ]</span>
<span id="cb45-5"><a href="metabolomics.html#cb45-5"></a>    metabolome_wb &lt;-<span class="st"> </span>metabolome[metabolome<span class="op">$</span>filter <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>, ]</span>
<span id="cb45-6"><a href="metabolomics.html#cb45-6"></a>    </span>
<span id="cb45-7"><a href="metabolomics.html#cb45-7"></a>    md_gb &lt;-<span class="st"> </span>md[md<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>metabolome_gb<span class="op">$</span>unified_ID, ]</span>
<span id="cb45-8"><a href="metabolomics.html#cb45-8"></a>    md_sf &lt;-<span class="st"> </span>md[md<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>metabolome_sf<span class="op">$</span>unified_ID, ]</span>
<span id="cb45-9"><a href="metabolomics.html#cb45-9"></a>    md_wb &lt;-<span class="st"> </span>md[md<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>metabolome_wb<span class="op">$</span>unified_ID, ]</span>
<span id="cb45-10"><a href="metabolomics.html#cb45-10"></a>    </span>
<span id="cb45-11"><a href="metabolomics.html#cb45-11"></a>    metabolome_gb &lt;-<span class="st"> </span>metabolome_gb[<span class="kw">order</span>(metabolome_gb<span class="op">$</span>unified_ID), ]</span>
<span id="cb45-12"><a href="metabolomics.html#cb45-12"></a>    metabolome_sf &lt;-<span class="st"> </span>metabolome_sf[<span class="kw">order</span>(metabolome_sf<span class="op">$</span>unified_ID), ]</span>
<span id="cb45-13"><a href="metabolomics.html#cb45-13"></a>    metabolome_wb &lt;-<span class="st"> </span>metabolome_wb[<span class="kw">order</span>(metabolome_wb<span class="op">$</span>unified_ID), ]</span>
<span id="cb45-14"><a href="metabolomics.html#cb45-14"></a>    </span>
<span id="cb45-15"><a href="metabolomics.html#cb45-15"></a>    metabolome_gb<span class="op">$</span>filter &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb45-16"><a href="metabolomics.html#cb45-16"></a>    metabolome_gb<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb45-17"><a href="metabolomics.html#cb45-17"></a>    metabolome_sf<span class="op">$</span>filter &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb45-18"><a href="metabolomics.html#cb45-18"></a>    metabolome_sf<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb45-19"><a href="metabolomics.html#cb45-19"></a>    metabolome_wb<span class="op">$</span>filter &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb45-20"><a href="metabolomics.html#cb45-20"></a>    metabolome_wb<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb45-21"><a href="metabolomics.html#cb45-21"></a>    </span>
<span id="cb45-22"><a href="metabolomics.html#cb45-22"></a>    md_gb &lt;-<span class="st"> </span>md_gb[<span class="kw">order</span>(md_gb<span class="op">$</span>unified_ID), ]</span>
<span id="cb45-23"><a href="metabolomics.html#cb45-23"></a>    md_sf &lt;-<span class="st"> </span>md_sf[<span class="kw">order</span>(md_sf<span class="op">$</span>unified_ID), ]</span>
<span id="cb45-24"><a href="metabolomics.html#cb45-24"></a>    md_wb &lt;-<span class="st"> </span>md_wb[<span class="kw">order</span>(md_wb<span class="op">$</span>unified_ID), ]</span>
<span id="cb45-25"><a href="metabolomics.html#cb45-25"></a>    </span>
<span id="cb45-26"><a href="metabolomics.html#cb45-26"></a>    mva_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">metabolome_gb =</span> metabolome_gb, <span class="dt">metabolome_sf =</span> metabolome_sf, <span class="dt">metabolome_wb =</span> metabolome_wb, <span class="dt">md_gb =</span> md_gb, <span class="dt">md_sf =</span> md_sf, <span class="dt">md_wb =</span> md_wb)</span>
<span id="cb45-27"><a href="metabolomics.html#cb45-27"></a>    <span class="kw">return</span>(mva_data)</span>
<span id="cb45-28"><a href="metabolomics.html#cb45-28"></a>}</span>
<span id="cb45-29"><a href="metabolomics.html#cb45-29"></a></span>
<span id="cb45-30"><a href="metabolomics.html#cb45-30"></a>hp_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(hilic_pos, md)</span>
<span id="cb45-31"><a href="metabolomics.html#cb45-31"></a>hn_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(hilic_neg, md)</span>
<span id="cb45-32"><a href="metabolomics.html#cb45-32"></a>rp_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(rp_pos, md)</span>
<span id="cb45-33"><a href="metabolomics.html#cb45-33"></a>rn_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(rp_neg, md)</span>
<span id="cb45-34"><a href="metabolomics.html#cb45-34"></a></span>
<span id="cb45-35"><a href="metabolomics.html#cb45-35"></a><span class="co"># P should be NA; or 1</span></span>
<span id="cb45-36"><a href="metabolomics.html#cb45-36"></a>ropls_wrapper &lt;-<span class="st"> </span><span class="cf">function</span>(opls_df, p1, p2, p3) {</span>
<span id="cb45-37"><a href="metabolomics.html#cb45-37"></a>    <span class="co"># ropls&#39; PCA</span></span>
<span id="cb45-38"><a href="metabolomics.html#cb45-38"></a>    gb.pca &lt;-<span class="st"> </span><span class="kw">opls</span>(opls_df<span class="op">$</span>metabolome_gb, <span class="dt">plotL =</span> F, <span class="dt">printL =</span> F)</span>
<span id="cb45-39"><a href="metabolomics.html#cb45-39"></a>    sf.pca &lt;-<span class="st"> </span><span class="kw">opls</span>(opls_df<span class="op">$</span>metabolome_sf, <span class="dt">plotL =</span> F, <span class="dt">printL =</span> F)</span>
<span id="cb45-40"><a href="metabolomics.html#cb45-40"></a>    wb.pca &lt;-<span class="st"> </span><span class="kw">opls</span>(opls_df<span class="op">$</span>metabolome_wb, <span class="dt">plotL =</span> F, <span class="dt">printL =</span> F)</span>
<span id="cb45-41"><a href="metabolomics.html#cb45-41"></a>    </span>
<span id="cb45-42"><a href="metabolomics.html#cb45-42"></a>    md_gb &lt;-<span class="st"> </span>opls_df<span class="op">$</span>md_gb</span>
<span id="cb45-43"><a href="metabolomics.html#cb45-43"></a>    md_sf &lt;-<span class="st"> </span>opls_df<span class="op">$</span>md_sf</span>
<span id="cb45-44"><a href="metabolomics.html#cb45-44"></a>    md_wb &lt;-<span class="st"> </span>opls_df<span class="op">$</span>md_wb</span>
<span id="cb45-45"><a href="metabolomics.html#cb45-45"></a>    </span>
<span id="cb45-46"><a href="metabolomics.html#cb45-46"></a>    <span class="co"># ropls&#39; OPLS</span></span>
<span id="cb45-47"><a href="metabolomics.html#cb45-47"></a>    gb.opls &lt;-<span class="st"> </span><span class="kw">opls</span>(opls_df<span class="op">$</span>metabolome_gb, md_gb[, <span class="st">&quot;Depth&quot;</span>], <span class="dt">permI =</span> <span class="dv">1000</span>, <span class="dt">orthoI =</span> p1, <span class="dt">scaleC =</span> <span class="st">&quot;pareto&quot;</span>, <span class="dt">plotL =</span> F)</span>
<span id="cb45-48"><a href="metabolomics.html#cb45-48"></a>    sf.opls &lt;-<span class="st"> </span><span class="kw">opls</span>(opls_df<span class="op">$</span>metabolome_sf, md_sf[, <span class="st">&quot;Depth&quot;</span>], <span class="dt">permI =</span> <span class="dv">1000</span>, <span class="dt">orthoI =</span> p2, <span class="dt">scaleC =</span> <span class="st">&quot;pareto&quot;</span>, <span class="dt">plotL =</span> F)</span>
<span id="cb45-49"><a href="metabolomics.html#cb45-49"></a>    wb.opls &lt;-<span class="st"> </span><span class="kw">opls</span>(opls_df<span class="op">$</span>metabolome_wb, md_wb[, <span class="st">&quot;Depth&quot;</span>], <span class="dt">permI =</span> <span class="dv">1000</span>, <span class="dt">orthoI =</span> p3, <span class="dt">scaleC =</span> <span class="st">&quot;pareto&quot;</span>, <span class="dt">plotL =</span> F)</span>
<span id="cb45-50"><a href="metabolomics.html#cb45-50"></a>    </span>
<span id="cb45-51"><a href="metabolomics.html#cb45-51"></a>    <span class="co"># summary</span></span>
<span id="cb45-52"><a href="metabolomics.html#cb45-52"></a>    gb.opls &lt;-<span class="st"> </span>gb.opls<span class="op">@</span>summaryDF</span>
<span id="cb45-53"><a href="metabolomics.html#cb45-53"></a>    sf.opls &lt;-<span class="st"> </span>sf.opls<span class="op">@</span>summaryDF</span>
<span id="cb45-54"><a href="metabolomics.html#cb45-54"></a>    wb.opls &lt;-<span class="st"> </span>wb.opls<span class="op">@</span>summaryDF</span>
<span id="cb45-55"><a href="metabolomics.html#cb45-55"></a>    </span>
<span id="cb45-56"><a href="metabolomics.html#cb45-56"></a>    opls_diagnostics &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb.opls, sf.opls, wb.opls)</span>
<span id="cb45-57"><a href="metabolomics.html#cb45-57"></a>    opls_diagnostics[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>, <span class="st">&quot;Stryphnus fortis&quot;</span>, <span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb45-58"><a href="metabolomics.html#cb45-58"></a>    <span class="kw">return</span>(opls_diagnostics)</span>
<span id="cb45-59"><a href="metabolomics.html#cb45-59"></a>}</span>
<span id="cb45-60"><a href="metabolomics.html#cb45-60"></a></span>
<span id="cb45-61"><a href="metabolomics.html#cb45-61"></a>a &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb45-62"><a href="metabolomics.html#cb45-62"></a>hp_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(hp_opls_df, <span class="ot">NA</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb45-63"><a href="metabolomics.html#cb45-63"></a>hn_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(hn_opls_df, <span class="ot">NA</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb45-64"><a href="metabolomics.html#cb45-64"></a>rp_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(rp_opls_df, <span class="ot">NA</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb45-65"><a href="metabolomics.html#cb45-65"></a>rn_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(rn_opls_df, <span class="dv">1</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb45-66"><a href="metabolomics.html#cb45-66"></a>b &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb45-67"><a href="metabolomics.html#cb45-67"></a>b <span class="op">-</span><span class="st"> </span>a</span>
<span id="cb45-68"><a href="metabolomics.html#cb45-68"></a></span>
<span id="cb45-69"><a href="metabolomics.html#cb45-69"></a>cleaned &lt;-<span class="st"> </span><span class="kw">rbind</span>(hp_cleaned_opls, hn_cleaned_opls, rp_cleaned_opls, rn_cleaned_opls)</span>
<span id="cb45-70"><a href="metabolomics.html#cb45-70"></a>cleaned[<span class="st">&quot;Experiment&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;HILIC pos&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;HILIC neg&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;RP pos&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;RP neg&quot;</span>, <span class="dv">3</span>))</span>
<span id="cb45-71"><a href="metabolomics.html#cb45-71"></a><span class="kw">write.csv</span>(cleaned, <span class="st">&quot;data/cleaned_opls_diagnostics.csv&quot;</span>, <span class="dt">row.names =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="metabolomics.html#cb46-1"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;data/opls_Gb_Hp.jpeg&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:ropls-figure"></span>
<img src="data/opls_Gb_Hp.jpeg" alt="Example output for OPLS models generated with ROPLS. This is HILIC positive cleaned data set for _G. barretti_." width="150%" />
<p class="caption">
Figure 2.4: Example output for OPLS models generated with ROPLS. This is HILIC positive cleaned data set for <em>G. barretti</em>.
</p>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="metabolomics.html#cb47-1"></a><span class="co"># R2X: The fraction of the variation of the X variables explained by the model.  R2Y: The fraction of the variation of the Y variables explained by the model.</span></span>
<span id="cb47-2"><a href="metabolomics.html#cb47-2"></a><span class="co"># Q2X: The fraction of the variation of the X variables predicted by the model.  Q2Y: The fraction of the variation of the Y variables predicted by the model.</span></span></code></pre></div>
<p>In the same manner, we can analyse the two remaining sets produced by different filtering options.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="metabolomics.html#cb48-1"></a><span class="co"># load data ION</span></span>
<span id="cb48-2"><a href="metabolomics.html#cb48-2"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_pos_20190417_cleaned_MH.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-3"><a href="metabolomics.html#cb48-3"></a>hilic_neg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_neg_20190421_cleaned_MH.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-4"><a href="metabolomics.html#cb48-4"></a>rp_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_pos_20190421_cleaned_MH.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-5"><a href="metabolomics.html#cb48-5"></a>rp_neg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_neg_20190422_cleaned_MH.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-6"><a href="metabolomics.html#cb48-6"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb48-7"><a href="metabolomics.html#cb48-7"></a></span>
<span id="cb48-8"><a href="metabolomics.html#cb48-8"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_pos, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.HILIC.positive&quot;</span>)</span>
<span id="cb48-9"><a href="metabolomics.html#cb48-9"></a>hilic_neg &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_neg, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.HILIC.negative&quot;</span>)</span>
<span id="cb48-10"><a href="metabolomics.html#cb48-10"></a>rp_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(rp_pos, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.RP.positive&quot;</span>)</span>
<span id="cb48-11"><a href="metabolomics.html#cb48-11"></a>rp_neg &lt;-<span class="st"> </span><span class="kw">formatting</span>(rp_neg, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.RP.negative&quot;</span>)</span>
<span id="cb48-12"><a href="metabolomics.html#cb48-12"></a></span>
<span id="cb48-13"><a href="metabolomics.html#cb48-13"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;YEAR&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)]</span>
<span id="cb48-14"><a href="metabolomics.html#cb48-14"></a></span>
<span id="cb48-15"><a href="metabolomics.html#cb48-15"></a>hp_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(hilic_pos, md, <span class="st">&quot;Hilic pos&quot;</span>)</span>
<span id="cb48-16"><a href="metabolomics.html#cb48-16"></a>hn_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(hilic_neg, md, <span class="st">&quot;Hilic neg&quot;</span>)</span>
<span id="cb48-17"><a href="metabolomics.html#cb48-17"></a>rp_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(rp_pos, md, <span class="st">&quot;RP pos&quot;</span>)</span>
<span id="cb48-18"><a href="metabolomics.html#cb48-18"></a>rn_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(rp_neg, md, <span class="st">&quot;RP neg&quot;</span>)</span>
<span id="cb48-19"><a href="metabolomics.html#cb48-19"></a></span>
<span id="cb48-20"><a href="metabolomics.html#cb48-20"></a><span class="kw">grid.arrange</span>(hp_pca, hn_pca, rp_pca, rn_pca, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:opls-2a"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/opls-2a-1.png" alt="PCA of the metabolome data set filtered to retain only annotated ions. Dots are Gb samples, squares are Wb samples, traingles are Sf samples." width="672" />
<p class="caption">
Figure 2.5: PCA of the metabolome data set filtered to retain only annotated ions. Dots are Gb samples, squares are Wb samples, traingles are Sf samples.
</p>
</div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="metabolomics.html#cb49-1"></a><span class="kw">permanova</span>(hilic_pos, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    7.9121  3.9560  48.131 0.69623  0.001 ***
## Residuals 42    3.4521  0.0822         0.30377           
## Total     44   11.3642                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="metabolomics.html#cb51-1"></a><span class="kw">permanova</span>(hilic_neg, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2   1.23799 0.61899  31.471 0.59978  0.001 ***
## Residuals 42   0.82609 0.01967         0.40022           
## Total     44   2.06408                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="metabolomics.html#cb53-1"></a><span class="kw">permanova</span>(rp_pos, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    8.9172  4.4586  52.824 0.71554  0.001 ***
## Residuals 42    3.5450  0.0844         0.28446           
## Total     44   12.4621                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="metabolomics.html#cb55-1"></a><span class="kw">permanova</span>(rp_neg, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    7.4863  3.7432  33.508 0.62043  0.001 ***
## Residuals 41    4.5801  0.1117         0.37957           
## Total     43   12.0665                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="metabolomics.html#cb57-1"></a>hp_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(hilic_pos, md)</span>
<span id="cb57-2"><a href="metabolomics.html#cb57-2"></a>hn_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(hilic_neg, md)</span>
<span id="cb57-3"><a href="metabolomics.html#cb57-3"></a>rp_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(rp_pos, md)</span>
<span id="cb57-4"><a href="metabolomics.html#cb57-4"></a>rn_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(rp_neg, md)</span>
<span id="cb57-5"><a href="metabolomics.html#cb57-5"></a></span>
<span id="cb57-6"><a href="metabolomics.html#cb57-6"></a>a &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb57-7"><a href="metabolomics.html#cb57-7"></a>hp_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(hp_opls_df, <span class="ot">NA</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb57-8"><a href="metabolomics.html#cb57-8"></a>hn_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(hn_opls_df, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)</span>
<span id="cb57-9"><a href="metabolomics.html#cb57-9"></a>rp_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(rp_opls_df, <span class="ot">NA</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb57-10"><a href="metabolomics.html#cb57-10"></a>rn_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(rn_opls_df, <span class="dv">1</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb57-11"><a href="metabolomics.html#cb57-11"></a>b &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb57-12"><a href="metabolomics.html#cb57-12"></a>b <span class="op">-</span><span class="st"> </span>a</span>
<span id="cb57-13"><a href="metabolomics.html#cb57-13"></a></span>
<span id="cb57-14"><a href="metabolomics.html#cb57-14"></a>ion &lt;-<span class="st"> </span><span class="kw">rbind</span>(hp_cleaned_opls, hn_cleaned_opls, rp_cleaned_opls, rn_cleaned_opls)</span>
<span id="cb57-15"><a href="metabolomics.html#cb57-15"></a>ion[<span class="st">&quot;Experiment&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;HILIC pos&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;HILIC neg&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;RP pos&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;RP neg&quot;</span>, <span class="dv">3</span>))</span>
<span id="cb57-16"><a href="metabolomics.html#cb57-16"></a><span class="kw">write.csv</span>(ion, <span class="st">&quot;data/cleaned_MH_opls_diagnostics.csv&quot;</span>, <span class="dt">row.names =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="metabolomics.html#cb58-1"></a><span class="co"># load data PC_GROUP</span></span>
<span id="cb58-2"><a href="metabolomics.html#cb58-2"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_pos_20190417_cleaned_pcgroup.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb58-3"><a href="metabolomics.html#cb58-3"></a>hilic_neg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HILIC_neg_20190421_cleaned_pcgroup.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb58-4"><a href="metabolomics.html#cb58-4"></a>rp_pos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_pos_20190421_cleaned_pcgroup.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb58-5"><a href="metabolomics.html#cb58-5"></a>rp_neg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/RP_neg_20190422_cleaned_pcgroup.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb58-6"><a href="metabolomics.html#cb58-6"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb58-7"><a href="metabolomics.html#cb58-7"></a></span>
<span id="cb58-8"><a href="metabolomics.html#cb58-8"></a>hilic_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_pos, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.HILIC.positive&quot;</span>)</span>
<span id="cb58-9"><a href="metabolomics.html#cb58-9"></a>hilic_neg &lt;-<span class="st"> </span><span class="kw">formatting</span>(hilic_neg, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.HILIC.negative&quot;</span>)</span>
<span id="cb58-10"><a href="metabolomics.html#cb58-10"></a>rp_pos &lt;-<span class="st"> </span><span class="kw">formatting</span>(rp_pos, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.RP.positive&quot;</span>)</span>
<span id="cb58-11"><a href="metabolomics.html#cb58-11"></a>rp_neg &lt;-<span class="st"> </span><span class="kw">formatting</span>(rp_neg, meta_data, <span class="dv">8</span>, <span class="st">&quot;LC.MS.RP.negative&quot;</span>)</span>
<span id="cb58-12"><a href="metabolomics.html#cb58-12"></a></span>
<span id="cb58-13"><a href="metabolomics.html#cb58-13"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;YEAR&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)]</span>
<span id="cb58-14"><a href="metabolomics.html#cb58-14"></a></span>
<span id="cb58-15"><a href="metabolomics.html#cb58-15"></a>hp_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(hilic_pos, md, <span class="st">&quot;Hilic pos&quot;</span>)</span>
<span id="cb58-16"><a href="metabolomics.html#cb58-16"></a>hn_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(hilic_neg, md, <span class="st">&quot;Hilic neg&quot;</span>)</span>
<span id="cb58-17"><a href="metabolomics.html#cb58-17"></a>rp_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(rp_pos, md, <span class="st">&quot;RP pos&quot;</span>)</span>
<span id="cb58-18"><a href="metabolomics.html#cb58-18"></a>rn_pca &lt;-<span class="st"> </span><span class="kw">pca_wrapper</span>(rp_neg, md, <span class="st">&quot;RP neg&quot;</span>)</span>
<span id="cb58-19"><a href="metabolomics.html#cb58-19"></a></span>
<span id="cb58-20"><a href="metabolomics.html#cb58-20"></a><span class="kw">grid.arrange</span>(hp_pca, hn_pca, rp_pca, rn_pca, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:opls-3a"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/opls-3a-1.png" alt="PCA of the metabolome data set filtered to retain the feature with the strongest signal per PC group. Dots are Gb samples, squares are Wb samples, traingles are Sf samples." width="672" />
<p class="caption">
Figure 2.6: PCA of the metabolome data set filtered to retain the feature with the strongest signal per PC group. Dots are Gb samples, squares are Wb samples, traingles are Sf samples.
</p>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="metabolomics.html#cb59-1"></a><span class="kw">permanova</span>(hilic_pos, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model     R2 Pr(&gt;F)    
## Species    2    6.0660 3.03302  33.376 0.6138  0.001 ***
## Residuals 42    3.8167 0.09087         0.3862           
## Total     44    9.8828                 1.0000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="metabolomics.html#cb61-1"></a><span class="kw">permanova</span>(hilic_neg, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model     R2 Pr(&gt;F)    
## Species    2    5.1323 2.56616  32.819 0.6098  0.001 ***
## Residuals 42    3.2840 0.07819         0.3902           
## Total     44    8.4163                 1.0000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="metabolomics.html#cb63-1"></a><span class="kw">permanova</span>(rp_pos, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    5.7191 2.85957  35.582 0.62886  0.001 ***
## Residuals 42    3.3754 0.08037         0.37114           
## Total     44    9.0945                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="metabolomics.html#cb65-1"></a><span class="kw">permanova</span>(rp_neg, md)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = metabolome ~ Species, data = md) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##           Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## Species    2    6.8700  3.4350  33.333 0.61919  0.001 ***
## Residuals 41    4.2251  0.1031         0.38081           
## Total     43   11.0952                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="metabolomics.html#cb67-1"></a>hp_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(hilic_pos, md)</span>
<span id="cb67-2"><a href="metabolomics.html#cb67-2"></a>hn_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(hilic_neg, md)</span>
<span id="cb67-3"><a href="metabolomics.html#cb67-3"></a>rp_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(rp_pos, md)</span>
<span id="cb67-4"><a href="metabolomics.html#cb67-4"></a>rn_opls_df &lt;-<span class="st"> </span><span class="kw">spl_ada</span>(rp_neg, md)</span>
<span id="cb67-5"><a href="metabolomics.html#cb67-5"></a></span>
<span id="cb67-6"><a href="metabolomics.html#cb67-6"></a>a &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb67-7"><a href="metabolomics.html#cb67-7"></a>hp_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(hp_opls_df, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)</span>
<span id="cb67-8"><a href="metabolomics.html#cb67-8"></a>hn_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(hn_opls_df, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)</span>
<span id="cb67-9"><a href="metabolomics.html#cb67-9"></a>rp_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(rp_opls_df, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)</span>
<span id="cb67-10"><a href="metabolomics.html#cb67-10"></a>rn_cleaned_opls &lt;-<span class="st"> </span><span class="kw">ropls_wrapper</span>(rn_opls_df, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)</span>
<span id="cb67-11"><a href="metabolomics.html#cb67-11"></a>b &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb67-12"><a href="metabolomics.html#cb67-12"></a>b <span class="op">-</span><span class="st"> </span>a</span>
<span id="cb67-13"><a href="metabolomics.html#cb67-13"></a></span>
<span id="cb67-14"><a href="metabolomics.html#cb67-14"></a>pcg &lt;-<span class="st"> </span><span class="kw">rbind</span>(hp_cleaned_opls, hn_cleaned_opls, rp_cleaned_opls, rn_cleaned_opls)</span>
<span id="cb67-15"><a href="metabolomics.html#cb67-15"></a>pcg[<span class="st">&quot;Experiment&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;HILIC pos&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;HILIC neg&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;RP pos&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;RP neg&quot;</span>, <span class="dv">3</span>))</span>
<span id="cb67-16"><a href="metabolomics.html#cb67-16"></a><span class="kw">write.csv</span>(pcg, <span class="st">&quot;data/cleaned_PC_opls_diagnostics.csv&quot;</span>, <span class="dt">row.names =</span> F)</span></code></pre></div>
<p>In some cases, an OPLS model was not appropriate. Typically, the model chooses the number of orthogonal components by itself (<code>orthI=NA</code>) and when the first component is not significant, the model building will stop. However, one can force any number of orthogonal components and run the OPLS model anyway. You can spot those cases when the <code>NA</code> was set to <code>1</code> in the <code>ropls_wrapper</code> function</p>
<p>The multivariate analyses (OPLS) were quite time consuming, requiring 1.4 hours for the “cleaned” data sets, 46.3 min for the “PC-group” data stes and 4 min for the “ion” data sets on my system. Therefore, the combined model diagnostics are summarised in Tab <a href="#tab:opls4"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="metabolomics.html#cb68-1"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb68-2"><a href="metabolomics.html#cb68-2"></a>cleaned &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/cleaned_opls_diagnostics.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb68-3"><a href="metabolomics.html#cb68-3"></a>pcgrp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/cleaned_PC_opls_diagnostics.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb68-4"><a href="metabolomics.html#cb68-4"></a>ion &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/cleaned_MH_opls_diagnostics.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb68-5"><a href="metabolomics.html#cb68-5"></a></span>
<span id="cb68-6"><a href="metabolomics.html#cb68-6"></a>opls_diagnostics &lt;-<span class="st"> </span><span class="kw">rbind</span>(cleaned, pcgrp, ion)</span>
<span id="cb68-7"><a href="metabolomics.html#cb68-7"></a>opls_diagnostics[<span class="st">&quot;filtering&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;cleaned&quot;</span>, <span class="dv">12</span>), <span class="kw">rep</span>(<span class="st">&quot;pc group&quot;</span>, <span class="dv">12</span>), <span class="kw">rep</span>(<span class="st">&quot;ion&quot;</span>, <span class="dv">12</span>))</span>
<span id="cb68-8"><a href="metabolomics.html#cb68-8"></a></span>
<span id="cb68-9"><a href="metabolomics.html#cb68-9"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb68-10"><a href="metabolomics.html#cb68-10"></a><span class="kw">kable</span>(opls_diagnostics, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;R2X cum&quot;</span>, <span class="st">&quot;R2Y cum&quot;</span>, <span class="st">&quot;Q2 cum&quot;</span>, <span class="st">&quot;RMSEE&quot;</span>, <span class="st">&quot;pre&quot;</span>, <span class="st">&quot;ort&quot;</span>, <span class="st">&quot;pR2Y&quot;</span>, <span class="st">&quot;pQ2&quot;</span>, <span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Experiment&quot;</span>, <span class="st">&quot;data set&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb68-11"><a href="metabolomics.html#cb68-11"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Model diagnostics of the metabolome variations modelled by depth&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="dt">Diagnostics =</span> <span class="dv">8</span>, <span class="st">`</span><span class="dt">Data set attribution</span><span class="st">`</span> =<span class="st"> </span><span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-12"><a href="metabolomics.html#cb68-12"></a><span class="st">    </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb68-13"><a href="metabolomics.html#cb68-13"></a>        <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">R2X cum</th>
<th align="right">R2Y cum</th>
<th align="right">Q2 cum</th>
<th align="right">RMSEE</th>
<th align="right">pre</th>
<th align="right">ort</th>
<th align="right">pR2Y</th>
<th align="right">pQ2</th>
<th align="left">Species</th>
<th align="left">Experiment</th>
<th align="left">data set</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.425</td>
<td align="right">0.998</td>
<td align="right">0.8670</td>
<td align="right">19.7</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="left">Geodia barretti</td>
<td align="left">HILIC pos</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td align="right">0.257</td>
<td align="right">0.988</td>
<td align="right">0.6530</td>
<td align="right">42.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.067</td>
<td align="right">0.002</td>
<td align="left">Stryphnus fortis</td>
<td align="left">HILIC pos</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td align="right">0.496</td>
<td align="right">0.999</td>
<td align="right">0.5490</td>
<td align="right">13.7</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.002</td>
<td align="right">0.028</td>
<td align="left">Weberella bursa</td>
<td align="left">HILIC pos</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td align="right">0.464</td>
<td align="right">0.988</td>
<td align="right">0.7670</td>
<td align="right">47.4</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.010</td>
<td align="right">0.001</td>
<td align="left">Geodia barretti</td>
<td align="left">HILIC neg</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td align="right">0.436</td>
<td align="right">0.924</td>
<td align="right">0.6290</td>
<td align="right">106.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.074</td>
<td align="right">0.002</td>
<td align="left">Stryphnus fortis</td>
<td align="left">HILIC neg</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td align="right">0.366</td>
<td align="right">0.985</td>
<td align="right">0.5560</td>
<td align="right">42.4</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.233</td>
<td align="right">0.013</td>
<td align="left">Weberella bursa</td>
<td align="left">HILIC neg</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td align="right">0.585</td>
<td align="right">0.998</td>
<td align="right">0.7960</td>
<td align="right">22.6</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.003</td>
<td align="right">0.001</td>
<td align="left">Geodia barretti</td>
<td align="left">RP pos</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td align="right">0.328</td>
<td align="right">0.965</td>
<td align="right">0.5680</td>
<td align="right">71.5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.039</td>
<td align="right">0.010</td>
<td align="left">Stryphnus fortis</td>
<td align="left">RP pos</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td align="right">0.343</td>
<td align="right">0.980</td>
<td align="right">0.3350</td>
<td align="right">48.8</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.113</td>
<td align="right">0.108</td>
<td align="left">Weberella bursa</td>
<td align="left">RP pos</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td align="right">0.304</td>
<td align="right">0.937</td>
<td align="right">0.6140</td>
<td align="right">99.8</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.040</td>
<td align="right">0.003</td>
<td align="left">Geodia barretti</td>
<td align="left">RP neg</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td align="right">0.390</td>
<td align="right">0.924</td>
<td align="right">0.5060</td>
<td align="right">106.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.089</td>
<td align="right">0.015</td>
<td align="left">Stryphnus fortis</td>
<td align="left">RP neg</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td align="right">0.412</td>
<td align="right">0.985</td>
<td align="right">0.4500</td>
<td align="right">41.9</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.029</td>
<td align="right">0.027</td>
<td align="left">Weberella bursa</td>
<td align="left">RP neg</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td align="right">0.429</td>
<td align="right">0.997</td>
<td align="right">0.8660</td>
<td align="right">23.7</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.003</td>
<td align="right">0.001</td>
<td align="left">Geodia barretti</td>
<td align="left">HILIC pos</td>
<td align="left">pc group</td>
</tr>
<tr class="even">
<td align="right">0.362</td>
<td align="right">0.998</td>
<td align="right">0.7020</td>
<td align="right">19.9</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.049</td>
<td align="right">0.004</td>
<td align="left">Stryphnus fortis</td>
<td align="left">HILIC pos</td>
<td align="left">pc group</td>
</tr>
<tr class="odd">
<td align="right">0.542</td>
<td align="right">0.995</td>
<td align="right">0.5820</td>
<td align="right">25.9</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.114</td>
<td align="right">0.015</td>
<td align="left">Weberella bursa</td>
<td align="left">HILIC pos</td>
<td align="left">pc group</td>
</tr>
<tr class="even">
<td align="right">0.499</td>
<td align="right">0.990</td>
<td align="right">0.7500</td>
<td align="right">43.2</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.004</td>
<td align="right">0.002</td>
<td align="left">Geodia barretti</td>
<td align="left">HILIC neg</td>
<td align="left">pc group</td>
</tr>
<tr class="odd">
<td align="right">0.433</td>
<td align="right">0.990</td>
<td align="right">0.7230</td>
<td align="right">40.9</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.068</td>
<td align="right">0.002</td>
<td align="left">Stryphnus fortis</td>
<td align="left">HILIC neg</td>
<td align="left">pc group</td>
</tr>
<tr class="even">
<td align="right">0.390</td>
<td align="right">0.986</td>
<td align="right">0.6000</td>
<td align="right">39.8</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.132</td>
<td align="right">0.005</td>
<td align="left">Weberella bursa</td>
<td align="left">HILIC neg</td>
<td align="left">pc group</td>
</tr>
<tr class="odd">
<td align="right">0.602</td>
<td align="right">0.996</td>
<td align="right">0.8090</td>
<td align="right">28.9</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.014</td>
<td align="right">0.001</td>
<td align="left">Geodia barretti</td>
<td align="left">RP pos</td>
<td align="left">pc group</td>
</tr>
<tr class="even">
<td align="right">0.464</td>
<td align="right">0.990</td>
<td align="right">0.5850</td>
<td align="right">40.9</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.122</td>
<td align="right">0.017</td>
<td align="left">Stryphnus fortis</td>
<td align="left">RP pos</td>
<td align="left">pc group</td>
</tr>
<tr class="odd">
<td align="right">0.393</td>
<td align="right">0.979</td>
<td align="right">0.3590</td>
<td align="right">49.8</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.045</td>
<td align="right">0.115</td>
<td align="left">Weberella bursa</td>
<td align="left">RP pos</td>
<td align="left">pc group</td>
</tr>
<tr class="even">
<td align="right">0.373</td>
<td align="right">0.979</td>
<td align="right">0.6850</td>
<td align="right">59.9</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.137</td>
<td align="right">0.002</td>
<td align="left">Geodia barretti</td>
<td align="left">RP neg</td>
<td align="left">pc group</td>
</tr>
<tr class="odd">
<td align="right">0.637</td>
<td align="right">0.991</td>
<td align="right">0.6140</td>
<td align="right">39.9</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.455</td>
<td align="right">0.035</td>
<td align="left">Stryphnus fortis</td>
<td align="left">RP neg</td>
<td align="left">pc group</td>
</tr>
<tr class="even">
<td align="right">0.440</td>
<td align="right">0.980</td>
<td align="right">0.4170</td>
<td align="right">48.6</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.089</td>
<td align="right">0.049</td>
<td align="left">Weberella bursa</td>
<td align="left">RP neg</td>
<td align="left">pc group</td>
</tr>
<tr class="odd">
<td align="right">0.761</td>
<td align="right">0.995</td>
<td align="right">0.6610</td>
<td align="right">34.2</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.072</td>
<td align="right">0.018</td>
<td align="left">Geodia barretti</td>
<td align="left">HILIC pos</td>
<td align="left">ion</td>
</tr>
<tr class="even">
<td align="right">0.294</td>
<td align="right">0.915</td>
<td align="right">0.3540</td>
<td align="right">112.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.226</td>
<td align="right">0.109</td>
<td align="left">Stryphnus fortis</td>
<td align="left">HILIC pos</td>
<td align="left">ion</td>
</tr>
<tr class="odd">
<td align="right">0.694</td>
<td align="right">0.988</td>
<td align="right">0.6570</td>
<td align="right">40.2</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.032</td>
<td align="right">0.019</td>
<td align="left">Weberella bursa</td>
<td align="left">HILIC pos</td>
<td align="left">ion</td>
</tr>
<tr class="even">
<td align="right">0.401</td>
<td align="right">0.942</td>
<td align="right">0.6580</td>
<td align="right">105.0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.013</td>
<td align="right">0.002</td>
<td align="left">Geodia barretti</td>
<td align="left">HILIC neg</td>
<td align="left">ion</td>
</tr>
<tr class="odd">
<td align="right">0.815</td>
<td align="right">0.992</td>
<td align="right">0.7570</td>
<td align="right">39.5</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.007</td>
<td align="right">0.008</td>
<td align="left">Stryphnus fortis</td>
<td align="left">HILIC neg</td>
<td align="left">ion</td>
</tr>
<tr class="even">
<td align="right">0.556</td>
<td align="right">0.949</td>
<td align="right">0.6530</td>
<td align="right">77.3</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.005</td>
<td align="right">0.004</td>
<td align="left">Weberella bursa</td>
<td align="left">HILIC neg</td>
<td align="left">ion</td>
</tr>
<tr class="odd">
<td align="right">0.778</td>
<td align="right">0.910</td>
<td align="right">0.7940</td>
<td align="right">126.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="left">Geodia barretti</td>
<td align="left">RP pos</td>
<td align="left">ion</td>
</tr>
<tr class="even">
<td align="right">0.368</td>
<td align="right">0.874</td>
<td align="right">0.2560</td>
<td align="right">137.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.026</td>
<td align="right">0.159</td>
<td align="left">Stryphnus fortis</td>
<td align="left">RP pos</td>
<td align="left">ion</td>
</tr>
<tr class="odd">
<td align="right">0.479</td>
<td align="right">0.960</td>
<td align="right">0.4060</td>
<td align="right">68.1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.005</td>
<td align="right">0.032</td>
<td align="left">Weberella bursa</td>
<td align="left">RP pos</td>
<td align="left">ion</td>
</tr>
<tr class="even">
<td align="right">0.430</td>
<td align="right">0.624</td>
<td align="right">0.0345</td>
<td align="right">244.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.268</td>
<td align="right">0.198</td>
<td align="left">Geodia barretti</td>
<td align="left">RP neg</td>
<td align="left">ion</td>
</tr>
<tr class="odd">
<td align="right">0.821</td>
<td align="right">0.392</td>
<td align="right">0.0936</td>
<td align="right">300.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.585</td>
<td align="right">0.190</td>
<td align="left">Stryphnus fortis</td>
<td align="left">RP neg</td>
<td align="left">ion</td>
</tr>
<tr class="even">
<td align="right">0.804</td>
<td align="right">0.973</td>
<td align="right">0.5850</td>
<td align="right">61.8</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.065</td>
<td align="right">0.027</td>
<td align="left">Weberella bursa</td>
<td align="left">RP neg</td>
<td align="left">ion</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="metabolomics.html#cb69-1"></a><span class="co"># write.csv(opls_diagnostics, &#39;data/opls_diagnostics.csv&#39;, row.names = F)</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="metabolomics.html#cb70-1"></a>opls_diagnostics<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw">as.character</span>(opls_diagnostics<span class="op">$</span>Species)</span>
<span id="cb70-2"><a href="metabolomics.html#cb70-2"></a>opls_diagnostics<span class="op">$</span>Species[opls_diagnostics<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Geodia barretti&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;G. barretti&quot;</span>)</span>
<span id="cb70-3"><a href="metabolomics.html#cb70-3"></a>opls_diagnostics<span class="op">$</span>Species[opls_diagnostics<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Stryphnus fortis&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;S. fortis&quot;</span>)</span>
<span id="cb70-4"><a href="metabolomics.html#cb70-4"></a>opls_diagnostics<span class="op">$</span>Species[opls_diagnostics<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Weberella bursa&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;W. bursa&quot;</span>)</span>
<span id="cb70-5"><a href="metabolomics.html#cb70-5"></a></span>
<span id="cb70-6"><a href="metabolomics.html#cb70-6"></a>k &lt;-<span class="st"> </span><span class="kw">ggplot</span>(opls_diagnostics, <span class="kw">aes</span>(<span class="dt">x =</span> R2X.cum., <span class="dt">y =</span> Q2.cum.)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">col =</span> Species, <span class="dt">shape =</span> Experiment)) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb70-7"><a href="metabolomics.html#cb70-7"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;R2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Q2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">col =</span> <span class="kw">guide_legend</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>), <span class="dt">shape =</span> <span class="kw">guide_legend</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb70-8"><a href="metabolomics.html#cb70-8"></a><span class="kw">library</span>(ggExtra)</span>
<span id="cb70-9"><a href="metabolomics.html#cb70-9"></a><span class="kw">ggMarginal</span>(k, <span class="dt">groupColour =</span> <span class="ot">TRUE</span>, <span class="dt">groupFill =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:opls-results"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/opls-results-1.png" alt="Model performance visualised. The larger R2 and Q2, the better the model fits with our data." width="672" />
<p class="caption">
Figure 2.7: Model performance visualised. The larger R2 and Q2, the better the model fits with our data.
</p>
</div>
</div>
<div id="vips" class="section level2">
<h2><span class="header-section-number">2.5</span> VIPS</h2>
<p>From the multivariate model (OPLS) you can derive a vaiable importance in projection (VIF) score for every feature in this model. This is a approximation (but not a statistics test!) of features that support the model.
A feature with a VIP score <span class="math inline">\(\geq\)</span> 1 is considered important and the higher the score, the greater the contribution to the model.</p>
</div>
<div id="metabolites-and-correlations" class="section level2">
<h2><span class="header-section-number">2.6</span> Metabolites and correlations</h2>
<p>A manually curated data set of signal intensities was produced for analysis of identified known and novel compounds.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="metabolomics.html#cb71-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb71-2"><a href="metabolomics.html#cb71-2"></a><span class="kw">library</span>(ggrepel)</span>
<span id="cb71-3"><a href="metabolomics.html#cb71-3"></a><span class="kw">library</span>(reshape)</span>
<span id="cb71-4"><a href="metabolomics.html#cb71-4"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb71-5"><a href="metabolomics.html#cb71-5"></a><span class="kw">library</span>(forcats)</span>
<span id="cb71-6"><a href="metabolomics.html#cb71-6"></a></span>
<span id="cb71-7"><a href="metabolomics.html#cb71-7"></a>cmp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/metabolite_master_20190605.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb71-8"><a href="metabolomics.html#cb71-8"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb71-9"><a href="metabolomics.html#cb71-9"></a>md &lt;-<span class="st"> </span>meta_data[<span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)]</span>
<span id="cb71-10"><a href="metabolomics.html#cb71-10"></a></span>
<span id="cb71-11"><a href="metabolomics.html#cb71-11"></a><span class="co"># FUN prep: remove, QC samples format depth and IDs</span></span>
<span id="cb71-12"><a href="metabolomics.html#cb71-12"></a>prep &lt;-<span class="st"> </span><span class="cf">function</span>(metabolites, md) {</span>
<span id="cb71-13"><a href="metabolomics.html#cb71-13"></a>    metabolites<span class="op">$</span>X &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb71-14"><a href="metabolomics.html#cb71-14"></a>    metabolites[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(metabolites<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb71-15"><a href="metabolomics.html#cb71-15"></a>    metabolites &lt;-<span class="st"> </span>metabolites[<span class="op">!</span>metabolites<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;QC&quot;</span>, ]</span>
<span id="cb71-16"><a href="metabolomics.html#cb71-16"></a>    metabolites &lt;-<span class="st"> </span><span class="kw">left_join</span>(metabolites, md)</span>
<span id="cb71-17"><a href="metabolomics.html#cb71-17"></a>    metabolites &lt;-<span class="st"> </span>metabolites[<span class="op">-</span><span class="kw">c</span>(<span class="dv">9</span>), ]  <span class="co">#removes Gb16 (Geodia atlantica)</span></span>
<span id="cb71-18"><a href="metabolomics.html#cb71-18"></a>    metabolites<span class="op">$</span>Depth &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(metabolites<span class="op">$</span>Depth)</span>
<span id="cb71-19"><a href="metabolomics.html#cb71-19"></a>    metabolites &lt;-<span class="st"> </span>metabolites[<span class="kw">with</span>(metabolites, <span class="kw">order</span>(metabolites<span class="op">$</span>spec, metabolites<span class="op">$</span>Depth)), ]</span>
<span id="cb71-20"><a href="metabolomics.html#cb71-20"></a>    metabolites[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(metabolites, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) </span>
<span id="cb71-21"><a href="metabolomics.html#cb71-21"></a>        <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb71-22"><a href="metabolomics.html#cb71-22"></a>    metabolites<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="kw">factor</span>(metabolites<span class="op">$</span>unified_ID, <span class="dt">levels =</span> metabolites<span class="op">$</span>unified_ID)</span>
<span id="cb71-23"><a href="metabolomics.html#cb71-23"></a>    <span class="kw">return</span>(metabolites)</span>
<span id="cb71-24"><a href="metabolomics.html#cb71-24"></a>}</span>
<span id="cb71-25"><a href="metabolomics.html#cb71-25"></a></span>
<span id="cb71-26"><a href="metabolomics.html#cb71-26"></a>metabolites &lt;-<span class="st"> </span><span class="kw">prep</span>(cmp, md)</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="metabolomics.html#cb72-1"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb72-2"><a href="metabolomics.html#cb72-2"></a>mets &lt;-<span class="st"> </span>metabolites[, <span class="kw">c</span>(<span class="st">&quot;asb&quot;</span>, <span class="st">&quot;his&quot;</span>, <span class="st">&quot;cre&quot;</span>, <span class="st">&quot;pch&quot;</span>, <span class="st">&quot;crn&quot;</span>, <span class="st">&quot;acl&quot;</span>, <span class="st">&quot;ser&quot;</span>, <span class="st">&quot;mbc&quot;</span>, <span class="st">&quot;chol_s&quot;</span>, <span class="st">&quot;bet&quot;</span>, <span class="st">&quot;choline&quot;</span>, <span class="st">&quot;ura&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;spec&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb72-3"><a href="metabolomics.html#cb72-3"></a><span class="kw">colnames</span>(mets) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;arseno- betaine&quot;</span>, <span class="st">&quot;histamine&quot;</span>, <span class="st">&quot;creatine&quot;</span>, <span class="st">&quot;phospho- choline&quot;</span>, <span class="st">&quot;carnitine&quot;</span>, <span class="st">&quot;acetyl- choline&quot;</span>, <span class="st">&quot;serotonin&quot;</span>, <span class="st">&quot;2-methyl- butyroyl- carnitine&quot;</span>, </span>
<span id="cb72-4"><a href="metabolomics.html#cb72-4"></a>    <span class="st">&quot;choline sulfate&quot;</span>, <span class="st">&quot;betaine&quot;</span>, <span class="st">&quot;choline&quot;</span>, <span class="st">&quot;uranidine&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;spec&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb72-5"><a href="metabolomics.html#cb72-5"></a></span>
<span id="cb72-6"><a href="metabolomics.html#cb72-6"></a>mets &lt;-<span class="st"> </span><span class="kw">melt</span>(mets, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>))</span>
<span id="cb72-7"><a href="metabolomics.html#cb72-7"></a>mets[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb72-8"><a href="metabolomics.html#cb72-8"></a>mets<span class="op">$</span>Species[mets<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb72-9"><a href="metabolomics.html#cb72-9"></a>mets<span class="op">$</span>Species[mets<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb72-10"><a href="metabolomics.html#cb72-10"></a>mets<span class="op">$</span>Species[mets<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb72-11"><a href="metabolomics.html#cb72-11"></a></span>
<span id="cb72-12"><a href="metabolomics.html#cb72-12"></a><span class="co"># labeller needs formula interface</span></span>
<span id="cb72-13"><a href="metabolomics.html#cb72-13"></a>all &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mets, <span class="kw">aes</span>(<span class="dt">x =</span> Depth, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>Species, <span class="dt">labeller =</span> <span class="kw">labeller</span>(<span class="dt">variable =</span> <span class="kw">label_wrap_gen</span>(<span class="dv">10</span>, <span class="dt">multi_line =</span> <span class="ot">TRUE</span>)), </span>
<span id="cb72-14"><a href="metabolomics.html#cb72-14"></a>    <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb72-15"><a href="metabolomics.html#cb72-15"></a>all &lt;-<span class="st"> </span>all <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;VIPs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;signal&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>), <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, </span>
<span id="cb72-16"><a href="metabolomics.html#cb72-16"></a>    <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>), <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>scientific) <span class="op">+</span><span class="st"> </span></span>
<span id="cb72-17"><a href="metabolomics.html#cb72-17"></a><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw">pretty_breaks</span>(<span class="dt">n =</span> <span class="dv">12</span>))</span>
<span id="cb72-18"><a href="metabolomics.html#cb72-18"></a>all</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/compounds2-1.png" width="85%" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="metabolomics.html#cb73-1"></a>cmp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/metabolite_master_20190605.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb73-2"><a href="metabolomics.html#cb73-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb73-3"><a href="metabolomics.html#cb73-3"></a>md &lt;-<span class="st"> </span>meta_data[<span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)]</span>
<span id="cb73-4"><a href="metabolomics.html#cb73-4"></a>metabolites &lt;-<span class="st"> </span><span class="kw">prep</span>(cmp, md)</span>
<span id="cb73-5"><a href="metabolomics.html#cb73-5"></a>mets &lt;-<span class="st"> </span>metabolites[, <span class="kw">c</span>(<span class="st">&quot;asb&quot;</span>, <span class="st">&quot;his&quot;</span>, <span class="st">&quot;cre&quot;</span>, <span class="st">&quot;pch&quot;</span>, <span class="st">&quot;crn&quot;</span>, <span class="st">&quot;acl&quot;</span>, <span class="st">&quot;ser&quot;</span>, <span class="st">&quot;mbc&quot;</span>, <span class="st">&quot;chol_s&quot;</span>, <span class="st">&quot;bet&quot;</span>, <span class="st">&quot;choline&quot;</span>, <span class="st">&quot;ura&quot;</span>, <span class="st">&quot;spec&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb73-6"><a href="metabolomics.html#cb73-6"></a></span>
<span id="cb73-7"><a href="metabolomics.html#cb73-7"></a>mets_gb &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>, ]</span>
<span id="cb73-8"><a href="metabolomics.html#cb73-8"></a>mets_sf &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>, ]</span>
<span id="cb73-9"><a href="metabolomics.html#cb73-9"></a>mets_wb &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>, ]</span>
<span id="cb73-10"><a href="metabolomics.html#cb73-10"></a>mets_gb<span class="op">$</span>spec &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb73-11"><a href="metabolomics.html#cb73-11"></a>mets_sf<span class="op">$</span>spec &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb73-12"><a href="metabolomics.html#cb73-12"></a>mets_wb<span class="op">$</span>spec &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb73-13"><a href="metabolomics.html#cb73-13"></a></span>
<span id="cb73-14"><a href="metabolomics.html#cb73-14"></a>mets_gb<span class="op">$</span>ser &lt;-<span class="st"> </span><span class="ot">NULL</span>  <span class="co"># too many NAs</span></span>
<span id="cb73-15"><a href="metabolomics.html#cb73-15"></a></span>
<span id="cb73-16"><a href="metabolomics.html#cb73-16"></a>metabolite_stats &lt;-<span class="st"> </span><span class="cf">function</span>(mets) {</span>
<span id="cb73-17"><a href="metabolomics.html#cb73-17"></a>    <span class="co"># Prepare df for collecting results</span></span>
<span id="cb73-18"><a href="metabolomics.html#cb73-18"></a>    results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">colnames</span>(mets)[<span class="op">-</span><span class="kw">length</span>(<span class="kw">colnames</span>(mets))])</span>
<span id="cb73-19"><a href="metabolomics.html#cb73-19"></a>    <span class="kw">colnames</span>(results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb73-20"><a href="metabolomics.html#cb73-20"></a>    results[, <span class="kw">c</span>(<span class="st">&quot;cor_rho&quot;</span>, <span class="st">&quot;cor_p.value&quot;</span>, <span class="st">&quot;cor_fdr&quot;</span>, <span class="st">&quot;t.test_stat&quot;</span>, <span class="st">&quot;t.test_param&quot;</span>, <span class="st">&quot;t.test_p.val&quot;</span>, <span class="st">&quot;t.test_fdr&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb73-21"><a href="metabolomics.html#cb73-21"></a>    </span>
<span id="cb73-22"><a href="metabolomics.html#cb73-22"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb73-23"><a href="metabolomics.html#cb73-23"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mets)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb73-24"><a href="metabolomics.html#cb73-24"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb73-25"><a href="metabolomics.html#cb73-25"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb73-26"><a href="metabolomics.html#cb73-26"></a>        corr &lt;-<span class="st"> </span><span class="kw">cor.test</span>(mets[, n], mets<span class="op">$</span>Depth, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb73-27"><a href="metabolomics.html#cb73-27"></a>        results<span class="op">$</span>cor_rho[n] &lt;-<span class="st"> </span>corr<span class="op">$</span>estimate</span>
<span id="cb73-28"><a href="metabolomics.html#cb73-28"></a>        results<span class="op">$</span>cor_p.value[n] &lt;-<span class="st"> </span>corr<span class="op">$</span>p.value</span>
<span id="cb73-29"><a href="metabolomics.html#cb73-29"></a>        tt &lt;-<span class="st"> </span><span class="kw">t.test</span>(mets[, n][mets<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>], mets[, n][mets<span class="op">$</span>Depth <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>], <span class="dt">var.equal =</span> T)</span>
<span id="cb73-30"><a href="metabolomics.html#cb73-30"></a>        results<span class="op">$</span>t.test_stat[n] &lt;-<span class="st"> </span>tt<span class="op">$</span>statistic</span>
<span id="cb73-31"><a href="metabolomics.html#cb73-31"></a>        results<span class="op">$</span>t.test_param[n] &lt;-<span class="st"> </span>tt<span class="op">$</span>parameter</span>
<span id="cb73-32"><a href="metabolomics.html#cb73-32"></a>        results<span class="op">$</span>t.test_p.val[n] &lt;-<span class="st"> </span>tt<span class="op">$</span>p.value</span>
<span id="cb73-33"><a href="metabolomics.html#cb73-33"></a>    }</span>
<span id="cb73-34"><a href="metabolomics.html#cb73-34"></a>    cor_fdr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">p.adjust</span>(results<span class="op">$</span>cor_p.value, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>))</span>
<span id="cb73-35"><a href="metabolomics.html#cb73-35"></a>    <span class="co"># colnames(cor_fdr) &lt;- c(&#39;cor_fdr&#39;)</span></span>
<span id="cb73-36"><a href="metabolomics.html#cb73-36"></a>    results<span class="op">$</span>cor_fdr &lt;-<span class="st"> </span>cor_fdr</span>
<span id="cb73-37"><a href="metabolomics.html#cb73-37"></a>    t.test_fdr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">p.adjust</span>(results<span class="op">$</span>t.test_p.val, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>))</span>
<span id="cb73-38"><a href="metabolomics.html#cb73-38"></a>    <span class="co"># colnames(t.test_fdr) &lt;- c(&#39;t.test_fdr&#39;)</span></span>
<span id="cb73-39"><a href="metabolomics.html#cb73-39"></a>    results<span class="op">$</span>t.test_fdr &lt;-<span class="st"> </span>t.test_fdr</span>
<span id="cb73-40"><a href="metabolomics.html#cb73-40"></a>    </span>
<span id="cb73-41"><a href="metabolomics.html#cb73-41"></a>    <span class="kw">return</span>(results)</span>
<span id="cb73-42"><a href="metabolomics.html#cb73-42"></a>}</span>
<span id="cb73-43"><a href="metabolomics.html#cb73-43"></a></span>
<span id="cb73-44"><a href="metabolomics.html#cb73-44"></a>gb_met_stats &lt;-<span class="st"> </span><span class="kw">metabolite_stats</span>(mets_gb)</span>
<span id="cb73-45"><a href="metabolomics.html#cb73-45"></a>sf_met_stats &lt;-<span class="st"> </span><span class="kw">metabolite_stats</span>(mets_sf)</span>
<span id="cb73-46"><a href="metabolomics.html#cb73-46"></a>wb_met_stats &lt;-<span class="st"> </span><span class="kw">metabolite_stats</span>(mets_wb)</span>
<span id="cb73-47"><a href="metabolomics.html#cb73-47"></a></span>
<span id="cb73-48"><a href="metabolomics.html#cb73-48"></a>gb_met_stats[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Gb&quot;</span>)</span>
<span id="cb73-49"><a href="metabolomics.html#cb73-49"></a>sf_met_stats[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sf&quot;</span>)</span>
<span id="cb73-50"><a href="metabolomics.html#cb73-50"></a>wb_met_stats[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Wb&quot;</span>)</span>
<span id="cb73-51"><a href="metabolomics.html#cb73-51"></a></span>
<span id="cb73-52"><a href="metabolomics.html#cb73-52"></a>gb_met_stats<span class="op">$</span>metabolite &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;arsenobetaine&quot;</span>, <span class="st">&quot;histamine&quot;</span>, <span class="st">&quot;creatine&quot;</span>, <span class="st">&quot;phosphocholine&quot;</span>, <span class="st">&quot;carnitine&quot;</span>, <span class="st">&quot;acetylcholine&quot;</span>, <span class="st">&quot;2-methyl-butyroyl-carnitine&quot;</span>, <span class="st">&quot;choline sulfate&quot;</span>, </span>
<span id="cb73-53"><a href="metabolomics.html#cb73-53"></a>    <span class="st">&quot;betaine&quot;</span>, <span class="st">&quot;choline&quot;</span>, <span class="st">&quot;uranidine&quot;</span>)</span>
<span id="cb73-54"><a href="metabolomics.html#cb73-54"></a>sf_met_stats<span class="op">$</span>metabolite &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;arsenobetaine&quot;</span>, <span class="st">&quot;histamine&quot;</span>, <span class="st">&quot;creatine&quot;</span>, <span class="st">&quot;phosphocholine&quot;</span>, <span class="st">&quot;carnitine&quot;</span>, <span class="st">&quot;acetylcholine&quot;</span>, <span class="st">&quot;serotonin&quot;</span>, <span class="st">&quot;2-methyl-butyroyl-carnitine&quot;</span>, </span>
<span id="cb73-55"><a href="metabolomics.html#cb73-55"></a>    <span class="st">&quot;choline sulfate&quot;</span>, <span class="st">&quot;betaine&quot;</span>, <span class="st">&quot;choline&quot;</span>, <span class="st">&quot;uranidine&quot;</span>)</span>
<span id="cb73-56"><a href="metabolomics.html#cb73-56"></a>wb_met_stats<span class="op">$</span>metabolite &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;arsenobetaine&quot;</span>, <span class="st">&quot;histamine&quot;</span>, <span class="st">&quot;creatine&quot;</span>, <span class="st">&quot;phosphocholine&quot;</span>, <span class="st">&quot;carnitine&quot;</span>, <span class="st">&quot;acetylcholine&quot;</span>, <span class="st">&quot;serotonin&quot;</span>, <span class="st">&quot;2-methyl-butyroyl-carnitine&quot;</span>, </span>
<span id="cb73-57"><a href="metabolomics.html#cb73-57"></a>    <span class="st">&quot;choline sulfate&quot;</span>, <span class="st">&quot;betaine&quot;</span>, <span class="st">&quot;choline&quot;</span>, <span class="st">&quot;uranidine&quot;</span>)</span>
<span id="cb73-58"><a href="metabolomics.html#cb73-58"></a></span>
<span id="cb73-59"><a href="metabolomics.html#cb73-59"></a></span>
<span id="cb73-60"><a href="metabolomics.html#cb73-60"></a>results &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_met_stats, sf_met_stats, wb_met_stats)</span>
<span id="cb73-61"><a href="metabolomics.html#cb73-61"></a><span class="kw">kable</span>(results, <span class="dt">digits =</span> <span class="dv">4</span>, <span class="dt">longtable =</span> T, <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Depth response for VIP metabolites as approximated by different methods.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, </span>
<span id="cb73-62"><a href="metabolomics.html#cb73-62"></a>    <span class="st">`</span><span class="dt">depth correlation</span><span class="st">`</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">`</span><span class="dt">depth groups</span><span class="st">`</span> =<span class="st"> </span><span class="dv">4</span>, <span class="st">&quot;&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, </span>
<span id="cb73-63"><a href="metabolomics.html#cb73-63"></a>    <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="24%" />
<col width="7%" />
<col width="10%" />
<col width="7%" />
<col width="10%" />
<col width="11%" />
<col width="11%" />
<col width="9%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">metabolite</th>
<th align="right">cor_rho</th>
<th align="right">cor_p.value</th>
<th align="right">cor_fdr</th>
<th align="right">t.test_stat</th>
<th align="right">t.test_param</th>
<th align="right">t.test_p.val</th>
<th align="right">t.test_fdr</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">arsenobetaine</td>
<td align="right">-0.7214</td>
<td align="right">0.0033</td>
<td align="right">0.0123</td>
<td align="right">3.0590</td>
<td align="right">13</td>
<td align="right">0.0091</td>
<td align="right">0.0189</td>
<td align="left">Gb</td>
</tr>
<tr class="even">
<td align="left">histamine</td>
<td align="right">-0.1821</td>
<td align="right">0.5151</td>
<td align="right">0.5666</td>
<td align="right">1.7978</td>
<td align="right">13</td>
<td align="right">0.0955</td>
<td align="right">0.1313</td>
<td align="left">Gb</td>
</tr>
<tr class="odd">
<td align="left">creatine</td>
<td align="right">-0.5879</td>
<td align="right">0.0381</td>
<td align="right">0.0838</td>
<td align="right">2.3348</td>
<td align="right">11</td>
<td align="right">0.0395</td>
<td align="right">0.0621</td>
<td align="left">Gb</td>
</tr>
<tr class="even">
<td align="left">phosphocholine</td>
<td align="right">0.6429</td>
<td align="right">0.0117</td>
<td align="right">0.0321</td>
<td align="right">-4.6000</td>
<td align="right">13</td>
<td align="right">0.0005</td>
<td align="right">0.0018</td>
<td align="left">Gb</td>
</tr>
<tr class="odd">
<td align="left">carnitine</td>
<td align="right">-0.7214</td>
<td align="right">0.0033</td>
<td align="right">0.0123</td>
<td align="right">7.0103</td>
<td align="right">13</td>
<td align="right">0.0000</td>
<td align="right">0.0001</td>
<td align="left">Gb</td>
</tr>
<tr class="even">
<td align="left">acetylcholine</td>
<td align="right">-0.0750</td>
<td align="right">0.7926</td>
<td align="right">0.7926</td>
<td align="right">0.4203</td>
<td align="right">13</td>
<td align="right">0.6811</td>
<td align="right">0.7492</td>
<td align="left">Gb</td>
</tr>
<tr class="odd">
<td align="left">2-methyl-butyroyl-carnitine</td>
<td align="right">-0.2357</td>
<td align="right">0.3966</td>
<td align="right">0.5308</td>
<td align="right">1.2505</td>
<td align="right">13</td>
<td align="right">0.2332</td>
<td align="right">0.2850</td>
<td align="left">Gb</td>
</tr>
<tr class="even">
<td align="left">choline sulfate</td>
<td align="right">-0.5036</td>
<td align="right">0.0582</td>
<td align="right">0.1067</td>
<td align="right">4.8391</td>
<td align="right">13</td>
<td align="right">0.0003</td>
<td align="right">0.0018</td>
<td align="left">Gb</td>
</tr>
<tr class="odd">
<td align="left">betaine</td>
<td align="right">0.4786</td>
<td align="right">0.0735</td>
<td align="right">0.1154</td>
<td align="right">-2.9955</td>
<td align="right">13</td>
<td align="right">0.0103</td>
<td align="right">0.0189</td>
<td align="left">Gb</td>
</tr>
<tr class="even">
<td align="left">choline</td>
<td align="right">0.2179</td>
<td align="right">0.4343</td>
<td align="right">0.5308</td>
<td align="right">0.1295</td>
<td align="right">13</td>
<td align="right">0.8990</td>
<td align="right">0.8990</td>
<td align="left">Gb</td>
</tr>
<tr class="odd">
<td align="left">uranidine</td>
<td align="right">-0.8321</td>
<td align="right">0.0002</td>
<td align="right">0.0017</td>
<td align="right">4.2900</td>
<td align="right">13</td>
<td align="right">0.0009</td>
<td align="right">0.0024</td>
<td align="left">Gb</td>
</tr>
<tr class="even">
<td align="left">arsenobetaine</td>
<td align="right">-0.1923</td>
<td align="right">0.5292</td>
<td align="right">0.6350</td>
<td align="right">0.3574</td>
<td align="right">11</td>
<td align="right">0.7276</td>
<td align="right">0.8273</td>
<td align="left">Sf</td>
</tr>
<tr class="odd">
<td align="left">histamine</td>
<td align="right">-0.4945</td>
<td align="right">0.0889</td>
<td align="right">0.1524</td>
<td align="right">2.2062</td>
<td align="right">11</td>
<td align="right">0.0495</td>
<td align="right">0.0991</td>
<td align="left">Sf</td>
</tr>
<tr class="even">
<td align="left">creatine</td>
<td align="right">-0.7967</td>
<td align="right">0.0018</td>
<td align="right">0.0111</td>
<td align="right">5.3100</td>
<td align="right">11</td>
<td align="right">0.0002</td>
<td align="right">0.0028</td>
<td align="left">Sf</td>
</tr>
<tr class="odd">
<td align="left">phosphocholine</td>
<td align="right">0.7637</td>
<td align="right">0.0036</td>
<td align="right">0.0144</td>
<td align="right">-4.9112</td>
<td align="right">11</td>
<td align="right">0.0005</td>
<td align="right">0.0028</td>
<td align="left">Sf</td>
</tr>
<tr class="even">
<td align="left">carnitine</td>
<td align="right">0.5275</td>
<td align="right">0.0673</td>
<td align="right">0.1347</td>
<td align="right">-2.4433</td>
<td align="right">11</td>
<td align="right">0.0326</td>
<td align="right">0.0783</td>
<td align="left">Sf</td>
</tr>
<tr class="odd">
<td align="left">acetylcholine</td>
<td align="right">-0.0165</td>
<td align="right">0.9639</td>
<td align="right">0.9639</td>
<td align="right">0.2234</td>
<td align="right">11</td>
<td align="right">0.8273</td>
<td align="right">0.8273</td>
<td align="left">Sf</td>
</tr>
<tr class="even">
<td align="left">serotonin</td>
<td align="right">0.5824</td>
<td align="right">0.0403</td>
<td align="right">0.0967</td>
<td align="right">-1.8692</td>
<td align="right">11</td>
<td align="right">0.0884</td>
<td align="right">0.1516</td>
<td align="left">Sf</td>
</tr>
<tr class="odd">
<td align="left">2-methyl-butyroyl-carnitine</td>
<td align="right">0.8681</td>
<td align="right">0.0001</td>
<td align="right">0.0015</td>
<td align="right">-3.5643</td>
<td align="right">11</td>
<td align="right">0.0044</td>
<td align="right">0.0178</td>
<td align="left">Sf</td>
</tr>
<tr class="even">
<td align="left">choline sulfate</td>
<td align="right">-0.3147</td>
<td align="right">0.3195</td>
<td align="right">0.4260</td>
<td align="right">1.6828</td>
<td align="right">10</td>
<td align="right">0.1233</td>
<td align="right">0.1850</td>
<td align="left">Sf</td>
</tr>
<tr class="odd">
<td align="left">betaine</td>
<td align="right">-0.3516</td>
<td align="right">0.2392</td>
<td align="right">0.3588</td>
<td align="right">-0.2609</td>
<td align="right">11</td>
<td align="right">0.7990</td>
<td align="right">0.8273</td>
<td align="left">Sf</td>
</tr>
<tr class="even">
<td align="left">choline</td>
<td align="right">0.7198</td>
<td align="right">0.0075</td>
<td align="right">0.0225</td>
<td align="right">-2.5136</td>
<td align="right">11</td>
<td align="right">0.0288</td>
<td align="right">0.0783</td>
<td align="left">Sf</td>
</tr>
<tr class="odd">
<td align="left">uranidine</td>
<td align="right">-0.1264</td>
<td align="right">0.6826</td>
<td align="right">0.7447</td>
<td align="right">0.7272</td>
<td align="right">11</td>
<td align="right">0.4823</td>
<td align="right">0.6431</td>
<td align="left">Sf</td>
</tr>
<tr class="even">
<td align="left">arsenobetaine</td>
<td align="right">0.6059</td>
<td align="right">0.0148</td>
<td align="right">0.1772</td>
<td align="right">-2.1540</td>
<td align="right">14</td>
<td align="right">0.0492</td>
<td align="right">0.2949</td>
<td align="left">Wb</td>
</tr>
<tr class="odd">
<td align="left">histamine</td>
<td align="right">-0.1765</td>
<td align="right">0.5122</td>
<td align="right">0.6028</td>
<td align="right">0.4515</td>
<td align="right">14</td>
<td align="right">0.6585</td>
<td align="right">0.6585</td>
<td align="left">Wb</td>
</tr>
<tr class="even">
<td align="left">creatine</td>
<td align="right">0.4000</td>
<td align="right">0.1259</td>
<td align="right">0.3776</td>
<td align="right">-1.3384</td>
<td align="right">14</td>
<td align="right">0.2021</td>
<td align="right">0.4850</td>
<td align="left">Wb</td>
</tr>
<tr class="odd">
<td align="left">phosphocholine</td>
<td align="right">0.2363</td>
<td align="right">0.4367</td>
<td align="right">0.6028</td>
<td align="right">-0.7905</td>
<td align="right">11</td>
<td align="right">0.4460</td>
<td align="right">0.6547</td>
<td align="left">Wb</td>
</tr>
<tr class="even">
<td align="left">carnitine</td>
<td align="right">0.5294</td>
<td align="right">0.0373</td>
<td align="right">0.2237</td>
<td align="right">-2.3928</td>
<td align="right">14</td>
<td align="right">0.0313</td>
<td align="right">0.2949</td>
<td align="left">Wb</td>
</tr>
<tr class="odd">
<td align="left">acetylcholine</td>
<td align="right">-0.1882</td>
<td align="right">0.4839</td>
<td align="right">0.6028</td>
<td align="right">0.6617</td>
<td align="right">14</td>
<td align="right">0.5189</td>
<td align="right">0.6547</td>
<td align="left">Wb</td>
</tr>
<tr class="even">
<td align="left">serotonin</td>
<td align="right">-0.1736</td>
<td align="right">0.5526</td>
<td align="right">0.6028</td>
<td align="right">0.6219</td>
<td align="right">12</td>
<td align="right">0.5456</td>
<td align="right">0.6547</td>
<td align="left">Wb</td>
</tr>
<tr class="odd">
<td align="left">2-methyl-butyroyl-carnitine</td>
<td align="right">0.2029</td>
<td align="right">0.4496</td>
<td align="right">0.6028</td>
<td align="right">-1.7389</td>
<td align="right">14</td>
<td align="right">0.1040</td>
<td align="right">0.3140</td>
<td align="left">Wb</td>
</tr>
<tr class="even">
<td align="left">choline sulfate</td>
<td align="right">-0.0143</td>
<td align="right">0.9642</td>
<td align="right">0.9642</td>
<td align="right">-0.4725</td>
<td align="right">13</td>
<td align="right">0.6444</td>
<td align="right">0.6585</td>
<td align="left">Wb</td>
</tr>
<tr class="odd">
<td align="left">betaine</td>
<td align="right">0.3382</td>
<td align="right">0.2000</td>
<td align="right">0.4801</td>
<td align="right">-0.6415</td>
<td align="right">14</td>
<td align="right">0.5316</td>
<td align="right">0.6547</td>
<td align="left">Wb</td>
</tr>
<tr class="even">
<td align="left">choline</td>
<td align="right">0.2588</td>
<td align="right">0.3319</td>
<td align="right">0.6028</td>
<td align="right">-1.7352</td>
<td align="right">14</td>
<td align="right">0.1047</td>
<td align="right">0.3140</td>
<td align="left">Wb</td>
</tr>
<tr class="odd">
<td align="left">uranidine</td>
<td align="right">-0.4294</td>
<td align="right">0.0985</td>
<td align="right">0.3776</td>
<td align="right">1.1807</td>
<td align="right">14</td>
<td align="right">0.2574</td>
<td align="right">0.5148</td>
<td align="left">Wb</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="metabolomics.html#cb74-1"></a>cmp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/metabolite_master_20190605.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb74-2"><a href="metabolomics.html#cb74-2"></a></span>
<span id="cb74-3"><a href="metabolomics.html#cb74-3"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb74-4"><a href="metabolomics.html#cb74-4"></a>md &lt;-<span class="st"> </span>meta_data[<span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb74-5"><a href="metabolomics.html#cb74-5"></a></span>
<span id="cb74-6"><a href="metabolomics.html#cb74-6"></a><span class="co"># 6-bromo-8-hydroxy-conicamin = cp4 cyclo Pro-Arg = solterin or soelterin</span></span>
<span id="cb74-7"><a href="metabolomics.html#cb74-7"></a></span>
<span id="cb74-8"><a href="metabolomics.html#cb74-8"></a><span class="co"># Prepare df for Gb compounds</span></span>
<span id="cb74-9"><a href="metabolomics.html#cb74-9"></a>metabolites &lt;-<span class="st"> </span><span class="kw">prep</span>(cmp, md)</span>
<span id="cb74-10"><a href="metabolomics.html#cb74-10"></a>mets &lt;-<span class="st"> </span>metabolites[, <span class="kw">c</span>(<span class="st">&quot;bar&quot;</span>, <span class="st">&quot;dhb&quot;</span>, <span class="st">&quot;dhhb&quot;</span>, <span class="st">&quot;GeoA&quot;</span>, <span class="st">&quot;GeoAi&quot;</span>, <span class="st">&quot;GeoB&quot;</span>, <span class="st">&quot;sol&quot;</span>, <span class="st">&quot;brc&quot;</span>, <span class="st">&quot;cp4&quot;</span>, <span class="st">&quot;GeoC&quot;</span>, <span class="st">&quot;L6bhp&quot;</span>, <span class="st">&quot;barrettide_A&quot;</span>, <span class="st">&quot;barrettide_B&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, </span>
<span id="cb74-11"><a href="metabolomics.html#cb74-11"></a>    <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb74-12"><a href="metabolomics.html#cb74-12"></a>mets &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Geodia barretti&quot;</span>, ]</span>
<span id="cb74-13"><a href="metabolomics.html#cb74-13"></a><span class="kw">colnames</span>(mets) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;barettin&quot;</span>, <span class="st">&quot;8,9-dihydrobarettin&quot;</span>, <span class="st">&quot;8,9−dihydro−8−hydroxy−barettin&quot;</span>, <span class="st">&quot;Geobarrettin A&quot;</span>, <span class="st">&quot;Geobarrettin A isomer&quot;</span>, <span class="st">&quot;Geobarrettin B&quot;</span>, </span>
<span id="cb74-14"><a href="metabolomics.html#cb74-14"></a>    <span class="st">&quot;cyclo Pro-Arg&quot;</span>, <span class="st">&quot;6-bromo-conicamin&quot;</span>, <span class="st">&quot;6-bromo-8-hydroxy-conicamin&quot;</span>, <span class="st">&quot;Geobarrettin C&quot;</span>, <span class="st">&quot;L-6-bromo- </span><span class="ch">\n</span><span class="st"> hypaphorine&quot;</span>, <span class="st">&quot;Barrettide A&quot;</span>, <span class="st">&quot;Barrettide B&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, </span>
<span id="cb74-15"><a href="metabolomics.html#cb74-15"></a>    <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)</span>
<span id="cb74-16"><a href="metabolomics.html#cb74-16"></a>mets[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb74-17"><a href="metabolomics.html#cb74-17"></a></span>
<span id="cb74-18"><a href="metabolomics.html#cb74-18"></a>mets &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(mets, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>))</span>
<span id="cb74-19"><a href="metabolomics.html#cb74-19"></a><span class="kw">ggplot</span>(mets, <span class="kw">aes</span>(<span class="dt">x =</span> Depth, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(. <span class="op">~</span><span class="st"> </span>variable, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/known-compounds-fig-1.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="metabolomics.html#cb75-1"></a>mets &lt;-<span class="st"> </span>metabolites[, <span class="kw">c</span>(<span class="st">&quot;sfn&quot;</span>, <span class="st">&quot;ian&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb75-2"><a href="metabolomics.html#cb75-2"></a>mets &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Stryphnus fortis&quot;</span>, ]</span>
<span id="cb75-3"><a href="metabolomics.html#cb75-3"></a>mets[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb75-4"><a href="metabolomics.html#cb75-4"></a><span class="kw">colnames</span>(mets) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnusin&quot;</span>, <span class="st">&quot;Ianthellin&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb75-5"><a href="metabolomics.html#cb75-5"></a></span>
<span id="cb75-6"><a href="metabolomics.html#cb75-6"></a>mets &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(mets, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>))</span>
<span id="cb75-7"><a href="metabolomics.html#cb75-7"></a><span class="kw">ggplot</span>(mets, <span class="kw">aes</span>(<span class="dt">x =</span> Depth, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(. <span class="op">~</span><span class="st"> </span>variable, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/known-compounds-fig-2.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="metabolomics.html#cb76-1"></a>cmp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/metabolite_master_20190605.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb76-2"><a href="metabolomics.html#cb76-2"></a></span>
<span id="cb76-3"><a href="metabolomics.html#cb76-3"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb76-4"><a href="metabolomics.html#cb76-4"></a>md &lt;-<span class="st"> </span>meta_data[<span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb76-5"><a href="metabolomics.html#cb76-5"></a></span>
<span id="cb76-6"><a href="metabolomics.html#cb76-6"></a><span class="co"># 6-bromo-8-hydroxy-conicamin = cp4 cyclo Pro-Arg = solterin or soelterin</span></span>
<span id="cb76-7"><a href="metabolomics.html#cb76-7"></a></span>
<span id="cb76-8"><a href="metabolomics.html#cb76-8"></a><span class="co"># Prepare df for Gb compounds</span></span>
<span id="cb76-9"><a href="metabolomics.html#cb76-9"></a>metabolites &lt;-<span class="st"> </span><span class="kw">prep</span>(cmp, md)</span>
<span id="cb76-10"><a href="metabolomics.html#cb76-10"></a>mets &lt;-<span class="st"> </span>metabolites[, <span class="kw">c</span>(<span class="st">&quot;bar&quot;</span>, <span class="st">&quot;dhb&quot;</span>, <span class="st">&quot;dhhb&quot;</span>, <span class="st">&quot;GeoA&quot;</span>, <span class="st">&quot;GeoAi&quot;</span>, <span class="st">&quot;GeoB&quot;</span>, <span class="st">&quot;sol&quot;</span>, <span class="st">&quot;brc&quot;</span>, <span class="st">&quot;cp4&quot;</span>, <span class="st">&quot;GeoC&quot;</span>, <span class="st">&quot;L6bhp&quot;</span>, <span class="st">&quot;barrettide_A&quot;</span>, <span class="st">&quot;barrettide_B&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, </span>
<span id="cb76-11"><a href="metabolomics.html#cb76-11"></a>    <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb76-12"><a href="metabolomics.html#cb76-12"></a>mets &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Geodia barretti&quot;</span>, ]</span>
<span id="cb76-13"><a href="metabolomics.html#cb76-13"></a>mets[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb76-14"><a href="metabolomics.html#cb76-14"></a></span>
<span id="cb76-15"><a href="metabolomics.html#cb76-15"></a></span>
<span id="cb76-16"><a href="metabolomics.html#cb76-16"></a>metabolite_stats &lt;-<span class="st"> </span><span class="cf">function</span>(mets) {</span>
<span id="cb76-17"><a href="metabolomics.html#cb76-17"></a>    <span class="co"># Prepare df for collecting results</span></span>
<span id="cb76-18"><a href="metabolomics.html#cb76-18"></a>    results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">colnames</span>(mets)[<span class="op">-</span><span class="kw">length</span>(<span class="kw">colnames</span>(mets))])</span>
<span id="cb76-19"><a href="metabolomics.html#cb76-19"></a>    <span class="kw">colnames</span>(results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb76-20"><a href="metabolomics.html#cb76-20"></a>    results[, <span class="kw">c</span>(<span class="st">&quot;cor_rho&quot;</span>, <span class="st">&quot;cor_p.value&quot;</span>, <span class="st">&quot;cor_fdr&quot;</span>, <span class="st">&quot;t.test_stat&quot;</span>, <span class="st">&quot;t.test_param&quot;</span>, <span class="st">&quot;t.test_p.val&quot;</span>, <span class="st">&quot;t.test_fdr&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb76-21"><a href="metabolomics.html#cb76-21"></a>    </span>
<span id="cb76-22"><a href="metabolomics.html#cb76-22"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb76-23"><a href="metabolomics.html#cb76-23"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mets)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb76-24"><a href="metabolomics.html#cb76-24"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb76-25"><a href="metabolomics.html#cb76-25"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb76-26"><a href="metabolomics.html#cb76-26"></a>        corr &lt;-<span class="st"> </span><span class="kw">cor.test</span>(mets[, n], mets<span class="op">$</span>Depth, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb76-27"><a href="metabolomics.html#cb76-27"></a>        results<span class="op">$</span>cor_rho[n] &lt;-<span class="st"> </span>corr<span class="op">$</span>estimate</span>
<span id="cb76-28"><a href="metabolomics.html#cb76-28"></a>        results<span class="op">$</span>cor_p.value[n] &lt;-<span class="st"> </span>corr<span class="op">$</span>p.value</span>
<span id="cb76-29"><a href="metabolomics.html#cb76-29"></a>        tt &lt;-<span class="st"> </span><span class="kw">t.test</span>(mets[, n][mets<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>], mets[, n][mets<span class="op">$</span>Depth <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>], <span class="dt">var.equal =</span> T)</span>
<span id="cb76-30"><a href="metabolomics.html#cb76-30"></a>        results<span class="op">$</span>t.test_stat[n] &lt;-<span class="st"> </span>tt<span class="op">$</span>statistic</span>
<span id="cb76-31"><a href="metabolomics.html#cb76-31"></a>        results<span class="op">$</span>t.test_param[n] &lt;-<span class="st"> </span>tt<span class="op">$</span>parameter</span>
<span id="cb76-32"><a href="metabolomics.html#cb76-32"></a>        results<span class="op">$</span>t.test_p.val[n] &lt;-<span class="st"> </span>tt<span class="op">$</span>p.value</span>
<span id="cb76-33"><a href="metabolomics.html#cb76-33"></a>    }</span>
<span id="cb76-34"><a href="metabolomics.html#cb76-34"></a>    cor_fdr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">p.adjust</span>(results<span class="op">$</span>cor_p.value, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>))</span>
<span id="cb76-35"><a href="metabolomics.html#cb76-35"></a>    <span class="co"># colnames(cor_fdr) &lt;- c(&#39;cor_fdr&#39;)</span></span>
<span id="cb76-36"><a href="metabolomics.html#cb76-36"></a>    results<span class="op">$</span>cor_fdr &lt;-<span class="st"> </span>cor_fdr</span>
<span id="cb76-37"><a href="metabolomics.html#cb76-37"></a>    t.test_fdr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">p.adjust</span>(results<span class="op">$</span>t.test_p.val, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>))</span>
<span id="cb76-38"><a href="metabolomics.html#cb76-38"></a>    <span class="co"># colnames(t.test_fdr) &lt;- c(&#39;t.test_fdr&#39;)</span></span>
<span id="cb76-39"><a href="metabolomics.html#cb76-39"></a>    results<span class="op">$</span>t.test_fdr &lt;-<span class="st"> </span>t.test_fdr</span>
<span id="cb76-40"><a href="metabolomics.html#cb76-40"></a>    </span>
<span id="cb76-41"><a href="metabolomics.html#cb76-41"></a>    <span class="kw">return</span>(results)</span>
<span id="cb76-42"><a href="metabolomics.html#cb76-42"></a>}</span>
<span id="cb76-43"><a href="metabolomics.html#cb76-43"></a></span>
<span id="cb76-44"><a href="metabolomics.html#cb76-44"></a>mets_stats &lt;-<span class="st"> </span><span class="kw">metabolite_stats</span>(mets)</span>
<span id="cb76-45"><a href="metabolomics.html#cb76-45"></a></span>
<span id="cb76-46"><a href="metabolomics.html#cb76-46"></a><span class="co"># better names</span></span>
<span id="cb76-47"><a href="metabolomics.html#cb76-47"></a>Metabolites &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;barettin&quot;</span>, <span class="st">&quot;8,9-dihydrobarettin&quot;</span>, <span class="st">&quot;8,9−dihydro−8−hydroxy−barettin&quot;</span>, <span class="st">&quot;Geobarrettin A&quot;</span>, <span class="st">&quot;Geobarrettin A isomer&quot;</span>, <span class="st">&quot;Geobarrettin B&quot;</span>, <span class="st">&quot;cyclo Pro-Arg&quot;</span>, </span>
<span id="cb76-48"><a href="metabolomics.html#cb76-48"></a>    <span class="st">&quot;6-bromo-conicamin&quot;</span>, <span class="st">&quot;6-bromo-8-hydroxy-conicamin&quot;</span>, <span class="st">&quot;Geobarrettin C&quot;</span>, <span class="st">&quot;L-6-bromohypaphorine&quot;</span>, <span class="st">&quot;Barrettide A&quot;</span>, <span class="st">&quot;Barrettide B&quot;</span>)</span>
<span id="cb76-49"><a href="metabolomics.html#cb76-49"></a>mets_stats<span class="op">$</span>metabolite &lt;-<span class="st"> </span>Metabolites</span>
<span id="cb76-50"><a href="metabolomics.html#cb76-50"></a></span>
<span id="cb76-51"><a href="metabolomics.html#cb76-51"></a><span class="kw">kable</span>(mets_stats, <span class="dt">digits =</span> <span class="dv">4</span>, <span class="dt">longtable =</span> T, <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Depth response for _G. barretti_ metabolites as approximated by different methods.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb76-52"><a href="metabolomics.html#cb76-52"></a><span class="st">    </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">`</span><span class="dt">depth correlation</span><span class="st">`</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">`</span><span class="dt">depth groups</span><span class="st">`</span> =<span class="st"> </span><span class="dv">4</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, </span>
<span id="cb76-53"><a href="metabolomics.html#cb76-53"></a>    <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="28%" />
<col width="7%" />
<col width="11%" />
<col width="7%" />
<col width="11%" />
<col width="12%" />
<col width="12%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">metabolite</th>
<th align="right">cor_rho</th>
<th align="right">cor_p.value</th>
<th align="right">cor_fdr</th>
<th align="right">t.test_stat</th>
<th align="right">t.test_param</th>
<th align="right">t.test_p.val</th>
<th align="right">t.test_fdr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">barettin</td>
<td align="right">-0.7714</td>
<td align="right">0.0012</td>
<td align="right">0.0106</td>
<td align="right">17.2398</td>
<td align="right">13</td>
<td align="right">0.0000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">8,9-dihydrobarettin</td>
<td align="right">-0.5607</td>
<td align="right">0.0323</td>
<td align="right">0.0699</td>
<td align="right">2.2800</td>
<td align="right">13</td>
<td align="right">0.0401</td>
<td align="right">0.0850</td>
</tr>
<tr class="odd">
<td align="left">8,9−dihydro−8−hydroxy−barettin</td>
<td align="right">-0.7571</td>
<td align="right">0.0016</td>
<td align="right">0.0106</td>
<td align="right">3.8027</td>
<td align="right">13</td>
<td align="right">0.0022</td>
<td align="right">0.0057</td>
</tr>
<tr class="even">
<td align="left">Geobarrettin A</td>
<td align="right">-0.6542</td>
<td align="right">0.0082</td>
<td align="right">0.0212</td>
<td align="right">4.4642</td>
<td align="right">13</td>
<td align="right">0.0006</td>
<td align="right">0.0021</td>
</tr>
<tr class="odd">
<td align="left">Geobarrettin A isomer</td>
<td align="right">-0.6792</td>
<td align="right">0.0054</td>
<td align="right">0.0189</td>
<td align="right">4.5859</td>
<td align="right">13</td>
<td align="right">0.0005</td>
<td align="right">0.0021</td>
</tr>
<tr class="even">
<td align="left">Geobarrettin B</td>
<td align="right">-0.4571</td>
<td align="right">0.0888</td>
<td align="right">0.1649</td>
<td align="right">1.9183</td>
<td align="right">13</td>
<td align="right">0.0773</td>
<td align="right">0.1256</td>
</tr>
<tr class="odd">
<td align="left">cyclo Pro-Arg</td>
<td align="right">-0.6893</td>
<td align="right">0.0058</td>
<td align="right">0.0189</td>
<td align="right">19.1189</td>
<td align="right">13</td>
<td align="right">0.0000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">6-bromo-conicamin</td>
<td align="right">-0.2143</td>
<td align="right">0.4420</td>
<td align="right">0.6385</td>
<td align="right">2.2089</td>
<td align="right">13</td>
<td align="right">0.0457</td>
<td align="right">0.0850</td>
</tr>
<tr class="odd">
<td align="left">6-bromo-8-hydroxy-conicamin</td>
<td align="right">0.2857</td>
<td align="right">0.3011</td>
<td align="right">0.4893</td>
<td align="right">-0.0877</td>
<td align="right">13</td>
<td align="right">0.9314</td>
<td align="right">0.9740</td>
</tr>
<tr class="even">
<td align="left">Geobarrettin C</td>
<td align="right">-0.0179</td>
<td align="right">0.9540</td>
<td align="right">0.9540</td>
<td align="right">0.8091</td>
<td align="right">13</td>
<td align="right">0.4330</td>
<td align="right">0.5629</td>
</tr>
<tr class="odd">
<td align="left">L-6-bromohypaphorine</td>
<td align="right">-0.0857</td>
<td align="right">0.7630</td>
<td align="right">0.9017</td>
<td align="right">1.0363</td>
<td align="right">13</td>
<td align="right">0.3190</td>
<td align="right">0.4607</td>
</tr>
<tr class="even">
<td align="left">Barrettide A</td>
<td align="right">-0.1571</td>
<td align="right">0.5756</td>
<td align="right">0.7482</td>
<td align="right">0.5131</td>
<td align="right">13</td>
<td align="right">0.6165</td>
<td align="right">0.7286</td>
</tr>
<tr class="odd">
<td align="left">Barrettide B</td>
<td align="right">0.0788</td>
<td align="right">0.8380</td>
<td align="right">0.9078</td>
<td align="right">-0.0336</td>
<td align="right">8</td>
<td align="right">0.9740</td>
<td align="right">0.9740</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="metabolomics.html#cb77-1"></a>cmp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/metabolite_master_20190605.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb77-2"><a href="metabolomics.html#cb77-2"></a></span>
<span id="cb77-3"><a href="metabolomics.html#cb77-3"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb77-4"><a href="metabolomics.html#cb77-4"></a>md &lt;-<span class="st"> </span>meta_data[<span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb77-5"><a href="metabolomics.html#cb77-5"></a></span>
<span id="cb77-6"><a href="metabolomics.html#cb77-6"></a><span class="co"># Prepare df for Gb compounds</span></span>
<span id="cb77-7"><a href="metabolomics.html#cb77-7"></a>metabolites &lt;-<span class="st"> </span><span class="kw">prep</span>(cmp, md)</span>
<span id="cb77-8"><a href="metabolomics.html#cb77-8"></a>mets &lt;-<span class="st"> </span>metabolites[, <span class="kw">c</span>(<span class="st">&quot;sfn&quot;</span>, <span class="st">&quot;ian&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb77-9"><a href="metabolomics.html#cb77-9"></a>mets &lt;-<span class="st"> </span>mets[mets<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;Stryphnus fortis&quot;</span>, ]</span>
<span id="cb77-10"><a href="metabolomics.html#cb77-10"></a>mets[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Species&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb77-11"><a href="metabolomics.html#cb77-11"></a></span>
<span id="cb77-12"><a href="metabolomics.html#cb77-12"></a>mets_stats &lt;-<span class="st"> </span><span class="kw">metabolite_stats</span>(mets)</span>
<span id="cb77-13"><a href="metabolomics.html#cb77-13"></a></span>
<span id="cb77-14"><a href="metabolomics.html#cb77-14"></a>Metabolites &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnusin&quot;</span>, <span class="st">&quot;Ianthellin&quot;</span>)</span>
<span id="cb77-15"><a href="metabolomics.html#cb77-15"></a>mets_stats<span class="op">$</span>metabolite &lt;-<span class="st"> </span>Metabolites</span>
<span id="cb77-16"><a href="metabolomics.html#cb77-16"></a></span>
<span id="cb77-17"><a href="metabolomics.html#cb77-17"></a><span class="kw">kable</span>(mets_stats, <span class="dt">longtable =</span> T, <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Depth response fro _S. fortis_ metabolites as approximated by different methods.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, </span>
<span id="cb77-18"><a href="metabolomics.html#cb77-18"></a>    <span class="st">`</span><span class="dt">depth correlation</span><span class="st">`</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">`</span><span class="dt">depth groups</span><span class="st">`</span> =<span class="st"> </span><span class="dv">4</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bed&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, </span>
<span id="cb77-19"><a href="metabolomics.html#cb77-19"></a>    <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="13%" />
<col width="10%" />
<col width="13%" />
<col width="8%" />
<col width="13%" />
<col width="14%" />
<col width="14%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">metabolite</th>
<th align="right">cor_rho</th>
<th align="right">cor_p.value</th>
<th align="right">cor_fdr</th>
<th align="right">t.test_stat</th>
<th align="right">t.test_param</th>
<th align="right">t.test_p.val</th>
<th align="right">t.test_fdr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Stryphnusin</td>
<td align="right">0.9393939</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-1.715332</td>
<td align="right">8</td>
<td align="right">0.1246247</td>
<td align="right">0.1246247</td>
</tr>
<tr class="even">
<td align="left">Ianthellin</td>
<td align="right">0.9393939</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-1.931431</td>
<td align="right">8</td>
<td align="right">0.0895227</td>
<td align="right">0.1246247</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="metabolomics.html#cb78-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS  10.15.5
## 
## Matrix products: default
## BLAS: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggExtra_0.9             plotly_4.9.2            ropls_1.14.1            reshape2_1.4.3          usdm_1.1-18             raster_3.0-12          
##  [7] sp_1.4-1                rnaturalearthdata_0.1.0 rnaturalearth_0.1.0     sf_0.8-1                marmap_1.0.3            mapdata_2.3.0          
## [13] maps_3.3.0              ggmap_3.0.0.901         kableExtra_1.1.0.9000   gridExtra_2.3           reshape_0.8.8           ggrepel_0.8.2          
## [19] igraph_1.2.5            metap_1.3               vegan_2.5-6             lattice_0.20-41         permute_0.9-5           forcats_0.5.0          
## [25] stringr_1.4.0           dplyr_0.8.5             purrr_0.3.3             readr_1.3.1             tidyr_1.0.2             tibble_3.0.0           
## [31] ggplot2_3.3.0           tidyverse_1.3.0         knitr_1.28             
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1        backports_1.1.5     sn_1.6-1            plyr_1.8.6          lazyeval_0.2.2      splines_3.5.1       crosstalk_1.1.0.1  
##   [8] TH.data_1.0-10      digest_0.6.25       htmltools_0.4.0     fansi_0.4.1         magrittr_1.5        memoise_1.1.0       cluster_2.1.0      
##  [15] modelr_0.1.6        sandwich_2.5-1      jpeg_0.1-8.1        colorspace_1.4-1    blob_1.2.1          rvest_0.3.5         haven_2.2.0        
##  [22] xfun_0.13.1         crayon_1.3.4        jsonlite_1.6.1      survival_3.1-11     zoo_1.8-7           glue_1.3.2          gtable_0.3.0       
##  [29] webshot_0.5.2       shape_1.4.4         BiocGenerics_0.28.0 scales_1.1.0        mvtnorm_1.1-0       DBI_1.1.0           bibtex_0.4.2.2     
##  [36] miniUI_0.1.1.1      Rcpp_1.0.4          isoband_0.2.0       plotrix_3.7-7       xtable_1.8-4        viridisLite_0.3.0   units_0.6-6        
##  [43] bit_1.1-15.2        stats4_3.5.1        htmlwidgets_1.5.1   httr_1.4.1          TFisher_0.2.0       ellipsis_0.3.0      pkgconfig_2.0.3    
##  [50] farver_2.0.3        dbplyr_1.4.2        later_1.0.0         tidyselect_1.0.0    labeling_0.3        rlang_0.4.5         munsell_0.5.0      
##  [57] cellranger_1.1.0    tools_3.5.1         cli_2.0.2           generics_0.0.2      RSQLite_2.2.0       broom_0.5.5         fastmap_1.0.1      
##  [64] evaluate_0.14       yaml_2.2.1          bit64_0.9-7         fs_1.4.0            RgoogleMaps_1.4.5.3 ncdf4_1.17          nlme_3.1-145       
##  [71] mime_0.9            formatR_1.7         xml2_1.3.0          compiler_3.5.1      rstudioapi_0.11     png_0.1-7           e1071_1.7-3        
##  [78] reprex_0.3.0        stringi_1.4.6       highr_0.8           rgeos_0.5-2         Matrix_1.2-18       classInt_0.4-2      multtest_2.38.0    
##  [85] vctrs_0.2.4         mutoss_0.1-12       pillar_1.4.3        lifecycle_0.2.0     Rdpack_0.11-1       data.table_1.12.8   bitops_1.0-6       
##  [92] gbRd_0.4-11         httpuv_1.5.2        R6_2.4.1            promises_1.1.0      bookdown_0.18       KernSmooth_2.23-16  codetools_0.2-16   
##  [99] MASS_7.3-51.5       assertthat_0.2.1    rjson_0.2.20        withr_2.1.2         mnormt_1.5-6        multcomp_1.4-12     adehabitatMA_0.3.14
## [106] mgcv_1.8-31         parallel_3.5.1      hms_0.5.3           class_7.3-16        rmarkdown_2.1       shiny_1.4.0.2       numDeriv_2016.8-1.1
## [113] Biobase_2.42.0      lubridate_1.7.4</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="microbiota.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.pdf", "Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
