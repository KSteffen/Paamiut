<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</title>
  <meta name="description" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  
  
  

<meta name="author" content="Karin Steffen" />


<meta name="date" content="2020-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metabolomics.html"/>
<link rel="next" href="inter-omics.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SUPPLEMENTARY MATERIAL</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Content</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#experimental-setup"><i class="fa fa-check"></i><b>1.1</b> Experimental setup</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#map"><i class="fa fa-check"></i><b>1.1.1</b> Map</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#water-masses"><i class="fa fa-check"></i><b>1.1.2</b> Water masses</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#sponges"><i class="fa fa-check"></i><b>1.1.3</b> Sponges</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#sample-metadata-analysis"><i class="fa fa-check"></i><b>1.2</b> Sample metadata analysis</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#index_cor_vif"><i class="fa fa-check"></i><b>1.2.1</b> Correlations, visual inspection and variance inflation factors (VIF) across all samples</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#correlations-visual-inspection-and-variance-inflation-factors-vif-across-g.-barretti-samples"><i class="fa fa-check"></i><b>1.2.2</b> Correlations, visual inspection and variance inflation factors (VIF) across <em>G. barretti</em> samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="metabolomics.html"><a href="metabolomics.html"><i class="fa fa-check"></i><b>2</b> Metabolomics</a><ul>
<li class="chapter" data-level="2.1" data-path="metabolomics.html"><a href="metabolomics.html#experimental-methods-and-detailed-description"><i class="fa fa-check"></i><b>2.1</b> Experimental methods and detailed description</a></li>
<li class="chapter" data-level="2.2" data-path="metabolomics.html"><a href="metabolomics.html#data-processing"><i class="fa fa-check"></i><b>2.2</b> Data processing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="metabolomics.html"><a href="metabolomics.html#peak-picking-with-xcms-and-annotation-with-camera"><i class="fa fa-check"></i><b>2.2.1</b> Peak picking with XCMS and annotation with CAMERA</a></li>
<li class="chapter" data-level="2.2.2" data-path="metabolomics.html"><a href="metabolomics.html#hilic-hydrophilic-interaction-chromatography-column-with-positive-esi-electron-spray-ionisation"><i class="fa fa-check"></i><b>2.2.2</b> HILIC (Hydrophilic interaction chromatography) column with positive ESI (electron spray ionisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="metabolomics.html"><a href="metabolomics.html#hilic-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.3</b> HILIC Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.4" data-path="metabolomics.html"><a href="metabolomics.html#rp-reversed-phase-chromatography-with-positive-esi"><i class="fa fa-check"></i><b>2.2.4</b> RP (Reversed phase) Chromatography with positive ESI</a></li>
<li class="chapter" data-level="2.2.5" data-path="metabolomics.html"><a href="metabolomics.html#rp-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.5</b> RP Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.6" data-path="metabolomics.html"><a href="metabolomics.html#filtering-of-the-raw-data-set"><i class="fa fa-check"></i><b>2.2.6</b> Filtering of the raw data set</a></li>
<li class="chapter" data-level="2.2.7" data-path="metabolomics.html"><a href="metabolomics.html#data-quality-control"><i class="fa fa-check"></i><b>2.2.7</b> Data quality control</a></li>
<li class="chapter" data-level="2.2.8" data-path="metabolomics.html"><a href="metabolomics.html#summary-of-data-processing"><i class="fa fa-check"></i><b>2.2.8</b> Summary of data processing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="metabolomics.html"><a href="metabolomics.html#multivariate-analyses"><i class="fa fa-check"></i><b>2.3</b> Multivariate analyses</a></li>
<li class="chapter" data-level="2.4" data-path="metabolomics.html"><a href="metabolomics.html#vips"><i class="fa fa-check"></i><b>2.4</b> VIPS</a></li>
<li class="chapter" data-level="2.5" data-path="metabolomics.html"><a href="metabolomics.html#manual-annotation-identification-and-extraction-of-metabolic-feature-signals"><i class="fa fa-check"></i><b>2.5</b> Manual annotation, identification and extraction of metabolic feature signals</a></li>
<li class="chapter" data-level="2.6" data-path="metabolomics.html"><a href="metabolomics.html#chromatorgrams"><i class="fa fa-check"></i><b>2.6</b> Chromatorgrams</a></li>
<li class="chapter" data-level="2.7" data-path="metabolomics.html"><a href="metabolomics.html#correlations"><i class="fa fa-check"></i><b>2.7</b> Correlations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="microbiota.html"><a href="microbiota.html"><i class="fa fa-check"></i><b>3</b> Microbiota</a><ul>
<li class="chapter" data-level="3.1" data-path="microbiota.html"><a href="microbiota.html#otu-table-overview"><i class="fa fa-check"></i><b>3.1</b> OTU table overview</a></li>
<li class="chapter" data-level="3.2" data-path="microbiota.html"><a href="microbiota.html#alpha-diversity"><i class="fa fa-check"></i><b>3.2</b> Alpha diversity</a></li>
<li class="chapter" data-level="3.3" data-path="microbiota.html"><a href="microbiota.html#environmental-modelling"><i class="fa fa-check"></i><b>3.3</b> Environmental modelling</a><ul>
<li class="chapter" data-level="3.3.1" data-path="microbiota.html"><a href="microbiota.html#constrained"><i class="fa fa-check"></i><b>3.3.1</b> Constrained modelling approach Automatic stepwise model building</a></li>
<li class="chapter" data-level="3.3.2" data-path="microbiota.html"><a href="microbiota.html#unconstrained"><i class="fa fa-check"></i><b>3.3.2</b> Unconstrained modelling approach</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="microbiota.html"><a href="microbiota.html#relative-abundance-bar-plots"><i class="fa fa-check"></i><b>3.4</b> Relative abundance bar plots</a></li>
<li class="chapter" data-level="3.5" data-path="microbiota.html"><a href="microbiota.html#depth-response"><i class="fa fa-check"></i><b>3.5</b> Depth response</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inter-omics.html"><a href="inter-omics.html"><i class="fa fa-check"></i><b>4</b> Inter-omics</a><ul>
<li class="chapter" data-level="4.1" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-and-procrustes-rotations"><i class="fa fa-check"></i><b>4.1</b> Mantel test and procrustes rotations</a><ul>
<li class="chapter" data-level="4.1.1" data-path="inter-omics.html"><a href="inter-omics.html#libraries-and-functions"><i class="fa fa-check"></i><b>4.1.1</b> Libraries and functions</a></li>
<li class="chapter" data-level="4.1.2" data-path="inter-omics.html"><a href="inter-omics.html#data-sets"><i class="fa fa-check"></i><b>4.1.2</b> Data sets</a></li>
<li class="chapter" data-level="4.1.3" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.3</b> Mantel test code and tabular output</a></li>
<li class="chapter" data-level="4.1.4" data-path="inter-omics.html"><a href="inter-omics.html#procrustes-rotation-and-protest-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.4</b> Procrustes rotation and protest code and tabular output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inter-omics.html"><a href="inter-omics.html#microbial-interaction-network"><i class="fa fa-check"></i><b>4.2</b> Microbial interaction network</a><ul>
<li class="chapter" data-level="4.2.1" data-path="inter-omics.html"><a href="inter-omics.html#generating-network-based-on-different-algorithms"><i class="fa fa-check"></i><b>4.2.1</b> Generating network based on different algorithms</a></li>
<li class="chapter" data-level="4.2.2" data-path="inter-omics.html"><a href="inter-omics.html#consolidation-of-the-different-networks"><i class="fa fa-check"></i><b>4.2.2</b> Consolidation of the different networks</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inter-omics.html"><a href="inter-omics.html#shortlist"><i class="fa fa-check"></i><b>4.3</b> Shortlist</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="funding-disclaimer.html"><a href="funding-disclaimer.html"><i class="fa fa-check"></i><b>5</b> Funding disclaimer</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="microbiota" class="section level1">
<h1><span class="header-section-number">3</span> Microbiota</h1>
<div id="otu-table-overview" class="section level2">
<h2><span class="header-section-number">3.1</span> OTU table overview</h2>
<p>Let’s start by taking a look at the OTU table and get an overall impression of our data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="microbiota.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="microbiota.html#cb1-2"></a></span>
<span id="cb1-3"><a href="microbiota.html#cb1-3"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb1-4"><a href="microbiota.html#cb1-4"></a><span class="kw">library</span>(stringr)</span>
<span id="cb1-5"><a href="microbiota.html#cb1-5"></a></span>
<span id="cb1-6"><a href="microbiota.html#cb1-6"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="microbiota.html#cb1-7"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb1-8"><a href="microbiota.html#cb1-8"></a><span class="kw">library</span>(forcats)</span>
<span id="cb1-9"><a href="microbiota.html#cb1-9"></a></span>
<span id="cb1-10"><a href="microbiota.html#cb1-10"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb1-11"><a href="microbiota.html#cb1-11"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb1-12"><a href="microbiota.html#cb1-12"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb1-13"><a href="microbiota.html#cb1-13"></a></span>
<span id="cb1-14"><a href="microbiota.html#cb1-14"></a><span class="kw">library</span>(vegan)</span>
<span id="cb1-15"><a href="microbiota.html#cb1-15"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb1-16"><a href="microbiota.html#cb1-16"></a><span class="kw">library</span>(picante)</span>
<span id="cb1-17"><a href="microbiota.html#cb1-17"></a></span>
<span id="cb1-18"><a href="microbiota.html#cb1-18"></a><span class="kw">library</span>(gtools)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="microbiota.html#cb2-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb2-2"><a href="microbiota.html#cb2-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb2-3"><a href="microbiota.html#cb2-3"></a></span>
<span id="cb2-4"><a href="microbiota.html#cb2-4"></a><span class="co"># meta_data &lt;- meta_data[!str_sub(meta_data$unified_ID,1,2)==&#39;QC&#39;,] # remove QC</span></span>
<span id="cb2-5"><a href="microbiota.html#cb2-5"></a><span class="co"># samples</span></span>
<span id="cb2-6"><a href="microbiota.html#cb2-6"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb2-7"><a href="microbiota.html#cb2-7"></a></span>
<span id="cb2-8"><a href="microbiota.html#cb2-8"></a>microbiome &lt;-<span class="st"> </span>microbiome[<span class="kw">order</span>(microbiome<span class="op">$</span>Sample_ID), ]</span>
<span id="cb2-9"><a href="microbiota.html#cb2-9"></a>meta_data &lt;-<span class="st"> </span>meta_data[<span class="kw">order</span>(meta_data<span class="op">$</span>unified_ID), ]</span>
<span id="cb2-10"><a href="microbiota.html#cb2-10"></a></span>
<span id="cb2-11"><a href="microbiota.html#cb2-11"></a><span class="co"># dropping factors from full data:</span></span>
<span id="cb2-12"><a href="microbiota.html#cb2-12"></a>meta_data[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(meta_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb2-13"><a href="microbiota.html#cb2-13"></a>microbiome[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(microbiome, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb2-14"><a href="microbiota.html#cb2-14"></a></span>
<span id="cb2-15"><a href="microbiota.html#cb2-15"></a><span class="co"># all(meta_data$unified_ID==microbiome$Sample_ID)</span></span>
<span id="cb2-16"><a href="microbiota.html#cb2-16"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb2-17"><a href="microbiota.html#cb2-17"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb2-18"><a href="microbiota.html#cb2-18"></a></span>
<span id="cb2-19"><a href="microbiota.html#cb2-19"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)  <span class="co">#total_OTUs = Cummulative read count</span></span>
<span id="cb2-20"><a href="microbiota.html#cb2-20"></a>micro_fig1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb2-21"><a href="microbiota.html#cb2-21"></a>micro_fig1[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb2-22"><a href="microbiota.html#cb2-22"></a>micro_fig1[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;none&quot;</span></span>
<span id="cb2-23"><a href="microbiota.html#cb2-23"></a></span>
<span id="cb2-24"><a href="microbiota.html#cb2-24"></a>microbiome<span class="op">$</span>total_OTUs &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb2-25"><a href="microbiota.html#cb2-25"></a>microbiome &lt;-<span class="st"> </span><span class="kw">sqrt</span>(microbiome)</span>
<span id="cb2-26"><a href="microbiota.html#cb2-26"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)</span>
<span id="cb2-27"><a href="microbiota.html#cb2-27"></a></span>
<span id="cb2-28"><a href="microbiota.html#cb2-28"></a>micro_fig2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb2-29"><a href="microbiota.html#cb2-29"></a>micro_fig2[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb2-30"><a href="microbiota.html#cb2-30"></a>micro_fig2[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;sqrt&quot;</span></span>
<span id="cb2-31"><a href="microbiota.html#cb2-31"></a></span>
<span id="cb2-32"><a href="microbiota.html#cb2-32"></a>microbiome<span class="op">$</span>total_OTUs &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb2-33"><a href="microbiota.html#cb2-33"></a>microbiome &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(microbiome)</span>
<span id="cb2-34"><a href="microbiota.html#cb2-34"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)</span>
<span id="cb2-35"><a href="microbiota.html#cb2-35"></a></span>
<span id="cb2-36"><a href="microbiota.html#cb2-36"></a>micro_fig3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb2-37"><a href="microbiota.html#cb2-37"></a>micro_fig3[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb2-38"><a href="microbiota.html#cb2-38"></a>micro_fig3[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;sqrt wisconsin&quot;</span></span>
<span id="cb2-39"><a href="microbiota.html#cb2-39"></a></span>
<span id="cb2-40"><a href="microbiota.html#cb2-40"></a>micro_fig &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_fig1, micro_fig2, micro_fig3)</span>
<span id="cb2-41"><a href="microbiota.html#cb2-41"></a><span class="kw">colnames</span>(micro_fig) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;total_OTUs&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;normalisation&quot;</span>)</span>
<span id="cb2-42"><a href="microbiota.html#cb2-42"></a>micro_fig[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(micro_fig<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb2-43"><a href="microbiota.html#cb2-43"></a></span>
<span id="cb2-44"><a href="microbiota.html#cb2-44"></a><span class="kw">ggplot</span>(micro_fig, <span class="kw">aes</span>(<span class="dt">x =</span> unified_ID, <span class="dt">y =</span> total_OTUs)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-45"><a href="microbiota.html#cb2-45"></a><span class="st">    </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(normalisation), <span class="kw">vars</span>(Species), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Samples&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-46"><a href="microbiota.html#cb2-46"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Number of OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cummulative read count after normalisation&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-47"><a href="microbiota.html#cb2-47"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:filtering-pca"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/filtering-pca-1.png" alt="Read count overview of the OTU table before and after the normalisation applied in the data analysis for this study." width="672" />
<p class="caption">
Figure 3.1: Read count overview of the OTU table before and after the normalisation applied in the data analysis for this study.
</p>
</div>
<p>Do the normalisations have affect how well we can discriminate between the microbiota?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="microbiota.html#cb3-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb3-2"><a href="microbiota.html#cb3-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb3-3"><a href="microbiota.html#cb3-3"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb3-4"><a href="microbiota.html#cb3-4"></a></span>
<span id="cb3-5"><a href="microbiota.html#cb3-5"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb3-6"><a href="microbiota.html#cb3-6"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb3-7"><a href="microbiota.html#cb3-7"></a></span>
<span id="cb3-8"><a href="microbiota.html#cb3-8"></a>pca_plot &lt;-<span class="st"> </span><span class="cf">function</span>(microbiome, meta_data, my_title) {</span>
<span id="cb3-9"><a href="microbiota.html#cb3-9"></a>    micro.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(microbiome, <span class="dt">scale =</span> T)</span>
<span id="cb3-10"><a href="microbiota.html#cb3-10"></a>    k &lt;-<span class="st"> </span><span class="kw">summary</span>(micro.pca)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb3-11"><a href="microbiota.html#cb3-11"></a>    micro_pca_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(micro.pca<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb3-12"><a href="microbiota.html#cb3-12"></a>    micro_pca_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(micro_pca_df))</span>
<span id="cb3-13"><a href="microbiota.html#cb3-13"></a>    x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb3-14"><a href="microbiota.html#cb3-14"></a>    y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb3-15"><a href="microbiota.html#cb3-15"></a>    micro_pca_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(micro_pca_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], </span>
<span id="cb3-16"><a href="microbiota.html#cb3-16"></a>        meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb3-17"><a href="microbiota.html#cb3-17"></a>            <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb3-18"><a href="microbiota.html#cb3-18"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(micro_pca_df, <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">shape =</span> <span class="kw">factor</span>(Species))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-19"><a href="microbiota.html#cb3-19"></a><span class="st">        </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(x1) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(y1) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">shape =</span> <span class="st">&quot;Species&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-20"><a href="microbiota.html#cb3-20"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb3-21"><a href="microbiota.html#cb3-21"></a>    <span class="kw">return</span>(p)</span>
<span id="cb3-22"><a href="microbiota.html#cb3-22"></a>}</span>
<span id="cb3-23"><a href="microbiota.html#cb3-23"></a></span>
<span id="cb3-24"><a href="microbiota.html#cb3-24"></a>untransformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(microbiome, meta_data, <span class="st">&quot;untransformed&quot;</span>)</span>
<span id="cb3-25"><a href="microbiota.html#cb3-25"></a>sqrt_transformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(<span class="kw">sqrt</span>(microbiome), meta_data, <span class="st">&quot;sqrt&quot;</span>)</span>
<span id="cb3-26"><a href="microbiota.html#cb3-26"></a>sqrt_wisc_transformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(<span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(microbiome)), meta_data, <span class="st">&quot;sqrt and wisconsin&quot;</span>)</span>
<span id="cb3-27"><a href="microbiota.html#cb3-27"></a></span>
<span id="cb3-28"><a href="microbiota.html#cb3-28"></a><span class="kw">grid.arrange</span>(untransformed, sqrt_transformed, sqrt_wisc_transformed, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">top =</span> <span class="st">&quot;PCA: Impact of normalisation on discimination of the microbiota&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:microbiome-pca"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/microbiome-pca-1.png" alt="PCA of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb" width="672" />
<p class="caption">
Figure 3.2: PCA of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="microbiota.html#cb4-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb4-2"><a href="microbiota.html#cb4-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb4-3"><a href="microbiota.html#cb4-3"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb4-4"><a href="microbiota.html#cb4-4"></a></span>
<span id="cb4-5"><a href="microbiota.html#cb4-5"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb4-6"><a href="microbiota.html#cb4-6"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb4-7"><a href="microbiota.html#cb4-7"></a></span>
<span id="cb4-8"><a href="microbiota.html#cb4-8"></a>nmds_plot &lt;-<span class="st"> </span><span class="cf">function</span>(microbiome, meta_data, my_title) {</span>
<span id="cb4-9"><a href="microbiota.html#cb4-9"></a>    micro.mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(microbiome, <span class="dt">k =</span> <span class="dv">2</span>, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-10"><a href="microbiota.html#cb4-10"></a>    nmds_points &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(micro.mds<span class="op">$</span>points)</span>
<span id="cb4-11"><a href="microbiota.html#cb4-11"></a>    samples &lt;-<span class="st"> </span><span class="kw">data.frame</span>(nmds_points<span class="op">$</span>MDS1, nmds_points<span class="op">$</span>MDS2)</span>
<span id="cb4-12"><a href="microbiota.html#cb4-12"></a>    samples[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb4-13"><a href="microbiota.html#cb4-13"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb4-14"><a href="microbiota.html#cb4-14"></a>    samples &lt;-<span class="st"> </span><span class="kw">left_join</span>(samples, meta_data)</span>
<span id="cb4-15"><a href="microbiota.html#cb4-15"></a>    stress &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Stress=&quot;</span>, <span class="kw">round</span>(micro.mds<span class="op">$</span>stress, <span class="dt">digits =</span> <span class="dv">3</span>))</span>
<span id="cb4-16"><a href="microbiota.html#cb4-16"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(samples, <span class="kw">aes</span>(<span class="dt">x =</span> nmds_points.MDS1, <span class="dt">y =</span> nmds_points.MDS2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Species, </span>
<span id="cb4-17"><a href="microbiota.html#cb4-17"></a>        <span class="dt">alpha =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">shape =</span> <span class="st">&quot;Sponge species&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-18"><a href="microbiota.html#cb4-18"></a><span class="st">        </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;NMDS 1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;NMDS 2&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-19"><a href="microbiota.html#cb4-19"></a><span class="st">        </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">label =</span> stress)</span>
<span id="cb4-20"><a href="microbiota.html#cb4-20"></a>    <span class="kw">return</span>(p)</span>
<span id="cb4-21"><a href="microbiota.html#cb4-21"></a>}</span>
<span id="cb4-22"><a href="microbiota.html#cb4-22"></a></span>
<span id="cb4-23"><a href="microbiota.html#cb4-23"></a>untransformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(microbiome, meta_data, <span class="st">&quot;untransformed&quot;</span>)</span>
<span id="cb4-24"><a href="microbiota.html#cb4-24"></a>sqrt_transformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(<span class="kw">sqrt</span>(microbiome), meta_data, <span class="st">&quot;sqrt&quot;</span>)</span>
<span id="cb4-25"><a href="microbiota.html#cb4-25"></a>sqrt_wisc_transformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(<span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(microbiome)), meta_data, <span class="st">&quot;sqrt and wisconsin&quot;</span>)</span>
<span id="cb4-26"><a href="microbiota.html#cb4-26"></a></span>
<span id="cb4-27"><a href="microbiota.html#cb4-27"></a><span class="kw">grid.arrange</span>(untransformed, sqrt_transformed, sqrt_wisc_transformed, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">top =</span> <span class="st">&quot;NMDS: Impact of normalisation on discimination of the microbiota&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:nmds"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/nmds-1.png" alt="NMDS of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb" width="672" />
<p class="caption">
Figure 3.3: NMDS of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb
</p>
</div>
<p>It seems that we don’t lose any relevant information and the normalisations in fact increase the discriminatory power.</p>
</div>
<div id="alpha-diversity" class="section level2">
<h2><span class="header-section-number">3.2</span> Alpha diversity</h2>
<p>The microbiota are composed of 420 OTUs in <em>G. barretti</em>, 461 OTUs in <em>S. fortis</em> and 135 OTUs in <em>W. bursa</em>. While <em>G. barretti</em> and <em>S. fortis</em> share 316, respectively they each only share 2 and 8 OTUs with <em>W. bursa</em>.</p>
<p>How does that reflect in their diversities? Below we show Shannon diversity, species richness (SR) and Faith’s phylogenetic distance (PD).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="microbiota.html#cb5-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb5-2"><a href="microbiota.html#cb5-2"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb5-3"><a href="microbiota.html#cb5-3"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb5-4"><a href="microbiota.html#cb5-4"></a><span class="kw">library</span>(picante)</span>
<span id="cb5-5"><a href="microbiota.html#cb5-5"></a></span>
<span id="cb5-6"><a href="microbiota.html#cb5-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb5-7"><a href="microbiota.html#cb5-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb5-8"><a href="microbiota.html#cb5-8"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb5-9"><a href="microbiota.html#cb5-9"></a>tree &lt;-<span class="st"> </span><span class="kw">read.nexus</span>(<span class="st">&quot;data/infile.nex.con.X.tre&quot;</span>)</span>
<span id="cb5-10"><a href="microbiota.html#cb5-10"></a></span>
<span id="cb5-11"><a href="microbiota.html#cb5-11"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome<span class="op">$</span>Sample_ID</span>
<span id="cb5-12"><a href="microbiota.html#cb5-12"></a>microbiome<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb5-13"><a href="microbiota.html#cb5-13"></a>otumat &lt;-<span class="st"> </span><span class="kw">t</span>(microbiome)</span>
<span id="cb5-14"><a href="microbiota.html#cb5-14"></a>otumat &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(otumat))</span>
<span id="cb5-15"><a href="microbiota.html#cb5-15"></a><span class="kw">colnames</span>(otumat) &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb5-16"><a href="microbiota.html#cb5-16"></a><span class="kw">rownames</span>(taxonomy) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, taxonomy<span class="op">$</span>OTU_ID)</span>
<span id="cb5-17"><a href="microbiota.html#cb5-17"></a>taxonomy<span class="op">$</span>OTU_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb5-18"><a href="microbiota.html#cb5-18"></a><span class="co"># all(rownames(taxonomy)==rownames(otumat))</span></span>
<span id="cb5-19"><a href="microbiota.html#cb5-19"></a></span>
<span id="cb5-20"><a href="microbiota.html#cb5-20"></a><span class="co"># relative abundance</span></span>
<span id="cb5-21"><a href="microbiota.html#cb5-21"></a>otumat &lt;-<span class="st"> </span><span class="kw">apply</span>(otumat, <span class="dv">2</span>, <span class="cf">function</span>(i) i<span class="op">/</span><span class="kw">sum</span>(i))</span>
<span id="cb5-22"><a href="microbiota.html#cb5-22"></a>OTU &lt;-<span class="st"> </span><span class="kw">otu_table</span>(otumat, <span class="dt">taxa_are_rows =</span> <span class="ot">TRUE</span>)</span>
<span id="cb5-23"><a href="microbiota.html#cb5-23"></a><span class="co"># remove low abundance taxa OTU &lt;- filter_taxa(OTU, function(x) mean(x) &gt; 0.0025,</span></span>
<span id="cb5-24"><a href="microbiota.html#cb5-24"></a><span class="co"># TRUE)</span></span>
<span id="cb5-25"><a href="microbiota.html#cb5-25"></a>taxmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(taxonomy)</span>
<span id="cb5-26"><a href="microbiota.html#cb5-26"></a>TAX &lt;-<span class="st"> </span><span class="kw">tax_table</span>(taxmat)</span>
<span id="cb5-27"><a href="microbiota.html#cb5-27"></a>biom_data &lt;-<span class="st"> </span><span class="kw">phyloseq</span>(OTU, TAX)</span>
<span id="cb5-28"><a href="microbiota.html#cb5-28"></a><span class="co"># Merge into phyloseq object</span></span>
<span id="cb5-29"><a href="microbiota.html#cb5-29"></a>pso &lt;-<span class="st"> </span><span class="kw">merge_phyloseq</span>(biom_data, tree)  <span class="co">#merging a phyloseq and a tree file</span></span>
<span id="cb5-30"><a href="microbiota.html#cb5-30"></a>pso &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(<span class="kw">taxa_sums</span>(pso) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, pso)</span>
<span id="cb5-31"><a href="microbiota.html#cb5-31"></a></span>
<span id="cb5-32"><a href="microbiota.html#cb5-32"></a><span class="co"># Calculate Phylogenetic Distance (PD) of the dataset, ALPHA DIVERSITY</span></span>
<span id="cb5-33"><a href="microbiota.html#cb5-33"></a>otu_table_pso &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(pso<span class="op">@</span>otu_table)</span>
<span id="cb5-34"><a href="microbiota.html#cb5-34"></a>df.pd &lt;-<span class="st"> </span><span class="kw">pd</span>(<span class="kw">t</span>(otu_table_pso), tree, <span class="dt">include.root =</span> F)</span>
<span id="cb5-35"><a href="microbiota.html#cb5-35"></a>df.pd[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df.pd)</span>
<span id="cb5-36"><a href="microbiota.html#cb5-36"></a><span class="co"># df.pd: PD = Faith&#39;s Phylogenetic diversity, SR= species richness</span></span>
<span id="cb5-37"><a href="microbiota.html#cb5-37"></a>div &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">diversity</span>(<span class="kw">t</span>(otumat), <span class="dt">index =</span> <span class="st">&quot;shannon&quot;</span>))</span>
<span id="cb5-38"><a href="microbiota.html#cb5-38"></a>div[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(<span class="kw">rownames</span>(div), <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb5-39"><a href="microbiota.html#cb5-39"></a><span class="kw">colnames</span>(div) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Shannon_diversity&quot;</span>, <span class="st">&quot;spec&quot;</span>)</span>
<span id="cb5-40"><a href="microbiota.html#cb5-40"></a>div[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(div)</span>
<span id="cb5-41"><a href="microbiota.html#cb5-41"></a>div_indices &lt;-<span class="st"> </span><span class="kw">full_join</span>(div, df.pd)</span>
<span id="cb5-42"><a href="microbiota.html#cb5-42"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb5-43"><a href="microbiota.html#cb5-43"></a>div_indices &lt;-<span class="st"> </span><span class="kw">left_join</span>(div_indices, md)</span>
<span id="cb5-44"><a href="microbiota.html#cb5-44"></a></span>
<span id="cb5-45"><a href="microbiota.html#cb5-45"></a>div_indices &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(div_indices, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>))</span>
<span id="cb5-46"><a href="microbiota.html#cb5-46"></a><span class="kw">ggplot</span>(div_indices, <span class="kw">aes</span>(<span class="dt">x =</span> Depth, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(variable), </span>
<span id="cb5-47"><a href="microbiota.html#cb5-47"></a>    <span class="kw">vars</span>(spec), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, </span>
<span id="cb5-48"><a href="microbiota.html#cb5-48"></a>    <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust =</span> <span class="dv">1</span>), <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Diversity metrics&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-49"><a href="microbiota.html#cb5-49"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Sample depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<div class="figure"><span id="fig:diversities"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/diversities-1.png" alt="Microbiota diversity indices grouped by sponge species and ordered by sample depth." width="672" />
<p class="caption">
Figure 3.4: Microbiota diversity indices grouped by sponge species and ordered by sample depth.
</p>
</div>
<p>In some of the downstream analyses, we distinguish between common/abundant OTUs and rare OTUs. We use a cutoff of 0.25% average relative abundance per OTU for the classification. That implies drastically modifying the origial numbers of OTUs per sponge as outlined below.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="microbiota.html#cb6-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb6-2"><a href="microbiota.html#cb6-2"></a>emp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/SpongeEMP.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb6-3"><a href="microbiota.html#cb6-3"></a></span>
<span id="cb6-4"><a href="microbiota.html#cb6-4"></a>emp[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;X196900&quot;</span>)</span>
<span id="cb6-5"><a href="microbiota.html#cb6-5"></a><span class="co"># The full data set had the entries listed by sponge host, so there are 62</span></span>
<span id="cb6-6"><a href="microbiota.html#cb6-6"></a><span class="co"># duplicates in the OTU list length(emp$XOTU_id) # 207</span></span>
<span id="cb6-7"><a href="microbiota.html#cb6-7"></a><span class="co"># length(unique(emp$XOTU_id)) # 145</span></span>
<span id="cb6-8"><a href="microbiota.html#cb6-8"></a>emp[<span class="st">&quot;num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb6-9"><a href="microbiota.html#cb6-9"></a>emp &lt;-<span class="st"> </span>emp[<span class="kw">order</span>(emp<span class="op">$</span>num), ]</span>
<span id="cb6-10"><a href="microbiota.html#cb6-10"></a>emp[<span class="st">&quot;dup&quot;</span>] &lt;-<span class="st"> </span><span class="kw">duplicated</span>(emp<span class="op">$</span>num)</span>
<span id="cb6-11"><a href="microbiota.html#cb6-11"></a><span class="co"># dim(emp[emp$dup==&#39;TRUE&#39;,]) #62</span></span>
<span id="cb6-12"><a href="microbiota.html#cb6-12"></a>emp &lt;-<span class="st"> </span>emp[emp<span class="op">$</span>dup <span class="op">==</span><span class="st"> &quot;FALSE&quot;</span>, ]</span>
<span id="cb6-13"><a href="microbiota.html#cb6-13"></a>emp[, <span class="kw">c</span>(<span class="st">&quot;sponge&quot;</span>, <span class="st">&quot;num&quot;</span>, <span class="st">&quot;dup&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb6-14"><a href="microbiota.html#cb6-14"></a></span>
<span id="cb6-15"><a href="microbiota.html#cb6-15"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb6-16"><a href="microbiota.html#cb6-16"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb6-17"><a href="microbiota.html#cb6-17"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb6-18"><a href="microbiota.html#cb6-18"></a>    <span class="co"># micro &lt;- sqrt(micro)</span></span>
<span id="cb6-19"><a href="microbiota.html#cb6-19"></a>    </span>
<span id="cb6-20"><a href="microbiota.html#cb6-20"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb6-21"><a href="microbiota.html#cb6-21"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb6-22"><a href="microbiota.html#cb6-22"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb6-23"><a href="microbiota.html#cb6-23"></a>    </span>
<span id="cb6-24"><a href="microbiota.html#cb6-24"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]  <span class="co">#removes columns that only contain 0</span></span>
<span id="cb6-25"><a href="microbiota.html#cb6-25"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb6-26"><a href="microbiota.html#cb6-26"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb6-27"><a href="microbiota.html#cb6-27"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb6-28"><a href="microbiota.html#cb6-28"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb6-29"><a href="microbiota.html#cb6-29"></a>}</span>
<span id="cb6-30"><a href="microbiota.html#cb6-30"></a></span>
<span id="cb6-31"><a href="microbiota.html#cb6-31"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb6-32"><a href="microbiota.html#cb6-32"></a></span>
<span id="cb6-33"><a href="microbiota.html#cb6-33"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb6-34"><a href="microbiota.html#cb6-34"></a>    mic &lt;-<span class="st"> </span>micro</span>
<span id="cb6-35"><a href="microbiota.html#cb6-35"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb6-36"><a href="microbiota.html#cb6-36"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb6-37"><a href="microbiota.html#cb6-37"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb6-38"><a href="microbiota.html#cb6-38"></a>    </span>
<span id="cb6-39"><a href="microbiota.html#cb6-39"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb6-40"><a href="microbiota.html#cb6-40"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb6-41"><a href="microbiota.html#cb6-41"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb6-42"><a href="microbiota.html#cb6-42"></a>    }</span>
<span id="cb6-43"><a href="microbiota.html#cb6-43"></a>    </span>
<span id="cb6-44"><a href="microbiota.html#cb6-44"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb6-45"><a href="microbiota.html#cb6-45"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb6-46"><a href="microbiota.html#cb6-46"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb6-47"><a href="microbiota.html#cb6-47"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb6-48"><a href="microbiota.html#cb6-48"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb6-49"><a href="microbiota.html#cb6-49"></a>}</span>
<span id="cb6-50"><a href="microbiota.html#cb6-50"></a></span>
<span id="cb6-51"><a href="microbiota.html#cb6-51"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb6-52"><a href="microbiota.html#cb6-52"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb6-53"><a href="microbiota.html#cb6-53"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb6-54"><a href="microbiota.html#cb6-54"></a></span>
<span id="cb6-55"><a href="microbiota.html#cb6-55"></a>gb_occurrence &lt;-<span class="st"> </span>gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb6-56"><a href="microbiota.html#cb6-56"></a>gb_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(gb_occurrence)</span>
<span id="cb6-57"><a href="microbiota.html#cb6-57"></a>gb_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_occurrence, emp)</span>
<span id="cb6-58"><a href="microbiota.html#cb6-58"></a></span>
<span id="cb6-59"><a href="microbiota.html#cb6-59"></a>sf_occurrence &lt;-<span class="st"> </span>sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb6-60"><a href="microbiota.html#cb6-60"></a>sf_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(sf_occurrence)</span>
<span id="cb6-61"><a href="microbiota.html#cb6-61"></a>sf_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_occurrence, emp)</span>
<span id="cb6-62"><a href="microbiota.html#cb6-62"></a></span>
<span id="cb6-63"><a href="microbiota.html#cb6-63"></a>wb_occurrence &lt;-<span class="st"> </span>wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb6-64"><a href="microbiota.html#cb6-64"></a>wb_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(wb_occurrence)</span>
<span id="cb6-65"><a href="microbiota.html#cb6-65"></a>wb_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(wb_occurrence, emp)</span>
<span id="cb6-66"><a href="microbiota.html#cb6-66"></a></span>
<span id="cb6-67"><a href="microbiota.html#cb6-67"></a>gb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(gb_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(gb_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb6-68"><a href="microbiota.html#cb6-68"></a>sf_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(sf_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(sf_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb6-69"><a href="microbiota.html#cb6-69"></a>wb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wb_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(wb_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb6-70"><a href="microbiota.html#cb6-70"></a></span>
<span id="cb6-71"><a href="microbiota.html#cb6-71"></a>aggr &lt;-<span class="st"> </span><span class="kw">cbind</span>(gb_aggr, sf_aggr<span class="op">$</span>x, wb_aggr<span class="op">$</span>x)</span>
<span id="cb6-72"><a href="microbiota.html#cb6-72"></a><span class="kw">colnames</span>(aggr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count Gb&quot;</span>, <span class="st">&quot;count Sf&quot;</span>, <span class="st">&quot;count Wb&quot;</span>)</span>
<span id="cb6-73"><a href="microbiota.html#cb6-73"></a></span>
<span id="cb6-74"><a href="microbiota.html#cb6-74"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb6-75"><a href="microbiota.html#cb6-75"></a><span class="kw">kable</span>(aggr, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count (Gb)&quot;</span>, <span class="st">&quot;count (Sf)&quot;</span>, <span class="st">&quot;count (Wb)&quot;</span>), </span>
<span id="cb6-76"><a href="microbiota.html#cb6-76"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Number of OTUs being excluded and retained in the three sponges&#39; microbiota when filtering for average relative abundance &gt; 0.25%.&quot;</span>, </span>
<span id="cb6-77"><a href="microbiota.html#cb6-77"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, </span>
<span id="cb6-78"><a href="microbiota.html#cb6-78"></a>    <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:filtering-low-abdc-1">Table 3.1: </span>Number of OTUs being excluded and retained in the three sponges’ microbiota when filtering for average relative abundance &gt; 0.25%.
</caption>
<thead>
<tr>
<th style="text-align:left;">
OTU classification
</th>
<th style="text-align:right;">
count (Gb)
</th>
<th style="text-align:right;">
count (Sf)
</th>
<th style="text-align:right;">
count (Wb)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
common
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
rare
</td>
<td style="text-align:right;">
324
</td>
<td style="text-align:right;">
372
</td>
<td style="text-align:right;">
115
</td>
</tr>
</tbody>
</table>
<p>That means, for <em>G. barretti</em> we exclude 77.1 % of OTUs, for <em>S. fortis</em> 80.7 % and for <em>W. bursa</em> 85.2%.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="microbiota.html#cb7-1"></a>gb_common &lt;-<span class="st"> </span>gb_occ_emp[gb_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb7-2"><a href="microbiota.html#cb7-2"></a>sf_common &lt;-<span class="st"> </span>sf_occ_emp[sf_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb7-3"><a href="microbiota.html#cb7-3"></a>wb_common &lt;-<span class="st"> </span>wb_occ_emp[wb_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb7-4"><a href="microbiota.html#cb7-4"></a></span>
<span id="cb7-5"><a href="microbiota.html#cb7-5"></a>gb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(gb_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(gb_common<span class="op">$</span>spongeEMP_enriched), </span>
<span id="cb7-6"><a href="microbiota.html#cb7-6"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb7-7"><a href="microbiota.html#cb7-7"></a>sf_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(sf_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(sf_common<span class="op">$</span>spongeEMP_enriched), </span>
<span id="cb7-8"><a href="microbiota.html#cb7-8"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb7-9"><a href="microbiota.html#cb7-9"></a>wb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wb_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(wb_common<span class="op">$</span>spongeEMP_enriched), </span>
<span id="cb7-10"><a href="microbiota.html#cb7-10"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb7-11"><a href="microbiota.html#cb7-11"></a></span>
<span id="cb7-12"><a href="microbiota.html#cb7-12"></a>aggr &lt;-<span class="st"> </span><span class="kw">cbind</span>(gb_aggr, sf_aggr<span class="op">$</span>x)</span>
<span id="cb7-13"><a href="microbiota.html#cb7-13"></a>aggr &lt;-<span class="st"> </span><span class="kw">left_join</span>(aggr, wb_aggr, <span class="dt">by =</span> <span class="st">&quot;Group.1&quot;</span>)</span>
<span id="cb7-14"><a href="microbiota.html#cb7-14"></a><span class="kw">colnames</span>(aggr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;EMP OTU count&quot;</span>, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Wb&quot;</span>)</span>
<span id="cb7-15"><a href="microbiota.html#cb7-15"></a></span>
<span id="cb7-16"><a href="microbiota.html#cb7-16"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb7-17"><a href="microbiota.html#cb7-17"></a><span class="kw">kable</span>(aggr, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count (Gb)&quot;</span>, <span class="st">&quot;count (Sf)&quot;</span>, <span class="st">&quot;count (Wb)&quot;</span>), </span>
<span id="cb7-18"><a href="microbiota.html#cb7-18"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Number of common/abundant OTUs found in the SpongeEMP data base&quot;</span>, </span>
<span id="cb7-19"><a href="microbiota.html#cb7-19"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, </span>
<span id="cb7-20"><a href="microbiota.html#cb7-20"></a>    <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:filtering-low-abdc-2">Table 3.2: </span>Number of common/abundant OTUs found in the SpongeEMP data base
</caption>
<thead>
<tr>
<th style="text-align:left;">
OTU classification
</th>
<th style="text-align:right;">
count (Gb)
</th>
<th style="text-align:right;">
count (Sf)
</th>
<th style="text-align:right;">
count (Wb)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
yes
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table>
</div>
<div id="environmental-modelling" class="section level2">
<h2><span class="header-section-number">3.3</span> Environmental modelling</h2>
<p>In order to investigate whether and which of the environmental parameter might “explain”/correlate with variation the the microbiota, we apply <a href="microbiota.html#constrained">constrained</a> and <a href="microbiota.html#unconstrained">unconstrained</a> ecological data analysis methods.</p>
<div id="constrained" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Constrained modelling approach Automatic stepwise model building</h3>
<p>We use canonical correspondence analysis as method for ordination. According to the manual for the R package vegan, “a good dissimilarity index for multidimensional scaling should have a high rank-order similarity with gradient separation” <span class="citation">(Oksanen et al. <a href="#ref-R-vegan" role="doc-biblioref">2019</a>)</span>. Thus interpreting the results of Tab <a href="microbiota.html#tab:rankindex">3.3</a>, we find that square root transformation and wisconsin standardisation increase the rank correlation between the microbial community dissimilarity matrix and the environmental gradient separation in all three sponge microbiota for a number of ecological dissimilarity indices.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="microbiota.html#cb8-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb8-2"><a href="microbiota.html#cb8-2"></a></span>
<span id="cb8-3"><a href="microbiota.html#cb8-3"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb8-4"><a href="microbiota.html#cb8-4"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb8-5"><a href="microbiota.html#cb8-5"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb8-6"><a href="microbiota.html#cb8-6"></a></span>
<span id="cb8-7"><a href="microbiota.html#cb8-7"></a><span class="co"># Gb12 has no salinity and temperature: impute from Gb11 &amp; Gb13: Salinity:34.92;</span></span>
<span id="cb8-8"><a href="microbiota.html#cb8-8"></a><span class="co"># Temp:3.59</span></span>
<span id="cb8-9"><a href="microbiota.html#cb8-9"></a>row &lt;-<span class="st"> </span><span class="kw">which</span>(meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>)</span>
<span id="cb8-10"><a href="microbiota.html#cb8-10"></a>temp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBottomTemp_Cdeg&quot;</span>)</span>
<span id="cb8-11"><a href="microbiota.html#cb8-11"></a>sal &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBotSalinity_PSU&quot;</span>)</span>
<span id="cb8-12"><a href="microbiota.html#cb8-12"></a>meta_data[row, temp] &lt;-<span class="st"> </span><span class="fl">3.59</span></span>
<span id="cb8-13"><a href="microbiota.html#cb8-13"></a>meta_data[row, sal] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb8-14"><a href="microbiota.html#cb8-14"></a><span class="kw">rm</span>(row, temp, sal)</span>
<span id="cb8-15"><a href="microbiota.html#cb8-15"></a></span>
<span id="cb8-16"><a href="microbiota.html#cb8-16"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb8-17"><a href="microbiota.html#cb8-17"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb8-18"><a href="microbiota.html#cb8-18"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb8-19"><a href="microbiota.html#cb8-19"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb8-20"><a href="microbiota.html#cb8-20"></a>    </span>
<span id="cb8-21"><a href="microbiota.html#cb8-21"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb8-22"><a href="microbiota.html#cb8-22"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb8-23"><a href="microbiota.html#cb8-23"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb8-24"><a href="microbiota.html#cb8-24"></a>    </span>
<span id="cb8-25"><a href="microbiota.html#cb8-25"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb8-26"><a href="microbiota.html#cb8-26"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb8-27"><a href="microbiota.html#cb8-27"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb8-28"><a href="microbiota.html#cb8-28"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb8-29"><a href="microbiota.html#cb8-29"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb8-30"><a href="microbiota.html#cb8-30"></a>}</span>
<span id="cb8-31"><a href="microbiota.html#cb8-31"></a></span>
<span id="cb8-32"><a href="microbiota.html#cb8-32"></a>microbiomes &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb8-33"><a href="microbiota.html#cb8-33"></a></span>
<span id="cb8-34"><a href="microbiota.html#cb8-34"></a>md_prep &lt;-<span class="st"> </span><span class="cf">function</span>(microbiomes, meta_data) {</span>
<span id="cb8-35"><a href="microbiota.html#cb8-35"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb8-36"><a href="microbiota.html#cb8-36"></a>        <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb8-37"><a href="microbiota.html#cb8-37"></a>    </span>
<span id="cb8-38"><a href="microbiota.html#cb8-38"></a>    gb &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>gb</span>
<span id="cb8-39"><a href="microbiota.html#cb8-39"></a>    sf &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>sf</span>
<span id="cb8-40"><a href="microbiota.html#cb8-40"></a>    wb &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>wb</span>
<span id="cb8-41"><a href="microbiota.html#cb8-41"></a>    </span>
<span id="cb8-42"><a href="microbiota.html#cb8-42"></a>    gb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(gb), ]</span>
<span id="cb8-43"><a href="microbiota.html#cb8-43"></a>    <span class="kw">rownames</span>(gb_md) &lt;-<span class="st"> </span>gb_md<span class="op">$</span>unified_ID</span>
<span id="cb8-44"><a href="microbiota.html#cb8-44"></a>    gb_md &lt;-<span class="st"> </span>gb_md[<span class="kw">order</span>(gb_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb8-45"><a href="microbiota.html#cb8-45"></a>    <span class="kw">all</span>(<span class="kw">rownames</span>(microbiomes<span class="op">$</span>gb) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(gb_md))</span>
<span id="cb8-46"><a href="microbiota.html#cb8-46"></a>    gb_md &lt;-<span class="st"> </span>gb_md[, <span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, </span>
<span id="cb8-47"><a href="microbiota.html#cb8-47"></a>        <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb8-48"><a href="microbiota.html#cb8-48"></a>    </span>
<span id="cb8-49"><a href="microbiota.html#cb8-49"></a>    sf_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(sf), ]</span>
<span id="cb8-50"><a href="microbiota.html#cb8-50"></a>    <span class="kw">rownames</span>(sf_md) &lt;-<span class="st"> </span>sf_md<span class="op">$</span>unified_ID</span>
<span id="cb8-51"><a href="microbiota.html#cb8-51"></a>    sf_md &lt;-<span class="st"> </span>sf_md[<span class="kw">order</span>(sf_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb8-52"><a href="microbiota.html#cb8-52"></a>    sf_md<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb8-53"><a href="microbiota.html#cb8-53"></a>    wb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(wb), ]</span>
<span id="cb8-54"><a href="microbiota.html#cb8-54"></a>    <span class="kw">rownames</span>(wb_md) &lt;-<span class="st"> </span>wb_md<span class="op">$</span>unified_ID</span>
<span id="cb8-55"><a href="microbiota.html#cb8-55"></a>    wb_md &lt;-<span class="st"> </span>wb_md[<span class="kw">order</span>(wb_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb8-56"><a href="microbiota.html#cb8-56"></a>    wb_md<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb8-57"><a href="microbiota.html#cb8-57"></a>    </span>
<span id="cb8-58"><a href="microbiota.html#cb8-58"></a>    mds &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb_md =</span> gb_md, <span class="dt">sf_md =</span> sf_md, <span class="dt">wb_md =</span> wb_md)</span>
<span id="cb8-59"><a href="microbiota.html#cb8-59"></a>    <span class="kw">return</span>(mds)</span>
<span id="cb8-60"><a href="microbiota.html#cb8-60"></a>}</span>
<span id="cb8-61"><a href="microbiota.html#cb8-61"></a></span>
<span id="cb8-62"><a href="microbiota.html#cb8-62"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb8-63"><a href="microbiota.html#cb8-63"></a></span>
<span id="cb8-64"><a href="microbiota.html#cb8-64"></a><span class="co"># Standardization If there is a large difference between smallest non-zero</span></span>
<span id="cb8-65"><a href="microbiota.html#cb8-65"></a><span class="co"># abundance and largest abundance, we want to reduce this difference. Usually</span></span>
<span id="cb8-66"><a href="microbiota.html#cb8-66"></a><span class="co"># square root transformation is sufficient to balance the data. Wisconsin double</span></span>
<span id="cb8-67"><a href="microbiota.html#cb8-67"></a><span class="co"># standardization often improves the gradient detection ability of dissimilarity</span></span>
<span id="cb8-68"><a href="microbiota.html#cb8-68"></a><span class="co"># indices.</span></span>
<span id="cb8-69"><a href="microbiota.html#cb8-69"></a></span>
<span id="cb8-70"><a href="microbiota.html#cb8-70"></a><span class="co"># Which dissimilarity index is best?</span></span>
<span id="cb8-71"><a href="microbiota.html#cb8-71"></a>gb_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), (microbiomes<span class="op">$</span>gb)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, </span>
<span id="cb8-72"><a href="microbiota.html#cb8-72"></a>    <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#unstandardized</span></span>
<span id="cb8-73"><a href="microbiota.html#cb8-73"></a>gb_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), microbiomes<span class="op">$</span>gb, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, </span>
<span id="cb8-74"><a href="microbiota.html#cb8-74"></a>    <span class="st">&quot;kul&quot;</span>))  <span class="co">#sqrt</span></span>
<span id="cb8-75"><a href="microbiota.html#cb8-75"></a>gb_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, </span>
<span id="cb8-76"><a href="microbiota.html#cb8-76"></a>    <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#sqrt and wisconsin</span></span>
<span id="cb8-77"><a href="microbiota.html#cb8-77"></a></span>
<span id="cb8-78"><a href="microbiota.html#cb8-78"></a>sf_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), (microbiomes<span class="op">$</span>sf)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, </span>
<span id="cb8-79"><a href="microbiota.html#cb8-79"></a>    <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb8-80"><a href="microbiota.html#cb8-80"></a>sf_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), microbiomes<span class="op">$</span>sf, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, </span>
<span id="cb8-81"><a href="microbiota.html#cb8-81"></a>    <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb8-82"><a href="microbiota.html#cb8-82"></a>sf_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, </span>
<span id="cb8-83"><a href="microbiota.html#cb8-83"></a>    <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb8-84"><a href="microbiota.html#cb8-84"></a></span>
<span id="cb8-85"><a href="microbiota.html#cb8-85"></a>wb_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), (microbiomes<span class="op">$</span>wb)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, </span>
<span id="cb8-86"><a href="microbiota.html#cb8-86"></a>    <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb8-87"><a href="microbiota.html#cb8-87"></a>wb_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), microbiomes<span class="op">$</span>wb, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, </span>
<span id="cb8-88"><a href="microbiota.html#cb8-88"></a>    <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb8-89"><a href="microbiota.html#cb8-89"></a>wb_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, </span>
<span id="cb8-90"><a href="microbiota.html#cb8-90"></a>    <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb8-91"><a href="microbiota.html#cb8-91"></a></span>
<span id="cb8-92"><a href="microbiota.html#cb8-92"></a>rankindices &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_ri1, gb_ri2, gb_ri3, sf_ri1, sf_ri2, sf_ri3, wb_ri1, wb_ri2, </span>
<span id="cb8-93"><a href="microbiota.html#cb8-93"></a>    wb_ri3)</span>
<span id="cb8-94"><a href="microbiota.html#cb8-94"></a>rankindices &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rankindices)</span>
<span id="cb8-95"><a href="microbiota.html#cb8-95"></a>rankindices[<span class="st">&quot;Sponge species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;G. barretti&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;S. fortis&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;W. bursa&quot;</span>, </span>
<span id="cb8-96"><a href="microbiota.html#cb8-96"></a>    <span class="dv">3</span>))</span>
<span id="cb8-97"><a href="microbiota.html#cb8-97"></a>rankindices[<span class="st">&quot;Normalisation&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;sqrt&quot;</span>, <span class="st">&quot;sqrt &amp; wisconsin&quot;</span>), <span class="dv">3</span>))</span>
<span id="cb8-98"><a href="microbiota.html#cb8-98"></a></span>
<span id="cb8-99"><a href="microbiota.html#cb8-99"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb8-100"><a href="microbiota.html#cb8-100"></a><span class="kw">kable</span>(rankindices, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Euclidean&quot;</span>, <span class="st">&quot;Manhattan&quot;</span>, <span class="st">&quot;Bray–Curtis&quot;</span>, <span class="st">&quot;Jaccard&quot;</span>, </span>
<span id="cb8-101"><a href="microbiota.html#cb8-101"></a>    <span class="st">&quot;Kulczynski&quot;</span>, <span class="st">&quot;Sponge species&quot;</span>, <span class="st">&quot;Normalisation&quot;</span>), <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Rank correlation between dissimilarity indices and gradient separation. The higher the number the stronger the correlation, i.e. the better the fit.&quot;</span>, </span>
<span id="cb8-102"><a href="microbiota.html#cb8-102"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb8-103"><a href="microbiota.html#cb8-103"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb8-104"><a href="microbiota.html#cb8-104"></a>    <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:rankindex">Table 3.3: </span>Rank correlation between dissimilarity indices and gradient separation. The higher the number the stronger the correlation, i.e. the better the fit.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Euclidean
</th>
<th style="text-align:right;">
Manhattan
</th>
<th style="text-align:right;">
Bray–Curtis
</th>
<th style="text-align:right;">
Jaccard
</th>
<th style="text-align:right;">
Kulczynski
</th>
<th style="text-align:left;">
Sponge species
</th>
<th style="text-align:left;">
Normalisation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.0512024
</td>
<td style="text-align:right;">
-0.0445135
</td>
<td style="text-align:right;">
0.3979615
</td>
<td style="text-align:right;">
0.3979615
</td>
<td style="text-align:right;">
0.4509158
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0930562
</td>
<td style="text-align:right;">
0.1658067
</td>
<td style="text-align:right;">
0.3967033
</td>
<td style="text-align:right;">
0.3967033
</td>
<td style="text-align:right;">
0.4010193
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4072305
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0816401
</td>
<td style="text-align:right;">
0.1826975
</td>
<td style="text-align:right;">
0.3111549
</td>
<td style="text-align:right;">
0.3111549
</td>
<td style="text-align:right;">
0.4108128
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3285092
</td>
<td style="text-align:right;">
0.3476778
</td>
<td style="text-align:right;">
0.4620775
</td>
<td style="text-align:right;">
0.4620775
</td>
<td style="text-align:right;">
0.4877255
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5056811
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0280922
</td>
<td style="text-align:right;">
0.0994375
</td>
<td style="text-align:right;">
0.0008681
</td>
<td style="text-align:right;">
0.0008681
</td>
<td style="text-align:right;">
0.0048476
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0376971
</td>
<td style="text-align:right;">
0.4854434
</td>
<td style="text-align:right;">
0.2801306
</td>
<td style="text-align:right;">
0.2801306
</td>
<td style="text-align:right;">
0.2656573
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.0833252
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
</tbody>
</table>
<p>We adapt the microbial data sets accordingly applying square root transformation and wisconsin standardisation of the microbiota in all subsequent ecological analyses. Then, we build a model (null model) without any environmental parameters, and one (full model) with the maximum number of environmental parameters (terms) possible so that none of them have a VIF &gt; 10. Finally, we use the stepwise model building function <code>ordistep</code> to determine, which of the environmental parameters is a significant constraint for the microbiomes. The function compares the null model and adds and removes terms from the full model to find (combinations of) significant contraints. The significance of the paramters is then tested in an ANOVA.</p>
<p><strong><em>G. barretti</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the anova of the suggested model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="microbiota.html#cb9-1"></a><span class="co"># mod0 has no terms, intercept only mod1 includes all terms possible with a VIF &lt;</span></span>
<span id="cb9-2"><a href="microbiota.html#cb9-2"></a><span class="co"># 10. Available: &#39;Depth&#39;, &#39;Latitude&#39;, &#39;Longitude&#39;, &#39;MeanBottomTemp_Cdeg&#39;,</span></span>
<span id="cb9-3"><a href="microbiota.html#cb9-3"></a><span class="co"># &#39;MeanBotSalinity_PSU&#39;, &#39;YEAR&#39;</span></span>
<span id="cb9-4"><a href="microbiota.html#cb9-4"></a></span>
<span id="cb9-5"><a href="microbiota.html#cb9-5"></a><span class="co">## Gb</span></span>
<span id="cb9-6"><a href="microbiota.html#cb9-6"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>gb_md)</span>
<span id="cb9-7"><a href="microbiota.html#cb9-7"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>MeanBottomTemp_Cdeg <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-8"><a href="microbiota.html#cb9-8"></a><span class="st">    </span>YEAR, mds<span class="op">$</span>gb_md)</span>
<span id="cb9-9"><a href="microbiota.html#cb9-9"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude MeanBottomTemp_Cdeg                YEAR 
##            1.230382            1.775034            1.929029            1.651565</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="microbiota.html#cb11-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)  <span class="co">#0</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="microbiota.html#cb12-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 6.7097 3.4066  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="microbiota.html#cb14-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$gb) ~ Depth, data = mds$gb_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1   0.34451 3.4066  0.001 ***
## Residual 12   1.21355                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong><em>S. fortis</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the anova of the suggested model.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="microbiota.html#cb16-1"></a><span class="co">## Sf</span></span>
<span id="cb16-2"><a href="microbiota.html#cb16-2"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>sf_md)</span>
<span id="cb16-3"><a href="microbiota.html#cb16-3"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>YEAR <span class="op">+</span><span class="st"> </span>MeanBotSalinity_PSU <span class="op">+</span><span class="st"> </span></span>
<span id="cb16-4"><a href="microbiota.html#cb16-4"></a><span class="st">    </span>Longitude, mds<span class="op">$</span>sf_md)</span>
<span id="cb16-5"><a href="microbiota.html#cb16-5"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude                YEAR MeanBotSalinity_PSU 
##            4.218950            5.079261            1.082453            3.648340 
##           Longitude 
##            5.071690</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="microbiota.html#cb18-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="microbiota.html#cb19-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 13.547 2.1462  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="microbiota.html#cb21-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$sf) ~ Depth, data = mds$sf_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1   0.31199 2.1462  0.001 ***
## Residual 13   1.88978                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong><em>W. bursa</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the anova of the suggested model.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="microbiota.html#cb23-1"></a><span class="co">## Wb</span></span>
<span id="cb23-2"><a href="microbiota.html#cb23-2"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>wb_md)</span>
<span id="cb23-3"><a href="microbiota.html#cb23-3"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>MeanBottomTemp_Cdeg <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-4"><a href="microbiota.html#cb23-4"></a><span class="st">    </span>YEAR, mds<span class="op">$</span>wb_md)</span>
<span id="cb23-5"><a href="microbiota.html#cb23-5"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude MeanBottomTemp_Cdeg                YEAR 
##            2.216302            1.217879            2.402357            1.153565</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="microbiota.html#cb25-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="microbiota.html#cb26-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##            Df    AIC      F Pr(&gt;F)   
## + Depth     1 25.701 1.6576  0.005 **
## + Latitude  1 25.993 1.4649  0.040 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="microbiota.html#cb28-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$wb) ~ Depth + Latitude, data = mds$wb_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     2    0.8527 1.5888  0.001 ***
## Residual 13    3.4888                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>For all <em>G. barretti</em> and <em>S. fortis</em> depth is a significant constraint of the microbial community. For <em>W. bursa</em> we find temperature to be a significant constraint.</p>
</div>
<div id="unconstrained" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Unconstrained modelling approach</h3>
<p>In an alternative approach, we fit environmental vectors onto an ordination of the microbiota. This method allows to include all environmental parameters (regardless of collinearity). Length of the arrow indicates strength of the predictor (environmental parameter).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="microbiota.html#cb30-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb30-2"><a href="microbiota.html#cb30-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb30-3"><a href="microbiota.html#cb30-3"></a></span>
<span id="cb30-4"><a href="microbiota.html#cb30-4"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb30-5"><a href="microbiota.html#cb30-5"></a>row &lt;-<span class="st"> </span><span class="kw">which</span>(meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>)</span>
<span id="cb30-6"><a href="microbiota.html#cb30-6"></a>temp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBottomTemp_Cdeg&quot;</span>)</span>
<span id="cb30-7"><a href="microbiota.html#cb30-7"></a>sal &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBotSalinity_PSU&quot;</span>)</span>
<span id="cb30-8"><a href="microbiota.html#cb30-8"></a>meta_data[row, temp] &lt;-<span class="st"> </span><span class="fl">3.59</span></span>
<span id="cb30-9"><a href="microbiota.html#cb30-9"></a>meta_data[row, sal] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb30-10"><a href="microbiota.html#cb30-10"></a><span class="kw">rm</span>(row, temp, sal)</span>
<span id="cb30-11"><a href="microbiota.html#cb30-11"></a></span>
<span id="cb30-12"><a href="microbiota.html#cb30-12"></a>microbiomes &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb30-13"><a href="microbiota.html#cb30-13"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb30-14"><a href="microbiota.html#cb30-14"></a></span>
<span id="cb30-15"><a href="microbiota.html#cb30-15"></a><span class="kw">colnames</span>(mds<span class="op">$</span>gb_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb30-16"><a href="microbiota.html#cb30-16"></a><span class="kw">colnames</span>(mds<span class="op">$</span>sf_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb30-17"><a href="microbiota.html#cb30-17"></a><span class="kw">colnames</span>(mds<span class="op">$</span>wb_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb30-18"><a href="microbiota.html#cb30-18"></a></span>
<span id="cb30-19"><a href="microbiota.html#cb30-19"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb))  <span class="co">#distance matrix</span></span>
<span id="cb30-20"><a href="microbiota.html#cb30-20"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb30-21"><a href="microbiota.html#cb30-21"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>gb_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows; STRATA?</span></span>
<span id="cb30-22"><a href="microbiota.html#cb30-22"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co">#plot</span></span>
<span id="cb30-23"><a href="microbiota.html#cb30-23"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co">#arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-1"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-1-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of G. barretti microbiome." width="672" />
<p class="caption">
Figure 3.5: Fitting significant (p&lt;0.05) environmental vectors onto ordination of G. barretti microbiome.
</p>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="microbiota.html#cb31-1"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf))  <span class="co"># distance matrix</span></span>
<span id="cb31-2"><a href="microbiota.html#cb31-2"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb31-3"><a href="microbiota.html#cb31-3"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>sf_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows</span></span>
<span id="cb31-4"><a href="microbiota.html#cb31-4"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co"># plot</span></span>
<span id="cb31-5"><a href="microbiota.html#cb31-5"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co"># arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-2"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-2-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of S. fortis microbiome." width="672" />
<p class="caption">
Figure 3.6: Fitting significant (p&lt;0.05) environmental vectors onto ordination of S. fortis microbiome.
</p>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="microbiota.html#cb32-1"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb))  <span class="co"># distance matrix</span></span>
<span id="cb32-2"><a href="microbiota.html#cb32-2"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb32-3"><a href="microbiota.html#cb32-3"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>wb_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows</span></span>
<span id="cb32-4"><a href="microbiota.html#cb32-4"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co"># plot</span></span>
<span id="cb32-5"><a href="microbiota.html#cb32-5"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co"># arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-3"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-3-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of W. bursa microbiome." width="672" />
<p class="caption">
Figure 3.7: Fitting significant (p&lt;0.05) environmental vectors onto ordination of W. bursa microbiome.
</p>
</div>
<p>Hierarchical clustering</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="microbiota.html#cb33-1"></a><span class="co">## Clustering</span></span>
<span id="cb33-2"><a href="microbiota.html#cb33-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb33-3"><a href="microbiota.html#cb33-3"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb))  <span class="co">#distance matrix</span></span>
<span id="cb33-4"><a href="microbiota.html#cb33-4"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb33-5"><a href="microbiota.html#cb33-5"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Gb&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span>
<span id="cb33-6"><a href="microbiota.html#cb33-6"></a><span class="kw">rect.hclust</span>(clua, <span class="dv">2</span>)</span>
<span id="cb33-7"><a href="microbiota.html#cb33-7"></a>grp1 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb33-8"><a href="microbiota.html#cb33-8"></a></span>
<span id="cb33-9"><a href="microbiota.html#cb33-9"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf))  <span class="co">#distance matrix</span></span>
<span id="cb33-10"><a href="microbiota.html#cb33-10"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb33-11"><a href="microbiota.html#cb33-11"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Sf&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span>
<span id="cb33-12"><a href="microbiota.html#cb33-12"></a>grp2 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb33-13"><a href="microbiota.html#cb33-13"></a></span>
<span id="cb33-14"><a href="microbiota.html#cb33-14"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb))  <span class="co">#distance matrix</span></span>
<span id="cb33-15"><a href="microbiota.html#cb33-15"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb33-16"><a href="microbiota.html#cb33-16"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Wb&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:hclust"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/hclust-1.png" alt="Hclust" width="672" />
<p class="caption">
Figure 3.8: Hclust
</p>
</div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="microbiota.html#cb34-1"></a>grp3 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb34-2"><a href="microbiota.html#cb34-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb34-3"><a href="microbiota.html#cb34-3"></a></span>
<span id="cb34-4"><a href="microbiota.html#cb34-4"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$gb)) plot(ord, display = &#39;sites&#39;)</span></span>
<span id="cb34-5"><a href="microbiota.html#cb34-5"></a><span class="co"># ordihull(ord, grp1, lty = 2, col = &#39;red&#39;)</span></span>
<span id="cb34-6"><a href="microbiota.html#cb34-6"></a></span>
<span id="cb34-7"><a href="microbiota.html#cb34-7"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$sf)) plot(ord, display = &#39;sites&#39;)</span></span>
<span id="cb34-8"><a href="microbiota.html#cb34-8"></a><span class="co"># ordihull(ord, grp2, lty = 2, col = &#39;red&#39;)</span></span>
<span id="cb34-9"><a href="microbiota.html#cb34-9"></a></span>
<span id="cb34-10"><a href="microbiota.html#cb34-10"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$wb)) plot(ord, display = &#39;sites&#39;)</span></span>
<span id="cb34-11"><a href="microbiota.html#cb34-11"></a><span class="co"># ordihull(ord, grp3, lty = 2, col = &#39;red&#39;)</span></span></code></pre></div>
</div>
</div>
<div id="relative-abundance-bar-plots" class="section level2">
<h2><span class="header-section-number">3.4</span> Relative abundance bar plots</h2>
<p>Enough of the anonymous modelling and data fitting, let’s take a look at the taxonomy to see who is there.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="microbiota.html#cb35-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb35-2"><a href="microbiota.html#cb35-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/PANGAEA_Final.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb35-3"><a href="microbiota.html#cb35-3"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb35-4"><a href="microbiota.html#cb35-4"></a></span>
<span id="cb35-5"><a href="microbiota.html#cb35-5"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb35-6"><a href="microbiota.html#cb35-6"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb35-7"><a href="microbiota.html#cb35-7"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb35-8"><a href="microbiota.html#cb35-8"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb35-9"><a href="microbiota.html#cb35-9"></a>    </span>
<span id="cb35-10"><a href="microbiota.html#cb35-10"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb35-11"><a href="microbiota.html#cb35-11"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb35-12"><a href="microbiota.html#cb35-12"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb35-13"><a href="microbiota.html#cb35-13"></a>    </span>
<span id="cb35-14"><a href="microbiota.html#cb35-14"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb35-15"><a href="microbiota.html#cb35-15"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb35-16"><a href="microbiota.html#cb35-16"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb35-17"><a href="microbiota.html#cb35-17"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb35-18"><a href="microbiota.html#cb35-18"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb35-19"><a href="microbiota.html#cb35-19"></a>}</span>
<span id="cb35-20"><a href="microbiota.html#cb35-20"></a></span>
<span id="cb35-21"><a href="microbiota.html#cb35-21"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb35-22"><a href="microbiota.html#cb35-22"></a></span>
<span id="cb35-23"><a href="microbiota.html#cb35-23"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb35-24"><a href="microbiota.html#cb35-24"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb35-25"><a href="microbiota.html#cb35-25"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb35-26"><a href="microbiota.html#cb35-26"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb35-27"><a href="microbiota.html#cb35-27"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb35-28"><a href="microbiota.html#cb35-28"></a>    </span>
<span id="cb35-29"><a href="microbiota.html#cb35-29"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb35-30"><a href="microbiota.html#cb35-30"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb35-31"><a href="microbiota.html#cb35-31"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb35-32"><a href="microbiota.html#cb35-32"></a>    }</span>
<span id="cb35-33"><a href="microbiota.html#cb35-33"></a>    </span>
<span id="cb35-34"><a href="microbiota.html#cb35-34"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb35-35"><a href="microbiota.html#cb35-35"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb35-36"><a href="microbiota.html#cb35-36"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb35-37"><a href="microbiota.html#cb35-37"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb35-38"><a href="microbiota.html#cb35-38"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb35-39"><a href="microbiota.html#cb35-39"></a>}</span>
<span id="cb35-40"><a href="microbiota.html#cb35-40"></a></span>
<span id="cb35-41"><a href="microbiota.html#cb35-41"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb35-42"><a href="microbiota.html#cb35-42"></a></span>
<span id="cb35-43"><a href="microbiota.html#cb35-43"></a><span class="co"># PHYLUM</span></span>
<span id="cb35-44"><a href="microbiota.html#cb35-44"></a>adonis_prep &lt;-<span class="st"> </span><span class="cf">function</span>(taxonomy, occurrence) {</span>
<span id="cb35-45"><a href="microbiota.html#cb35-45"></a>    occurrence<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>gb)</span>
<span id="cb35-46"><a href="microbiota.html#cb35-46"></a>    occurrence<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>sf)</span>
<span id="cb35-47"><a href="microbiota.html#cb35-47"></a>    occurrence<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>wb)</span>
<span id="cb35-48"><a href="microbiota.html#cb35-48"></a>    </span>
<span id="cb35-49"><a href="microbiota.html#cb35-49"></a>    tax &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb35-50"><a href="microbiota.html#cb35-50"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb35-51"><a href="microbiota.html#cb35-51"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(tax)[<span class="dv">1</span>]</span>
<span id="cb35-52"><a href="microbiota.html#cb35-52"></a>    tax[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb35-53"><a href="microbiota.html#cb35-53"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb35-54"><a href="microbiota.html#cb35-54"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb35-55"><a href="microbiota.html#cb35-55"></a>        tax<span class="op">$</span>XOTU[n] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, tax<span class="op">$</span>OTU_ID[n])</span>
<span id="cb35-56"><a href="microbiota.html#cb35-56"></a>    }</span>
<span id="cb35-57"><a href="microbiota.html#cb35-57"></a>    </span>
<span id="cb35-58"><a href="microbiota.html#cb35-58"></a>    tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>gb)</span>
<span id="cb35-59"><a href="microbiota.html#cb35-59"></a>    tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>sf)</span>
<span id="cb35-60"><a href="microbiota.html#cb35-60"></a>    tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>wb)</span>
<span id="cb35-61"><a href="microbiota.html#cb35-61"></a>    </span>
<span id="cb35-62"><a href="microbiota.html#cb35-62"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> tax_gb, <span class="dt">sf =</span> tax_sf, <span class="dt">wb =</span> tax_wb)</span>
<span id="cb35-63"><a href="microbiota.html#cb35-63"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb35-64"><a href="microbiota.html#cb35-64"></a>}</span>
<span id="cb35-65"><a href="microbiota.html#cb35-65"></a></span>
<span id="cb35-66"><a href="microbiota.html#cb35-66"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb35-67"><a href="microbiota.html#cb35-67"></a></span>
<span id="cb35-68"><a href="microbiota.html#cb35-68"></a>cleaning &lt;-<span class="st"> </span><span class="cf">function</span>(taxes) {</span>
<span id="cb35-69"><a href="microbiota.html#cb35-69"></a>    gb &lt;-<span class="st"> </span>taxes<span class="op">$</span>gb</span>
<span id="cb35-70"><a href="microbiota.html#cb35-70"></a>    sf &lt;-<span class="st"> </span>taxes<span class="op">$</span>sf</span>
<span id="cb35-71"><a href="microbiota.html#cb35-71"></a>    wb &lt;-<span class="st"> </span>taxes<span class="op">$</span>wb</span>
<span id="cb35-72"><a href="microbiota.html#cb35-72"></a>    <span class="co"># Renaming &amp; removing whitespaces</span></span>
<span id="cb35-73"><a href="microbiota.html#cb35-73"></a>    gb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Phylum)))</span>
<span id="cb35-74"><a href="microbiota.html#cb35-74"></a>    sf<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Phylum)))</span>
<span id="cb35-75"><a href="microbiota.html#cb35-75"></a>    wb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Phylum)))</span>
<span id="cb35-76"><a href="microbiota.html#cb35-76"></a>    gb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Class)))</span>
<span id="cb35-77"><a href="microbiota.html#cb35-77"></a>    sf<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Class)))</span>
<span id="cb35-78"><a href="microbiota.html#cb35-78"></a>    wb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Class)))</span>
<span id="cb35-79"><a href="microbiota.html#cb35-79"></a>    <span class="co">## GB</span></span>
<span id="cb35-80"><a href="microbiota.html#cb35-80"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb35-81"><a href="microbiota.html#cb35-81"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb35-82"><a href="microbiota.html#cb35-82"></a>    gb<span class="op">$</span>Phylum[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb35-83"><a href="microbiota.html#cb35-83"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb35-84"><a href="microbiota.html#cb35-84"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb35-85"><a href="microbiota.html#cb35-85"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb35-86"><a href="microbiota.html#cb35-86"></a>    gb<span class="op">$</span>Class[gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Chloroflexi&quot;</span> <span class="op">&amp;</span><span class="st"> </span>gb<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> &quot;Chloroflexi_unclassified&quot;</span></span>
<span id="cb35-87"><a href="microbiota.html#cb35-87"></a>    <span class="co">## SF</span></span>
<span id="cb35-88"><a href="microbiota.html#cb35-88"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb35-89"><a href="microbiota.html#cb35-89"></a>    sf<span class="op">$</span>Phylum[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb35-90"><a href="microbiota.html#cb35-90"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb35-91"><a href="microbiota.html#cb35-91"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Proteobacteria&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sf<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;Proteobacteria_unclassified&quot;</span></span>
<span id="cb35-92"><a href="microbiota.html#cb35-92"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb35-93"><a href="microbiota.html#cb35-93"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb35-94"><a href="microbiota.html#cb35-94"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb35-95"><a href="microbiota.html#cb35-95"></a>    <span class="co">## WB</span></span>
<span id="cb35-96"><a href="microbiota.html#cb35-96"></a>    wb<span class="op">$</span>Class[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb35-97"><a href="microbiota.html#cb35-97"></a>    wb<span class="op">$</span>Phylum[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb35-98"><a href="microbiota.html#cb35-98"></a>    <span class="co"># merge back</span></span>
<span id="cb35-99"><a href="microbiota.html#cb35-99"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb, <span class="dt">sf =</span> sf, <span class="dt">wb =</span> wb)</span>
<span id="cb35-100"><a href="microbiota.html#cb35-100"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb35-101"><a href="microbiota.html#cb35-101"></a>}</span>
<span id="cb35-102"><a href="microbiota.html#cb35-102"></a></span>
<span id="cb35-103"><a href="microbiota.html#cb35-103"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb35-104"><a href="microbiota.html#cb35-104"></a></span>
<span id="cb35-105"><a href="microbiota.html#cb35-105"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb35-106"><a href="microbiota.html#cb35-106"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb35-107"><a href="microbiota.html#cb35-107"></a>    x</span>
<span id="cb35-108"><a href="microbiota.html#cb35-108"></a>})</span>
<span id="cb35-109"><a href="microbiota.html#cb35-109"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb35-110"><a href="microbiota.html#cb35-110"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb35-111"><a href="microbiota.html#cb35-111"></a>    x</span>
<span id="cb35-112"><a href="microbiota.html#cb35-112"></a>})</span>
<span id="cb35-113"><a href="microbiota.html#cb35-113"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb35-114"><a href="microbiota.html#cb35-114"></a>    x[<span class="st">&quot;Class&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb35-115"><a href="microbiota.html#cb35-115"></a>    x</span>
<span id="cb35-116"><a href="microbiota.html#cb35-116"></a>})</span>
<span id="cb35-117"><a href="microbiota.html#cb35-117"></a></span>
<span id="cb35-118"><a href="microbiota.html#cb35-118"></a></span>
<span id="cb35-119"><a href="microbiota.html#cb35-119"></a><span class="co"># aggregate sum of relative abundance per phylum in each sponge sample</span></span>
<span id="cb35-120"><a href="microbiota.html#cb35-120"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb35-121"><a href="microbiota.html#cb35-121"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb35-122"><a href="microbiota.html#cb35-122"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb35-123"><a href="microbiota.html#cb35-123"></a></span>
<span id="cb35-124"><a href="microbiota.html#cb35-124"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb35-125"><a href="microbiota.html#cb35-125"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_phy, wb)</span>
<span id="cb35-126"><a href="microbiota.html#cb35-126"></a>taxes_phy[<span class="kw">is.na</span>(taxes_phy)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb35-127"><a href="microbiota.html#cb35-127"></a></span>
<span id="cb35-128"><a href="microbiota.html#cb35-128"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_phy, sum)</span></span>
<span id="cb35-129"><a href="microbiota.html#cb35-129"></a></span>
<span id="cb35-130"><a href="microbiota.html#cb35-130"></a><span class="kw">rownames</span>(taxes_phy) &lt;-<span class="st"> </span>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb35-131"><a href="microbiota.html#cb35-131"></a>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb35-132"><a href="microbiota.html#cb35-132"></a>df_phylum &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_phy))  <span class="co">#taxes_phy_t &lt;- df_phylum</span></span>
<span id="cb35-133"><a href="microbiota.html#cb35-133"></a>df_phylum[<span class="st">&quot;Sample_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df_phylum)</span>
<span id="cb35-134"><a href="microbiota.html#cb35-134"></a>df_phylum &lt;-<span class="st"> </span><span class="kw">melt</span>(df_phylum, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>))</span>
<span id="cb35-135"><a href="microbiota.html#cb35-135"></a><span class="kw">colnames</span>(df_phylum) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;variable&quot;</span>)</span>
<span id="cb35-136"><a href="microbiota.html#cb35-136"></a></span>
<span id="cb35-137"><a href="microbiota.html#cb35-137"></a><span class="kw">ggplot</span>(df_phylum, <span class="kw">aes</span>(<span class="dt">x =</span> Sample_ID, <span class="dt">y =</span> variable, <span class="dt">fill =</span> Phylum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-138"><a href="microbiota.html#cb35-138"></a><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>), <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-139"><a href="microbiota.html#cb35-139"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Samples ordered by depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Relative abundance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">&quot;Gb1&quot;</span>, </span>
<span id="cb35-140"><a href="microbiota.html#cb35-140"></a>    <span class="st">&quot;Gb2&quot;</span>, <span class="st">&quot;Gb3&quot;</span>, <span class="st">&quot;Gb4&quot;</span>, <span class="st">&quot;Gb5&quot;</span>, <span class="st">&quot;Gb6&quot;</span>, <span class="st">&quot;Gb7&quot;</span>, <span class="st">&quot;Gb8&quot;</span>, <span class="st">&quot;Gb9&quot;</span>, <span class="st">&quot;Gb10&quot;</span>, <span class="st">&quot;Gb11&quot;</span>, <span class="st">&quot;Gb12&quot;</span>, </span>
<span id="cb35-141"><a href="microbiota.html#cb35-141"></a>    <span class="st">&quot;Gb13&quot;</span>, <span class="st">&quot;Gb14&quot;</span>, <span class="st">&quot;Sf1&quot;</span>, <span class="st">&quot;Sf2&quot;</span>, <span class="st">&quot;Sf3&quot;</span>, <span class="st">&quot;Sf4&quot;</span>, <span class="st">&quot;Sf5&quot;</span>, <span class="st">&quot;Sf6&quot;</span>, <span class="st">&quot;Sf7&quot;</span>, <span class="st">&quot;Sf8&quot;</span>, <span class="st">&quot;Sf9&quot;</span>, </span>
<span id="cb35-142"><a href="microbiota.html#cb35-142"></a>    <span class="st">&quot;Sf10&quot;</span>, <span class="st">&quot;Sf11&quot;</span>, <span class="st">&quot;Sf12&quot;</span>, <span class="st">&quot;Sf13&quot;</span>, <span class="st">&quot;Sf14&quot;</span>, <span class="st">&quot;Sf15&quot;</span>, <span class="st">&quot;Wb1&quot;</span>, <span class="st">&quot;Wb2&quot;</span>, <span class="st">&quot;Wb3&quot;</span>, <span class="st">&quot;Wb4&quot;</span>, <span class="st">&quot;Wb5&quot;</span>, </span>
<span id="cb35-143"><a href="microbiota.html#cb35-143"></a>    <span class="st">&quot;Wb6&quot;</span>, <span class="st">&quot;Wb7&quot;</span>, <span class="st">&quot;Wb8&quot;</span>, <span class="st">&quot;Wb9&quot;</span>, <span class="st">&quot;Wb10&quot;</span>, <span class="st">&quot;Wb11&quot;</span>, <span class="st">&quot;Wb12&quot;</span>, <span class="st">&quot;Wb13&quot;</span>, <span class="st">&quot;Wb14&quot;</span>, <span class="st">&quot;Wb15&quot;</span>, <span class="st">&quot;Wb16&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-144"><a href="microbiota.html#cb35-144"></a><span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Acidobacteria&quot;</span>, <span class="st">&quot;Actinobacteria&quot;</span>, <span class="st">&quot;Bacteroidetes&quot;</span>, </span>
<span id="cb35-145"><a href="microbiota.html#cb35-145"></a>        <span class="st">&quot;Chlamydiae&quot;</span>, <span class="st">&quot;Chloroflexi&quot;</span>, <span class="st">&quot;Cyanobacteria&quot;</span>, <span class="st">&quot;Deferribacteres&quot;</span>, <span class="st">&quot;Deinococcus.Thermus&quot;</span>, </span>
<span id="cb35-146"><a href="microbiota.html#cb35-146"></a>        <span class="st">&quot;Firmicutes&quot;</span>, <span class="st">&quot;Gemmatimonadetes&quot;</span>, <span class="st">&quot;Nitrospinae&quot;</span>, <span class="st">&quot;Nitrospirae&quot;</span>, <span class="st">&quot;PAUC34f&quot;</span>, </span>
<span id="cb35-147"><a href="microbiota.html#cb35-147"></a>        <span class="st">&quot;Planctomycetes&quot;</span>, <span class="st">&quot;Poribacteria&quot;</span>, <span class="st">&quot;Proteobacteria&quot;</span>, <span class="st">&quot;SBR1093&quot;</span>, <span class="st">&quot;Spirochaetae&quot;</span>, </span>
<span id="cb35-148"><a href="microbiota.html#cb35-148"></a>        <span class="st">&quot;Tectomicrobia&quot;</span>, <span class="st">&quot;Thaumarchaeota&quot;</span>, <span class="st">&quot;unclassified&quot;</span>, <span class="st">&quot;Verrucomicrobia&quot;</span>), <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#b8c4f6&quot;</span>, </span>
<span id="cb35-149"><a href="microbiota.html#cb35-149"></a>        <span class="st">&quot;#ffaaaf&quot;</span>, <span class="st">&quot;#3d1349&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#01559d&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, </span>
<span id="cb35-150"><a href="microbiota.html#cb35-150"></a>        <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#019c51&quot;</span>, <span class="st">&quot;#b10060&quot;</span>, <span class="st">&quot;#49ca00&quot;</span>, <span class="st">&quot;#dd8e00&quot;</span>, <span class="st">&quot;#f282ff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, </span>
<span id="cb35-151"><a href="microbiota.html#cb35-151"></a>        <span class="st">&quot;#ff633f&quot;</span>, <span class="st">&quot;#ec0040&quot;</span>, <span class="st">&quot;#010b92&quot;</span>, <span class="st">&quot;#cf00aa&quot;</span>, <span class="st">&quot;#aba900&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#fce300&quot;</span>), </span>
<span id="cb35-152"><a href="microbiota.html#cb35-152"></a>        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Acidobacteria&quot;</span>, <span class="st">&quot;Actinobacteria&quot;</span>, <span class="st">&quot;Bacteroidetes&quot;</span>, <span class="st">&quot;Chlamydiae&quot;</span>, </span>
<span id="cb35-153"><a href="microbiota.html#cb35-153"></a>            <span class="st">&quot;Chloroflexi&quot;</span>, <span class="st">&quot;Cyanobacteria&quot;</span>, <span class="st">&quot;Deferribacteres&quot;</span>, <span class="st">&quot;Deinococcus.Thermus&quot;</span>, </span>
<span id="cb35-154"><a href="microbiota.html#cb35-154"></a>            <span class="st">&quot;Firmicutes&quot;</span>, <span class="st">&quot;Gemmatimonadetes&quot;</span>, <span class="st">&quot;Nitrospinae&quot;</span>, <span class="st">&quot;Nitrospirae&quot;</span>, <span class="st">&quot;PAUC34f&quot;</span>, </span>
<span id="cb35-155"><a href="microbiota.html#cb35-155"></a>            <span class="st">&quot;Planctomycetes&quot;</span>, <span class="st">&quot;Poribacteria&quot;</span>, <span class="st">&quot;Proteobacteria&quot;</span>, <span class="st">&quot;SBR1093&quot;</span>, <span class="st">&quot;Spirochaetae&quot;</span>, </span>
<span id="cb35-156"><a href="microbiota.html#cb35-156"></a>            <span class="st">&quot;Tectomicrobia&quot;</span>, <span class="st">&quot;Thaumarchaeota&quot;</span>, <span class="st">&quot;unclassified&quot;</span>, <span class="st">&quot;Verrucomicrobia&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:rel-abdc-plot"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/rel-abdc-plot-1.png" alt="Relative abundance of prokaryotic phyla per sponge sample." width="672" />
<p class="caption">
Figure 3.9: Relative abundance of prokaryotic phyla per sponge sample.
</p>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="microbiota.html#cb36-1"></a><span class="co"># df_phylum[&#39;spec&#39;] &lt;- str_sub(df_phylum$Sample_ID,1,2) md &lt;-</span></span>
<span id="cb36-2"><a href="microbiota.html#cb36-2"></a><span class="co"># meta_data[,c(&#39;unified_ID&#39;, &#39;Depth&#39;)] colnames(md) &lt;- c(&#39;Sample_ID&#39;, &#39;Depth&#39;)</span></span>
<span id="cb36-3"><a href="microbiota.html#cb36-3"></a><span class="co"># df_phylum &lt;- left_join(df_phylum, md)</span></span>
<span id="cb36-4"><a href="microbiota.html#cb36-4"></a></span>
<span id="cb36-5"><a href="microbiota.html#cb36-5"></a><span class="co"># ggplot(df_phylum, aes(x=as.factor(Depth), y=variable, fill=Phylum))+</span></span>
<span id="cb36-6"><a href="microbiota.html#cb36-6"></a><span class="co"># geom_bar(stat=&#39;identity&#39;)+facet_wrap(.~spec, scales=&#39;free&#39;)+</span></span>
<span id="cb36-7"><a href="microbiota.html#cb36-7"></a><span class="co"># theme_classic()+theme(axis.text.x = element_text(angle = 90, hjust =</span></span>
<span id="cb36-8"><a href="microbiota.html#cb36-8"></a><span class="co"># 1),legend.position = &#39;bottom&#39;)+xlab(&#39;Samples ordered by depth&#39;)+ylab(&#39;Relative</span></span>
<span id="cb36-9"><a href="microbiota.html#cb36-9"></a><span class="co"># abundance&#39;)+ scale_fill_manual(&#39;&#39;, breaks = c(&#39;Acidobacteria&#39;,</span></span>
<span id="cb36-10"><a href="microbiota.html#cb36-10"></a><span class="co"># &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;, &#39;Chloroflexi&#39;,</span></span>
<span id="cb36-11"><a href="microbiota.html#cb36-11"></a><span class="co"># &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;, &#39;Firmicutes&#39;,</span></span>
<span id="cb36-12"><a href="microbiota.html#cb36-12"></a><span class="co"># &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;, &#39;Planctomycetes&#39;,</span></span>
<span id="cb36-13"><a href="microbiota.html#cb36-13"></a><span class="co"># &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;, &#39;Tectomicrobia&#39;,</span></span>
<span id="cb36-14"><a href="microbiota.html#cb36-14"></a><span class="co"># &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;), values =</span></span>
<span id="cb36-15"><a href="microbiota.html#cb36-15"></a><span class="co"># c(&#39;#b8c4f6&#39;,&#39;#ffaaaf&#39;,&#39;#3d1349&#39;,&#39;#ffffff&#39;,&#39;#01559d&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#019c51&#39;,&#39;#b10060&#39;,&#39;#49ca00&#39;,&#39;#dd8e00&#39;,&#39;#f282ff&#39;,&#39;#ffffff&#39;,&#39;#ff633f&#39;,&#39;#ec0040&#39;,&#39;#010b92&#39;,&#39;#cf00aa&#39;,&#39;#aba900&#39;,&#39;#ffffff&#39;,&#39;#fce300&#39;),</span></span>
<span id="cb36-16"><a href="microbiota.html#cb36-16"></a><span class="co"># labels = c(&#39;Acidobacteria&#39;, &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;,</span></span>
<span id="cb36-17"><a href="microbiota.html#cb36-17"></a><span class="co"># &#39;Chloroflexi&#39;, &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;,</span></span>
<span id="cb36-18"><a href="microbiota.html#cb36-18"></a><span class="co"># &#39;Firmicutes&#39;, &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;,</span></span>
<span id="cb36-19"><a href="microbiota.html#cb36-19"></a><span class="co"># &#39;Planctomycetes&#39;, &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;,</span></span>
<span id="cb36-20"><a href="microbiota.html#cb36-20"></a><span class="co"># &#39;Tectomicrobia&#39;, &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;) )</span></span></code></pre></div>
<p>We see in this bar plot that the relative abundance of phyla remains fairly stable across the different depths. The composition of the prokaryotic communities in the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> is similar, while the composition in the LMA sponge <em>W. bursa</em> is different to them.
The phyla left white/blank are present at very low abundance and we thought the figure might be visually easier without too many colours.</p>
<p>If you prefer numbers, this is what it breaks down to:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="microbiota.html#cb37-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb37-2"><a href="microbiota.html#cb37-2"></a></span>
<span id="cb37-3"><a href="microbiota.html#cb37-3"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb37-4"><a href="microbiota.html#cb37-4"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb37-5"><a href="microbiota.html#cb37-5"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb37-6"><a href="microbiota.html#cb37-6"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb37-7"><a href="microbiota.html#cb37-7"></a>    </span>
<span id="cb37-8"><a href="microbiota.html#cb37-8"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb37-9"><a href="microbiota.html#cb37-9"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb37-10"><a href="microbiota.html#cb37-10"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb37-11"><a href="microbiota.html#cb37-11"></a>    </span>
<span id="cb37-12"><a href="microbiota.html#cb37-12"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb37-13"><a href="microbiota.html#cb37-13"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb37-14"><a href="microbiota.html#cb37-14"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb37-15"><a href="microbiota.html#cb37-15"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb37-16"><a href="microbiota.html#cb37-16"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb37-17"><a href="microbiota.html#cb37-17"></a>}</span>
<span id="cb37-18"><a href="microbiota.html#cb37-18"></a></span>
<span id="cb37-19"><a href="microbiota.html#cb37-19"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb37-20"><a href="microbiota.html#cb37-20"></a></span>
<span id="cb37-21"><a href="microbiota.html#cb37-21"></a><span class="co"># calculate relative abundance of OTU across sponge samples</span></span>
<span id="cb37-22"><a href="microbiota.html#cb37-22"></a></span>
<span id="cb37-23"><a href="microbiota.html#cb37-23"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb37-24"><a href="microbiota.html#cb37-24"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb37-25"><a href="microbiota.html#cb37-25"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb37-26"><a href="microbiota.html#cb37-26"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb37-27"><a href="microbiota.html#cb37-27"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb37-28"><a href="microbiota.html#cb37-28"></a>    </span>
<span id="cb37-29"><a href="microbiota.html#cb37-29"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb37-30"><a href="microbiota.html#cb37-30"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb37-31"><a href="microbiota.html#cb37-31"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb37-32"><a href="microbiota.html#cb37-32"></a>    }</span>
<span id="cb37-33"><a href="microbiota.html#cb37-33"></a>    </span>
<span id="cb37-34"><a href="microbiota.html#cb37-34"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb37-35"><a href="microbiota.html#cb37-35"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb37-36"><a href="microbiota.html#cb37-36"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb37-37"><a href="microbiota.html#cb37-37"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb37-38"><a href="microbiota.html#cb37-38"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb37-39"><a href="microbiota.html#cb37-39"></a>}</span>
<span id="cb37-40"><a href="microbiota.html#cb37-40"></a></span>
<span id="cb37-41"><a href="microbiota.html#cb37-41"></a><span class="co"># gb_occurrence &lt;- overall_rabdc(micro_ds$gb) sf_occurrence &lt;-</span></span>
<span id="cb37-42"><a href="microbiota.html#cb37-42"></a><span class="co"># overall_rabdc(micro_ds$sf) wb_occurrence &lt;- overall_rabdc(micro_ds$wb)</span></span>
<span id="cb37-43"><a href="microbiota.html#cb37-43"></a><span class="co"># occurrence &lt;- list(gb=gb_occurrence, sf=sf_occurrence, wb=wb_occurrence)</span></span>
<span id="cb37-44"><a href="microbiota.html#cb37-44"></a></span>
<span id="cb37-45"><a href="microbiota.html#cb37-45"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb37-46"><a href="microbiota.html#cb37-46"></a></span>
<span id="cb37-47"><a href="microbiota.html#cb37-47"></a>aggregations &lt;-<span class="st"> </span><span class="cf">function</span>(taxonomy, occurrence) {</span>
<span id="cb37-48"><a href="microbiota.html#cb37-48"></a>    occurrence<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>gb)</span>
<span id="cb37-49"><a href="microbiota.html#cb37-49"></a>    occurrence<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>sf)</span>
<span id="cb37-50"><a href="microbiota.html#cb37-50"></a>    occurrence<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>wb)</span>
<span id="cb37-51"><a href="microbiota.html#cb37-51"></a>    </span>
<span id="cb37-52"><a href="microbiota.html#cb37-52"></a>    tax &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb37-53"><a href="microbiota.html#cb37-53"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb37-54"><a href="microbiota.html#cb37-54"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(tax)[<span class="dv">1</span>]</span>
<span id="cb37-55"><a href="microbiota.html#cb37-55"></a>    tax[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb37-56"><a href="microbiota.html#cb37-56"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb37-57"><a href="microbiota.html#cb37-57"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb37-58"><a href="microbiota.html#cb37-58"></a>        tax<span class="op">$</span>XOTU[n] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, tax<span class="op">$</span>OTU_ID[n])</span>
<span id="cb37-59"><a href="microbiota.html#cb37-59"></a>    }</span>
<span id="cb37-60"><a href="microbiota.html#cb37-60"></a>    </span>
<span id="cb37-61"><a href="microbiota.html#cb37-61"></a>    tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>gb[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb37-62"><a href="microbiota.html#cb37-62"></a>    tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>sf[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb37-63"><a href="microbiota.html#cb37-63"></a>    tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>wb[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb37-64"><a href="microbiota.html#cb37-64"></a>    </span>
<span id="cb37-65"><a href="microbiota.html#cb37-65"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> tax_gb, <span class="dt">sf =</span> tax_sf, <span class="dt">wb =</span> tax_wb)</span>
<span id="cb37-66"><a href="microbiota.html#cb37-66"></a>    </span>
<span id="cb37-67"><a href="microbiota.html#cb37-67"></a>    gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb37-68"><a href="microbiota.html#cb37-68"></a>    gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb37-69"><a href="microbiota.html#cb37-69"></a>    gb_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb37-70"><a href="microbiota.html#cb37-70"></a>    <span class="kw">colnames</span>(gb_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb37-71"><a href="microbiota.html#cb37-71"></a>    </span>
<span id="cb37-72"><a href="microbiota.html#cb37-72"></a>    gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb37-73"><a href="microbiota.html#cb37-73"></a>    gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb37-74"><a href="microbiota.html#cb37-74"></a>    gb_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb37-75"><a href="microbiota.html#cb37-75"></a>    <span class="kw">colnames</span>(gb_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb37-76"><a href="microbiota.html#cb37-76"></a>    </span>
<span id="cb37-77"><a href="microbiota.html#cb37-77"></a>    test1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, </span>
<span id="cb37-78"><a href="microbiota.html#cb37-78"></a>        <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb37-79"><a href="microbiota.html#cb37-79"></a>    <span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span>
<span id="cb37-80"><a href="microbiota.html#cb37-80"></a>    </span>
<span id="cb37-81"><a href="microbiota.html#cb37-81"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb37-82"><a href="microbiota.html#cb37-82"></a>}</span>
<span id="cb37-83"><a href="microbiota.html#cb37-83"></a></span>
<span id="cb37-84"><a href="microbiota.html#cb37-84"></a>taxes &lt;-<span class="st"> </span><span class="kw">aggregations</span>(taxonomy, occurrence)</span>
<span id="cb37-85"><a href="microbiota.html#cb37-85"></a></span>
<span id="cb37-86"><a href="microbiota.html#cb37-86"></a>cleaning &lt;-<span class="st"> </span><span class="cf">function</span>(taxes) {</span>
<span id="cb37-87"><a href="microbiota.html#cb37-87"></a>    gb &lt;-<span class="st"> </span>taxes<span class="op">$</span>gb</span>
<span id="cb37-88"><a href="microbiota.html#cb37-88"></a>    sf &lt;-<span class="st"> </span>taxes<span class="op">$</span>sf</span>
<span id="cb37-89"><a href="microbiota.html#cb37-89"></a>    wb &lt;-<span class="st"> </span>taxes<span class="op">$</span>wb</span>
<span id="cb37-90"><a href="microbiota.html#cb37-90"></a>    <span class="co"># Renaming &amp; removing whitespaces</span></span>
<span id="cb37-91"><a href="microbiota.html#cb37-91"></a>    gb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Phylum)))</span>
<span id="cb37-92"><a href="microbiota.html#cb37-92"></a>    sf<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Phylum)))</span>
<span id="cb37-93"><a href="microbiota.html#cb37-93"></a>    wb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Phylum)))</span>
<span id="cb37-94"><a href="microbiota.html#cb37-94"></a>    gb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Class)))</span>
<span id="cb37-95"><a href="microbiota.html#cb37-95"></a>    sf<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Class)))</span>
<span id="cb37-96"><a href="microbiota.html#cb37-96"></a>    wb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Class)))</span>
<span id="cb37-97"><a href="microbiota.html#cb37-97"></a>    <span class="co">## GB</span></span>
<span id="cb37-98"><a href="microbiota.html#cb37-98"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb37-99"><a href="microbiota.html#cb37-99"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb37-100"><a href="microbiota.html#cb37-100"></a>    gb<span class="op">$</span>Phylum[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb37-101"><a href="microbiota.html#cb37-101"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb37-102"><a href="microbiota.html#cb37-102"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb37-103"><a href="microbiota.html#cb37-103"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb37-104"><a href="microbiota.html#cb37-104"></a>    gb<span class="op">$</span>Class[gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Chloroflexi&quot;</span> <span class="op">&amp;</span><span class="st"> </span>gb<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> &quot;Chloroflexi_unclassified&quot;</span></span>
<span id="cb37-105"><a href="microbiota.html#cb37-105"></a>    <span class="co">## SF</span></span>
<span id="cb37-106"><a href="microbiota.html#cb37-106"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb37-107"><a href="microbiota.html#cb37-107"></a>    sf<span class="op">$</span>Phylum[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb37-108"><a href="microbiota.html#cb37-108"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb37-109"><a href="microbiota.html#cb37-109"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Proteobacteria&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sf<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;Proteobacteria_unclassified&quot;</span></span>
<span id="cb37-110"><a href="microbiota.html#cb37-110"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb37-111"><a href="microbiota.html#cb37-111"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb37-112"><a href="microbiota.html#cb37-112"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb37-113"><a href="microbiota.html#cb37-113"></a>    <span class="co">## WB</span></span>
<span id="cb37-114"><a href="microbiota.html#cb37-114"></a>    wb<span class="op">$</span>Class[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb37-115"><a href="microbiota.html#cb37-115"></a>    wb<span class="op">$</span>Phylum[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb37-116"><a href="microbiota.html#cb37-116"></a>    <span class="co"># merge back</span></span>
<span id="cb37-117"><a href="microbiota.html#cb37-117"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb, <span class="dt">sf =</span> sf, <span class="dt">wb =</span> wb)</span>
<span id="cb37-118"><a href="microbiota.html#cb37-118"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb37-119"><a href="microbiota.html#cb37-119"></a>}</span>
<span id="cb37-120"><a href="microbiota.html#cb37-120"></a></span>
<span id="cb37-121"><a href="microbiota.html#cb37-121"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb37-122"><a href="microbiota.html#cb37-122"></a></span>
<span id="cb37-123"><a href="microbiota.html#cb37-123"></a>phy_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))  <span class="co">#OTU count</span></span>
<span id="cb37-124"><a href="microbiota.html#cb37-124"></a>phy_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, </span>
<span id="cb37-125"><a href="microbiota.html#cb37-125"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))  <span class="co">#sums relative abundance</span></span>
<span id="cb37-126"><a href="microbiota.html#cb37-126"></a></span>
<span id="cb37-127"><a href="microbiota.html#cb37-127"></a>class_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb37-128"><a href="microbiota.html#cb37-128"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb37-129"><a href="microbiota.html#cb37-129"></a>class_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb37-130"><a href="microbiota.html#cb37-130"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span>
<span id="cb37-131"><a href="microbiota.html#cb37-131"></a></span>
<span id="cb37-132"><a href="microbiota.html#cb37-132"></a>gb_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>gb, phy_rabdc<span class="op">$</span>gb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb37-133"><a href="microbiota.html#cb37-133"></a><span class="kw">colnames</span>(gb_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>)</span>
<span id="cb37-134"><a href="microbiota.html#cb37-134"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb37-135"><a href="microbiota.html#cb37-135"></a><span class="kw">kable</span>(gb_P, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb37-136"><a href="microbiota.html#cb37-136"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Phylum level composition of the G. barretti prokaryotic community&quot;</span>, </span>
<span id="cb37-137"><a href="microbiota.html#cb37-137"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb37-138"><a href="microbiota.html#cb37-138"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb37-139"><a href="microbiota.html#cb37-139"></a>    <span class="st">&quot;scale_down&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;float_left&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="font-size: 12px; width: auto !important; float: left; margin-right: 10px;">
<caption style="font-size: initial !important;">
<span id="tab:class-phylum-stats">Table 3.4: </span>Phylum level composition of the G. barretti prokaryotic community
</caption>
<thead>
<tr>
<th style="text-align:left;">
Phylum
</th>
<th style="text-align:right;">
OTU count
</th>
<th style="text-align:right;">
cum. avg. abundance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acidobacteria
</td>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
0.2649414
</td>
</tr>
<tr>
<td style="text-align:left;">
Actinobacteria
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0.0842461
</td>
</tr>
<tr>
<td style="text-align:left;">
Bacteroidetes
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0062993
</td>
</tr>
<tr>
<td style="text-align:left;">
Chloroflexi
</td>
<td style="text-align:right;">
139
</td>
<td style="text-align:right;">
0.2750718
</td>
</tr>
<tr>
<td style="text-align:left;">
Deinococcus-Thermus
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0028932
</td>
</tr>
<tr>
<td style="text-align:left;">
Gemmatimonadetes
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
0.0924849
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospinae
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0054695
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospirae
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0102463
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUC34f
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0181477
</td>
</tr>
<tr>
<td style="text-align:left;">
Poribacteria
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0014376
</td>
</tr>
<tr>
<td style="text-align:left;">
Proteobacteria
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
0.1528140
</td>
</tr>
<tr>
<td style="text-align:left;">
SBR1093
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0227708
</td>
</tr>
<tr>
<td style="text-align:left;">
Spirochaetae
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0015659
</td>
</tr>
<tr>
<td style="text-align:left;">
Tectomicrobia
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0037265
</td>
</tr>
<tr>
<td style="text-align:left;">
Thaumarchaeota
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.0501133
</td>
</tr>
<tr>
<td style="text-align:left;">
unclassified
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0073353
</td>
</tr>
<tr>
<td style="text-align:left;">
Verrucomicrobia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0004364
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="microbiota.html#cb38-1"></a>gb_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>gb, class_rabdc<span class="op">$</span>gb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb38-2"><a href="microbiota.html#cb38-2"></a><span class="kw">colnames</span>(gb_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb38-3"><a href="microbiota.html#cb38-3"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb38-4"><a href="microbiota.html#cb38-4"></a><span class="kw">kable</span>(gb_C, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb38-5"><a href="microbiota.html#cb38-5"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Class level composition of the G. barretti prokaryotic community&quot;</span>, </span>
<span id="cb38-6"><a href="microbiota.html#cb38-6"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb38-7"><a href="microbiota.html#cb38-7"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb38-8"><a href="microbiota.html#cb38-8"></a>    <span class="st">&quot;scale_down&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="font-size: 12px; width: auto !important; ">
<caption style="font-size: initial !important;">
<span id="tab:class-phylum-stats">Table 3.4: </span>Class level composition of the G. barretti prokaryotic community
</caption>
<thead>
<tr>
<th style="text-align:left;">
Class
</th>
<th style="text-align:right;">
OTU count
</th>
<th style="text-align:right;">
cum. avg. abundance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acidimicrobiia
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0.0739840
</td>
</tr>
<tr>
<td style="text-align:left;">
Alphaproteobacteria
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
0.0390006
</td>
</tr>
<tr>
<td style="text-align:left;">
Anaerolineae
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0.0482071
</td>
</tr>
<tr>
<td style="text-align:left;">
Bacteroidetes_Incertae_Sedis
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0062993
</td>
</tr>
<tr>
<td style="text-align:left;">
BD2-11_terrestrial_group
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0.0842964
</td>
</tr>
<tr>
<td style="text-align:left;">
Caldilineae
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0148265
</td>
</tr>
<tr>
<td style="text-align:left;">
cD4-96
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0002192
</td>
</tr>
<tr>
<td style="text-align:left;">
Chloroflexi_unclassified
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0004288
</td>
</tr>
<tr>
<td style="text-align:left;">
Deinococci
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0028932
</td>
</tr>
<tr>
<td style="text-align:left;">
Deltaproteobacteria
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0116819
</td>
</tr>
<tr>
<td style="text-align:left;">
Gammaproteobacteria
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0.0703735
</td>
</tr>
<tr>
<td style="text-align:left;">
Gemmatimonadetes
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0003909
</td>
</tr>
<tr>
<td style="text-align:left;">
Holophagae
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0140614
</td>
</tr>
<tr>
<td style="text-align:left;">
JG30-KF-CM66
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0.0338617
</td>
</tr>
<tr>
<td style="text-align:left;">
JTB23
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0307588
</td>
</tr>
<tr>
<td style="text-align:left;">
Marine_Group_I
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.0501133
</td>
</tr>
<tr>
<td style="text-align:left;">
MD2896-B214
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0004925
</td>
</tr>
<tr>
<td style="text-align:left;">
MD2898-B26
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0049770
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospira
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0102463
</td>
</tr>
<tr>
<td style="text-align:left;">
Opitutae
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0004364
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUC34f_unclassified
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0181477
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUC43f_marine_benthic_group
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0077976
</td>
</tr>
<tr>
<td style="text-align:left;">
Poribacteria_unclassified
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0014376
</td>
</tr>
<tr>
<td style="text-align:left;">
S085
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0144239
</td>
</tr>
<tr>
<td style="text-align:left;">
SAR202_clade
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0.1300463
</td>
</tr>
<tr>
<td style="text-align:left;">
SBR1093_unclassified
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0227708
</td>
</tr>
<tr>
<td style="text-align:left;">
Solibacteres
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0.0147902
</td>
</tr>
<tr>
<td style="text-align:left;">
Spirochaetes
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0015659
</td>
</tr>
<tr>
<td style="text-align:left;">
SPOTSOCT00m83
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0009992
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_11
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0158604
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_12
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0002899
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_13
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0076461
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_15
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0041330
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_17
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0014770
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0033117
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_21
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0.0330822
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_26
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0081765
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0044164
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_6
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
0.1090133
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_9
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0.0486833
</td>
</tr>
<tr>
<td style="text-align:left;">
Tectomicrobia_unclassified
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0037265
</td>
</tr>
<tr>
<td style="text-align:left;">
Thermoleophilia
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0102621
</td>
</tr>
<tr>
<td style="text-align:left;">
TK10
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0.0330583
</td>
</tr>
<tr>
<td style="text-align:left;">
unclassified
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0073353
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="microbiota.html#cb39-1"></a>sf_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>sf, phy_rabdc<span class="op">$</span>sf[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb39-2"><a href="microbiota.html#cb39-2"></a><span class="kw">colnames</span>(sf_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>)</span>
<span id="cb39-3"><a href="microbiota.html#cb39-3"></a><span class="kw">kable</span>(sf_P, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb39-4"><a href="microbiota.html#cb39-4"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Phylum level composition of the S. fortis prokaryotic community&quot;</span>, </span>
<span id="cb39-5"><a href="microbiota.html#cb39-5"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb39-6"><a href="microbiota.html#cb39-6"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb39-7"><a href="microbiota.html#cb39-7"></a>    <span class="st">&quot;scale_down&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;float_left&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="font-size: 12px; width: auto !important; float: left; margin-right: 10px;">
<caption style="font-size: initial !important;">
<span id="tab:class-phylum-stats">Table 3.4: </span>Phylum level composition of the S. fortis prokaryotic community
</caption>
<thead>
<tr>
<th style="text-align:left;">
Phylum
</th>
<th style="text-align:right;">
OTU count
</th>
<th style="text-align:right;">
cum. avg. abundance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acidobacteria
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
0.2386777
</td>
</tr>
<tr>
<td style="text-align:left;">
Actinobacteria
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0.0693343
</td>
</tr>
<tr>
<td style="text-align:left;">
Bacteroidetes
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0107237
</td>
</tr>
<tr>
<td style="text-align:left;">
Chloroflexi
</td>
<td style="text-align:right;">
152
</td>
<td style="text-align:right;">
0.3064161
</td>
</tr>
<tr>
<td style="text-align:left;">
Deferribacteres
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0001785
</td>
</tr>
<tr>
<td style="text-align:left;">
Deinococcus-Thermus
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0025092
</td>
</tr>
<tr>
<td style="text-align:left;">
Firmicutes
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0003206
</td>
</tr>
<tr>
<td style="text-align:left;">
Gemmatimonadetes
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0.0645283
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospinae
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0130719
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospirae
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0129293
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUC34f
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0338805
</td>
</tr>
<tr>
<td style="text-align:left;">
Planctomycetes
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0007755
</td>
</tr>
<tr>
<td style="text-align:left;">
Poribacteria
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0073678
</td>
</tr>
<tr>
<td style="text-align:left;">
Proteobacteria
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
0.1351338
</td>
</tr>
<tr>
<td style="text-align:left;">
SBR1093
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0205948
</td>
</tr>
<tr>
<td style="text-align:left;">
Spirochaetae
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0154965
</td>
</tr>
<tr>
<td style="text-align:left;">
Tectomicrobia
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0090314
</td>
</tr>
<tr>
<td style="text-align:left;">
Thaumarchaeota
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0.0537437
</td>
</tr>
<tr>
<td style="text-align:left;">
unclassified
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0028007
</td>
</tr>
<tr>
<td style="text-align:left;">
Verrucomicrobia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0024857
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="microbiota.html#cb40-1"></a>sf_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>sf, class_rabdc<span class="op">$</span>sf[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb40-2"><a href="microbiota.html#cb40-2"></a><span class="kw">colnames</span>(sf_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb40-3"><a href="microbiota.html#cb40-3"></a><span class="kw">kable</span>(sf_C, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb40-4"><a href="microbiota.html#cb40-4"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Class level composition of the S. fortis prokaryotic community&quot;</span>, </span>
<span id="cb40-5"><a href="microbiota.html#cb40-5"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb40-6"><a href="microbiota.html#cb40-6"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb40-7"><a href="microbiota.html#cb40-7"></a>    <span class="st">&quot;scale_down&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="font-size: 12px; width: auto !important; ">
<caption style="font-size: initial !important;">
<span id="tab:class-phylum-stats">Table 3.4: </span>Class level composition of the S. fortis prokaryotic community
</caption>
<thead>
<tr>
<th style="text-align:left;">
Class
</th>
<th style="text-align:right;">
OTU count
</th>
<th style="text-align:right;">
cum. avg. abundance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acidimicrobiia
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0.0596458
</td>
</tr>
<tr>
<td style="text-align:left;">
Alphaproteobacteria
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
0.0287870
</td>
</tr>
<tr>
<td style="text-align:left;">
Anaerolineae
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0.0216667
</td>
</tr>
<tr>
<td style="text-align:left;">
Bacilli
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0003206
</td>
</tr>
<tr>
<td style="text-align:left;">
Bacteroidetes_Incertae_Sedis
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0104868
</td>
</tr>
<tr>
<td style="text-align:left;">
BD2-11_terrestrial_group
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
0.0533001
</td>
</tr>
<tr>
<td style="text-align:left;">
Betaproteobacteria
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0010582
</td>
</tr>
<tr>
<td style="text-align:left;">
Caldilineae
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0294433
</td>
</tr>
<tr>
<td style="text-align:left;">
cD4-96
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0001888
</td>
</tr>
<tr>
<td style="text-align:left;">
Deferribacteres_Incertae_Sedis
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0001785
</td>
</tr>
<tr>
<td style="text-align:left;">
Deinococci
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0025092
</td>
</tr>
<tr>
<td style="text-align:left;">
Deltaproteobacteria
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0126067
</td>
</tr>
<tr>
<td style="text-align:left;">
Flavobacteriia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0002369
</td>
</tr>
<tr>
<td style="text-align:left;">
Gammaproteobacteria
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
0.0669805
</td>
</tr>
<tr>
<td style="text-align:left;">
Holophagae
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0106407
</td>
</tr>
<tr>
<td style="text-align:left;">
JG30-KF-CM66
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0.0201982
</td>
</tr>
<tr>
<td style="text-align:left;">
JTB23
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0219184
</td>
</tr>
<tr>
<td style="text-align:left;">
MACA-EFT26
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0007113
</td>
</tr>
<tr>
<td style="text-align:left;">
Marine_Group_I
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0.0537437
</td>
</tr>
<tr>
<td style="text-align:left;">
MD2896-B214
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0030810
</td>
</tr>
<tr>
<td style="text-align:left;">
MD2898-B26
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0099909
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospira
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0129293
</td>
</tr>
<tr>
<td style="text-align:left;">
Opitutae
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0024857
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUC34f_unclassified
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0338805
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUC43f_marine_benthic_group
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0112281
</td>
</tr>
<tr>
<td style="text-align:left;">
Planctomycetacia
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0007755
</td>
</tr>
<tr>
<td style="text-align:left;">
Poribacteria_unclassified
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0073678
</td>
</tr>
<tr>
<td style="text-align:left;">
Proteobacteria_unclassified
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0002715
</td>
</tr>
<tr>
<td style="text-align:left;">
S085
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0071626
</td>
</tr>
<tr>
<td style="text-align:left;">
SAR202_clade
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
0.1851571
</td>
</tr>
<tr>
<td style="text-align:left;">
SBR1093_unclassified
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0205948
</td>
</tr>
<tr>
<td style="text-align:left;">
Solibacteres
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0.0301007
</td>
</tr>
<tr>
<td style="text-align:left;">
Spirochaetes
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0154965
</td>
</tr>
<tr>
<td style="text-align:left;">
SPOTSOCT00m83
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0028001
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_11
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0126648
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_12
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0007423
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_13
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0068617
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_15
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0015782
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_17
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0006895
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0017008
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_21
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0.0353000
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_26
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0009411
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0068393
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_6
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
0.0710777
</td>
</tr>
<tr>
<td style="text-align:left;">
Subgroup_9
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0.0595411
</td>
</tr>
<tr>
<td style="text-align:left;">
Tectomicrobia_unclassified
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0090314
</td>
</tr>
<tr>
<td style="text-align:left;">
Thermoleophilia
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0096884
</td>
</tr>
<tr>
<td style="text-align:left;">
TK10
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0.0425994
</td>
</tr>
<tr>
<td style="text-align:left;">
unclassified
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0028007
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="microbiota.html#cb41-1"></a>wb_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>wb, phy_rabdc<span class="op">$</span>wb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb41-2"><a href="microbiota.html#cb41-2"></a><span class="kw">colnames</span>(wb_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb41-3"><a href="microbiota.html#cb41-3"></a><span class="kw">kable</span>(wb_P, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb41-4"><a href="microbiota.html#cb41-4"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Phylum level composition of the W. bursa prokaryotic community&quot;</span>, </span>
<span id="cb41-5"><a href="microbiota.html#cb41-5"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb41-6"><a href="microbiota.html#cb41-6"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb41-7"><a href="microbiota.html#cb41-7"></a>    <span class="st">&quot;scale_down&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;float_left&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="font-size: 12px; width: auto !important; float: left; margin-right: 10px;">
<caption style="font-size: initial !important;">
<span id="tab:class-phylum-stats">Table 3.4: </span>Phylum level composition of the W. bursa prokaryotic community
</caption>
<thead>
<tr>
<th style="text-align:left;">
Phylum
</th>
<th style="text-align:right;">
OTU count
</th>
<th style="text-align:right;">
cum. avg. abundance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Actinobacteria
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0380424
</td>
</tr>
<tr>
<td style="text-align:left;">
Bacteroidetes
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0.0271417
</td>
</tr>
<tr>
<td style="text-align:left;">
Chlamydiae
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0005021
</td>
</tr>
<tr>
<td style="text-align:left;">
Chloroflexi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0157040
</td>
</tr>
<tr>
<td style="text-align:left;">
Cyanobacteria
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0049057
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospinae
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0336527
</td>
</tr>
<tr>
<td style="text-align:left;">
Planctomycetes
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0.1052024
</td>
</tr>
<tr>
<td style="text-align:left;">
Proteobacteria
</td>
<td style="text-align:right;">
65
</td>
<td style="text-align:right;">
0.6137849
</td>
</tr>
<tr>
<td style="text-align:left;">
SBR1093
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0015293
</td>
</tr>
<tr>
<td style="text-align:left;">
Spirochaetae
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0030580
</td>
</tr>
<tr>
<td style="text-align:left;">
Thaumarchaeota
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.1210771
</td>
</tr>
<tr>
<td style="text-align:left;">
unclassified
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0042501
</td>
</tr>
<tr>
<td style="text-align:left;">
Verrucomicrobia
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.0311496
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="microbiota.html#cb42-1"></a>wb_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>wb, class_rabdc<span class="op">$</span>wb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb42-2"><a href="microbiota.html#cb42-2"></a><span class="kw">colnames</span>(wb_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb42-3"><a href="microbiota.html#cb42-3"></a><span class="kw">kable</span>(wb_C, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>), <span class="dt">longtable =</span> T, </span>
<span id="cb42-4"><a href="microbiota.html#cb42-4"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Class level composition of the W. bursa prokaryotic community&quot;</span>, </span>
<span id="cb42-5"><a href="microbiota.html#cb42-5"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb42-6"><a href="microbiota.html#cb42-6"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">font_size =</span> <span class="dv">12</span>, <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb42-7"><a href="microbiota.html#cb42-7"></a>    <span class="st">&quot;scale_down&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="font-size: 12px; width: auto !important; ">
<caption style="font-size: initial !important;">
<span id="tab:class-phylum-stats">Table 3.4: </span>Class level composition of the W. bursa prokaryotic community
</caption>
<thead>
<tr>
<th style="text-align:left;">
Class
</th>
<th style="text-align:right;">
OTU count
</th>
<th style="text-align:right;">
cum. avg. abundance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acidimicrobiia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0004464
</td>
</tr>
<tr>
<td style="text-align:left;">
Actinobacteria
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0375960
</td>
</tr>
<tr>
<td style="text-align:left;">
Alphaproteobacteria
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0219860
</td>
</tr>
<tr>
<td style="text-align:left;">
Arctic97B-4_marine_group
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0035973
</td>
</tr>
<tr>
<td style="text-align:left;">
Betaproteobacteria
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0038210
</td>
</tr>
<tr>
<td style="text-align:left;">
Chlamydiae
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0005021
</td>
</tr>
<tr>
<td style="text-align:left;">
Chloroplast
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0043399
</td>
</tr>
<tr>
<td style="text-align:left;">
Deltaproteobacteria
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0094565
</td>
</tr>
<tr>
<td style="text-align:left;">
Flavobacteriia
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0.0271417
</td>
</tr>
<tr>
<td style="text-align:left;">
Gammaproteobacteria
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
0.5657918
</td>
</tr>
<tr>
<td style="text-align:left;">
JTB23
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0127296
</td>
</tr>
<tr>
<td style="text-align:left;">
Marine_Group_I
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.1210771
</td>
</tr>
<tr>
<td style="text-align:left;">
ML635J-21
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0005658
</td>
</tr>
<tr>
<td style="text-align:left;">
Nitrospinia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0336527
</td>
</tr>
<tr>
<td style="text-align:left;">
OM190
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0006182
</td>
</tr>
<tr>
<td style="text-align:left;">
Phycisphaerae
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0071209
</td>
</tr>
<tr>
<td style="text-align:left;">
Planctomycetacia
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0.0974633
</td>
</tr>
<tr>
<td style="text-align:left;">
SAR202_clade
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0157040
</td>
</tr>
<tr>
<td style="text-align:left;">
Spirochaetes
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0030580
</td>
</tr>
<tr>
<td style="text-align:left;">
unclassified
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0042501
</td>
</tr>
<tr>
<td style="text-align:left;">
uncultured_Desulfohalobiaceae_bacterium
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0015293
</td>
</tr>
<tr>
<td style="text-align:left;">
Verrucomicrobiae
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.0275523
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="microbiota.html#cb43-1"></a><span class="kw">rm</span>(gb_P, sf_P, wb_P, gb_C, sf_C, wb_C)</span></code></pre></div>
</div>
<div id="depth-response" class="section level2">
<h2><span class="header-section-number">3.5</span> Depth response</h2>
<p>Summarising the OTU diversity by phylum or class only show what was previously known. The composition of the sponges’ prokaryotic community is stable. However, summarising doesn’t do the data justice. We therefore correlate the average realitve abundance of every OTU with depth</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="microbiota.html#cb44-1"></a><span class="co"># ====================== INC-DEC CORRELATION ================== Categorises the</span></span>
<span id="cb44-2"><a href="microbiota.html#cb44-2"></a><span class="co"># OTUs by their response to depth. Requires meta_data_prep, OTU_prep_sqrt,</span></span>
<span id="cb44-3"><a href="microbiota.html#cb44-3"></a><span class="co"># rel_abdc.</span></span>
<span id="cb44-4"><a href="microbiota.html#cb44-4"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb44-5"><a href="microbiota.html#cb44-5"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb44-6"><a href="microbiota.html#cb44-6"></a></span>
<span id="cb44-7"><a href="microbiota.html#cb44-7"></a>meta_data_prep &lt;-<span class="st"> </span><span class="cf">function</span>(meta_data) {</span>
<span id="cb44-8"><a href="microbiota.html#cb44-8"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb44-9"><a href="microbiota.html#cb44-9"></a>        <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb44-10"><a href="microbiota.html#cb44-10"></a>    <span class="kw">colnames</span>(meta_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Temperature&quot;</span>, </span>
<span id="cb44-11"><a href="microbiota.html#cb44-11"></a>        <span class="st">&quot;Salinity&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb44-12"><a href="microbiota.html#cb44-12"></a>    meta_data &lt;-<span class="st"> </span>meta_data[<span class="op">!</span>(<span class="kw">str_sub</span>(meta_data<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;QC&quot;</span>), ]</span>
<span id="cb44-13"><a href="microbiota.html#cb44-13"></a>    meta_data[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(meta_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) </span>
<span id="cb44-14"><a href="microbiota.html#cb44-14"></a>        <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb44-15"><a href="microbiota.html#cb44-15"></a>    <span class="co"># Gb12, Gb20 and Gb21 are missing temperature and salinity. Imputing data from</span></span>
<span id="cb44-16"><a href="microbiota.html#cb44-16"></a>    <span class="co"># closeby samples:</span></span>
<span id="cb44-17"><a href="microbiota.html#cb44-17"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb44-18"><a href="microbiota.html#cb44-18"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb20&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb44-19"><a href="microbiota.html#cb44-19"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb21&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.56</span></span>
<span id="cb44-20"><a href="microbiota.html#cb44-20"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>] &lt;-<span class="st"> </span><span class="fl">3.71</span></span>
<span id="cb44-21"><a href="microbiota.html#cb44-21"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb20&quot;</span>] &lt;-<span class="st"> </span><span class="fl">3.65</span></span>
<span id="cb44-22"><a href="microbiota.html#cb44-22"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb21&quot;</span>] &lt;-<span class="st"> </span><span class="fl">2.32</span></span>
<span id="cb44-23"><a href="microbiota.html#cb44-23"></a>    meta_data[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(meta_data<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb44-24"><a href="microbiota.html#cb44-24"></a>    meta_data &lt;-<span class="st"> </span>meta_data[<span class="kw">order</span>(meta_data<span class="op">$</span>unified_ID), ]</span>
<span id="cb44-25"><a href="microbiota.html#cb44-25"></a>    <span class="kw">return</span>(meta_data)</span>
<span id="cb44-26"><a href="microbiota.html#cb44-26"></a>}</span>
<span id="cb44-27"><a href="microbiota.html#cb44-27"></a></span>
<span id="cb44-28"><a href="microbiota.html#cb44-28"></a>meta_data &lt;-<span class="st"> </span><span class="kw">meta_data_prep</span>(meta_data)</span>
<span id="cb44-29"><a href="microbiota.html#cb44-29"></a></span>
<span id="cb44-30"><a href="microbiota.html#cb44-30"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb44-31"><a href="microbiota.html#cb44-31"></a></span>
<span id="cb44-32"><a href="microbiota.html#cb44-32"></a>rel_abdc &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb44-33"><a href="microbiota.html#cb44-33"></a>    mic &lt;-<span class="st"> </span>micro</span>
<span id="cb44-34"><a href="microbiota.html#cb44-34"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb44-35"><a href="microbiota.html#cb44-35"></a>    mic[<span class="st">&quot;max&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, max)</span>
<span id="cb44-36"><a href="microbiota.html#cb44-36"></a>    </span>
<span id="cb44-37"><a href="microbiota.html#cb44-37"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb44-38"><a href="microbiota.html#cb44-38"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb44-39"><a href="microbiota.html#cb44-39"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb44-40"><a href="microbiota.html#cb44-40"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb44-41"><a href="microbiota.html#cb44-41"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>max[n])</span>
<span id="cb44-42"><a href="microbiota.html#cb44-42"></a>    }</span>
<span id="cb44-43"><a href="microbiota.html#cb44-43"></a>    mic<span class="op">$</span>max &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb44-44"><a href="microbiota.html#cb44-44"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb44-45"><a href="microbiota.html#cb44-45"></a>}</span>
<span id="cb44-46"><a href="microbiota.html#cb44-46"></a></span>
<span id="cb44-47"><a href="microbiota.html#cb44-47"></a>rabdc_gb &lt;-<span class="st"> </span><span class="kw">rel_abdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb44-48"><a href="microbiota.html#cb44-48"></a>rabdc_sf &lt;-<span class="st"> </span><span class="kw">rel_abdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb44-49"><a href="microbiota.html#cb44-49"></a>rabdc_wb &lt;-<span class="st"> </span><span class="kw">rel_abdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb44-50"><a href="microbiota.html#cb44-50"></a></span>
<span id="cb44-51"><a href="microbiota.html#cb44-51"></a>inc_dec &lt;-<span class="st"> </span><span class="cf">function</span>(rabdc_df, meta_data) {</span>
<span id="cb44-52"><a href="microbiota.html#cb44-52"></a>    </span>
<span id="cb44-53"><a href="microbiota.html#cb44-53"></a>    md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(rabdc_df), ]</span>
<span id="cb44-54"><a href="microbiota.html#cb44-54"></a>    inc_dec &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(rabdc_df))</span>
<span id="cb44-55"><a href="microbiota.html#cb44-55"></a>    <span class="kw">colnames</span>(inc_dec) &lt;-<span class="st"> &quot;XOTU&quot;</span></span>
<span id="cb44-56"><a href="microbiota.html#cb44-56"></a>    inc_dec[<span class="st">&quot;inc_dec_estimate&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb44-57"><a href="microbiota.html#cb44-57"></a>    inc_dec[<span class="st">&quot;inc_dec_p_val&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb44-58"><a href="microbiota.html#cb44-58"></a>    </span>
<span id="cb44-59"><a href="microbiota.html#cb44-59"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb44-60"><a href="microbiota.html#cb44-60"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(inc_dec)[<span class="dv">1</span>]</span>
<span id="cb44-61"><a href="microbiota.html#cb44-61"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb44-62"><a href="microbiota.html#cb44-62"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb44-63"><a href="microbiota.html#cb44-63"></a>        inc_dec<span class="op">$</span>inc_dec_estimate[n] &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="kw">as.numeric</span>(rabdc_df[n, ]), md<span class="op">$</span>Depth)<span class="op">$</span>estimate</span>
<span id="cb44-64"><a href="microbiota.html#cb44-64"></a>        inc_dec<span class="op">$</span>inc_dec_p_val[n] &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="kw">as.numeric</span>(rabdc_df[n, ]), md<span class="op">$</span>Depth)<span class="op">$</span>p.value</span>
<span id="cb44-65"><a href="microbiota.html#cb44-65"></a>    }</span>
<span id="cb44-66"><a href="microbiota.html#cb44-66"></a>    </span>
<span id="cb44-67"><a href="microbiota.html#cb44-67"></a>    inc_dec[<span class="st">&quot;classification&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb44-68"><a href="microbiota.html#cb44-68"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;dec.trend&quot;</span></span>
<span id="cb44-69"><a href="microbiota.html#cb44-69"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;inc.trend&quot;</span></span>
<span id="cb44-70"><a href="microbiota.html#cb44-70"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>inc_dec<span class="op">$</span>inc_dec_p <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> &quot;decreasing&quot;</span></span>
<span id="cb44-71"><a href="microbiota.html#cb44-71"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>inc_dec<span class="op">$</span>inc_dec_p <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> &quot;increasing&quot;</span></span>
<span id="cb44-72"><a href="microbiota.html#cb44-72"></a>    <span class="kw">return</span>(inc_dec)</span>
<span id="cb44-73"><a href="microbiota.html#cb44-73"></a>}</span>
<span id="cb44-74"><a href="microbiota.html#cb44-74"></a></span>
<span id="cb44-75"><a href="microbiota.html#cb44-75"></a>gb_response &lt;-<span class="st"> </span><span class="kw">inc_dec</span>(rabdc_gb, meta_data)</span>
<span id="cb44-76"><a href="microbiota.html#cb44-76"></a>sf_response &lt;-<span class="st"> </span><span class="kw">inc_dec</span>(rabdc_sf, meta_data)</span>
<span id="cb44-77"><a href="microbiota.html#cb44-77"></a>wb_response &lt;-<span class="st"> </span><span class="kw">inc_dec</span>(rabdc_wb, meta_data)</span>
<span id="cb44-78"><a href="microbiota.html#cb44-78"></a></span>
<span id="cb44-79"><a href="microbiota.html#cb44-79"></a><span class="co"># For heatmaps gb</span></span>
<span id="cb44-80"><a href="microbiota.html#cb44-80"></a>rabdc_gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_gb)</span>
<span id="cb44-81"><a href="microbiota.html#cb44-81"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_gb, gb_response)</span>
<span id="cb44-82"><a href="microbiota.html#cb44-82"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(gb_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, </span>
<span id="cb44-83"><a href="microbiota.html#cb44-83"></a>    <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb44-84"><a href="microbiota.html#cb44-84"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb44-85"><a href="microbiota.html#cb44-85"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb44-86"><a href="microbiota.html#cb44-86"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_heatmap, md)</span>
<span id="cb44-87"><a href="microbiota.html#cb44-87"></a>gb_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(gb_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb44-88"><a href="microbiota.html#cb44-88"></a>gb_heatmap_i &lt;-<span class="st"> </span>gb_heatmap[gb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb44-89"><a href="microbiota.html#cb44-89"></a>gb_heatmap_d &lt;-<span class="st"> </span>gb_heatmap[gb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb44-90"><a href="microbiota.html#cb44-90"></a></span>
<span id="cb44-91"><a href="microbiota.html#cb44-91"></a><span class="co"># gb_i &lt;- ggplot(gb_heatmap_i, aes(x=as.factor(gb_heatmap_i$Depth),</span></span>
<span id="cb44-92"><a href="microbiota.html#cb44-92"></a><span class="co"># y=gb_heatmap_i$name, fill=gb_heatmap_i$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb44-93"><a href="microbiota.html#cb44-93"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;GB</span></span>
<span id="cb44-94"><a href="microbiota.html#cb44-94"></a><span class="co"># OTUs increasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb44-95"><a href="microbiota.html#cb44-95"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb44-96"><a href="microbiota.html#cb44-96"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb44-97"><a href="microbiota.html#cb44-97"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb44-98"><a href="microbiota.html#cb44-98"></a></span>
<span id="cb44-99"><a href="microbiota.html#cb44-99"></a><span class="co"># gb_d &lt;- ggplot(gb_heatmap_d, aes(x=as.factor(gb_heatmap_d$Depth),</span></span>
<span id="cb44-100"><a href="microbiota.html#cb44-100"></a><span class="co"># y=gb_heatmap_d$name, fill=gb_heatmap_d$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb44-101"><a href="microbiota.html#cb44-101"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;GB</span></span>
<span id="cb44-102"><a href="microbiota.html#cb44-102"></a><span class="co"># OTUs decreasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb44-103"><a href="microbiota.html#cb44-103"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb44-104"><a href="microbiota.html#cb44-104"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb44-105"><a href="microbiota.html#cb44-105"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb44-106"><a href="microbiota.html#cb44-106"></a></span>
<span id="cb44-107"><a href="microbiota.html#cb44-107"></a><span class="co"># sf</span></span>
<span id="cb44-108"><a href="microbiota.html#cb44-108"></a>rabdc_sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_sf)</span>
<span id="cb44-109"><a href="microbiota.html#cb44-109"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_sf, sf_response)</span>
<span id="cb44-110"><a href="microbiota.html#cb44-110"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(sf_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, </span>
<span id="cb44-111"><a href="microbiota.html#cb44-111"></a>    <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb44-112"><a href="microbiota.html#cb44-112"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb44-113"><a href="microbiota.html#cb44-113"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb44-114"><a href="microbiota.html#cb44-114"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_heatmap, md)</span>
<span id="cb44-115"><a href="microbiota.html#cb44-115"></a>sf_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(sf_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb44-116"><a href="microbiota.html#cb44-116"></a>sf_heatmap_i &lt;-<span class="st"> </span>sf_heatmap[sf_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb44-117"><a href="microbiota.html#cb44-117"></a>sf_heatmap_d &lt;-<span class="st"> </span>sf_heatmap[sf_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb44-118"><a href="microbiota.html#cb44-118"></a></span>
<span id="cb44-119"><a href="microbiota.html#cb44-119"></a><span class="co"># sf_i &lt;- ggplot(sf_heatmap_i, aes(x=as.factor(sf_heatmap_i$Depth),</span></span>
<span id="cb44-120"><a href="microbiota.html#cb44-120"></a><span class="co"># y=sf_heatmap_i$name, fill=sf_heatmap_i$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb44-121"><a href="microbiota.html#cb44-121"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;SF</span></span>
<span id="cb44-122"><a href="microbiota.html#cb44-122"></a><span class="co"># OTUs increasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb44-123"><a href="microbiota.html#cb44-123"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb44-124"><a href="microbiota.html#cb44-124"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb44-125"><a href="microbiota.html#cb44-125"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb44-126"><a href="microbiota.html#cb44-126"></a></span>
<span id="cb44-127"><a href="microbiota.html#cb44-127"></a><span class="co"># sf_d &lt;- ggplot(sf_heatmap_d, aes(x=as.factor(sf_heatmap_d$Depth),</span></span>
<span id="cb44-128"><a href="microbiota.html#cb44-128"></a><span class="co"># y=sf_heatmap_d$name, fill=sf_heatmap_d$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb44-129"><a href="microbiota.html#cb44-129"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;SF</span></span>
<span id="cb44-130"><a href="microbiota.html#cb44-130"></a><span class="co"># OTUs decreasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb44-131"><a href="microbiota.html#cb44-131"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb44-132"><a href="microbiota.html#cb44-132"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb44-133"><a href="microbiota.html#cb44-133"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb44-134"><a href="microbiota.html#cb44-134"></a></span>
<span id="cb44-135"><a href="microbiota.html#cb44-135"></a><span class="co"># wb</span></span>
<span id="cb44-136"><a href="microbiota.html#cb44-136"></a>rabdc_wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_wb)</span>
<span id="cb44-137"><a href="microbiota.html#cb44-137"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_wb, wb_response)</span>
<span id="cb44-138"><a href="microbiota.html#cb44-138"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(wb_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, </span>
<span id="cb44-139"><a href="microbiota.html#cb44-139"></a>    <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb44-140"><a href="microbiota.html#cb44-140"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb44-141"><a href="microbiota.html#cb44-141"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb44-142"><a href="microbiota.html#cb44-142"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(wb_heatmap, md)</span>
<span id="cb44-143"><a href="microbiota.html#cb44-143"></a>wb_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(wb_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb44-144"><a href="microbiota.html#cb44-144"></a>wb_heatmap_i &lt;-<span class="st"> </span>wb_heatmap[wb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb44-145"><a href="microbiota.html#cb44-145"></a>wb_heatmap_d &lt;-<span class="st"> </span>wb_heatmap[wb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb44-146"><a href="microbiota.html#cb44-146"></a></span>
<span id="cb44-147"><a href="microbiota.html#cb44-147"></a><span class="co"># wb_i &lt;- ggplot(wb_heatmap_i, aes(x=as.factor(wb_heatmap_i$Depth),</span></span>
<span id="cb44-148"><a href="microbiota.html#cb44-148"></a><span class="co"># y=wb_heatmap_i$name, fill=wb_heatmap_i$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb44-149"><a href="microbiota.html#cb44-149"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;WB</span></span>
<span id="cb44-150"><a href="microbiota.html#cb44-150"></a><span class="co"># OTUs increasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb44-151"><a href="microbiota.html#cb44-151"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb44-152"><a href="microbiota.html#cb44-152"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb44-153"><a href="microbiota.html#cb44-153"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb44-154"><a href="microbiota.html#cb44-154"></a></span>
<span id="cb44-155"><a href="microbiota.html#cb44-155"></a><span class="co"># wb_d &lt;- ggplot(wb_heatmap_d, aes(x=as.factor(wb_heatmap_d$Depth),</span></span>
<span id="cb44-156"><a href="microbiota.html#cb44-156"></a><span class="co"># y=wb_heatmap_d$name, fill=wb_heatmap_d$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb44-157"><a href="microbiota.html#cb44-157"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;WB</span></span>
<span id="cb44-158"><a href="microbiota.html#cb44-158"></a><span class="co"># OTUs decreasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb44-159"><a href="microbiota.html#cb44-159"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb44-160"><a href="microbiota.html#cb44-160"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb44-161"><a href="microbiota.html#cb44-161"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb44-162"><a href="microbiota.html#cb44-162"></a></span>
<span id="cb44-163"><a href="microbiota.html#cb44-163"></a><span class="co"># Facetting for the figure in the publication</span></span>
<span id="cb44-164"><a href="microbiota.html#cb44-164"></a>gb_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb44-165"><a href="microbiota.html#cb44-165"></a>sf_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb44-166"><a href="microbiota.html#cb44-166"></a>wb_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb44-167"><a href="microbiota.html#cb44-167"></a>increase &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_heatmap_i, sf_heatmap_i, wb_heatmap_i)</span>
<span id="cb44-168"><a href="microbiota.html#cb44-168"></a>inc &lt;-<span class="st"> </span><span class="kw">ggplot</span>(increase, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(Depth), <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span></span>
<span id="cb44-169"><a href="microbiota.html#cb44-169"></a><span class="st">    </span>spec, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, </span>
<span id="cb44-170"><a href="microbiota.html#cb44-170"></a>    <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;OTUs increasing&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-171"><a href="microbiota.html#cb44-171"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb44-172"><a href="microbiota.html#cb44-172"></a>        <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb44-173"><a href="microbiota.html#cb44-173"></a></span>
<span id="cb44-174"><a href="microbiota.html#cb44-174"></a>gb_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb44-175"><a href="microbiota.html#cb44-175"></a>sf_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb44-176"><a href="microbiota.html#cb44-176"></a>wb_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb44-177"><a href="microbiota.html#cb44-177"></a>decrease &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_heatmap_d, sf_heatmap_d, wb_heatmap_d)</span>
<span id="cb44-178"><a href="microbiota.html#cb44-178"></a>dec &lt;-<span class="st"> </span><span class="kw">ggplot</span>(decrease, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(Depth), <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span></span>
<span id="cb44-179"><a href="microbiota.html#cb44-179"></a><span class="st">    </span>spec, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">drop =</span> T) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-180"><a href="microbiota.html#cb44-180"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-181"><a href="microbiota.html#cb44-181"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;OTUs decreasing&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb44-182"><a href="microbiota.html#cb44-182"></a>    <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb44-183"><a href="microbiota.html#cb44-183"></a></span>
<span id="cb44-184"><a href="microbiota.html#cb44-184"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb44-185"><a href="microbiota.html#cb44-185"></a><span class="kw">grid.arrange</span>(inc, dec, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/increade-decrease-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="microbiota.html#cb45-1"></a>gb_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap_i<span class="op">$</span>name)), </span>
<span id="cb45-2"><a href="microbiota.html#cb45-2"></a>    <span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb45-3"><a href="microbiota.html#cb45-3"></a>sf_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap_i<span class="op">$</span>name)), </span>
<span id="cb45-4"><a href="microbiota.html#cb45-4"></a>    <span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb45-5"><a href="microbiota.html#cb45-5"></a>wb_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap_i<span class="op">$</span>name)), </span>
<span id="cb45-6"><a href="microbiota.html#cb45-6"></a>    <span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb45-7"><a href="microbiota.html#cb45-7"></a></span>
<span id="cb45-8"><a href="microbiota.html#cb45-8"></a>overview &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_nums, sf_nums, wb_nums)</span>
<span id="cb45-9"><a href="microbiota.html#cb45-9"></a><span class="kw">colnames</span>(overview) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Total&quot;</span>, <span class="st">&quot;increasing&quot;</span>, <span class="st">&quot;decreasing&quot;</span>)</span>
<span id="cb45-10"><a href="microbiota.html#cb45-10"></a><span class="kw">rownames</span>(overview) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;G. barretti microbiota&quot;</span>, <span class="st">&quot;S. fortis microbiota&quot;</span>, <span class="st">&quot;W. bursa microbiota&quot;</span>)</span>
<span id="cb45-11"><a href="microbiota.html#cb45-11"></a>overview &lt;-<span class="st"> </span><span class="kw">data.frame</span>(overview)</span>
<span id="cb45-12"><a href="microbiota.html#cb45-12"></a>overview[<span class="st">&quot;unaffected&quot;</span>] &lt;-<span class="st"> </span>overview<span class="op">$</span>Total <span class="op">-</span><span class="st"> </span>(overview<span class="op">$</span>increasing <span class="op">+</span><span class="st"> </span>overview<span class="op">$</span>decreasing)</span>
<span id="cb45-13"><a href="microbiota.html#cb45-13"></a></span>
<span id="cb45-14"><a href="microbiota.html#cb45-14"></a><span class="kw">kable</span>(overview, <span class="dt">escape =</span> F, <span class="dt">align =</span> <span class="st">&quot;c&quot;</span>, <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Microbiota response to depth&quot;</span>, </span>
<span id="cb45-15"><a href="microbiota.html#cb45-15"></a>    <span class="st">&quot;html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span>, </span>
<span id="cb45-16"><a href="microbiota.html#cb45-16"></a>    <span class="st">&quot;responsive&quot;</span>, <span class="dt">latex_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="dt">full_width =</span> F))</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:increade-decrease">Table 3.5: </span>Microbiota response to depth
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Total
</th>
<th style="text-align:center;">
increasing
</th>
<th style="text-align:center;">
decreasing
</th>
<th style="text-align:center;">
unaffected
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
G. barretti microbiota
</td>
<td style="text-align:center;">
420
</td>
<td style="text-align:center;">
82
</td>
<td style="text-align:center;">
58
</td>
<td style="text-align:center;">
280
</td>
</tr>
<tr>
<td style="text-align:left;">
S. fortis microbiota
</td>
<td style="text-align:center;">
461
</td>
<td style="text-align:center;">
72
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
357
</td>
</tr>
<tr>
<td style="text-align:left;">
W. bursa microbiota
</td>
<td style="text-align:center;">
135
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
111
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="microbiota.html#cb46-1"></a><span class="co"># overview &lt;- overview[,c(2:4)] overview[&#39;response&#39;] &lt;- rownames(overview) plot</span></span>
<span id="cb46-2"><a href="microbiota.html#cb46-2"></a><span class="co"># &lt;- melt(overview)</span></span>
<span id="cb46-3"><a href="microbiota.html#cb46-3"></a></span>
<span id="cb46-4"><a href="microbiota.html#cb46-4"></a><span class="co"># stacked &lt;- ggplot(plot, aes(x=response, y=value, fill=variable)) +</span></span>
<span id="cb46-5"><a href="microbiota.html#cb46-5"></a><span class="co"># geom_bar(position=&#39;stack&#39;, stat=&#39;identity&#39;)+ theme_minimal()+ggtitle(&#39;Stacked</span></span>
<span id="cb46-6"><a href="microbiota.html#cb46-6"></a><span class="co"># counts&#39;)+xlab(&#39;Sponge species&#39;)+ylab(&#39;OTU count&#39;)+ theme(axis.text.x =</span></span>
<span id="cb46-7"><a href="microbiota.html#cb46-7"></a><span class="co"># element_text(angle = 90, hjust = 1))</span></span>
<span id="cb46-8"><a href="microbiota.html#cb46-8"></a></span>
<span id="cb46-9"><a href="microbiota.html#cb46-9"></a><span class="co"># perc &lt;- ggplot(plot, aes(x=response, y=value, fill=variable)) +</span></span>
<span id="cb46-10"><a href="microbiota.html#cb46-10"></a><span class="co"># geom_bar(position=&#39;fill&#39;, stat=&#39;identity&#39;)+</span></span>
<span id="cb46-11"><a href="microbiota.html#cb46-11"></a><span class="co"># theme_minimal()+ggtitle(&#39;Percentages&#39;)+xlab(&#39;Sponge species&#39;)+ylab(&#39;relative</span></span>
<span id="cb46-12"><a href="microbiota.html#cb46-12"></a><span class="co"># OTU count&#39;)+ theme(axis.text.x = element_text(angle = 90, hjust = 1))</span></span>
<span id="cb46-13"><a href="microbiota.html#cb46-13"></a></span>
<span id="cb46-14"><a href="microbiota.html#cb46-14"></a><span class="co"># grid.arrange(stacked, perc, nrow=2) write.csv(gb_response, &#39;gb_response.csv&#39;)</span></span>
<span id="cb46-15"><a href="microbiota.html#cb46-15"></a><span class="co"># write.csv(sf_response, &#39;sf_response.csv&#39;) write.csv(wb_response,</span></span>
<span id="cb46-16"><a href="microbiota.html#cb46-16"></a><span class="co"># &#39;wb_response.csv&#39;)</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="microbiota.html#cb47-1"></a><span class="co"># ====================== OCCURRENCE ============== REL ABDC On original data</span></span>
<span id="cb47-2"><a href="microbiota.html#cb47-2"></a><span class="co"># sets, NOT SQRT transformed (Y tho?) micros is sqrt transformed</span></span>
<span id="cb47-3"><a href="microbiota.html#cb47-3"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb47-4"><a href="microbiota.html#cb47-4"></a></span>
<span id="cb47-5"><a href="microbiota.html#cb47-5"></a><span class="co"># RUN occurrence gb_occurrence &lt;- overall_rabdc((micro_ds$gb**2)) #INDRA&#39;s way</span></span>
<span id="cb47-6"><a href="microbiota.html#cb47-6"></a><span class="co"># exponentiate (**2) to reverse sqrt sf_occurrence &lt;-</span></span>
<span id="cb47-7"><a href="microbiota.html#cb47-7"></a><span class="co"># overall_rabdc((micro_ds$sf**2)) wb_occurrence &lt;-</span></span>
<span id="cb47-8"><a href="microbiota.html#cb47-8"></a><span class="co"># overall_rabdc((micro_ds$wb**2))</span></span>
<span id="cb47-9"><a href="microbiota.html#cb47-9"></a></span>
<span id="cb47-10"><a href="microbiota.html#cb47-10"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb47-11"><a href="microbiota.html#cb47-11"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb47-12"><a href="microbiota.html#cb47-12"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb47-13"><a href="microbiota.html#cb47-13"></a></span>
<span id="cb47-14"><a href="microbiota.html#cb47-14"></a><span class="co"># only file dump write.csv(gb_occurrence, &#39;gb_occurrence_avg_rel_abdc_OTU.csv&#39;)</span></span>
<span id="cb47-15"><a href="microbiota.html#cb47-15"></a><span class="co"># write.csv(sf_occurrence, &#39;sf_occurrence_avg_rel_abdc_OTU.csv&#39;)</span></span>
<span id="cb47-16"><a href="microbiota.html#cb47-16"></a><span class="co"># write.csv(wb_occurrence, &#39;wb_occurrence_avg_rel_abdc_OTU.csv&#39;)</span></span>
<span id="cb47-17"><a href="microbiota.html#cb47-17"></a></span>
<span id="cb47-18"><a href="microbiota.html#cb47-18"></a><span class="kw">aggregate</span>(gb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(gb_occurrence<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-19"><a href="microbiota.html#cb47-19"></a><span class="kw">aggregate</span>(sf_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(sf_occurrence<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-20"><a href="microbiota.html#cb47-20"></a><span class="kw">aggregate</span>(wb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(wb_occurrence<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-21"><a href="microbiota.html#cb47-21"></a></span>
<span id="cb47-22"><a href="microbiota.html#cb47-22"></a><span class="co"># combined file dump gb_occurrence[&#39;XOTU&#39;] &lt;- rownames(gb_occurrence)</span></span>
<span id="cb47-23"><a href="microbiota.html#cb47-23"></a><span class="co"># sf_occurrence[&#39;XOTU&#39;] &lt;- rownames(sf_occurrence) wb_occurrence[&#39;XOTU&#39;] &lt;-</span></span>
<span id="cb47-24"><a href="microbiota.html#cb47-24"></a><span class="co"># rownames(wb_occurrence) gb_data &lt;- full_join(gb_response,</span></span>
<span id="cb47-25"><a href="microbiota.html#cb47-25"></a><span class="co"># gb_occurrence[,c(&#39;XOTU&#39;, &#39;avg_rel_abdc&#39;, &#39;occurrence&#39;)]) sf_data &lt;-</span></span>
<span id="cb47-26"><a href="microbiota.html#cb47-26"></a><span class="co"># full_join(sf_response, sf_occurrence[,c(&#39;XOTU&#39;, &#39;avg_rel_abdc&#39;, &#39;occurrence&#39;)])</span></span>
<span id="cb47-27"><a href="microbiota.html#cb47-27"></a><span class="co"># wb_data &lt;- full_join(wb_response, wb_occurrence[,c(&#39;XOTU&#39;, &#39;avg_rel_abdc&#39;,</span></span>
<span id="cb47-28"><a href="microbiota.html#cb47-28"></a><span class="co"># &#39;occurrence&#39;)]) taxonomy[&#39;dummy&#39;] &lt;- c(&#39;X&#39;) taxonomy[&#39;XOTU&#39;] &lt;-</span></span>
<span id="cb47-29"><a href="microbiota.html#cb47-29"></a><span class="co"># str_c(taxonomy$dummy, taxonomy$OTU_ID) taxonomy$dummy &lt;- NULL gb_data &lt;-</span></span>
<span id="cb47-30"><a href="microbiota.html#cb47-30"></a><span class="co"># left_join(gb_data, taxonomy) sf_data &lt;- left_join(sf_data, taxonomy) wb_data &lt;-</span></span>
<span id="cb47-31"><a href="microbiota.html#cb47-31"></a><span class="co"># left_join(wb_data, taxonomy) write.csv(gb_data, &#39;gb_data.csv&#39;)</span></span>
<span id="cb47-32"><a href="microbiota.html#cb47-32"></a><span class="co"># write.csv(sf_data, &#39;sf_data.csv&#39;) write.csv(wb_data, &#39;wb_data.csv&#39;)</span></span>
<span id="cb47-33"><a href="microbiota.html#cb47-33"></a></span>
<span id="cb47-34"><a href="microbiota.html#cb47-34"></a></span>
<span id="cb47-35"><a href="microbiota.html#cb47-35"></a></span>
<span id="cb47-36"><a href="microbiota.html#cb47-36"></a><span class="co"># quick_comparison</span></span>
<span id="cb47-37"><a href="microbiota.html#cb47-37"></a>gb_occurrence &lt;-<span class="st"> </span>gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb47-38"><a href="microbiota.html#cb47-38"></a>sf_occurrence &lt;-<span class="st"> </span>sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb47-39"><a href="microbiota.html#cb47-39"></a>wb_occurrence &lt;-<span class="st"> </span>wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb47-40"><a href="microbiota.html#cb47-40"></a></span>
<span id="cb47-41"><a href="microbiota.html#cb47-41"></a><span class="kw">colnames</span>(gb_occurrence) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gb.avg_rabdc&quot;</span>, <span class="st">&quot;gb.occurr&quot;</span>)</span>
<span id="cb47-42"><a href="microbiota.html#cb47-42"></a><span class="kw">colnames</span>(sf_occurrence) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sf.avg_rabdc&quot;</span>, <span class="st">&quot;sf.occurr&quot;</span>)</span>
<span id="cb47-43"><a href="microbiota.html#cb47-43"></a><span class="kw">colnames</span>(wb_occurrence) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;wb.avg_rabdc&quot;</span>, <span class="st">&quot;wb.occurr&quot;</span>)</span>
<span id="cb47-44"><a href="microbiota.html#cb47-44"></a></span>
<span id="cb47-45"><a href="microbiota.html#cb47-45"></a>gb_occurrence[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(gb_occurrence)</span>
<span id="cb47-46"><a href="microbiota.html#cb47-46"></a>sf_occurrence[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(sf_occurrence)</span>
<span id="cb47-47"><a href="microbiota.html#cb47-47"></a>wb_occurrence[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(wb_occurrence)</span>
<span id="cb47-48"><a href="microbiota.html#cb47-48"></a></span>
<span id="cb47-49"><a href="microbiota.html#cb47-49"></a><span class="kw">aggregate</span>(gb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(gb_occurrence<span class="op">$</span>gb.occurr), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-50"><a href="microbiota.html#cb47-50"></a><span class="kw">aggregate</span>(sf_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(sf_occurrence<span class="op">$</span>sf.occurr), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-51"><a href="microbiota.html#cb47-51"></a><span class="kw">aggregate</span>(wb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(wb_occurrence<span class="op">$</span>wb.occurr), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-52"><a href="microbiota.html#cb47-52"></a></span>
<span id="cb47-53"><a href="microbiota.html#cb47-53"></a>occurrence_sqrt &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb_occurrence, sf_occurrence)</span>
<span id="cb47-54"><a href="microbiota.html#cb47-54"></a>occurrence_sqrt &lt;-<span class="st"> </span><span class="kw">full_join</span>(occurrence_sqrt, wb_occurrence)</span>
<span id="cb47-55"><a href="microbiota.html#cb47-55"></a><span class="kw">head</span>(occurrence_sqrt)</span>
<span id="cb47-56"><a href="microbiota.html#cb47-56"></a></span>
<span id="cb47-57"><a href="microbiota.html#cb47-57"></a>occurrence_exp.raw &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb_occurrence, sf_occurrence)</span>
<span id="cb47-58"><a href="microbiota.html#cb47-58"></a>occurrence_exp.raw &lt;-<span class="st"> </span><span class="kw">full_join</span>(occurrence_exp.raw, wb_occurrence)</span>
<span id="cb47-59"><a href="microbiota.html#cb47-59"></a><span class="kw">head</span>(occurrence_exp.raw)</span>
<span id="cb47-60"><a href="microbiota.html#cb47-60"></a></span>
<span id="cb47-61"><a href="microbiota.html#cb47-61"></a><span class="co"># ====================== overview phylum class ========== For figures (OTU</span></span>
<span id="cb47-62"><a href="microbiota.html#cb47-62"></a><span class="co"># relative abdc heatmaps), and inc-dec correlations. Requires OTU_prep_sqrt.</span></span>
<span id="cb47-63"><a href="microbiota.html#cb47-63"></a></span>
<span id="cb47-64"><a href="microbiota.html#cb47-64"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb47-65"><a href="microbiota.html#cb47-65"></a><span class="co"># RUN calculate relative abundance of OTU across sponge samples</span></span>
<span id="cb47-66"><a href="microbiota.html#cb47-66"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb47-67"><a href="microbiota.html#cb47-67"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb47-68"><a href="microbiota.html#cb47-68"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb47-69"><a href="microbiota.html#cb47-69"></a></span>
<span id="cb47-70"><a href="microbiota.html#cb47-70"></a>occurrence &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb_occurrence, <span class="dt">sf =</span> sf_occurrence, <span class="dt">wb =</span> wb_occurrence)</span>
<span id="cb47-71"><a href="microbiota.html#cb47-71"></a>taxes &lt;-<span class="st"> </span><span class="kw">aggregations</span>(taxonomy, occurrence)</span>
<span id="cb47-72"><a href="microbiota.html#cb47-72"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb47-73"><a href="microbiota.html#cb47-73"></a></span>
<span id="cb47-74"><a href="microbiota.html#cb47-74"></a>phy_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))  <span class="co">#OTU count</span></span>
<span id="cb47-75"><a href="microbiota.html#cb47-75"></a>phy_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, </span>
<span id="cb47-76"><a href="microbiota.html#cb47-76"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))  <span class="co">#sums relative abundance</span></span>
<span id="cb47-77"><a href="microbiota.html#cb47-77"></a></span>
<span id="cb47-78"><a href="microbiota.html#cb47-78"></a>class_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb47-79"><a href="microbiota.html#cb47-79"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb47-80"><a href="microbiota.html#cb47-80"></a>class_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb47-81"><a href="microbiota.html#cb47-81"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span>
<span id="cb47-82"><a href="microbiota.html#cb47-82"></a><span class="co"># all collected in Excel file. Done. Microbiome_aggregation_phylum_class.xlsx ,</span></span>
<span id="cb47-83"><a href="microbiota.html#cb47-83"></a><span class="co"># in &#39;/writing/&#39;.</span></span>
<span id="cb47-84"><a href="microbiota.html#cb47-84"></a></span>
<span id="cb47-85"><a href="microbiota.html#cb47-85"></a><span class="co"># Statistic comparison based on averages of relative abundance of phyla and</span></span>
<span id="cb47-86"><a href="microbiota.html#cb47-86"></a><span class="co"># classes CLASS</span></span>
<span id="cb47-87"><a href="microbiota.html#cb47-87"></a>class &lt;-<span class="st"> </span><span class="kw">full_join</span>(class_rabdc<span class="op">$</span>gb, class_rabdc<span class="op">$</span>sf, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>))</span>
<span id="cb47-88"><a href="microbiota.html#cb47-88"></a>class &lt;-<span class="st"> </span><span class="kw">full_join</span>(class, class_rabdc<span class="op">$</span>wb, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>))</span>
<span id="cb47-89"><a href="microbiota.html#cb47-89"></a><span class="kw">colnames</span>(class) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;gb_avg&quot;</span>, <span class="st">&quot;sf_avg&quot;</span>, <span class="st">&quot;wb_avg&quot;</span>)</span>
<span id="cb47-90"><a href="microbiota.html#cb47-90"></a></span>
<span id="cb47-91"><a href="microbiota.html#cb47-91"></a>class<span class="op">$</span>gb_avg[<span class="kw">is.na</span>(class<span class="op">$</span>gb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-92"><a href="microbiota.html#cb47-92"></a>class<span class="op">$</span>sf_avg[<span class="kw">is.na</span>(class<span class="op">$</span>sf_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-93"><a href="microbiota.html#cb47-93"></a>class<span class="op">$</span>wb_avg[<span class="kw">is.na</span>(class<span class="op">$</span>wb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-94"><a href="microbiota.html#cb47-94"></a></span>
<span id="cb47-95"><a href="microbiota.html#cb47-95"></a><span class="kw">head</span>(class)</span>
<span id="cb47-96"><a href="microbiota.html#cb47-96"></a><span class="kw">kruskal.test</span>(class[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)])  <span class="co">#p-value = 3.364e-05 # all three</span></span>
<span id="cb47-97"><a href="microbiota.html#cb47-97"></a><span class="kw">kruskal.test</span>(class[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)])  <span class="co">#p-value = 0.6594    # gb &amp; sf</span></span>
<span id="cb47-98"><a href="microbiota.html#cb47-98"></a></span>
<span id="cb47-99"><a href="microbiota.html#cb47-99"></a><span class="co"># PHYLUM</span></span>
<span id="cb47-100"><a href="microbiota.html#cb47-100"></a>phylum &lt;-<span class="st"> </span><span class="kw">full_join</span>(phy_rabdc<span class="op">$</span>gb, phy_rabdc<span class="op">$</span>sf, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>))</span>
<span id="cb47-101"><a href="microbiota.html#cb47-101"></a>phylum &lt;-<span class="st"> </span><span class="kw">full_join</span>(phylum, phy_rabdc<span class="op">$</span>wb, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>))</span>
<span id="cb47-102"><a href="microbiota.html#cb47-102"></a><span class="kw">colnames</span>(phylum) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;gb_avg&quot;</span>, <span class="st">&quot;sf_avg&quot;</span>, <span class="st">&quot;wb_avg&quot;</span>)</span>
<span id="cb47-103"><a href="microbiota.html#cb47-103"></a></span>
<span id="cb47-104"><a href="microbiota.html#cb47-104"></a>phylum<span class="op">$</span>gb_avg[<span class="kw">is.na</span>(phylum<span class="op">$</span>gb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-105"><a href="microbiota.html#cb47-105"></a>phylum<span class="op">$</span>sf_avg[<span class="kw">is.na</span>(phylum<span class="op">$</span>sf_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-106"><a href="microbiota.html#cb47-106"></a>phylum<span class="op">$</span>wb_avg[<span class="kw">is.na</span>(phylum<span class="op">$</span>wb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-107"><a href="microbiota.html#cb47-107"></a></span>
<span id="cb47-108"><a href="microbiota.html#cb47-108"></a><span class="kw">head</span>(phylum)</span>
<span id="cb47-109"><a href="microbiota.html#cb47-109"></a><span class="kw">kruskal.test</span>(phylum[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)])  <span class="co">#p-value = 0.2915 # all three</span></span>
<span id="cb47-110"><a href="microbiota.html#cb47-110"></a><span class="kw">kruskal.test</span>(phylum[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)])  <span class="co">#p-value = 0.5102    # gb &amp; sf</span></span>
<span id="cb47-111"><a href="microbiota.html#cb47-111"></a></span>
<span id="cb47-112"><a href="microbiota.html#cb47-112"></a><span class="co"># ======================= Testing differences at phylum and class level</span></span>
<span id="cb47-113"><a href="microbiota.html#cb47-113"></a><span class="co"># ===========</span></span>
<span id="cb47-114"><a href="microbiota.html#cb47-114"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb47-115"><a href="microbiota.html#cb47-115"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb47-116"><a href="microbiota.html#cb47-116"></a></span>
<span id="cb47-117"><a href="microbiota.html#cb47-117"></a><span class="co"># PHYLUM</span></span>
<span id="cb47-118"><a href="microbiota.html#cb47-118"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb47-119"><a href="microbiota.html#cb47-119"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb47-120"><a href="microbiota.html#cb47-120"></a></span>
<span id="cb47-121"><a href="microbiota.html#cb47-121"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb47-122"><a href="microbiota.html#cb47-122"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb47-123"><a href="microbiota.html#cb47-123"></a>    x</span>
<span id="cb47-124"><a href="microbiota.html#cb47-124"></a>})</span>
<span id="cb47-125"><a href="microbiota.html#cb47-125"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb47-126"><a href="microbiota.html#cb47-126"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb47-127"><a href="microbiota.html#cb47-127"></a>    x</span>
<span id="cb47-128"><a href="microbiota.html#cb47-128"></a>})</span>
<span id="cb47-129"><a href="microbiota.html#cb47-129"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb47-130"><a href="microbiota.html#cb47-130"></a>    x[<span class="st">&quot;Class&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb47-131"><a href="microbiota.html#cb47-131"></a>    x</span>
<span id="cb47-132"><a href="microbiota.html#cb47-132"></a>})</span>
<span id="cb47-133"><a href="microbiota.html#cb47-133"></a><span class="kw">head</span>(taxes)</span>
<span id="cb47-134"><a href="microbiota.html#cb47-134"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb47-135"><a href="microbiota.html#cb47-135"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb47-136"><a href="microbiota.html#cb47-136"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb47-137"><a href="microbiota.html#cb47-137"></a></span>
<span id="cb47-138"><a href="microbiota.html#cb47-138"></a><span class="co"># for this to work, dono&#39;t run: taxes &lt;- lapply(taxes, function(x) {x[&#39;Class&#39;] &lt;-</span></span>
<span id="cb47-139"><a href="microbiota.html#cb47-139"></a><span class="co"># NULL; x}) gb &lt;- aggregate(taxes$gb[,3:dim(taxes$gb)[2]],</span></span>
<span id="cb47-140"><a href="microbiota.html#cb47-140"></a><span class="co"># list(taxes$gb[,&#39;Phylum&#39;], taxes$gb[,&#39;Class&#39;]), sum) #works sf &lt;-</span></span>
<span id="cb47-141"><a href="microbiota.html#cb47-141"></a><span class="co"># aggregate(taxes$sf[,3:dim(taxes$sf)[2]], list(taxes$sf[,&#39;Phylum&#39;],</span></span>
<span id="cb47-142"><a href="microbiota.html#cb47-142"></a><span class="co"># taxes$sf[,&#39;Class&#39;]), sum) #works wb &lt;- aggregate(taxes$wb[,3:dim(taxes$wb)[2]],</span></span>
<span id="cb47-143"><a href="microbiota.html#cb47-143"></a><span class="co"># list(taxes$wb[,&#39;Phylum&#39;], taxes$wb[,&#39;Class&#39;]), sum) #works</span></span>
<span id="cb47-144"><a href="microbiota.html#cb47-144"></a></span>
<span id="cb47-145"><a href="microbiota.html#cb47-145"></a></span>
<span id="cb47-146"><a href="microbiota.html#cb47-146"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb47-147"><a href="microbiota.html#cb47-147"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_phy, wb)</span>
<span id="cb47-148"><a href="microbiota.html#cb47-148"></a>taxes_phy[<span class="kw">is.na</span>(taxes_phy)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-149"><a href="microbiota.html#cb47-149"></a><span class="kw">head</span>(taxes_phy)</span>
<span id="cb47-150"><a href="microbiota.html#cb47-150"></a></span>
<span id="cb47-151"><a href="microbiota.html#cb47-151"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_phy, sum)</span></span>
<span id="cb47-152"><a href="microbiota.html#cb47-152"></a><span class="kw">rownames</span>(taxes_phy) &lt;-<span class="st"> </span>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb47-153"><a href="microbiota.html#cb47-153"></a>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb47-154"><a href="microbiota.html#cb47-154"></a></span>
<span id="cb47-155"><a href="microbiota.html#cb47-155"></a>taxes_phy_t &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_phy))</span>
<span id="cb47-156"><a href="microbiota.html#cb47-156"></a>specs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(taxes_phy_t))</span>
<span id="cb47-157"><a href="microbiota.html#cb47-157"></a><span class="kw">colnames</span>(specs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>)</span>
<span id="cb47-158"><a href="microbiota.html#cb47-158"></a>specs[<span class="st">&quot;species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(specs<span class="op">$</span>Sample_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb47-159"><a href="microbiota.html#cb47-159"></a></span>
<span id="cb47-160"><a href="microbiota.html#cb47-160"></a><span class="co"># Permutational anova</span></span>
<span id="cb47-161"><a href="microbiota.html#cb47-161"></a><span class="kw">adonis</span>(taxes_phy_t <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species)  <span class="co">#all three species //significant</span></span>
<span id="cb47-162"><a href="microbiota.html#cb47-162"></a><span class="kw">adonis</span>(taxes_phy_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ] <span class="op">~</span><span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), <span class="dv">2</span>])  <span class="co">#only Gb and Sf //significant</span></span>
<span id="cb47-163"><a href="microbiota.html#cb47-163"></a></span>
<span id="cb47-164"><a href="microbiota.html#cb47-164"></a><span class="co"># Compare variation of relative abundance of each phylum/class among/within the</span></span>
<span id="cb47-165"><a href="microbiota.html#cb47-165"></a><span class="co"># two/three groups ANOVA (three groups)</span></span>
<span id="cb47-166"><a href="microbiota.html#cb47-166"></a><span class="kw">apply</span>(taxes_phy_t, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb47-167"><a href="microbiota.html#cb47-167"></a>    <span class="kw">summary</span>(<span class="kw">aov</span>(x <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species))</span>
<span id="cb47-168"><a href="microbiota.html#cb47-168"></a>})</span>
<span id="cb47-169"><a href="microbiota.html#cb47-169"></a><span class="co"># of course they&#39;re all different, this includes Weberella.</span></span>
<span id="cb47-170"><a href="microbiota.html#cb47-170"></a></span>
<span id="cb47-171"><a href="microbiota.html#cb47-171"></a><span class="co"># Mann-Whittney U aka Wilcoxon rank sum test(two groups, gb vs sf)</span></span>
<span id="cb47-172"><a href="microbiota.html#cb47-172"></a>gbsf_phy &lt;-<span class="st"> </span>taxes_phy_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb47-173"><a href="microbiota.html#cb47-173"></a>gbsf_spec &lt;-<span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb47-174"><a href="microbiota.html#cb47-174"></a><span class="kw">apply</span>(gbsf_phy, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb47-175"><a href="microbiota.html#cb47-175"></a>    <span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species)</span>
<span id="cb47-176"><a href="microbiota.html#cb47-176"></a>})</span>
<span id="cb47-177"><a href="microbiota.html#cb47-177"></a><span class="kw">apply</span>(gbsf_phy, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb47-178"><a href="microbiota.html#cb47-178"></a>    (<span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species))[<span class="st">&quot;p.value&quot;</span>]</span>
<span id="cb47-179"><a href="microbiota.html#cb47-179"></a>})  <span class="co">#This is really the result we want</span></span>
<span id="cb47-180"><a href="microbiota.html#cb47-180"></a></span>
<span id="cb47-181"><a href="microbiota.html#cb47-181"></a><span class="co"># CLASS</span></span>
<span id="cb47-182"><a href="microbiota.html#cb47-182"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb47-183"><a href="microbiota.html#cb47-183"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb47-184"><a href="microbiota.html#cb47-184"></a></span>
<span id="cb47-185"><a href="microbiota.html#cb47-185"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb47-186"><a href="microbiota.html#cb47-186"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb47-187"><a href="microbiota.html#cb47-187"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb47-188"><a href="microbiota.html#cb47-188"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb47-189"><a href="microbiota.html#cb47-189"></a>    x</span>
<span id="cb47-190"><a href="microbiota.html#cb47-190"></a>})</span>
<span id="cb47-191"><a href="microbiota.html#cb47-191"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb47-192"><a href="microbiota.html#cb47-192"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb47-193"><a href="microbiota.html#cb47-193"></a>    x</span>
<span id="cb47-194"><a href="microbiota.html#cb47-194"></a>})</span>
<span id="cb47-195"><a href="microbiota.html#cb47-195"></a></span>
<span id="cb47-196"><a href="microbiota.html#cb47-196"></a><span class="co"># ================out=================== gb &lt;- taxes$gb sf &lt;- taxes$sf wb &lt;-</span></span>
<span id="cb47-197"><a href="microbiota.html#cb47-197"></a><span class="co"># taxes$wb Renaming &amp; removing whitespaces gb$Phylum &lt;-</span></span>
<span id="cb47-198"><a href="microbiota.html#cb47-198"></a><span class="co"># as.character(str_trim(as.character(gb$Phylum))) sf$Phylum &lt;-</span></span>
<span id="cb47-199"><a href="microbiota.html#cb47-199"></a><span class="co"># as.character(str_trim(as.character(sf$Phylum))) wb$Phylum &lt;-</span></span>
<span id="cb47-200"><a href="microbiota.html#cb47-200"></a><span class="co"># as.character(str_trim(as.character(wb$Phylum))) gb$Class &lt;-</span></span>
<span id="cb47-201"><a href="microbiota.html#cb47-201"></a><span class="co"># as.character(str_trim(as.character(gb$Class))) sf$Class &lt;-</span></span>
<span id="cb47-202"><a href="microbiota.html#cb47-202"></a><span class="co"># as.character(str_trim(as.character(sf$Class))) wb$Class &lt;-</span></span>
<span id="cb47-203"><a href="microbiota.html#cb47-203"></a><span class="co"># as.character(str_trim(as.character(wb$Class))) GB</span></span>
<span id="cb47-204"><a href="microbiota.html#cb47-204"></a><span class="co"># gb$Class[(gb$Phylum==&#39;PAUC34f&#39;)] &lt;- &#39;PAUC34f_unclassified&#39;</span></span>
<span id="cb47-205"><a href="microbiota.html#cb47-205"></a><span class="co"># gb$Class[(gb$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39; gb$Phylum[(gb$Phylum==&#39;&#39;)] &lt;-</span></span>
<span id="cb47-206"><a href="microbiota.html#cb47-206"></a><span class="co"># &#39;unclassified&#39; gb$Class[(gb$Phylum==&#39;Tectomicrobia&#39;)] &lt;-</span></span>
<span id="cb47-207"><a href="microbiota.html#cb47-207"></a><span class="co"># &#39;Tectomicrobia_unclassified&#39; gb$Class[(gb$Phylum==&#39;SBR1093&#39;)] &lt;-</span></span>
<span id="cb47-208"><a href="microbiota.html#cb47-208"></a><span class="co"># &#39;SBR1093_unclassified&#39; gb$Class[(gb$Phylum==&#39;Poribacteria&#39;)] &lt;-</span></span>
<span id="cb47-209"><a href="microbiota.html#cb47-209"></a><span class="co"># &#39;Poribacteria_unclassified&#39; gb$Class[gb$Phylum==&#39;Chloroflexi&#39; &amp; gb$Class==&#39;&#39;]</span></span>
<span id="cb47-210"><a href="microbiota.html#cb47-210"></a><span class="co"># &lt;- &#39;Chloroflexi_unclassified&#39; SF sf$Class[(sf$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39;</span></span>
<span id="cb47-211"><a href="microbiota.html#cb47-211"></a><span class="co"># sf$Phylum[(sf$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39; sf$Class[(sf$Phylum==&#39;PAUC34f&#39;)]</span></span>
<span id="cb47-212"><a href="microbiota.html#cb47-212"></a><span class="co"># &lt;- &#39;PAUC34f_unclassified&#39; sf$Class[(sf$Phylum==&#39;Proteobacteria&#39; &amp;</span></span>
<span id="cb47-213"><a href="microbiota.html#cb47-213"></a><span class="co"># sf$Class==&#39;&#39;)] &lt;- &#39;Proteobacteria_unclassified&#39;</span></span>
<span id="cb47-214"><a href="microbiota.html#cb47-214"></a><span class="co"># sf$Class[(sf$Phylum==&#39;Tectomicrobia&#39;)] &lt;- &#39;Tectomicrobia_unclassified&#39;</span></span>
<span id="cb47-215"><a href="microbiota.html#cb47-215"></a><span class="co"># sf$Class[(sf$Phylum==&#39;SBR1093&#39;)] &lt;- &#39;SBR1093_unclassified&#39;</span></span>
<span id="cb47-216"><a href="microbiota.html#cb47-216"></a><span class="co"># sf$Class[(sf$Phylum==&#39;Poribacteria&#39;)] &lt;- &#39;Poribacteria_unclassified&#39; WB</span></span>
<span id="cb47-217"><a href="microbiota.html#cb47-217"></a><span class="co"># wb$Class[(wb$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39; wb$Phylum[(wb$Phylum==&#39;&#39;)] &lt;-</span></span>
<span id="cb47-218"><a href="microbiota.html#cb47-218"></a><span class="co"># &#39;unclassified&#39; merge back taxes &lt;- list(gb=gb, sf=sf, wb=wb)</span></span>
<span id="cb47-219"><a href="microbiota.html#cb47-219"></a><span class="co"># =========================================</span></span>
<span id="cb47-220"><a href="microbiota.html#cb47-220"></a></span>
<span id="cb47-221"><a href="microbiota.html#cb47-221"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb47-222"><a href="microbiota.html#cb47-222"></a>    x[<span class="st">&quot;Phylum&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb47-223"><a href="microbiota.html#cb47-223"></a>    x</span>
<span id="cb47-224"><a href="microbiota.html#cb47-224"></a>})</span>
<span id="cb47-225"><a href="microbiota.html#cb47-225"></a><span class="kw">head</span>(taxes)</span>
<span id="cb47-226"><a href="microbiota.html#cb47-226"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Class&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb47-227"><a href="microbiota.html#cb47-227"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Class&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb47-228"><a href="microbiota.html#cb47-228"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Class&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb47-229"><a href="microbiota.html#cb47-229"></a></span>
<span id="cb47-230"><a href="microbiota.html#cb47-230"></a>taxes_cla &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb47-231"><a href="microbiota.html#cb47-231"></a>taxes_cla &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_cla, wb)</span>
<span id="cb47-232"><a href="microbiota.html#cb47-232"></a>taxes_cla[<span class="kw">is.na</span>(taxes_cla)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-233"><a href="microbiota.html#cb47-233"></a><span class="kw">head</span>(taxes_cla)</span>
<span id="cb47-234"><a href="microbiota.html#cb47-234"></a></span>
<span id="cb47-235"><a href="microbiota.html#cb47-235"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_cla, sum)</span></span>
<span id="cb47-236"><a href="microbiota.html#cb47-236"></a><span class="kw">rownames</span>(taxes_cla) &lt;-<span class="st"> </span>taxes_cla<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb47-237"><a href="microbiota.html#cb47-237"></a>taxes_cla<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb47-238"><a href="microbiota.html#cb47-238"></a></span>
<span id="cb47-239"><a href="microbiota.html#cb47-239"></a>taxes_cla_t &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_cla))</span>
<span id="cb47-240"><a href="microbiota.html#cb47-240"></a>specs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(taxes_cla_t))</span>
<span id="cb47-241"><a href="microbiota.html#cb47-241"></a><span class="kw">colnames</span>(specs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>)</span>
<span id="cb47-242"><a href="microbiota.html#cb47-242"></a>specs[<span class="st">&quot;species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(specs<span class="op">$</span>Sample_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb47-243"><a href="microbiota.html#cb47-243"></a></span>
<span id="cb47-244"><a href="microbiota.html#cb47-244"></a><span class="co"># Permutational anova</span></span>
<span id="cb47-245"><a href="microbiota.html#cb47-245"></a><span class="kw">adonis</span>(taxes_cla_t <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species)  <span class="co">#all three species //significant</span></span>
<span id="cb47-246"><a href="microbiota.html#cb47-246"></a><span class="kw">adonis</span>(taxes_cla_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ] <span class="op">~</span><span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), <span class="dv">2</span>])  <span class="co">#only Gb and Sf //significant</span></span>
<span id="cb47-247"><a href="microbiota.html#cb47-247"></a></span>
<span id="cb47-248"><a href="microbiota.html#cb47-248"></a><span class="co"># Compare variation of relative abundance of each clalum/class among/within the</span></span>
<span id="cb47-249"><a href="microbiota.html#cb47-249"></a><span class="co"># two/three groups ANOVA (three groups)</span></span>
<span id="cb47-250"><a href="microbiota.html#cb47-250"></a><span class="kw">apply</span>(taxes_cla_t, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb47-251"><a href="microbiota.html#cb47-251"></a>    <span class="kw">summary</span>(<span class="kw">aov</span>(x <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species))</span>
<span id="cb47-252"><a href="microbiota.html#cb47-252"></a>})</span>
<span id="cb47-253"><a href="microbiota.html#cb47-253"></a><span class="co"># of course they&#39;re all different, this includes Weberella.</span></span>
<span id="cb47-254"><a href="microbiota.html#cb47-254"></a></span>
<span id="cb47-255"><a href="microbiota.html#cb47-255"></a><span class="co"># Mann-Whittney U aka Wilcoxon rank sum test(two groups, gb vs sf)</span></span>
<span id="cb47-256"><a href="microbiota.html#cb47-256"></a>gbsf_cla &lt;-<span class="st"> </span>taxes_cla_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb47-257"><a href="microbiota.html#cb47-257"></a>gbsf_spec &lt;-<span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb47-258"><a href="microbiota.html#cb47-258"></a><span class="kw">apply</span>(gbsf_cla, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb47-259"><a href="microbiota.html#cb47-259"></a>    <span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species)</span>
<span id="cb47-260"><a href="microbiota.html#cb47-260"></a>})</span>
<span id="cb47-261"><a href="microbiota.html#cb47-261"></a><span class="kw">apply</span>(gbsf_cla, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb47-262"><a href="microbiota.html#cb47-262"></a>    (<span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species))[<span class="st">&quot;p.value&quot;</span>]</span>
<span id="cb47-263"><a href="microbiota.html#cb47-263"></a>})</span>
<span id="cb47-264"><a href="microbiota.html#cb47-264"></a></span>
<span id="cb47-265"><a href="microbiota.html#cb47-265"></a><span class="co">### =========================================== For plotting</span></span>
<span id="cb47-266"><a href="microbiota.html#cb47-266"></a><span class="co">### ================================</span></span>
<span id="cb47-267"><a href="microbiota.html#cb47-267"></a></span>
<span id="cb47-268"><a href="microbiota.html#cb47-268"></a><span class="co"># YAS!</span></span>
<span id="cb47-269"><a href="microbiota.html#cb47-269"></a>taxes_phy_m &lt;-<span class="st"> </span>taxes_phy_t</span>
<span id="cb47-270"><a href="microbiota.html#cb47-270"></a>taxes_phy_m[<span class="st">&quot;Sample_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(taxes_phy_m)</span>
<span id="cb47-271"><a href="microbiota.html#cb47-271"></a>taxes_phy_m &lt;-<span class="st"> </span><span class="kw">melt</span>(taxes_phy_m, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>))</span>
<span id="cb47-272"><a href="microbiota.html#cb47-272"></a>taxes_phy_m[<span class="st">&quot;Phylum&quot;</span>] &lt;-<span class="st"> </span>taxes_phy_m<span class="op">$</span>variable</span>
<span id="cb47-273"><a href="microbiota.html#cb47-273"></a><span class="co"># taxes_phy_m$Phylum[taxes_phy_m$Phylum==&#39;classified&#39;] &lt;- &#39;unclassified&#39;</span></span>
<span id="cb47-274"><a href="microbiota.html#cb47-274"></a>taxes_phy_m</span>
<span id="cb47-275"><a href="microbiota.html#cb47-275"></a></span>
<span id="cb47-276"><a href="microbiota.html#cb47-276"></a><span class="kw">unique</span>(taxes_phy_m<span class="op">$</span>Phylum)</span>
<span id="cb47-277"><a href="microbiota.html#cb47-277"></a></span>
<span id="cb47-278"><a href="microbiota.html#cb47-278"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb47-279"><a href="microbiota.html#cb47-279"></a>phylum_palette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#b8c4f6&quot;</span>, <span class="st">&quot;#ffaaaf&quot;</span>, <span class="st">&quot;#3d1349&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#01559d&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, </span>
<span id="cb47-280"><a href="microbiota.html#cb47-280"></a>    <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#019c51&quot;</span>, <span class="st">&quot;#b10060&quot;</span>, <span class="st">&quot;#49ca00&quot;</span>, <span class="st">&quot;#dd8e00&quot;</span>, </span>
<span id="cb47-281"><a href="microbiota.html#cb47-281"></a>    <span class="st">&quot;#f282ff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ff633f&quot;</span>, <span class="st">&quot;#ec0040&quot;</span>, <span class="st">&quot;#010b92&quot;</span>, <span class="st">&quot;#cf00aa&quot;</span>, <span class="st">&quot;#aba900&quot;</span>, </span>
<span id="cb47-282"><a href="microbiota.html#cb47-282"></a>    <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#fce300&quot;</span>)</span>
<span id="cb47-283"><a href="microbiota.html#cb47-283"></a><span class="kw">ggplot</span>(taxes_phy_m, <span class="kw">aes</span>(<span class="dt">x =</span> Sample_ID, <span class="dt">y =</span> value, <span class="dt">fill =</span> Phylum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb47-284"><a href="microbiota.html#cb47-284"></a><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb47-285"><a href="microbiota.html#cb47-285"></a><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">&quot;Gb1&quot;</span>, <span class="st">&quot;Gb2&quot;</span>, <span class="st">&quot;Gb3&quot;</span>, <span class="st">&quot;Gb4&quot;</span>, <span class="st">&quot;Gb5&quot;</span>, <span class="st">&quot;Gb6&quot;</span>, </span>
<span id="cb47-286"><a href="microbiota.html#cb47-286"></a>    <span class="st">&quot;Gb7&quot;</span>, <span class="st">&quot;Gb8&quot;</span>, <span class="st">&quot;Gb9&quot;</span>, <span class="st">&quot;Gb10&quot;</span>, <span class="st">&quot;Gb11&quot;</span>, <span class="st">&quot;Gb12&quot;</span>, <span class="st">&quot;Gb13&quot;</span>, <span class="st">&quot;Gb14&quot;</span>, <span class="st">&quot;Sf1&quot;</span>, <span class="st">&quot;Sf2&quot;</span>, <span class="st">&quot;Sf3&quot;</span>, </span>
<span id="cb47-287"><a href="microbiota.html#cb47-287"></a>    <span class="st">&quot;Sf4&quot;</span>, <span class="st">&quot;Sf5&quot;</span>, <span class="st">&quot;Sf6&quot;</span>, <span class="st">&quot;Sf7&quot;</span>, <span class="st">&quot;Sf8&quot;</span>, <span class="st">&quot;Sf9&quot;</span>, <span class="st">&quot;Sf10&quot;</span>, <span class="st">&quot;Sf11&quot;</span>, <span class="st">&quot;Sf12&quot;</span>, <span class="st">&quot;Sf13&quot;</span>, <span class="st">&quot;Sf14&quot;</span>, </span>
<span id="cb47-288"><a href="microbiota.html#cb47-288"></a>    <span class="st">&quot;Sf15&quot;</span>, <span class="st">&quot;Wb1&quot;</span>, <span class="st">&quot;Wb2&quot;</span>, <span class="st">&quot;Wb3&quot;</span>, <span class="st">&quot;Wb4&quot;</span>, <span class="st">&quot;Wb5&quot;</span>, <span class="st">&quot;Wb6&quot;</span>, <span class="st">&quot;Wb7&quot;</span>, <span class="st">&quot;Wb8&quot;</span>, <span class="st">&quot;Wb9&quot;</span>, <span class="st">&quot;Wb10&quot;</span>, </span>
<span id="cb47-289"><a href="microbiota.html#cb47-289"></a>    <span class="st">&quot;Wb11&quot;</span>, <span class="st">&quot;Wb12&quot;</span>, <span class="st">&quot;Wb13&quot;</span>, <span class="st">&quot;Wb14&quot;</span>, <span class="st">&quot;Wb15&quot;</span>, <span class="st">&quot;Wb16&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Samples ordered by depth&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb47-290"><a href="microbiota.html#cb47-290"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Relative abundance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> phylum_palette)</span>
<span id="cb47-291"><a href="microbiota.html#cb47-291"></a></span>
<span id="cb47-292"><a href="microbiota.html#cb47-292"></a><span class="co"># ======</span><span class="re">END</span><span class="co">=================================</span></span>
<span id="cb47-293"><a href="microbiota.html#cb47-293"></a></span>
<span id="cb47-294"><a href="microbiota.html#cb47-294"></a></span>
<span id="cb47-295"><a href="microbiota.html#cb47-295"></a><span class="co">### ===== For Venn diagramms =============================</span></span>
<span id="cb47-296"><a href="microbiota.html#cb47-296"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb47-297"><a href="microbiota.html#cb47-297"></a></span>
<span id="cb47-298"><a href="microbiota.html#cb47-298"></a>gb_otus &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_ds<span class="op">$</span>gb))</span>
<span id="cb47-299"><a href="microbiota.html#cb47-299"></a><span class="kw">colnames</span>(gb_otus) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb47-300"><a href="microbiota.html#cb47-300"></a>sf_otus &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_ds<span class="op">$</span>sf))</span>
<span id="cb47-301"><a href="microbiota.html#cb47-301"></a><span class="kw">colnames</span>(sf_otus) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb47-302"><a href="microbiota.html#cb47-302"></a>wb_otus &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_ds<span class="op">$</span>wb))</span>
<span id="cb47-303"><a href="microbiota.html#cb47-303"></a><span class="kw">colnames</span>(wb_otus) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb47-304"><a href="microbiota.html#cb47-304"></a></span>
<span id="cb47-305"><a href="microbiota.html#cb47-305"></a><span class="kw">dim</span>(<span class="kw">intersect</span>(gb_otus, sf_otus))[<span class="dv">1</span>]  <span class="co"># 361</span></span>
<span id="cb47-306"><a href="microbiota.html#cb47-306"></a><span class="kw">dim</span>(<span class="kw">intersect</span>(gb_otus, wb_otus))[<span class="dv">1</span>]  <span class="co"># 2</span></span>
<span id="cb47-307"><a href="microbiota.html#cb47-307"></a><span class="kw">dim</span>(<span class="kw">intersect</span>(sf_otus, wb_otus))[<span class="dv">1</span>]  <span class="co"># 8</span></span>
<span id="cb47-308"><a href="microbiota.html#cb47-308"></a></span>
<span id="cb47-309"><a href="microbiota.html#cb47-309"></a><span class="kw">length</span>(<span class="kw">intersect</span>(<span class="kw">intersect</span>(gb_otus, wb_otus), <span class="kw">intersect</span>(sf_otus, wb_otus)))  <span class="co"># 1</span></span>
<span id="cb47-310"><a href="microbiota.html#cb47-310"></a><span class="co"># ==========================================================</span></span>
<span id="cb47-311"><a href="microbiota.html#cb47-311"></a></span>
<span id="cb47-312"><a href="microbiota.html#cb47-312"></a></span>
<span id="cb47-313"><a href="microbiota.html#cb47-313"></a><span class="co"># levels(taxes_phy$Group.1)[1] &lt;- &#39;unclassified&#39;</span></span>
<span id="cb47-314"><a href="microbiota.html#cb47-314"></a></span>
<span id="cb47-315"><a href="microbiota.html#cb47-315"></a><span class="co">### old stuff , could be deleted I belive===========</span></span>
<span id="cb47-316"><a href="microbiota.html#cb47-316"></a></span>
<span id="cb47-317"><a href="microbiota.html#cb47-317"></a>tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb47-318"><a href="microbiota.html#cb47-318"></a>tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb47-319"><a href="microbiota.html#cb47-319"></a>tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb47-320"><a href="microbiota.html#cb47-320"></a></span>
<span id="cb47-321"><a href="microbiota.html#cb47-321"></a></span>
<span id="cb47-322"><a href="microbiota.html#cb47-322"></a>gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-323"><a href="microbiota.html#cb47-323"></a>gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb47-324"><a href="microbiota.html#cb47-324"></a>gb_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb47-325"><a href="microbiota.html#cb47-325"></a><span class="kw">colnames</span>(gb_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb47-326"><a href="microbiota.html#cb47-326"></a></span>
<span id="cb47-327"><a href="microbiota.html#cb47-327"></a>gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-328"><a href="microbiota.html#cb47-328"></a>gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb47-329"><a href="microbiota.html#cb47-329"></a>gb_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb47-330"><a href="microbiota.html#cb47-330"></a><span class="kw">colnames</span>(gb_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb47-331"><a href="microbiota.html#cb47-331"></a></span>
<span id="cb47-332"><a href="microbiota.html#cb47-332"></a>sf1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-333"><a href="microbiota.html#cb47-333"></a>sf2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb47-334"><a href="microbiota.html#cb47-334"></a>sf_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(sf1, sf2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb47-335"><a href="microbiota.html#cb47-335"></a><span class="kw">colnames</span>(sf_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb47-336"><a href="microbiota.html#cb47-336"></a></span>
<span id="cb47-337"><a href="microbiota.html#cb47-337"></a>sf1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb47-338"><a href="microbiota.html#cb47-338"></a>sf2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb47-339"><a href="microbiota.html#cb47-339"></a>sf_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(sf1, sf2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb47-340"><a href="microbiota.html#cb47-340"></a><span class="kw">colnames</span>(sf_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span></code></pre></div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-vegan">
<p>Oksanen, Jari, F. Guillaume Blanchet, Michael Friendly, Roeland Kindt, Pierre Legendre, Dan McGlinn, Peter R. Minchin, et al. 2019. <em>Vegan: Community Ecology Package</em>. <a href="https://CRAN.R-project.org/package=vegan">https://CRAN.R-project.org/package=vegan</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metabolomics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="inter-omics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.pdf", "Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
