<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</title>
  <meta name="description" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  
  
  

<meta name="author" content="Karin Steffen" />


<meta name="date" content="2020-05-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metabolomics.html"/>
<link rel="next" href="inter-omics.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SUPPLEMENTARY MATERIAL</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Content</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#experimental-setup"><i class="fa fa-check"></i><b>1.1</b> Experimental setup</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#map"><i class="fa fa-check"></i><b>1.1.1</b> Map</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#water-masses"><i class="fa fa-check"></i><b>1.1.2</b> Water masses</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#sponges"><i class="fa fa-check"></i><b>1.1.3</b> Sponges</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#sample-metadata-analysis"><i class="fa fa-check"></i><b>1.2</b> Sample metadata analysis</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#index_cor_vif"><i class="fa fa-check"></i><b>1.2.1</b> Correlations, visual inspection and variance inflation factors (VIF) across all samples</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#correlations-visual-inspection-and-variance-inflation-factors-vif-across-g.-barretti-samples"><i class="fa fa-check"></i><b>1.2.2</b> Correlations, visual inspection and variance inflation factors (VIF) across <em>G. barretti</em> samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="metabolomics.html"><a href="metabolomics.html"><i class="fa fa-check"></i><b>2</b> Metabolomics</a><ul>
<li class="chapter" data-level="2.1" data-path="metabolomics.html"><a href="metabolomics.html#experimental-methods-and-detailed-description"><i class="fa fa-check"></i><b>2.1</b> Experimental methods and detailed description</a></li>
<li class="chapter" data-level="2.2" data-path="metabolomics.html"><a href="metabolomics.html#data-processing"><i class="fa fa-check"></i><b>2.2</b> Data processing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="metabolomics.html"><a href="metabolomics.html#peak-picking-with-xcms-and-annotation-with-camera"><i class="fa fa-check"></i><b>2.2.1</b> Peak picking with XCMS and annotation with CAMERA</a></li>
<li class="chapter" data-level="2.2.2" data-path="metabolomics.html"><a href="metabolomics.html#hilic-hydrophilic-interaction-chromatography-column-with-positive-esi-electron-spray-ionisation"><i class="fa fa-check"></i><b>2.2.2</b> HILIC (Hydrophilic interaction chromatography) column with positive ESI (electron spray ionisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="metabolomics.html"><a href="metabolomics.html#hilic-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.3</b> HILIC Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.4" data-path="metabolomics.html"><a href="metabolomics.html#rp-reversed-phase-chromatography-with-positive-esi"><i class="fa fa-check"></i><b>2.2.4</b> RP (Reversed phase) Chromatography with positive ESI</a></li>
<li class="chapter" data-level="2.2.5" data-path="metabolomics.html"><a href="metabolomics.html#rp-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.5</b> RP Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.6" data-path="metabolomics.html"><a href="metabolomics.html#filtering-of-the-raw-data-set"><i class="fa fa-check"></i><b>2.2.6</b> Filtering of the raw data set</a></li>
<li class="chapter" data-level="2.2.7" data-path="metabolomics.html"><a href="metabolomics.html#data-quality-control"><i class="fa fa-check"></i><b>2.2.7</b> Data quality control</a></li>
<li class="chapter" data-level="2.2.8" data-path="metabolomics.html"><a href="metabolomics.html#summary-of-data-processing"><i class="fa fa-check"></i><b>2.2.8</b> Summary of data processing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="metabolomics.html"><a href="metabolomics.html#multivariate-analyses"><i class="fa fa-check"></i><b>2.3</b> Multivariate analyses</a></li>
<li class="chapter" data-level="2.4" data-path="metabolomics.html"><a href="metabolomics.html#vips"><i class="fa fa-check"></i><b>2.4</b> VIPS</a></li>
<li class="chapter" data-level="2.5" data-path="metabolomics.html"><a href="metabolomics.html#manual-annotation-identification-and-extraction-of-metabolic-feature-signals"><i class="fa fa-check"></i><b>2.5</b> Manual annotation, identification and extraction of metabolic feature signals</a></li>
<li class="chapter" data-level="2.6" data-path="metabolomics.html"><a href="metabolomics.html#chromatorgrams"><i class="fa fa-check"></i><b>2.6</b> Chromatorgrams</a></li>
<li class="chapter" data-level="2.7" data-path="metabolomics.html"><a href="metabolomics.html#correlations"><i class="fa fa-check"></i><b>2.7</b> Correlations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="microbiota.html"><a href="microbiota.html"><i class="fa fa-check"></i><b>3</b> Microbiota</a><ul>
<li class="chapter" data-level="3.1" data-path="microbiota.html"><a href="microbiota.html#otu-table-overview"><i class="fa fa-check"></i><b>3.1</b> OTU table overview</a></li>
<li class="chapter" data-level="3.2" data-path="microbiota.html"><a href="microbiota.html#alpha-diversity"><i class="fa fa-check"></i><b>3.2</b> Alpha diversity</a></li>
<li class="chapter" data-level="3.3" data-path="microbiota.html"><a href="microbiota.html#beta-diversity"><i class="fa fa-check"></i><b>3.3</b> Beta diversity</a></li>
<li class="chapter" data-level="3.4" data-path="microbiota.html"><a href="microbiota.html#EnvMod"><i class="fa fa-check"></i><b>3.4</b> Environmental modelling</a><ul>
<li class="chapter" data-level="3.4.1" data-path="microbiota.html"><a href="microbiota.html#constrained"><i class="fa fa-check"></i><b>3.4.1</b> Constrained modelling approach Automatic stepwise model building</a></li>
<li class="chapter" data-level="3.4.2" data-path="microbiota.html"><a href="microbiota.html#unconstrained"><i class="fa fa-check"></i><b>3.4.2</b> Unconstrained modelling approach</a></li>
<li class="chapter" data-level="3.4.3" data-path="microbiota.html"><a href="microbiota.html#Hclust"><i class="fa fa-check"></i><b>3.4.3</b> Hierarchical clustering</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="microbiota.html"><a href="microbiota.html#relative-abundances"><i class="fa fa-check"></i><b>3.5</b> Relative abundances</a><ul>
<li class="chapter" data-level="3.5.1" data-path="microbiota.html"><a href="microbiota.html#bar-plots"><i class="fa fa-check"></i><b>3.5.1</b> Bar plots</a></li>
<li class="chapter" data-level="3.5.2" data-path="microbiota.html"><a href="microbiota.html#tabular-overview"><i class="fa fa-check"></i><b>3.5.2</b> Tabular overview</a></li>
<li class="chapter" data-level="3.5.3" data-path="microbiota.html"><a href="microbiota.html#statistical-comparison-at-phylum-and-class-level"><i class="fa fa-check"></i><b>3.5.3</b> Statistical comparison at phylum and class level</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="microbiota.html"><a href="microbiota.html#depth-response-otu-perspective"><i class="fa fa-check"></i><b>3.6</b> Depth response: OTU perspective</a></li>
<li class="chapter" data-level="3.7" data-path="microbiota.html"><a href="microbiota.html#sequence-similarity"><i class="fa fa-check"></i><b>3.7</b> Sequence similarity</a></li>
<li class="chapter" data-level="3.8" data-path="microbiota.html"><a href="microbiota.html#phylogeny"><i class="fa fa-check"></i><b>3.8</b> Phylogeny</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inter-omics.html"><a href="inter-omics.html"><i class="fa fa-check"></i><b>4</b> Inter-omics</a><ul>
<li class="chapter" data-level="4.1" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-and-procrustes-rotations"><i class="fa fa-check"></i><b>4.1</b> Mantel test and procrustes rotations</a><ul>
<li class="chapter" data-level="4.1.1" data-path="inter-omics.html"><a href="inter-omics.html#libraries-and-functions"><i class="fa fa-check"></i><b>4.1.1</b> Libraries and functions</a></li>
<li class="chapter" data-level="4.1.2" data-path="inter-omics.html"><a href="inter-omics.html#data-sets"><i class="fa fa-check"></i><b>4.1.2</b> Data sets</a></li>
<li class="chapter" data-level="4.1.3" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.3</b> Mantel test code and tabular output</a></li>
<li class="chapter" data-level="4.1.4" data-path="inter-omics.html"><a href="inter-omics.html#procrustes-rotation-and-protest-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.4</b> Procrustes rotation and protest code and tabular output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inter-omics.html"><a href="inter-omics.html#microbial-interaction-network"><i class="fa fa-check"></i><b>4.2</b> Microbial interaction network</a><ul>
<li class="chapter" data-level="4.2.1" data-path="inter-omics.html"><a href="inter-omics.html#generating-network-based-on-different-algorithms"><i class="fa fa-check"></i><b>4.2.1</b> Generating network based on different algorithms</a></li>
<li class="chapter" data-level="4.2.2" data-path="inter-omics.html"><a href="inter-omics.html#consolidation-of-the-different-networks"><i class="fa fa-check"></i><b>4.2.2</b> Consolidation of the different networks</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inter-omics.html"><a href="inter-omics.html#shortlist"><i class="fa fa-check"></i><b>4.3</b> Shortlist</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="funding-disclaimer.html"><a href="funding-disclaimer.html"><i class="fa fa-check"></i><b>5</b> Funding disclaimer</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="microbiota" class="section level1">
<h1><span class="header-section-number">3</span> Microbiota</h1>
<div id="otu-table-overview" class="section level2">
<h2><span class="header-section-number">3.1</span> OTU table overview</h2>
<p>Letâ€™s start by taking a look at the OTU table and get an overall impression of our data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="microbiota.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="microbiota.html#cb1-2"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb1-3"><a href="microbiota.html#cb1-3"></a><span class="kw">library</span>(stringr)</span>
<span id="cb1-4"><a href="microbiota.html#cb1-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="microbiota.html#cb1-5"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb1-6"><a href="microbiota.html#cb1-6"></a><span class="kw">library</span>(forcats)</span>
<span id="cb1-7"><a href="microbiota.html#cb1-7"></a></span>
<span id="cb1-8"><a href="microbiota.html#cb1-8"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb1-9"><a href="microbiota.html#cb1-9"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb1-10"><a href="microbiota.html#cb1-10"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb1-11"><a href="microbiota.html#cb1-11"></a><span class="kw">library</span>(DT)</span>
<span id="cb1-12"><a href="microbiota.html#cb1-12"></a></span>
<span id="cb1-13"><a href="microbiota.html#cb1-13"></a><span class="kw">library</span>(vegan)</span>
<span id="cb1-14"><a href="microbiota.html#cb1-14"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb1-15"><a href="microbiota.html#cb1-15"></a><span class="kw">library</span>(picante)</span>
<span id="cb1-16"><a href="microbiota.html#cb1-16"></a><span class="kw">library</span>(seqinr)</span>
<span id="cb1-17"><a href="microbiota.html#cb1-17"></a></span>
<span id="cb1-18"><a href="microbiota.html#cb1-18"></a><span class="kw">library</span>(gtools)</span>
<span id="cb1-19"><a href="microbiota.html#cb1-19"></a><span class="co"># install.packages(&#39;webshot&#39;) webshot::install_phantomjs()</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="microbiota.html#cb2-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb2-2"><a href="microbiota.html#cb2-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb2-3"><a href="microbiota.html#cb2-3"></a></span>
<span id="cb2-4"><a href="microbiota.html#cb2-4"></a><span class="co"># meta_data &lt;- meta_data[!str_sub(meta_data$unified_ID,1,2)==&#39;QC&#39;,] # remove QC</span></span>
<span id="cb2-5"><a href="microbiota.html#cb2-5"></a><span class="co"># samples</span></span>
<span id="cb2-6"><a href="microbiota.html#cb2-6"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb2-7"><a href="microbiota.html#cb2-7"></a></span>
<span id="cb2-8"><a href="microbiota.html#cb2-8"></a>microbiome &lt;-<span class="st"> </span>microbiome[<span class="kw">order</span>(microbiome<span class="op">$</span>Sample_ID), ]</span>
<span id="cb2-9"><a href="microbiota.html#cb2-9"></a>meta_data &lt;-<span class="st"> </span>meta_data[<span class="kw">order</span>(meta_data<span class="op">$</span>unified_ID), ]</span>
<span id="cb2-10"><a href="microbiota.html#cb2-10"></a></span>
<span id="cb2-11"><a href="microbiota.html#cb2-11"></a><span class="co"># dropping factors from full data:</span></span>
<span id="cb2-12"><a href="microbiota.html#cb2-12"></a>meta_data[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(meta_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb2-13"><a href="microbiota.html#cb2-13"></a>microbiome[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(microbiome, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb2-14"><a href="microbiota.html#cb2-14"></a></span>
<span id="cb2-15"><a href="microbiota.html#cb2-15"></a><span class="co"># all(meta_data$unified_ID==microbiome$Sample_ID)</span></span>
<span id="cb2-16"><a href="microbiota.html#cb2-16"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb2-17"><a href="microbiota.html#cb2-17"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb2-18"><a href="microbiota.html#cb2-18"></a></span>
<span id="cb2-19"><a href="microbiota.html#cb2-19"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)  <span class="co">#total_OTUs = Cummulative read count</span></span>
<span id="cb2-20"><a href="microbiota.html#cb2-20"></a>micro_fig1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb2-21"><a href="microbiota.html#cb2-21"></a>micro_fig1[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb2-22"><a href="microbiota.html#cb2-22"></a>micro_fig1[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;none&quot;</span></span>
<span id="cb2-23"><a href="microbiota.html#cb2-23"></a></span>
<span id="cb2-24"><a href="microbiota.html#cb2-24"></a>microbiome<span class="op">$</span>total_OTUs &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb2-25"><a href="microbiota.html#cb2-25"></a>microbiome &lt;-<span class="st"> </span><span class="kw">sqrt</span>(microbiome)</span>
<span id="cb2-26"><a href="microbiota.html#cb2-26"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)</span>
<span id="cb2-27"><a href="microbiota.html#cb2-27"></a></span>
<span id="cb2-28"><a href="microbiota.html#cb2-28"></a>micro_fig2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb2-29"><a href="microbiota.html#cb2-29"></a>micro_fig2[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb2-30"><a href="microbiota.html#cb2-30"></a>micro_fig2[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;sqrt&quot;</span></span>
<span id="cb2-31"><a href="microbiota.html#cb2-31"></a></span>
<span id="cb2-32"><a href="microbiota.html#cb2-32"></a>microbiome<span class="op">$</span>total_OTUs &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb2-33"><a href="microbiota.html#cb2-33"></a>microbiome &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(microbiome)</span>
<span id="cb2-34"><a href="microbiota.html#cb2-34"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)</span>
<span id="cb2-35"><a href="microbiota.html#cb2-35"></a></span>
<span id="cb2-36"><a href="microbiota.html#cb2-36"></a>micro_fig3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb2-37"><a href="microbiota.html#cb2-37"></a>micro_fig3[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb2-38"><a href="microbiota.html#cb2-38"></a>micro_fig3[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;sqrt wisconsin&quot;</span></span>
<span id="cb2-39"><a href="microbiota.html#cb2-39"></a></span>
<span id="cb2-40"><a href="microbiota.html#cb2-40"></a>micro_fig &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_fig1, micro_fig2, micro_fig3)</span>
<span id="cb2-41"><a href="microbiota.html#cb2-41"></a><span class="kw">colnames</span>(micro_fig) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;total_OTUs&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;normalisation&quot;</span>)</span>
<span id="cb2-42"><a href="microbiota.html#cb2-42"></a>micro_fig[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(micro_fig<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb2-43"><a href="microbiota.html#cb2-43"></a></span>
<span id="cb2-44"><a href="microbiota.html#cb2-44"></a><span class="kw">ggplot</span>(micro_fig, <span class="kw">aes</span>(<span class="dt">x =</span> unified_ID, <span class="dt">y =</span> total_OTUs)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-45"><a href="microbiota.html#cb2-45"></a><span class="st">    </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(normalisation), <span class="kw">vars</span>(Species), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Samples&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-46"><a href="microbiota.html#cb2-46"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Number of OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cummulative read count after normalisation&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-47"><a href="microbiota.html#cb2-47"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:filtering-pca"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/filtering-pca-1.png" alt="Read count overview of the OTU table before and after the normalisation applied in the data analysis for this study." width="672" />
<p class="caption">
Figure 3.1: Read count overview of the OTU table before and after the normalisation applied in the data analysis for this study.
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="microbiota.html#cb3-1"></a><span class="co"># see</span></span>
<span id="cb3-2"><a href="microbiota.html#cb3-2"></a><span class="co"># https://chrischizinski.github.io/SNR_R_Group/2016-08-10-Data-Transformations</span></span></code></pre></div>
<p>Do the normalisations have affect how well we can discriminate between the microbiota?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="microbiota.html#cb4-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb4-2"><a href="microbiota.html#cb4-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb4-3"><a href="microbiota.html#cb4-3"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb4-4"><a href="microbiota.html#cb4-4"></a></span>
<span id="cb4-5"><a href="microbiota.html#cb4-5"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb4-6"><a href="microbiota.html#cb4-6"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb4-7"><a href="microbiota.html#cb4-7"></a></span>
<span id="cb4-8"><a href="microbiota.html#cb4-8"></a>pca_plot &lt;-<span class="st"> </span><span class="cf">function</span>(microbiome, meta_data, my_title) {</span>
<span id="cb4-9"><a href="microbiota.html#cb4-9"></a>    micro.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(microbiome, <span class="dt">scale =</span> T)</span>
<span id="cb4-10"><a href="microbiota.html#cb4-10"></a>    k &lt;-<span class="st"> </span><span class="kw">summary</span>(micro.pca)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb4-11"><a href="microbiota.html#cb4-11"></a>    micro_pca_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(micro.pca<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb4-12"><a href="microbiota.html#cb4-12"></a>    micro_pca_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(micro_pca_df))</span>
<span id="cb4-13"><a href="microbiota.html#cb4-13"></a>    x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb4-14"><a href="microbiota.html#cb4-14"></a>    y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb4-15"><a href="microbiota.html#cb4-15"></a>    micro_pca_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(micro_pca_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], </span>
<span id="cb4-16"><a href="microbiota.html#cb4-16"></a>        meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb4-17"><a href="microbiota.html#cb4-17"></a>            <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb4-18"><a href="microbiota.html#cb4-18"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(micro_pca_df, <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">shape =</span> <span class="kw">factor</span>(Species))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-19"><a href="microbiota.html#cb4-19"></a><span class="st">        </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(x1) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(y1) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">shape =</span> <span class="st">&quot;Species&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-20"><a href="microbiota.html#cb4-20"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb4-21"><a href="microbiota.html#cb4-21"></a>    <span class="kw">return</span>(p)</span>
<span id="cb4-22"><a href="microbiota.html#cb4-22"></a>}</span>
<span id="cb4-23"><a href="microbiota.html#cb4-23"></a></span>
<span id="cb4-24"><a href="microbiota.html#cb4-24"></a>untransformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(microbiome, meta_data, <span class="st">&quot;untransformed&quot;</span>)</span>
<span id="cb4-25"><a href="microbiota.html#cb4-25"></a>sqrt_transformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(<span class="kw">sqrt</span>(microbiome), meta_data, <span class="st">&quot;sqrt&quot;</span>)</span>
<span id="cb4-26"><a href="microbiota.html#cb4-26"></a>sqrt_wisc_transformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(<span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(microbiome)), meta_data, <span class="st">&quot;sqrt and wisconsin&quot;</span>)</span>
<span id="cb4-27"><a href="microbiota.html#cb4-27"></a></span>
<span id="cb4-28"><a href="microbiota.html#cb4-28"></a><span class="kw">grid.arrange</span>(untransformed, sqrt_transformed, sqrt_wisc_transformed, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">top =</span> <span class="st">&quot;PCA: Impact of normalisation on discrimination of the microbiota&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:microbiome-pca"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/microbiome-pca-1.png" alt="PCA of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb" width="672" />
<p class="caption">
Figure 3.2: PCA of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="microbiota.html#cb5-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb5-2"><a href="microbiota.html#cb5-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb5-3"><a href="microbiota.html#cb5-3"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb5-4"><a href="microbiota.html#cb5-4"></a></span>
<span id="cb5-5"><a href="microbiota.html#cb5-5"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb5-6"><a href="microbiota.html#cb5-6"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb5-7"><a href="microbiota.html#cb5-7"></a></span>
<span id="cb5-8"><a href="microbiota.html#cb5-8"></a>nmds_plot &lt;-<span class="st"> </span><span class="cf">function</span>(microbiome, meta_data, my_title) {</span>
<span id="cb5-9"><a href="microbiota.html#cb5-9"></a>    micro.mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(microbiome, <span class="dt">k =</span> <span class="dv">2</span>, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb5-10"><a href="microbiota.html#cb5-10"></a>    nmds_points &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(micro.mds<span class="op">$</span>points)</span>
<span id="cb5-11"><a href="microbiota.html#cb5-11"></a>    samples &lt;-<span class="st"> </span><span class="kw">data.frame</span>(nmds_points<span class="op">$</span>MDS1, nmds_points<span class="op">$</span>MDS2)</span>
<span id="cb5-12"><a href="microbiota.html#cb5-12"></a>    samples[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb5-13"><a href="microbiota.html#cb5-13"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb5-14"><a href="microbiota.html#cb5-14"></a>    samples &lt;-<span class="st"> </span><span class="kw">left_join</span>(samples, meta_data)</span>
<span id="cb5-15"><a href="microbiota.html#cb5-15"></a>    stress &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Stress=&quot;</span>, <span class="kw">round</span>(micro.mds<span class="op">$</span>stress, <span class="dt">digits =</span> <span class="dv">3</span>))</span>
<span id="cb5-16"><a href="microbiota.html#cb5-16"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(samples, <span class="kw">aes</span>(<span class="dt">x =</span> nmds_points.MDS1, <span class="dt">y =</span> nmds_points.MDS2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Species, </span>
<span id="cb5-17"><a href="microbiota.html#cb5-17"></a>        <span class="dt">alpha =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">shape =</span> <span class="st">&quot;Sponge species&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-18"><a href="microbiota.html#cb5-18"></a><span class="st">        </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;NMDS 1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;NMDS 2&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-19"><a href="microbiota.html#cb5-19"></a><span class="st">        </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">label =</span> stress)</span>
<span id="cb5-20"><a href="microbiota.html#cb5-20"></a>    <span class="kw">return</span>(p)</span>
<span id="cb5-21"><a href="microbiota.html#cb5-21"></a>}</span>
<span id="cb5-22"><a href="microbiota.html#cb5-22"></a></span>
<span id="cb5-23"><a href="microbiota.html#cb5-23"></a>untransformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(microbiome, meta_data, <span class="st">&quot;untransformed&quot;</span>)</span>
<span id="cb5-24"><a href="microbiota.html#cb5-24"></a>sqrt_transformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(<span class="kw">sqrt</span>(microbiome), meta_data, <span class="st">&quot;sqrt&quot;</span>)</span>
<span id="cb5-25"><a href="microbiota.html#cb5-25"></a>sqrt_wisc_transformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(<span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(microbiome)), meta_data, <span class="st">&quot;sqrt and wisconsin&quot;</span>)</span>
<span id="cb5-26"><a href="microbiota.html#cb5-26"></a></span>
<span id="cb5-27"><a href="microbiota.html#cb5-27"></a><span class="kw">grid.arrange</span>(untransformed, sqrt_transformed, sqrt_wisc_transformed, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">top =</span> <span class="st">&quot;NMDS: Impact of normalisation on discrimination of the microbiota&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:nmds"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/nmds-1.png" alt="NMDS of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb" width="672" />
<p class="caption">
Figure 3.3: NMDS of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb
</p>
</div>
<p>It seems that we donâ€™t lose any relevant information and the normalisations in fact increase the discriminatory power.</p>
</div>
<div id="alpha-diversity" class="section level2">
<h2><span class="header-section-number">3.2</span> Alpha diversity</h2>
<p>The microbiota are composed of 420 OTUs in <em>G. barretti</em>, 461 OTUs in <em>S. fortis</em> and 135 OTUs in <em>W. bursa</em>. While <em>G. barretti</em> and <em>S. fortis</em> share 316, respectively they each only share 2 and 8 OTUs with <em>W. bursa</em>. Only a single OTU (OTU4 or X1969004, an Archaeon) is shared among the three sponge hosts.</p>
<p>How does that reflect in their diversities? Below we show Shannon diversity, species richness (SR) and Faithâ€™s phylogenetic distance (PD).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="microbiota.html#cb6-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb6-2"><a href="microbiota.html#cb6-2"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb6-3"><a href="microbiota.html#cb6-3"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb6-4"><a href="microbiota.html#cb6-4"></a><span class="kw">library</span>(picante)</span>
<span id="cb6-5"><a href="microbiota.html#cb6-5"></a></span>
<span id="cb6-6"><a href="microbiota.html#cb6-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb6-7"><a href="microbiota.html#cb6-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb6-8"><a href="microbiota.html#cb6-8"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb6-9"><a href="microbiota.html#cb6-9"></a>tree &lt;-<span class="st"> </span><span class="kw">read.nexus</span>(<span class="st">&quot;data/infile.nex.con.X.tre&quot;</span>)</span>
<span id="cb6-10"><a href="microbiota.html#cb6-10"></a></span>
<span id="cb6-11"><a href="microbiota.html#cb6-11"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome<span class="op">$</span>Sample_ID</span>
<span id="cb6-12"><a href="microbiota.html#cb6-12"></a>microbiome<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb6-13"><a href="microbiota.html#cb6-13"></a>otumat &lt;-<span class="st"> </span><span class="kw">t</span>(microbiome)</span>
<span id="cb6-14"><a href="microbiota.html#cb6-14"></a>otumat &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(otumat))</span>
<span id="cb6-15"><a href="microbiota.html#cb6-15"></a><span class="kw">colnames</span>(otumat) &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb6-16"><a href="microbiota.html#cb6-16"></a><span class="kw">rownames</span>(taxonomy) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, taxonomy<span class="op">$</span>OTU_ID)</span>
<span id="cb6-17"><a href="microbiota.html#cb6-17"></a>taxonomy<span class="op">$</span>OTU_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb6-18"><a href="microbiota.html#cb6-18"></a><span class="co"># all(rownames(taxonomy)==rownames(otumat))</span></span>
<span id="cb6-19"><a href="microbiota.html#cb6-19"></a></span>
<span id="cb6-20"><a href="microbiota.html#cb6-20"></a><span class="co"># relative abundance</span></span>
<span id="cb6-21"><a href="microbiota.html#cb6-21"></a>otumat &lt;-<span class="st"> </span><span class="kw">apply</span>(otumat, <span class="dv">2</span>, <span class="cf">function</span>(i) i<span class="op">/</span><span class="kw">sum</span>(i))</span>
<span id="cb6-22"><a href="microbiota.html#cb6-22"></a>OTU &lt;-<span class="st"> </span><span class="kw">otu_table</span>(otumat, <span class="dt">taxa_are_rows =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-23"><a href="microbiota.html#cb6-23"></a><span class="co"># remove low abundance taxa OTU &lt;- filter_taxa(OTU, function(x) mean(x) &gt; 0.0025,</span></span>
<span id="cb6-24"><a href="microbiota.html#cb6-24"></a><span class="co"># TRUE)</span></span>
<span id="cb6-25"><a href="microbiota.html#cb6-25"></a>taxmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(taxonomy)</span>
<span id="cb6-26"><a href="microbiota.html#cb6-26"></a>TAX &lt;-<span class="st"> </span><span class="kw">tax_table</span>(taxmat)</span>
<span id="cb6-27"><a href="microbiota.html#cb6-27"></a>biom_data &lt;-<span class="st"> </span><span class="kw">phyloseq</span>(OTU, TAX)</span>
<span id="cb6-28"><a href="microbiota.html#cb6-28"></a><span class="co"># Merge into phyloseq object</span></span>
<span id="cb6-29"><a href="microbiota.html#cb6-29"></a>pso &lt;-<span class="st"> </span><span class="kw">merge_phyloseq</span>(biom_data, tree)  <span class="co">#merging a phyloseq and a tree file</span></span>
<span id="cb6-30"><a href="microbiota.html#cb6-30"></a>pso &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(<span class="kw">taxa_sums</span>(pso) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, pso)</span>
<span id="cb6-31"><a href="microbiota.html#cb6-31"></a></span>
<span id="cb6-32"><a href="microbiota.html#cb6-32"></a><span class="co"># Calculate Phylogenetic Distance (PD) of the dataset, ALPHA DIVERSITY</span></span>
<span id="cb6-33"><a href="microbiota.html#cb6-33"></a>otu_table_pso &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(pso<span class="op">@</span>otu_table)</span>
<span id="cb6-34"><a href="microbiota.html#cb6-34"></a>df.pd &lt;-<span class="st"> </span><span class="kw">pd</span>(<span class="kw">t</span>(otu_table_pso), tree, <span class="dt">include.root =</span> F)</span>
<span id="cb6-35"><a href="microbiota.html#cb6-35"></a>df.pd[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df.pd)</span>
<span id="cb6-36"><a href="microbiota.html#cb6-36"></a><span class="co"># df.pd: PD = Faith&#39;s Phylogenetic diversity, SR= species richness</span></span>
<span id="cb6-37"><a href="microbiota.html#cb6-37"></a>div &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">diversity</span>(<span class="kw">t</span>(otumat), <span class="dt">index =</span> <span class="st">&quot;shannon&quot;</span>))</span>
<span id="cb6-38"><a href="microbiota.html#cb6-38"></a>div[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(<span class="kw">rownames</span>(div), <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb6-39"><a href="microbiota.html#cb6-39"></a><span class="kw">colnames</span>(div) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Shannon_diversity&quot;</span>, <span class="st">&quot;spec&quot;</span>)</span>
<span id="cb6-40"><a href="microbiota.html#cb6-40"></a>div[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(div)</span>
<span id="cb6-41"><a href="microbiota.html#cb6-41"></a>div_indices &lt;-<span class="st"> </span><span class="kw">full_join</span>(div, df.pd)</span>
<span id="cb6-42"><a href="microbiota.html#cb6-42"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb6-43"><a href="microbiota.html#cb6-43"></a>div_indices &lt;-<span class="st"> </span><span class="kw">left_join</span>(div_indices, md)</span>
<span id="cb6-44"><a href="microbiota.html#cb6-44"></a></span>
<span id="cb6-45"><a href="microbiota.html#cb6-45"></a>div_indices &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(div_indices, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>))</span>
<span id="cb6-46"><a href="microbiota.html#cb6-46"></a><span class="kw">ggplot</span>(div_indices, <span class="kw">aes</span>(<span class="dt">x =</span> Depth, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(variable), </span>
<span id="cb6-47"><a href="microbiota.html#cb6-47"></a>    <span class="kw">vars</span>(spec), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, </span>
<span id="cb6-48"><a href="microbiota.html#cb6-48"></a>    <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust =</span> <span class="dv">1</span>), <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Diversity metrics&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-49"><a href="microbiota.html#cb6-49"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Sample depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<div class="figure"><span id="fig:a-diversities"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/a-diversities-1.png" alt="Microbiota diversity indices grouped by sponge species and ordered by sample depth." width="672" />
<p class="caption">
Figure 3.4: Microbiota diversity indices grouped by sponge species and ordered by sample depth.
</p>
</div>
<p>We see that the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> not only have more OTUs but also a higher diversity in their prokaryotic communities then the LMA sponge <em>W. bursa</em>.</p>
</div>
<div id="beta-diversity" class="section level2">
<h2><span class="header-section-number">3.3</span> Beta diversity</h2>
<p>In a way, the Fig. <a href="microbiota.html#fig:microbiome-pca">3.2</a> and <a href="microbiota.html#fig:nmds">3.3</a> have already shown us the beta diversity in our samples. Looking more into the data, we found that the two dimensional representation can be misleading at times and so we provide the first three axes components for exploration below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="microbiota.html#cb7-1"></a><span class="kw">library</span>(plot3D)</span>
<span id="cb7-2"><a href="microbiota.html#cb7-2"></a><span class="kw">library</span>(rgl)</span>
<span id="cb7-3"><a href="microbiota.html#cb7-3"></a><span class="kw">library</span>(plotly)</span>
<span id="cb7-4"><a href="microbiota.html#cb7-4"></a></span>
<span id="cb7-5"><a href="microbiota.html#cb7-5"></a><span class="co">### PCA</span></span>
<span id="cb7-6"><a href="microbiota.html#cb7-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb7-7"><a href="microbiota.html#cb7-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb7-8"><a href="microbiota.html#cb7-8"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb7-9"><a href="microbiota.html#cb7-9"></a></span>
<span id="cb7-10"><a href="microbiota.html#cb7-10"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb7-11"><a href="microbiota.html#cb7-11"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb7-12"><a href="microbiota.html#cb7-12"></a>microbiome &lt;-<span class="st"> </span><span class="kw">sqrt</span>(microbiome)</span>
<span id="cb7-13"><a href="microbiota.html#cb7-13"></a>micro.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(microbiome, <span class="dt">scale =</span> T)</span>
<span id="cb7-14"><a href="microbiota.html#cb7-14"></a>k &lt;-<span class="st"> </span><span class="kw">summary</span>(micro.pca)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb7-15"><a href="microbiota.html#cb7-15"></a>micro_pca_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(micro.pca<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb7-16"><a href="microbiota.html#cb7-16"></a>micro_pca_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(micro_pca_df))</span>
<span id="cb7-17"><a href="microbiota.html#cb7-17"></a>x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb7-18"><a href="microbiota.html#cb7-18"></a>y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb7-19"><a href="microbiota.html#cb7-19"></a>z1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC3&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">3</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb7-20"><a href="microbiota.html#cb7-20"></a>micro_pca_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(micro_pca_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], meta_data[, </span>
<span id="cb7-21"><a href="microbiota.html#cb7-21"></a>    <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, </span>
<span id="cb7-22"><a href="microbiota.html#cb7-22"></a>        <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb7-23"><a href="microbiota.html#cb7-23"></a></span>
<span id="cb7-24"><a href="microbiota.html#cb7-24"></a><span class="co"># ggplot(micro_pca_df, aes(x=PC1, y=PC2))+geom_point(size=3,</span></span>
<span id="cb7-25"><a href="microbiota.html#cb7-25"></a><span class="co"># mapping=aes(shape=factor(Species),</span></span>
<span id="cb7-26"><a href="microbiota.html#cb7-26"></a><span class="co"># col=Depth))+ggtitle(my_title)+xlab(x1)+ylab(y1)+labs(shape=&#39;Species&#39;)+theme_bw()+theme(legend.position</span></span>
<span id="cb7-27"><a href="microbiota.html#cb7-27"></a><span class="co"># = &#39;none&#39;)</span></span>
<span id="cb7-28"><a href="microbiota.html#cb7-28"></a></span>
<span id="cb7-29"><a href="microbiota.html#cb7-29"></a><span class="co">## rgl/plot3D</span></span>
<span id="cb7-30"><a href="microbiota.html#cb7-30"></a><span class="kw">with</span>(micro_pca_df, <span class="kw">text3D</span>(PC1, PC2, PC3, <span class="dt">colvar =</span> micro_pca_df<span class="op">$</span>Depth, <span class="dt">theta =</span> <span class="dv">60</span>, </span>
<span id="cb7-31"><a href="microbiota.html#cb7-31"></a>    <span class="dt">phi =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> x1, <span class="dt">ylab =</span> y1, <span class="dt">zlab =</span> z1, <span class="dt">main =</span> <span class="st">&quot;3D microbiome PCA&quot;</span>, <span class="dt">labels =</span> micro_pca_df<span class="op">$</span>unified_ID, </span>
<span id="cb7-32"><a href="microbiota.html#cb7-32"></a>    <span class="dt">cex =</span> <span class="fl">0.9</span>, <span class="dt">bty =</span> <span class="st">&quot;g&quot;</span>, <span class="dt">ticktype =</span> <span class="st">&quot;detailed&quot;</span>, <span class="dt">d =</span> <span class="dv">2</span>, <span class="dt">clab =</span> <span class="kw">c</span>(<span class="st">&quot;Depth [m]&quot;</span>), <span class="dt">adj =</span> <span class="fl">0.5</span>, </span>
<span id="cb7-33"><a href="microbiota.html#cb7-33"></a>    <span class="dt">font =</span> <span class="dv">2</span>))</span></code></pre></div>
<div class="figure"><span id="fig:b-divPCA"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/b-divPCA-1.png" alt="PCA of the met" width="672" />
<p class="caption">
Figure 3.5: PCA of the met
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="microbiota.html#cb8-1"></a><span class="co">## plotly</span></span>
<span id="cb8-2"><a href="microbiota.html#cb8-2"></a>axx &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, </span>
<span id="cb8-3"><a href="microbiota.html#cb8-3"></a>    <span class="dt">title =</span> x1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-4"><a href="microbiota.html#cb8-4"></a></span>
<span id="cb8-5"><a href="microbiota.html#cb8-5"></a>axy &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, </span>
<span id="cb8-6"><a href="microbiota.html#cb8-6"></a>    <span class="dt">title =</span> y1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-7"><a href="microbiota.html#cb8-7"></a></span>
<span id="cb8-8"><a href="microbiota.html#cb8-8"></a>axz &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, </span>
<span id="cb8-9"><a href="microbiota.html#cb8-9"></a>    <span class="dt">title =</span> z1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-10"><a href="microbiota.html#cb8-10"></a></span>
<span id="cb8-11"><a href="microbiota.html#cb8-11"></a>mic_i &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(micro_pca_df, <span class="dt">x =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC1, <span class="dt">y =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC2, <span class="dt">z =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC3, </span>
<span id="cb8-12"><a href="microbiota.html#cb8-12"></a>    <span class="dt">symbol =</span> <span class="op">~</span>Species, <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;circle&quot;</span>), <span class="dt">color =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>Depth) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-13"><a href="microbiota.html#cb8-13"></a><span class="st">    </span><span class="kw">add_markers</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layout</span>(<span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> axx, <span class="dt">yaxis =</span> axy, <span class="dt">zaxis =</span> axz))</span>
<span id="cb8-14"><a href="microbiota.html#cb8-14"></a>mic_i</span></code></pre></div>
<div class="figure"><span id="fig:b-divPCA"></span>
<div id="htmlwidget-fcb458792e1e25e0a890" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-fcb458792e1e25e0a890">{"x":{"visdat":{"40d0193c434a":["function () ","plotlyVisDat"]},"cur_data":"40d0193c434a","attrs":{"40d0193c434a":{"x":{},"y":{},"z":{},"color":{},"symbol":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"symbols":["diamond","x","circle"],"type":"scatter3d","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC1 18.5 %","showbackground":true},"yaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC2 9.8 %","showbackground":true},"zaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC3 8.1 %","showbackground":true}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-9.16017959106023,-9.12603414651757,-9.7203032613347,-7.81092384946648,-13.0783141579715,-11.4452930543219,-10.8754192788506,-9.09296069724172,-8.56932990321382,-7.44482056110354,-4.05319775249838,-12.6423140534378,-13.8091240789086,-21.8941070191161],"y":[11.6817254313368,11.7967413086439,1.3066169790786,1.82562208673323,-2.38547391078717,-1.21053959258772,8.3578063062921,12.8114901307763,11.3583046784118,10.2223526029249,7.43887849413778,13.498381637086,10.0454283127158,12.8663402789811],"z":[-5.9560418711539,-2.27781454238503,12.4733599737255,15.8620779791857,17.874159481195,22.9744899085815,-6.12395945156392,-5.97023704180219,-1.12722862952476,1.90880706351532,-4.10188826527539,-1.83669505665996,-3.17910089934022,-1.71845346354704],"type":"scatter3d","mode":"markers","name":"Geodia barretti","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744],"symbol":"diamond","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744]}},"frame":null},{"x":[-5.85130984524605,-4.35717099193864,-2.31314110328321,-9.76163755990342,-6.68975749081645,-12.1300774175099,-7.76157208182746,-2.6265551244536,-2.95785642347056,0.614339473933696,-5.23302503060812,-2.81840842435754,-8.16251916457826,-1.50874172279474,-6.34357020985989],"y":[-5.47469052438565,-12.1200687789487,-8.71497180140628,-11.9865866390643,-11.6526148253503,-17.0640375442191,-17.7632871749541,2.34118706123219,-4.58179094488733,1.49038592101216,-2.15157254350234,-6.65397046738693,-12.2793618339286,-7.91724009273525,-15.7139655834283],"z":[-15.3887130482298,-4.88739726613558,-1.76922522269387,7.95634228981677,3.042543154274,11.6270979023578,-0.880237819921141,-5.26216122675088,-1.69472816392325,-1.50882290203579,-5.28185068529196,-7.54451229733588,-16.3081422848649,-9.59160499629076,-9.49996512011797],"type":"scatter3d","mode":"markers","name":"Stryphnus fortis","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036],"symbol":"x","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036]}},"frame":null},{"x":[16.8814203804402,12.6174296015981,13.7076741757058,13.8646435852252,13.4827780838861,14.9483497646355,12.3535565451072,15.2360985336132,14.7830922816336,18.9679358276459,12.2362612341106,14.1915396044443,12.8500746008627,12.3435959334409,12.466391305313,15.692483064095],"y":[1.94266996753728,0.985959450626294,1.21444310505017,1.21273227181074,1.1417859464487,1.39688715303184,0.858537844864689,1.38199729370228,1.43249715507745,2.39024003039716,0.939097910413294,1.26433935575974,1.05533285666276,0.925731151210875,0.927091403989006,1.55956813162713],"z":[1.87480403704825,0.79032739413262,1.10128899911075,1.0521807372603,0.950861406425429,1.19272340863659,0.561618756173645,1.1110741030316,1.33859931883458,2.48136512675343,0.772166944219673,1.2637042579897,0.98603522670514,0.715889248500856,0.611163081805662,1.3861004555646],"type":"scatter3d","mode":"markers","name":"Weberella bursa","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728],"symbol":"circle","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728]}},"frame":null},{"x":[-21.8941070191161,18.9679358276459],"y":[-17.7632871749541,13.498381637086],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[244,1476],"line":{"color":"rgba(214,39,40,1)"}},"z":[-16.3081422848649,22.9744899085815],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.5: PCA of the met
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="microbiota.html#cb9-1"></a>f &lt;-<span class="st"> </span><span class="kw">basename</span>(<span class="kw">tempfile</span>(<span class="st">&quot;PCA_microbiome_plotly&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;.html&quot;</span>))</span>
<span id="cb9-2"><a href="microbiota.html#cb9-2"></a><span class="kw">on.exit</span>(<span class="kw">unlink</span>(f), <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb9-3"><a href="microbiota.html#cb9-3"></a>html &lt;-<span class="st"> </span>htmlwidgets<span class="op">::</span><span class="kw">saveWidget</span>(mic_i, f)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="microbiota.html#cb10-1"></a><span class="kw">library</span>(plot3D)</span>
<span id="cb10-2"><a href="microbiota.html#cb10-2"></a><span class="kw">library</span>(rgl)</span>
<span id="cb10-3"><a href="microbiota.html#cb10-3"></a><span class="kw">library</span>(plotly)</span>
<span id="cb10-4"><a href="microbiota.html#cb10-4"></a></span>
<span id="cb10-5"><a href="microbiota.html#cb10-5"></a><span class="co">### PCA</span></span>
<span id="cb10-6"><a href="microbiota.html#cb10-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb10-7"><a href="microbiota.html#cb10-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb10-8"><a href="microbiota.html#cb10-8"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb10-9"><a href="microbiota.html#cb10-9"></a></span>
<span id="cb10-10"><a href="microbiota.html#cb10-10"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb10-11"><a href="microbiota.html#cb10-11"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb10-12"><a href="microbiota.html#cb10-12"></a></span>
<span id="cb10-13"><a href="microbiota.html#cb10-13"></a>micro.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(microbiome, <span class="dt">scale =</span> T)</span>
<span id="cb10-14"><a href="microbiota.html#cb10-14"></a>k &lt;-<span class="st"> </span><span class="kw">summary</span>(micro.pca)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb10-15"><a href="microbiota.html#cb10-15"></a>micro_pca_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(micro.pca<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb10-16"><a href="microbiota.html#cb10-16"></a>micro_pca_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(micro_pca_df))</span>
<span id="cb10-17"><a href="microbiota.html#cb10-17"></a>x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb10-18"><a href="microbiota.html#cb10-18"></a>y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb10-19"><a href="microbiota.html#cb10-19"></a>z1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC3&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">3</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb10-20"><a href="microbiota.html#cb10-20"></a>micro_pca_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(micro_pca_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], meta_data[, </span>
<span id="cb10-21"><a href="microbiota.html#cb10-21"></a>    <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, </span>
<span id="cb10-22"><a href="microbiota.html#cb10-22"></a>        <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb10-23"><a href="microbiota.html#cb10-23"></a></span>
<span id="cb10-24"><a href="microbiota.html#cb10-24"></a><span class="co"># ggplot(micro_pca_df, aes(x=PC1, y=PC2))+geom_point(size=3,</span></span>
<span id="cb10-25"><a href="microbiota.html#cb10-25"></a><span class="co"># mapping=aes(shape=factor(Species),</span></span>
<span id="cb10-26"><a href="microbiota.html#cb10-26"></a><span class="co"># col=Depth))+ggtitle(my_title)+xlab(x1)+ylab(y1)+labs(shape=&#39;Species&#39;)+theme_bw()+theme(legend.position</span></span>
<span id="cb10-27"><a href="microbiota.html#cb10-27"></a><span class="co"># = &#39;none&#39;)</span></span>
<span id="cb10-28"><a href="microbiota.html#cb10-28"></a></span>
<span id="cb10-29"><a href="microbiota.html#cb10-29"></a><span class="co"># with(micro_pca_df, scatter3D(x = PC1, y = PC2, z = -PC3, colvar</span></span>
<span id="cb10-30"><a href="microbiota.html#cb10-30"></a><span class="co"># =micro_pca_df$Depth, pch = 16, cex = 1.5, xlab =x1, ylab =y1, zlab =z1, clab =</span></span>
<span id="cb10-31"><a href="microbiota.html#cb10-31"></a><span class="co"># c(&#39;Depth&#39;,&#39;m&#39;), main = &#39;3D microbiome PCA&#39;, ticktype = &#39;detailed&#39;, theta = 10,</span></span>
<span id="cb10-32"><a href="microbiota.html#cb10-32"></a><span class="co"># d = 2, colkey = list(length = 0.5, width = 0.5, cex.clab = 0.75)))</span></span>
<span id="cb10-33"><a href="microbiota.html#cb10-33"></a></span>
<span id="cb10-34"><a href="microbiota.html#cb10-34"></a><span class="co"># ks1 scatter3D(x=micro_pca_df$PC1, y=micro_pca_df$PC2, micro_pca_df$PC3) #works</span></span>
<span id="cb10-35"><a href="microbiota.html#cb10-35"></a></span>
<span id="cb10-36"><a href="microbiota.html#cb10-36"></a><span class="co"># crude #KEEP scatter3D(x=micro_pca_df$PC1, y=micro_pca_df$PC2, micro_pca_df$PC3,</span></span>
<span id="cb10-37"><a href="microbiota.html#cb10-37"></a><span class="co"># phi = 0, bty = &#39;g&#39;,pch = 20, cex = 2, ticktype = &#39;detailed&#39;)</span></span>
<span id="cb10-38"><a href="microbiota.html#cb10-38"></a></span>
<span id="cb10-39"><a href="microbiota.html#cb10-39"></a><span class="co"># scatter3D(x=micro_pca_df$PC1, y=micro_pca_df$PC2, micro_pca_df$PC3, phi = 0,</span></span>
<span id="cb10-40"><a href="microbiota.html#cb10-40"></a><span class="co"># labels = micro_pca_df$unified_ID, bty = &#39;g&#39;,pch = 20, cex = 2, ticktype =</span></span>
<span id="cb10-41"><a href="microbiota.html#cb10-41"></a><span class="co"># &#39;detailed&#39;,colvar = micro_pca_df$Depth)</span></span>
<span id="cb10-42"><a href="microbiota.html#cb10-42"></a></span>
<span id="cb10-43"><a href="microbiota.html#cb10-43"></a><span class="co"># rgl/plot3D</span></span>
<span id="cb10-44"><a href="microbiota.html#cb10-44"></a><span class="kw">with</span>(micro_pca_df, <span class="kw">text3D</span>(PC1, PC2, PC3, <span class="dt">colvar =</span> micro_pca_df<span class="op">$</span>Depth, <span class="dt">theta =</span> <span class="dv">60</span>, </span>
<span id="cb10-45"><a href="microbiota.html#cb10-45"></a>    <span class="dt">phi =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> x1, <span class="dt">ylab =</span> y1, <span class="dt">zlab =</span> z1, <span class="dt">main =</span> <span class="st">&quot;3D microbiome PCA&quot;</span>, <span class="dt">labels =</span> micro_pca_df<span class="op">$</span>unified_ID, </span>
<span id="cb10-46"><a href="microbiota.html#cb10-46"></a>    <span class="dt">cex =</span> <span class="fl">0.9</span>, <span class="dt">bty =</span> <span class="st">&quot;g&quot;</span>, <span class="dt">ticktype =</span> <span class="st">&quot;detailed&quot;</span>, <span class="dt">d =</span> <span class="dv">2</span>, <span class="dt">clab =</span> <span class="kw">c</span>(<span class="st">&quot;Depth [m]&quot;</span>), <span class="dt">adj =</span> <span class="fl">0.5</span>, </span>
<span id="cb10-47"><a href="microbiota.html#cb10-47"></a>    <span class="dt">font =</span> <span class="dv">2</span>))</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="microbiota.html#cb11-1"></a><span class="co">## plotly</span></span>
<span id="cb11-2"><a href="microbiota.html#cb11-2"></a>axx &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, </span>
<span id="cb11-3"><a href="microbiota.html#cb11-3"></a>    <span class="dt">title =</span> x1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-4"><a href="microbiota.html#cb11-4"></a></span>
<span id="cb11-5"><a href="microbiota.html#cb11-5"></a>axy &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, </span>
<span id="cb11-6"><a href="microbiota.html#cb11-6"></a>    <span class="dt">title =</span> y1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-7"><a href="microbiota.html#cb11-7"></a></span>
<span id="cb11-8"><a href="microbiota.html#cb11-8"></a>axz &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, </span>
<span id="cb11-9"><a href="microbiota.html#cb11-9"></a>    <span class="dt">title =</span> z1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-10"><a href="microbiota.html#cb11-10"></a></span>
<span id="cb11-11"><a href="microbiota.html#cb11-11"></a>mic_i &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(micro_pca_df, <span class="dt">x =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC1, <span class="dt">y =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC2, <span class="dt">z =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC3, </span>
<span id="cb11-12"><a href="microbiota.html#cb11-12"></a>    <span class="dt">symbol =</span> <span class="op">~</span>Species, <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;circle&quot;</span>), <span class="dt">color =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>Depth) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-13"><a href="microbiota.html#cb11-13"></a><span class="st">    </span><span class="kw">add_markers</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layout</span>(<span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> axx, <span class="dt">yaxis =</span> axy, <span class="dt">zaxis =</span> axz))</span>
<span id="cb11-14"><a href="microbiota.html#cb11-14"></a>mic_i</span></code></pre></div>
<div id="htmlwidget-7301c2aac688750a62fe" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7301c2aac688750a62fe">{"x":{"visdat":{"40d059ef823e":["function () ","plotlyVisDat"]},"cur_data":"40d059ef823e","attrs":{"40d059ef823e":{"x":{},"y":{},"z":{},"color":{},"symbol":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"symbols":["diamond","x","circle"],"type":"scatter3d","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC1 15.5 %","showbackground":true},"yaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC2 9.6 %","showbackground":true},"zaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC3 8.3 %","showbackground":true}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-8.7640710136495,-7.99245054557547,-8.72961942808486,-5.32303073778916,-13.2628012488319,-12.9990982180102,-7.43516360453514,-11.3775575889197,-9.97842261967914,-2.9894559558503,-0.735096201706143,-12.3370290180724,-13.144922377491,-31.5019600692898],"y":[9.90122222810311,9.98498915913403,0.588075358377457,1.16040222763125,-3.50139881263821,-2.60897459024596,5.52892230012069,12.7385629631271,10.5601970881489,6.79934559510791,5.3831555307002,11.4246201937546,8.02220904876705,14.7947252507445],"z":[-6.15783367840562,-2.57747716649009,10.5590904786648,11.2743759096936,15.9001590480987,22.8511326739226,-5.23550696394468,-7.59852682122288,-1.41964127294337,1.06014993828589,-2.68559635760316,-2.41384839948643,-4.19917926275331,-4.09006140717394],"type":"scatter3d","mode":"markers","name":"Geodia barretti","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744],"symbol":"diamond","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744]}},"frame":null},{"x":[-1.64582556179179,0.164239631987932,2.38702761159634,-7.55172387421327,-3.96744483069665,-12.0999234478026,-4.46013297849178,0.150871478146571,-0.297207630889947,2.02334921610431,-3.41661125752398,1.29630137417188,-9.0099319507173,2.36620370756672,-2.31619466956273],"y":[-6.57537718845966,-9.30148615126177,-4.85818123931695,-11.9592825522603,-10.9837621968868,-20.0122599898283,-16.1737427037662,1.36153570317398,-3.72352900972945,1.61583622086002,-2.6856982945978,-4.91658920949453,-20.2748599346528,-5.95218682777455,-15.3366762975596],"z":[-12.8985541438648,-3.35582044451899,-0.757302846408191,8.26203748304619,3.84114976181392,14.548908861455,0.175300722298067,-3.6261248530689,-0.235281353339061,-0.378219825299648,-4.27105914626862,-4.9136808646691,-25.5121790044315,-6.25558903753024,-8.53328840708558],"type":"scatter3d","mode":"markers","name":"Stryphnus fortis","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036],"symbol":"x","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036]}},"frame":null},{"x":[14.3485617498973,9.93368867120338,10.9143675151952,11.0219153934812,10.4729527792412,11.7373567876835,9.8136766471354,12.8841473552207,12.1613456816119,16.2362033703268,9.48651226339529,11.3690939735499,9.62404278257706,9.83345747627132,10.1499313033676,12.9604280594436],"y":[3.75028685146477,1.87181536009522,2.26758884760512,2.25880447291012,2.05678425428319,2.47884900498897,1.69770829728272,2.79895758770615,2.76265480346159,4.54544722598727,1.74258184141122,2.36063788964296,1.79073396480868,1.81604913087207,1.83926886970951,2.9620377284928],"z":[2.02895418888056,0.84610723024614,1.11996262093418,1.07954088750976,0.938765709739901,1.13356005573909,0.59469360816303,1.20339327860961,1.42135281729695,2.55803409362739,0.798763817569786,1.17951399255287,0.851507810525444,0.801198946156952,0.673677425849587,1.4134398958281],"type":"scatter3d","mode":"markers","name":"Weberella bursa","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728],"symbol":"circle","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728]}},"frame":null},{"x":[-31.5019600692898,16.2362033703268],"y":[-20.2748599346528,14.7947252507445],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[244,1476],"line":{"color":"rgba(214,39,40,1)"}},"z":[-25.5121790044315,22.8511326739226],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="microbiota.html#cb12-1"></a>f &lt;-<span class="st"> </span><span class="kw">basename</span>(<span class="kw">tempfile</span>(<span class="st">&quot;PCA_microbiome_plotly&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;.html&quot;</span>))</span>
<span id="cb12-2"><a href="microbiota.html#cb12-2"></a><span class="kw">on.exit</span>(<span class="kw">unlink</span>(f), <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb12-3"><a href="microbiota.html#cb12-3"></a>html &lt;-<span class="st"> </span>htmlwidgets<span class="op">::</span><span class="kw">saveWidget</span>(mic_i, f)</span></code></pre></div>
<p>In some of the downstream analyses, we distinguish between common/abundant OTUs and rare OTUs. We use a cutoff of 0.25% average relative abundance per OTU for the classification. That implies drastically modifying the original numbers of OTUs per sponge as outlined below.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="microbiota.html#cb13-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb13-2"><a href="microbiota.html#cb13-2"></a>emp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/SpongeEMP.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb13-3"><a href="microbiota.html#cb13-3"></a></span>
<span id="cb13-4"><a href="microbiota.html#cb13-4"></a>emp[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;X196900&quot;</span>)</span>
<span id="cb13-5"><a href="microbiota.html#cb13-5"></a><span class="co"># The full data set had the entries listed by sponge host, so there are 62</span></span>
<span id="cb13-6"><a href="microbiota.html#cb13-6"></a><span class="co"># duplicates in the OTU list length(emp$XOTU_id) # 207</span></span>
<span id="cb13-7"><a href="microbiota.html#cb13-7"></a><span class="co"># length(unique(emp$XOTU_id)) # 145</span></span>
<span id="cb13-8"><a href="microbiota.html#cb13-8"></a>emp[<span class="st">&quot;num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb13-9"><a href="microbiota.html#cb13-9"></a>emp &lt;-<span class="st"> </span>emp[<span class="kw">order</span>(emp<span class="op">$</span>num), ]</span>
<span id="cb13-10"><a href="microbiota.html#cb13-10"></a>emp[<span class="st">&quot;dup&quot;</span>] &lt;-<span class="st"> </span><span class="kw">duplicated</span>(emp<span class="op">$</span>num)</span>
<span id="cb13-11"><a href="microbiota.html#cb13-11"></a><span class="co"># dim(emp[emp$dup==&#39;TRUE&#39;,]) #62</span></span>
<span id="cb13-12"><a href="microbiota.html#cb13-12"></a>emp &lt;-<span class="st"> </span>emp[emp<span class="op">$</span>dup <span class="op">==</span><span class="st"> &quot;FALSE&quot;</span>, ]</span>
<span id="cb13-13"><a href="microbiota.html#cb13-13"></a>emp[, <span class="kw">c</span>(<span class="st">&quot;sponge&quot;</span>, <span class="st">&quot;num&quot;</span>, <span class="st">&quot;dup&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb13-14"><a href="microbiota.html#cb13-14"></a></span>
<span id="cb13-15"><a href="microbiota.html#cb13-15"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb13-16"><a href="microbiota.html#cb13-16"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb13-17"><a href="microbiota.html#cb13-17"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb13-18"><a href="microbiota.html#cb13-18"></a>    <span class="co"># micro &lt;- sqrt(micro)</span></span>
<span id="cb13-19"><a href="microbiota.html#cb13-19"></a>    </span>
<span id="cb13-20"><a href="microbiota.html#cb13-20"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb13-21"><a href="microbiota.html#cb13-21"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb13-22"><a href="microbiota.html#cb13-22"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb13-23"><a href="microbiota.html#cb13-23"></a>    </span>
<span id="cb13-24"><a href="microbiota.html#cb13-24"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]  <span class="co">#removes columns that only contain 0</span></span>
<span id="cb13-25"><a href="microbiota.html#cb13-25"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb13-26"><a href="microbiota.html#cb13-26"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb13-27"><a href="microbiota.html#cb13-27"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb13-28"><a href="microbiota.html#cb13-28"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb13-29"><a href="microbiota.html#cb13-29"></a>}</span>
<span id="cb13-30"><a href="microbiota.html#cb13-30"></a></span>
<span id="cb13-31"><a href="microbiota.html#cb13-31"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb13-32"><a href="microbiota.html#cb13-32"></a></span>
<span id="cb13-33"><a href="microbiota.html#cb13-33"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb13-34"><a href="microbiota.html#cb13-34"></a>    mic &lt;-<span class="st"> </span>micro</span>
<span id="cb13-35"><a href="microbiota.html#cb13-35"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb13-36"><a href="microbiota.html#cb13-36"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb13-37"><a href="microbiota.html#cb13-37"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb13-38"><a href="microbiota.html#cb13-38"></a>    </span>
<span id="cb13-39"><a href="microbiota.html#cb13-39"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb13-40"><a href="microbiota.html#cb13-40"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb13-41"><a href="microbiota.html#cb13-41"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb13-42"><a href="microbiota.html#cb13-42"></a>    }</span>
<span id="cb13-43"><a href="microbiota.html#cb13-43"></a>    </span>
<span id="cb13-44"><a href="microbiota.html#cb13-44"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb13-45"><a href="microbiota.html#cb13-45"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb13-46"><a href="microbiota.html#cb13-46"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb13-47"><a href="microbiota.html#cb13-47"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb13-48"><a href="microbiota.html#cb13-48"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb13-49"><a href="microbiota.html#cb13-49"></a>}</span>
<span id="cb13-50"><a href="microbiota.html#cb13-50"></a></span>
<span id="cb13-51"><a href="microbiota.html#cb13-51"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb13-52"><a href="microbiota.html#cb13-52"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb13-53"><a href="microbiota.html#cb13-53"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb13-54"><a href="microbiota.html#cb13-54"></a></span>
<span id="cb13-55"><a href="microbiota.html#cb13-55"></a>gb_occurrence &lt;-<span class="st"> </span>gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb13-56"><a href="microbiota.html#cb13-56"></a>gb_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(gb_occurrence)</span>
<span id="cb13-57"><a href="microbiota.html#cb13-57"></a>gb_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_occurrence, emp)</span>
<span id="cb13-58"><a href="microbiota.html#cb13-58"></a></span>
<span id="cb13-59"><a href="microbiota.html#cb13-59"></a>sf_occurrence &lt;-<span class="st"> </span>sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb13-60"><a href="microbiota.html#cb13-60"></a>sf_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(sf_occurrence)</span>
<span id="cb13-61"><a href="microbiota.html#cb13-61"></a>sf_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_occurrence, emp)</span>
<span id="cb13-62"><a href="microbiota.html#cb13-62"></a></span>
<span id="cb13-63"><a href="microbiota.html#cb13-63"></a>wb_occurrence &lt;-<span class="st"> </span>wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb13-64"><a href="microbiota.html#cb13-64"></a>wb_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(wb_occurrence)</span>
<span id="cb13-65"><a href="microbiota.html#cb13-65"></a>wb_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(wb_occurrence, emp)</span>
<span id="cb13-66"><a href="microbiota.html#cb13-66"></a></span>
<span id="cb13-67"><a href="microbiota.html#cb13-67"></a>gb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(gb_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(gb_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb13-68"><a href="microbiota.html#cb13-68"></a>sf_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(sf_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(sf_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb13-69"><a href="microbiota.html#cb13-69"></a>wb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wb_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(wb_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb13-70"><a href="microbiota.html#cb13-70"></a></span>
<span id="cb13-71"><a href="microbiota.html#cb13-71"></a>aggr &lt;-<span class="st"> </span><span class="kw">cbind</span>(gb_aggr, sf_aggr<span class="op">$</span>x, wb_aggr<span class="op">$</span>x)</span>
<span id="cb13-72"><a href="microbiota.html#cb13-72"></a><span class="kw">colnames</span>(aggr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count Gb&quot;</span>, <span class="st">&quot;count Sf&quot;</span>, <span class="st">&quot;count Wb&quot;</span>)</span>
<span id="cb13-73"><a href="microbiota.html#cb13-73"></a></span>
<span id="cb13-74"><a href="microbiota.html#cb13-74"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb13-75"><a href="microbiota.html#cb13-75"></a><span class="kw">kable</span>(aggr, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count (Gb)&quot;</span>, <span class="st">&quot;count (Sf)&quot;</span>, <span class="st">&quot;count (Wb)&quot;</span>), </span>
<span id="cb13-76"><a href="microbiota.html#cb13-76"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Number of OTUs being excluded and retained in the three sponges&#39; microbiota when filtering for average relative abundance &gt; 0.25%.&quot;</span>, </span>
<span id="cb13-77"><a href="microbiota.html#cb13-77"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, </span>
<span id="cb13-78"><a href="microbiota.html#cb13-78"></a>    <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:filtering-low-abdc-1">Table 3.1: </span>Number of OTUs being excluded and retained in the three spongesâ€™ microbiota when filtering for average relative abundance &gt; 0.25%.
</caption>
<thead>
<tr>
<th style="text-align:left;">
OTU classification
</th>
<th style="text-align:right;">
count (Gb)
</th>
<th style="text-align:right;">
count (Sf)
</th>
<th style="text-align:right;">
count (Wb)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
common
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
rare
</td>
<td style="text-align:right;">
324
</td>
<td style="text-align:right;">
372
</td>
<td style="text-align:right;">
115
</td>
</tr>
</tbody>
</table>
<p>That means, for <em>G. barretti</em> we exclude 77.1 % of OTUs, for <em>S. fortis</em> 80.7 % and for <em>W. bursa</em> 85.2%.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="microbiota.html#cb14-1"></a>gb_common &lt;-<span class="st"> </span>gb_occ_emp[gb_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb14-2"><a href="microbiota.html#cb14-2"></a>sf_common &lt;-<span class="st"> </span>sf_occ_emp[sf_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb14-3"><a href="microbiota.html#cb14-3"></a>wb_common &lt;-<span class="st"> </span>wb_occ_emp[wb_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb14-4"><a href="microbiota.html#cb14-4"></a></span>
<span id="cb14-5"><a href="microbiota.html#cb14-5"></a>gb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(gb_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(gb_common<span class="op">$</span>spongeEMP_enriched), </span>
<span id="cb14-6"><a href="microbiota.html#cb14-6"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb14-7"><a href="microbiota.html#cb14-7"></a>sf_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(sf_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(sf_common<span class="op">$</span>spongeEMP_enriched), </span>
<span id="cb14-8"><a href="microbiota.html#cb14-8"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb14-9"><a href="microbiota.html#cb14-9"></a>wb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wb_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(wb_common<span class="op">$</span>spongeEMP_enriched), </span>
<span id="cb14-10"><a href="microbiota.html#cb14-10"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb14-11"><a href="microbiota.html#cb14-11"></a></span>
<span id="cb14-12"><a href="microbiota.html#cb14-12"></a>aggr &lt;-<span class="st"> </span><span class="kw">cbind</span>(gb_aggr, sf_aggr<span class="op">$</span>x)</span>
<span id="cb14-13"><a href="microbiota.html#cb14-13"></a>aggr &lt;-<span class="st"> </span><span class="kw">left_join</span>(aggr, wb_aggr, <span class="dt">by =</span> <span class="st">&quot;Group.1&quot;</span>)</span>
<span id="cb14-14"><a href="microbiota.html#cb14-14"></a><span class="kw">colnames</span>(aggr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;EMP OTU count&quot;</span>, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Wb&quot;</span>)</span>
<span id="cb14-15"><a href="microbiota.html#cb14-15"></a></span>
<span id="cb14-16"><a href="microbiota.html#cb14-16"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb14-17"><a href="microbiota.html#cb14-17"></a><span class="kw">kable</span>(aggr, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count (Gb)&quot;</span>, <span class="st">&quot;count (Sf)&quot;</span>, <span class="st">&quot;count (Wb)&quot;</span>), </span>
<span id="cb14-18"><a href="microbiota.html#cb14-18"></a>    <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Number of common/abundant OTUs found in the SpongeEMP data base&quot;</span>, </span>
<span id="cb14-19"><a href="microbiota.html#cb14-19"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, </span>
<span id="cb14-20"><a href="microbiota.html#cb14-20"></a>    <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:filtering-low-abdc-2">Table 3.2: </span>Number of common/abundant OTUs found in the SpongeEMP data base
</caption>
<thead>
<tr>
<th style="text-align:left;">
OTU classification
</th>
<th style="text-align:right;">
count (Gb)
</th>
<th style="text-align:right;">
count (Sf)
</th>
<th style="text-align:right;">
count (Wb)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
yes
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table>
</div>
<div id="EnvMod" class="section level2">
<h2><span class="header-section-number">3.4</span> Environmental modelling</h2>
<p>In order to investigate whether and which of the environmental parameter might â€œexplainâ€/correlate with variation the the microbiota, we apply <a href="microbiota.html#constrained">constrained</a> and <a href="microbiota.html#unconstrained">unconstrained</a> ecological data analysis methods.</p>
<div id="constrained" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Constrained modelling approach Automatic stepwise model building</h3>
<p>We use canonical correspondence analysis as method for ordination. According to the manual for the R package vegan, â€œa good dissimilarity index for multidimensional scaling should have a high rank-order similarity with gradient separationâ€ <span class="citation">(Oksanen et al. <a href="#ref-R-vegan" role="doc-biblioref">2019</a>)</span>. Thus interpreting the results of Tab <a href="microbiota.html#tab:rankindex">3.3</a>, we find that square root transformation and Wisconsin standardisation increase the rank correlation between the microbial community dissimilarity matrix and the environmental gradient separation in all three sponge microbiota for a number of ecological dissimilarity indices.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="microbiota.html#cb15-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb15-2"><a href="microbiota.html#cb15-2"></a></span>
<span id="cb15-3"><a href="microbiota.html#cb15-3"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb15-4"><a href="microbiota.html#cb15-4"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb15-5"><a href="microbiota.html#cb15-5"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb15-6"><a href="microbiota.html#cb15-6"></a></span>
<span id="cb15-7"><a href="microbiota.html#cb15-7"></a><span class="co"># Gb12 has no salinity and temperature: impute from Gb11 &amp; Gb13: Salinity:34.92;</span></span>
<span id="cb15-8"><a href="microbiota.html#cb15-8"></a><span class="co"># Temp:3.59</span></span>
<span id="cb15-9"><a href="microbiota.html#cb15-9"></a>row &lt;-<span class="st"> </span><span class="kw">which</span>(meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>)</span>
<span id="cb15-10"><a href="microbiota.html#cb15-10"></a>temp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBottomTemp_Cdeg&quot;</span>)</span>
<span id="cb15-11"><a href="microbiota.html#cb15-11"></a>sal &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBotSalinity_PSU&quot;</span>)</span>
<span id="cb15-12"><a href="microbiota.html#cb15-12"></a>meta_data[row, temp] &lt;-<span class="st"> </span><span class="fl">3.59</span></span>
<span id="cb15-13"><a href="microbiota.html#cb15-13"></a>meta_data[row, sal] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb15-14"><a href="microbiota.html#cb15-14"></a><span class="kw">rm</span>(row, temp, sal)</span>
<span id="cb15-15"><a href="microbiota.html#cb15-15"></a></span>
<span id="cb15-16"><a href="microbiota.html#cb15-16"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb15-17"><a href="microbiota.html#cb15-17"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb15-18"><a href="microbiota.html#cb15-18"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb15-19"><a href="microbiota.html#cb15-19"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb15-20"><a href="microbiota.html#cb15-20"></a>    </span>
<span id="cb15-21"><a href="microbiota.html#cb15-21"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb15-22"><a href="microbiota.html#cb15-22"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb15-23"><a href="microbiota.html#cb15-23"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb15-24"><a href="microbiota.html#cb15-24"></a>    </span>
<span id="cb15-25"><a href="microbiota.html#cb15-25"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb15-26"><a href="microbiota.html#cb15-26"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb15-27"><a href="microbiota.html#cb15-27"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb15-28"><a href="microbiota.html#cb15-28"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb15-29"><a href="microbiota.html#cb15-29"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb15-30"><a href="microbiota.html#cb15-30"></a>}</span>
<span id="cb15-31"><a href="microbiota.html#cb15-31"></a></span>
<span id="cb15-32"><a href="microbiota.html#cb15-32"></a>microbiomes &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb15-33"><a href="microbiota.html#cb15-33"></a></span>
<span id="cb15-34"><a href="microbiota.html#cb15-34"></a>md_prep &lt;-<span class="st"> </span><span class="cf">function</span>(microbiomes, meta_data) {</span>
<span id="cb15-35"><a href="microbiota.html#cb15-35"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb15-36"><a href="microbiota.html#cb15-36"></a>        <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb15-37"><a href="microbiota.html#cb15-37"></a>    </span>
<span id="cb15-38"><a href="microbiota.html#cb15-38"></a>    gb &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>gb</span>
<span id="cb15-39"><a href="microbiota.html#cb15-39"></a>    sf &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>sf</span>
<span id="cb15-40"><a href="microbiota.html#cb15-40"></a>    wb &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>wb</span>
<span id="cb15-41"><a href="microbiota.html#cb15-41"></a>    </span>
<span id="cb15-42"><a href="microbiota.html#cb15-42"></a>    gb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(gb), ]</span>
<span id="cb15-43"><a href="microbiota.html#cb15-43"></a>    <span class="kw">rownames</span>(gb_md) &lt;-<span class="st"> </span>gb_md<span class="op">$</span>unified_ID</span>
<span id="cb15-44"><a href="microbiota.html#cb15-44"></a>    gb_md &lt;-<span class="st"> </span>gb_md[<span class="kw">order</span>(gb_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb15-45"><a href="microbiota.html#cb15-45"></a>    <span class="kw">all</span>(<span class="kw">rownames</span>(microbiomes<span class="op">$</span>gb) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(gb_md))</span>
<span id="cb15-46"><a href="microbiota.html#cb15-46"></a>    gb_md &lt;-<span class="st"> </span>gb_md[, <span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, </span>
<span id="cb15-47"><a href="microbiota.html#cb15-47"></a>        <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb15-48"><a href="microbiota.html#cb15-48"></a>    </span>
<span id="cb15-49"><a href="microbiota.html#cb15-49"></a>    sf_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(sf), ]</span>
<span id="cb15-50"><a href="microbiota.html#cb15-50"></a>    <span class="kw">rownames</span>(sf_md) &lt;-<span class="st"> </span>sf_md<span class="op">$</span>unified_ID</span>
<span id="cb15-51"><a href="microbiota.html#cb15-51"></a>    sf_md &lt;-<span class="st"> </span>sf_md[<span class="kw">order</span>(sf_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb15-52"><a href="microbiota.html#cb15-52"></a>    sf_md<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb15-53"><a href="microbiota.html#cb15-53"></a>    wb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(wb), ]</span>
<span id="cb15-54"><a href="microbiota.html#cb15-54"></a>    <span class="kw">rownames</span>(wb_md) &lt;-<span class="st"> </span>wb_md<span class="op">$</span>unified_ID</span>
<span id="cb15-55"><a href="microbiota.html#cb15-55"></a>    wb_md &lt;-<span class="st"> </span>wb_md[<span class="kw">order</span>(wb_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb15-56"><a href="microbiota.html#cb15-56"></a>    wb_md<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb15-57"><a href="microbiota.html#cb15-57"></a>    </span>
<span id="cb15-58"><a href="microbiota.html#cb15-58"></a>    mds &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb_md =</span> gb_md, <span class="dt">sf_md =</span> sf_md, <span class="dt">wb_md =</span> wb_md)</span>
<span id="cb15-59"><a href="microbiota.html#cb15-59"></a>    <span class="kw">return</span>(mds)</span>
<span id="cb15-60"><a href="microbiota.html#cb15-60"></a>}</span>
<span id="cb15-61"><a href="microbiota.html#cb15-61"></a></span>
<span id="cb15-62"><a href="microbiota.html#cb15-62"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb15-63"><a href="microbiota.html#cb15-63"></a></span>
<span id="cb15-64"><a href="microbiota.html#cb15-64"></a><span class="co"># Standardization If there is a large difference between smallest non-zero</span></span>
<span id="cb15-65"><a href="microbiota.html#cb15-65"></a><span class="co"># abundance and largest abundance, we want to reduce this difference. Usually</span></span>
<span id="cb15-66"><a href="microbiota.html#cb15-66"></a><span class="co"># square root transformation is sufficient to balance the data. Wisconsin double</span></span>
<span id="cb15-67"><a href="microbiota.html#cb15-67"></a><span class="co"># standardization often improves the gradient detection ability of dissimilarity</span></span>
<span id="cb15-68"><a href="microbiota.html#cb15-68"></a><span class="co"># indices.</span></span>
<span id="cb15-69"><a href="microbiota.html#cb15-69"></a></span>
<span id="cb15-70"><a href="microbiota.html#cb15-70"></a><span class="co"># Which dissimilarity index is best?</span></span>
<span id="cb15-71"><a href="microbiota.html#cb15-71"></a>gb_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), (microbiomes<span class="op">$</span>gb)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, </span>
<span id="cb15-72"><a href="microbiota.html#cb15-72"></a>    <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#unstandardized</span></span>
<span id="cb15-73"><a href="microbiota.html#cb15-73"></a>gb_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), microbiomes<span class="op">$</span>gb, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, </span>
<span id="cb15-74"><a href="microbiota.html#cb15-74"></a>    <span class="st">&quot;kul&quot;</span>))  <span class="co">#sqrt</span></span>
<span id="cb15-75"><a href="microbiota.html#cb15-75"></a>gb_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, </span>
<span id="cb15-76"><a href="microbiota.html#cb15-76"></a>    <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#sqrt and wisconsin</span></span>
<span id="cb15-77"><a href="microbiota.html#cb15-77"></a></span>
<span id="cb15-78"><a href="microbiota.html#cb15-78"></a>sf_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), (microbiomes<span class="op">$</span>sf)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, </span>
<span id="cb15-79"><a href="microbiota.html#cb15-79"></a>    <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb15-80"><a href="microbiota.html#cb15-80"></a>sf_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), microbiomes<span class="op">$</span>sf, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, </span>
<span id="cb15-81"><a href="microbiota.html#cb15-81"></a>    <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb15-82"><a href="microbiota.html#cb15-82"></a>sf_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, </span>
<span id="cb15-83"><a href="microbiota.html#cb15-83"></a>    <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb15-84"><a href="microbiota.html#cb15-84"></a></span>
<span id="cb15-85"><a href="microbiota.html#cb15-85"></a>wb_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), (microbiomes<span class="op">$</span>wb)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, </span>
<span id="cb15-86"><a href="microbiota.html#cb15-86"></a>    <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb15-87"><a href="microbiota.html#cb15-87"></a>wb_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), microbiomes<span class="op">$</span>wb, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, </span>
<span id="cb15-88"><a href="microbiota.html#cb15-88"></a>    <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb15-89"><a href="microbiota.html#cb15-89"></a>wb_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, </span>
<span id="cb15-90"><a href="microbiota.html#cb15-90"></a>    <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb15-91"><a href="microbiota.html#cb15-91"></a></span>
<span id="cb15-92"><a href="microbiota.html#cb15-92"></a>rankindices &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_ri1, gb_ri2, gb_ri3, sf_ri1, sf_ri2, sf_ri3, wb_ri1, wb_ri2, </span>
<span id="cb15-93"><a href="microbiota.html#cb15-93"></a>    wb_ri3)</span>
<span id="cb15-94"><a href="microbiota.html#cb15-94"></a>rankindices &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rankindices)</span>
<span id="cb15-95"><a href="microbiota.html#cb15-95"></a>rankindices[<span class="st">&quot;Sponge species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;G. barretti&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;S. fortis&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;W. bursa&quot;</span>, </span>
<span id="cb15-96"><a href="microbiota.html#cb15-96"></a>    <span class="dv">3</span>))</span>
<span id="cb15-97"><a href="microbiota.html#cb15-97"></a>rankindices[<span class="st">&quot;Normalisation&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;sqrt&quot;</span>, <span class="st">&quot;sqrt &amp; wisconsin&quot;</span>), <span class="dv">3</span>))</span>
<span id="cb15-98"><a href="microbiota.html#cb15-98"></a></span>
<span id="cb15-99"><a href="microbiota.html#cb15-99"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb15-100"><a href="microbiota.html#cb15-100"></a><span class="kw">kable</span>(rankindices, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Euclidean&quot;</span>, <span class="st">&quot;Manhattan&quot;</span>, <span class="st">&quot;Brayâ€“Curtis&quot;</span>, <span class="st">&quot;Jaccard&quot;</span>, </span>
<span id="cb15-101"><a href="microbiota.html#cb15-101"></a>    <span class="st">&quot;Kulczynski&quot;</span>, <span class="st">&quot;Sponge species&quot;</span>, <span class="st">&quot;Normalisation&quot;</span>), <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Rank correlation between dissimilarity indices and gradient separation. The higher the number the stronger the correlation, i.e. the better the fit.&quot;</span>, </span>
<span id="cb15-102"><a href="microbiota.html#cb15-102"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, </span>
<span id="cb15-103"><a href="microbiota.html#cb15-103"></a>    <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb15-104"><a href="microbiota.html#cb15-104"></a>    <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:rankindex">Table 3.3: </span>Rank correlation between dissimilarity indices and gradient separation. The higher the number the stronger the correlation, i.e.Â the better the fit.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Euclidean
</th>
<th style="text-align:right;">
Manhattan
</th>
<th style="text-align:right;">
Brayâ€“Curtis
</th>
<th style="text-align:right;">
Jaccard
</th>
<th style="text-align:right;">
Kulczynski
</th>
<th style="text-align:left;">
Sponge species
</th>
<th style="text-align:left;">
Normalisation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.0512024
</td>
<td style="text-align:right;">
-0.0445135
</td>
<td style="text-align:right;">
0.3979615
</td>
<td style="text-align:right;">
0.3979615
</td>
<td style="text-align:right;">
0.4509158
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0930562
</td>
<td style="text-align:right;">
0.1658067
</td>
<td style="text-align:right;">
0.3967033
</td>
<td style="text-align:right;">
0.3967033
</td>
<td style="text-align:right;">
0.4010193
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4072305
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0816401
</td>
<td style="text-align:right;">
0.1826975
</td>
<td style="text-align:right;">
0.3111549
</td>
<td style="text-align:right;">
0.3111549
</td>
<td style="text-align:right;">
0.4108128
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3285092
</td>
<td style="text-align:right;">
0.3476778
</td>
<td style="text-align:right;">
0.4620775
</td>
<td style="text-align:right;">
0.4620775
</td>
<td style="text-align:right;">
0.4877255
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5056811
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0280922
</td>
<td style="text-align:right;">
0.0994375
</td>
<td style="text-align:right;">
0.0008681
</td>
<td style="text-align:right;">
0.0008681
</td>
<td style="text-align:right;">
0.0048476
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0376971
</td>
<td style="text-align:right;">
0.4854434
</td>
<td style="text-align:right;">
0.2801306
</td>
<td style="text-align:right;">
0.2801306
</td>
<td style="text-align:right;">
0.2656573
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.0833252
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
</tbody>
</table>
<p>We adapt the microbial data sets accordingly applying square root transformation and Wisconsin standardisation of the microbiota in all subsequent ecological analyses. Then, we build a model (null model) without any environmental parameters, and one (full model) with the maximum number of environmental parameters (terms) possible so that none of them have a VIF &gt; 10. Finally, we use the stepwise model building function <code>ordistep</code> to determine, which of the environmental parameters is a significant constraint for the microbiomes. The function compares the null model and adds and removes terms from the full model to find (combinations of) significant constraints. The significance of the parameters is then tested in an ANOVA.</p>
<p><strong><em>G. barretti</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the ANOVA of the suggested model.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="microbiota.html#cb16-1"></a><span class="co"># mod0 has no terms, intercept only mod1 includes all terms possible with a VIF &lt;</span></span>
<span id="cb16-2"><a href="microbiota.html#cb16-2"></a><span class="co"># 10. Available: &#39;Depth&#39;, &#39;Latitude&#39;, &#39;Longitude&#39;, &#39;MeanBottomTemp_Cdeg&#39;,</span></span>
<span id="cb16-3"><a href="microbiota.html#cb16-3"></a><span class="co"># &#39;MeanBotSalinity_PSU&#39;, &#39;YEAR&#39;</span></span>
<span id="cb16-4"><a href="microbiota.html#cb16-4"></a></span>
<span id="cb16-5"><a href="microbiota.html#cb16-5"></a><span class="co">## Gb</span></span>
<span id="cb16-6"><a href="microbiota.html#cb16-6"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>gb_md)</span>
<span id="cb16-7"><a href="microbiota.html#cb16-7"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>MeanBottomTemp_Cdeg <span class="op">+</span><span class="st"> </span></span>
<span id="cb16-8"><a href="microbiota.html#cb16-8"></a><span class="st">    </span>YEAR, mds<span class="op">$</span>gb_md)</span>
<span id="cb16-9"><a href="microbiota.html#cb16-9"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude MeanBottomTemp_Cdeg                YEAR 
##            1.230382            1.775034            1.929029            1.651565</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="microbiota.html#cb18-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)  <span class="co">#0</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="microbiota.html#cb19-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 6.7097 3.4066  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="microbiota.html#cb21-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$gb) ~ Depth, data = mds$gb_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1   0.34451 3.4066  0.001 ***
## Residual 12   1.21355                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong><em>S. fortis</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the ANOVA of the suggested model.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="microbiota.html#cb23-1"></a><span class="co">## Sf</span></span>
<span id="cb23-2"><a href="microbiota.html#cb23-2"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>sf_md)</span>
<span id="cb23-3"><a href="microbiota.html#cb23-3"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>YEAR <span class="op">+</span><span class="st"> </span>MeanBotSalinity_PSU <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-4"><a href="microbiota.html#cb23-4"></a><span class="st">    </span>Longitude, mds<span class="op">$</span>sf_md)</span>
<span id="cb23-5"><a href="microbiota.html#cb23-5"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude                YEAR MeanBotSalinity_PSU 
##            4.218950            5.079261            1.082453            3.648340 
##           Longitude 
##            5.071690</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="microbiota.html#cb25-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="microbiota.html#cb26-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 13.547 2.1462  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="microbiota.html#cb28-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$sf) ~ Depth, data = mds$sf_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1   0.31199 2.1462  0.001 ***
## Residual 13   1.88978                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong><em>W. bursa</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the ANOVA of the suggested model.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="microbiota.html#cb30-1"></a><span class="co">## Wb</span></span>
<span id="cb30-2"><a href="microbiota.html#cb30-2"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>wb_md)</span>
<span id="cb30-3"><a href="microbiota.html#cb30-3"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>MeanBottomTemp_Cdeg <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-4"><a href="microbiota.html#cb30-4"></a><span class="st">    </span>YEAR, mds<span class="op">$</span>wb_md)</span>
<span id="cb30-5"><a href="microbiota.html#cb30-5"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude MeanBottomTemp_Cdeg                YEAR 
##            2.216302            1.217879            2.402357            1.153565</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="microbiota.html#cb32-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="microbiota.html#cb33-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 25.701 1.6576  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="microbiota.html#cb35-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$wb) ~ Depth, data = mds$wb_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1    0.4596 1.6576  0.001 ***
## Residual 14    3.8819                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>For all <em>G. barretti</em> and <em>S. fortis</em> depth is a significant constraint of the microbial community. For <em>W. bursa</em> we find temperature to be a significant constraint.</p>
</div>
<div id="unconstrained" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Unconstrained modelling approach</h3>
<p>In an alternative approach, we fit environmental vectors onto an ordination of the microbiota. This method allows to include all environmental parameters (regardless of collinearity). Length of the arrow indicates strength of the predictor (environmental parameter).</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="microbiota.html#cb37-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb37-2"><a href="microbiota.html#cb37-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb37-3"><a href="microbiota.html#cb37-3"></a></span>
<span id="cb37-4"><a href="microbiota.html#cb37-4"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb37-5"><a href="microbiota.html#cb37-5"></a>row &lt;-<span class="st"> </span><span class="kw">which</span>(meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>)</span>
<span id="cb37-6"><a href="microbiota.html#cb37-6"></a>temp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBottomTemp_Cdeg&quot;</span>)</span>
<span id="cb37-7"><a href="microbiota.html#cb37-7"></a>sal &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBotSalinity_PSU&quot;</span>)</span>
<span id="cb37-8"><a href="microbiota.html#cb37-8"></a>meta_data[row, temp] &lt;-<span class="st"> </span><span class="fl">3.59</span></span>
<span id="cb37-9"><a href="microbiota.html#cb37-9"></a>meta_data[row, sal] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb37-10"><a href="microbiota.html#cb37-10"></a><span class="kw">rm</span>(row, temp, sal)</span>
<span id="cb37-11"><a href="microbiota.html#cb37-11"></a></span>
<span id="cb37-12"><a href="microbiota.html#cb37-12"></a>microbiomes &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb37-13"><a href="microbiota.html#cb37-13"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb37-14"><a href="microbiota.html#cb37-14"></a></span>
<span id="cb37-15"><a href="microbiota.html#cb37-15"></a><span class="kw">colnames</span>(mds<span class="op">$</span>gb_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb37-16"><a href="microbiota.html#cb37-16"></a><span class="kw">colnames</span>(mds<span class="op">$</span>sf_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb37-17"><a href="microbiota.html#cb37-17"></a><span class="kw">colnames</span>(mds<span class="op">$</span>wb_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb37-18"><a href="microbiota.html#cb37-18"></a></span>
<span id="cb37-19"><a href="microbiota.html#cb37-19"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb))  <span class="co">#distance matrix</span></span>
<span id="cb37-20"><a href="microbiota.html#cb37-20"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb37-21"><a href="microbiota.html#cb37-21"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>gb_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows; STRATA?</span></span>
<span id="cb37-22"><a href="microbiota.html#cb37-22"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co">#plot</span></span>
<span id="cb37-23"><a href="microbiota.html#cb37-23"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co">#arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-1"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-1-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of G. barretti microbiome." width="672" />
<p class="caption">
Figure 3.6: Fitting significant (p&lt;0.05) environmental vectors onto ordination of G. barretti microbiome.
</p>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="microbiota.html#cb38-1"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf))  <span class="co"># distance matrix</span></span>
<span id="cb38-2"><a href="microbiota.html#cb38-2"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb38-3"><a href="microbiota.html#cb38-3"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>sf_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows</span></span>
<span id="cb38-4"><a href="microbiota.html#cb38-4"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co"># plot</span></span>
<span id="cb38-5"><a href="microbiota.html#cb38-5"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co"># arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-2"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-2-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of S. fortis microbiome." width="672" />
<p class="caption">
Figure 3.7: Fitting significant (p&lt;0.05) environmental vectors onto ordination of S. fortis microbiome.
</p>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="microbiota.html#cb39-1"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb))  <span class="co"># distance matrix</span></span>
<span id="cb39-2"><a href="microbiota.html#cb39-2"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb39-3"><a href="microbiota.html#cb39-3"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>wb_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows</span></span>
<span id="cb39-4"><a href="microbiota.html#cb39-4"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co"># plot</span></span>
<span id="cb39-5"><a href="microbiota.html#cb39-5"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co"># arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-3"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-3-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of W. bursa microbiome." width="672" />
<p class="caption">
Figure 3.8: Fitting significant (p&lt;0.05) environmental vectors onto ordination of W. bursa microbiome.
</p>
</div>
</div>
<div id="Hclust" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Hierarchical clustering</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="microbiota.html#cb40-1"></a><span class="co">## Clustering</span></span>
<span id="cb40-2"><a href="microbiota.html#cb40-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb40-3"><a href="microbiota.html#cb40-3"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb))  <span class="co">#distance matrix</span></span>
<span id="cb40-4"><a href="microbiota.html#cb40-4"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb40-5"><a href="microbiota.html#cb40-5"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Gb&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span>
<span id="cb40-6"><a href="microbiota.html#cb40-6"></a><span class="kw">rect.hclust</span>(clua, <span class="dv">2</span>)</span>
<span id="cb40-7"><a href="microbiota.html#cb40-7"></a>grp1 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb40-8"><a href="microbiota.html#cb40-8"></a></span>
<span id="cb40-9"><a href="microbiota.html#cb40-9"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf))  <span class="co">#distance matrix</span></span>
<span id="cb40-10"><a href="microbiota.html#cb40-10"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb40-11"><a href="microbiota.html#cb40-11"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Sf&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span>
<span id="cb40-12"><a href="microbiota.html#cb40-12"></a>grp2 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb40-13"><a href="microbiota.html#cb40-13"></a></span>
<span id="cb40-14"><a href="microbiota.html#cb40-14"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb))  <span class="co">#distance matrix</span></span>
<span id="cb40-15"><a href="microbiota.html#cb40-15"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb40-16"><a href="microbiota.html#cb40-16"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Wb&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:hclust"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/hclust-1.png" alt="Hclust" width="672" />
<p class="caption">
Figure 3.9: Hclust
</p>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="microbiota.html#cb41-1"></a>grp3 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb41-2"><a href="microbiota.html#cb41-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb41-3"><a href="microbiota.html#cb41-3"></a></span>
<span id="cb41-4"><a href="microbiota.html#cb41-4"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$gb)) plot(ord, display = &#39;sites&#39;)</span></span>
<span id="cb41-5"><a href="microbiota.html#cb41-5"></a><span class="co"># ordihull(ord, grp1, lty = 2, col = &#39;red&#39;)</span></span>
<span id="cb41-6"><a href="microbiota.html#cb41-6"></a></span>
<span id="cb41-7"><a href="microbiota.html#cb41-7"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$sf)) plot(ord, display = &#39;sites&#39;)</span></span>
<span id="cb41-8"><a href="microbiota.html#cb41-8"></a><span class="co"># ordihull(ord, grp2, lty = 2, col = &#39;red&#39;)</span></span>
<span id="cb41-9"><a href="microbiota.html#cb41-9"></a></span>
<span id="cb41-10"><a href="microbiota.html#cb41-10"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$wb)) plot(ord, display = &#39;sites&#39;)</span></span>
<span id="cb41-11"><a href="microbiota.html#cb41-11"></a><span class="co"># ordihull(ord, grp3, lty = 2, col = &#39;red&#39;)</span></span></code></pre></div>
<p>To summarise, in this section on <a href="microbiota.html#EnvMod">environmental modelling</a>, weâ€™ve shown that the prokaryotic communities in <em>G. barretti</em> and <em>S. fortis</em> seem to be influenced by depth both in <a href="microbiota.html#constrained">contrained</a> and <a href="microbiota.html#unconstrained">unconstrained</a> methods. For <em>W. bursa</em> we get mixed results. Hence at this point, the picture of a depth effect on LMA sponge prokaryotic communities remains ambiguous.<br />
Our intention with the <a href="##Hclust">hierarchical clustering</a> was to see if we could group the variation in the community composition in order to see if we can take hints from that about which aspect of the (a)biotic environment most likely causes/links to the changes. For <em>G. barretti</em>, we see the two main clusters representing the â€œshallowâ€ (Gb1-Gb10: 407-801 m) versus the â€œdeepâ€ (Gb11-Gb14: 1213-1427 m) specimens. These two groups match the two water masses detected in this part of the North Atlantic. The clustering also yiels a distinct clade/group of deep specimens in <em>S. fortis</em> (Sf9-Sf15: 1036-1476 m). Again, this highlights the distinctiveness of the prokatyotic commmunity of the deep specimens, potentially linked to the differences in the surrounding water masses. In <em>W. bursa</em> the specimens originating from depths greater than 1000 m (Wb13-Wb16) cluster with shallow samples and thus, we cannot deduce any stratifying effect of depth or water masses on its microbiome.</p>
<p>This section has given us a general impression that depth affects (mainly HMA) sponge prokarytoic community compositions. But can we be more specific and identify which OTUs are behind those patterns?</p>
</div>
</div>
<div id="relative-abundances" class="section level2">
<h2><span class="header-section-number">3.5</span> Relative abundances</h2>
<div id="bar-plots" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Bar plots</h3>
<p>Enough of the anonymous modelling and data fitting, letâ€™s take a look at the taxonomy of the OTUs to see who is there.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="microbiota.html#cb42-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb42-2"><a href="microbiota.html#cb42-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/PANGAEA_Final.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb42-3"><a href="microbiota.html#cb42-3"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb42-4"><a href="microbiota.html#cb42-4"></a></span>
<span id="cb42-5"><a href="microbiota.html#cb42-5"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb42-6"><a href="microbiota.html#cb42-6"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb42-7"><a href="microbiota.html#cb42-7"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb42-8"><a href="microbiota.html#cb42-8"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb42-9"><a href="microbiota.html#cb42-9"></a>    </span>
<span id="cb42-10"><a href="microbiota.html#cb42-10"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb42-11"><a href="microbiota.html#cb42-11"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb42-12"><a href="microbiota.html#cb42-12"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb42-13"><a href="microbiota.html#cb42-13"></a>    </span>
<span id="cb42-14"><a href="microbiota.html#cb42-14"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb42-15"><a href="microbiota.html#cb42-15"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb42-16"><a href="microbiota.html#cb42-16"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb42-17"><a href="microbiota.html#cb42-17"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb42-18"><a href="microbiota.html#cb42-18"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb42-19"><a href="microbiota.html#cb42-19"></a>}</span>
<span id="cb42-20"><a href="microbiota.html#cb42-20"></a></span>
<span id="cb42-21"><a href="microbiota.html#cb42-21"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb42-22"><a href="microbiota.html#cb42-22"></a></span>
<span id="cb42-23"><a href="microbiota.html#cb42-23"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb42-24"><a href="microbiota.html#cb42-24"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb42-25"><a href="microbiota.html#cb42-25"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb42-26"><a href="microbiota.html#cb42-26"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb42-27"><a href="microbiota.html#cb42-27"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb42-28"><a href="microbiota.html#cb42-28"></a>    </span>
<span id="cb42-29"><a href="microbiota.html#cb42-29"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb42-30"><a href="microbiota.html#cb42-30"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb42-31"><a href="microbiota.html#cb42-31"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb42-32"><a href="microbiota.html#cb42-32"></a>    }</span>
<span id="cb42-33"><a href="microbiota.html#cb42-33"></a>    </span>
<span id="cb42-34"><a href="microbiota.html#cb42-34"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb42-35"><a href="microbiota.html#cb42-35"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb42-36"><a href="microbiota.html#cb42-36"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb42-37"><a href="microbiota.html#cb42-37"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb42-38"><a href="microbiota.html#cb42-38"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb42-39"><a href="microbiota.html#cb42-39"></a>}</span>
<span id="cb42-40"><a href="microbiota.html#cb42-40"></a></span>
<span id="cb42-41"><a href="microbiota.html#cb42-41"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb42-42"><a href="microbiota.html#cb42-42"></a></span>
<span id="cb42-43"><a href="microbiota.html#cb42-43"></a><span class="co"># PHYLUM</span></span>
<span id="cb42-44"><a href="microbiota.html#cb42-44"></a>adonis_prep &lt;-<span class="st"> </span><span class="cf">function</span>(taxonomy, occurrence) {</span>
<span id="cb42-45"><a href="microbiota.html#cb42-45"></a>    occurrence<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>gb)</span>
<span id="cb42-46"><a href="microbiota.html#cb42-46"></a>    occurrence<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>sf)</span>
<span id="cb42-47"><a href="microbiota.html#cb42-47"></a>    occurrence<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>wb)</span>
<span id="cb42-48"><a href="microbiota.html#cb42-48"></a>    </span>
<span id="cb42-49"><a href="microbiota.html#cb42-49"></a>    tax &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb42-50"><a href="microbiota.html#cb42-50"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb42-51"><a href="microbiota.html#cb42-51"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(tax)[<span class="dv">1</span>]</span>
<span id="cb42-52"><a href="microbiota.html#cb42-52"></a>    tax[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb42-53"><a href="microbiota.html#cb42-53"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb42-54"><a href="microbiota.html#cb42-54"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb42-55"><a href="microbiota.html#cb42-55"></a>        tax<span class="op">$</span>XOTU[n] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, tax<span class="op">$</span>OTU_ID[n])</span>
<span id="cb42-56"><a href="microbiota.html#cb42-56"></a>    }</span>
<span id="cb42-57"><a href="microbiota.html#cb42-57"></a>    </span>
<span id="cb42-58"><a href="microbiota.html#cb42-58"></a>    tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>gb)</span>
<span id="cb42-59"><a href="microbiota.html#cb42-59"></a>    tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>sf)</span>
<span id="cb42-60"><a href="microbiota.html#cb42-60"></a>    tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>wb)</span>
<span id="cb42-61"><a href="microbiota.html#cb42-61"></a>    </span>
<span id="cb42-62"><a href="microbiota.html#cb42-62"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> tax_gb, <span class="dt">sf =</span> tax_sf, <span class="dt">wb =</span> tax_wb)</span>
<span id="cb42-63"><a href="microbiota.html#cb42-63"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb42-64"><a href="microbiota.html#cb42-64"></a>}</span>
<span id="cb42-65"><a href="microbiota.html#cb42-65"></a></span>
<span id="cb42-66"><a href="microbiota.html#cb42-66"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb42-67"><a href="microbiota.html#cb42-67"></a></span>
<span id="cb42-68"><a href="microbiota.html#cb42-68"></a>cleaning &lt;-<span class="st"> </span><span class="cf">function</span>(taxes) {</span>
<span id="cb42-69"><a href="microbiota.html#cb42-69"></a>    gb &lt;-<span class="st"> </span>taxes<span class="op">$</span>gb</span>
<span id="cb42-70"><a href="microbiota.html#cb42-70"></a>    sf &lt;-<span class="st"> </span>taxes<span class="op">$</span>sf</span>
<span id="cb42-71"><a href="microbiota.html#cb42-71"></a>    wb &lt;-<span class="st"> </span>taxes<span class="op">$</span>wb</span>
<span id="cb42-72"><a href="microbiota.html#cb42-72"></a>    <span class="co"># Renaming &amp; removing whitespaces</span></span>
<span id="cb42-73"><a href="microbiota.html#cb42-73"></a>    gb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Phylum)))</span>
<span id="cb42-74"><a href="microbiota.html#cb42-74"></a>    sf<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Phylum)))</span>
<span id="cb42-75"><a href="microbiota.html#cb42-75"></a>    wb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Phylum)))</span>
<span id="cb42-76"><a href="microbiota.html#cb42-76"></a>    gb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Class)))</span>
<span id="cb42-77"><a href="microbiota.html#cb42-77"></a>    sf<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Class)))</span>
<span id="cb42-78"><a href="microbiota.html#cb42-78"></a>    wb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Class)))</span>
<span id="cb42-79"><a href="microbiota.html#cb42-79"></a>    <span class="co">## GB</span></span>
<span id="cb42-80"><a href="microbiota.html#cb42-80"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb42-81"><a href="microbiota.html#cb42-81"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb42-82"><a href="microbiota.html#cb42-82"></a>    gb<span class="op">$</span>Phylum[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb42-83"><a href="microbiota.html#cb42-83"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb42-84"><a href="microbiota.html#cb42-84"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb42-85"><a href="microbiota.html#cb42-85"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb42-86"><a href="microbiota.html#cb42-86"></a>    gb<span class="op">$</span>Class[gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Chloroflexi&quot;</span> <span class="op">&amp;</span><span class="st"> </span>gb<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> &quot;Chloroflexi_unclassified&quot;</span></span>
<span id="cb42-87"><a href="microbiota.html#cb42-87"></a>    <span class="co">## SF</span></span>
<span id="cb42-88"><a href="microbiota.html#cb42-88"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb42-89"><a href="microbiota.html#cb42-89"></a>    sf<span class="op">$</span>Phylum[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb42-90"><a href="microbiota.html#cb42-90"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb42-91"><a href="microbiota.html#cb42-91"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Proteobacteria&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sf<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;Proteobacteria_unclassified&quot;</span></span>
<span id="cb42-92"><a href="microbiota.html#cb42-92"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb42-93"><a href="microbiota.html#cb42-93"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb42-94"><a href="microbiota.html#cb42-94"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb42-95"><a href="microbiota.html#cb42-95"></a>    <span class="co">## WB</span></span>
<span id="cb42-96"><a href="microbiota.html#cb42-96"></a>    wb<span class="op">$</span>Class[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb42-97"><a href="microbiota.html#cb42-97"></a>    wb<span class="op">$</span>Phylum[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb42-98"><a href="microbiota.html#cb42-98"></a>    <span class="co"># merge back</span></span>
<span id="cb42-99"><a href="microbiota.html#cb42-99"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb, <span class="dt">sf =</span> sf, <span class="dt">wb =</span> wb)</span>
<span id="cb42-100"><a href="microbiota.html#cb42-100"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb42-101"><a href="microbiota.html#cb42-101"></a>}</span>
<span id="cb42-102"><a href="microbiota.html#cb42-102"></a></span>
<span id="cb42-103"><a href="microbiota.html#cb42-103"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb42-104"><a href="microbiota.html#cb42-104"></a></span>
<span id="cb42-105"><a href="microbiota.html#cb42-105"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb42-106"><a href="microbiota.html#cb42-106"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb42-107"><a href="microbiota.html#cb42-107"></a>    x</span>
<span id="cb42-108"><a href="microbiota.html#cb42-108"></a>})</span>
<span id="cb42-109"><a href="microbiota.html#cb42-109"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb42-110"><a href="microbiota.html#cb42-110"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb42-111"><a href="microbiota.html#cb42-111"></a>    x</span>
<span id="cb42-112"><a href="microbiota.html#cb42-112"></a>})</span>
<span id="cb42-113"><a href="microbiota.html#cb42-113"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb42-114"><a href="microbiota.html#cb42-114"></a>    x[<span class="st">&quot;Class&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb42-115"><a href="microbiota.html#cb42-115"></a>    x</span>
<span id="cb42-116"><a href="microbiota.html#cb42-116"></a>})</span>
<span id="cb42-117"><a href="microbiota.html#cb42-117"></a></span>
<span id="cb42-118"><a href="microbiota.html#cb42-118"></a></span>
<span id="cb42-119"><a href="microbiota.html#cb42-119"></a><span class="co"># aggregate sum of relative abundance per phylum in each sponge sample</span></span>
<span id="cb42-120"><a href="microbiota.html#cb42-120"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb42-121"><a href="microbiota.html#cb42-121"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb42-122"><a href="microbiota.html#cb42-122"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb42-123"><a href="microbiota.html#cb42-123"></a></span>
<span id="cb42-124"><a href="microbiota.html#cb42-124"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb42-125"><a href="microbiota.html#cb42-125"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_phy, wb)</span>
<span id="cb42-126"><a href="microbiota.html#cb42-126"></a>taxes_phy[<span class="kw">is.na</span>(taxes_phy)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb42-127"><a href="microbiota.html#cb42-127"></a></span>
<span id="cb42-128"><a href="microbiota.html#cb42-128"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_phy, sum)</span></span>
<span id="cb42-129"><a href="microbiota.html#cb42-129"></a></span>
<span id="cb42-130"><a href="microbiota.html#cb42-130"></a><span class="kw">rownames</span>(taxes_phy) &lt;-<span class="st"> </span>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb42-131"><a href="microbiota.html#cb42-131"></a>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb42-132"><a href="microbiota.html#cb42-132"></a>df_phylum &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_phy))  <span class="co">#taxes_phy_t &lt;- df_phylum</span></span>
<span id="cb42-133"><a href="microbiota.html#cb42-133"></a>df_phylum[<span class="st">&quot;Sample_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df_phylum)</span>
<span id="cb42-134"><a href="microbiota.html#cb42-134"></a>df_phylum &lt;-<span class="st"> </span><span class="kw">melt</span>(df_phylum, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>))</span>
<span id="cb42-135"><a href="microbiota.html#cb42-135"></a><span class="kw">colnames</span>(df_phylum) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;variable&quot;</span>)</span>
<span id="cb42-136"><a href="microbiota.html#cb42-136"></a></span>
<span id="cb42-137"><a href="microbiota.html#cb42-137"></a><span class="co"># ggplot(df_phylum, aes(x=Sample_ID, y=variable,</span></span>
<span id="cb42-138"><a href="microbiota.html#cb42-138"></a><span class="co"># fill=Phylum))+geom_bar(stat=&#39;identity&#39;)+ theme_classic()+theme(axis.text.x =</span></span>
<span id="cb42-139"><a href="microbiota.html#cb42-139"></a><span class="co"># element_text(angle = 90, hjust = 1), legend.position = &#39;bottom&#39;)+xlab(&#39;Samples</span></span>
<span id="cb42-140"><a href="microbiota.html#cb42-140"></a><span class="co"># ordered by depth&#39;)+ylab(&#39;Relative abundance&#39;)+</span></span>
<span id="cb42-141"><a href="microbiota.html#cb42-141"></a><span class="co"># scale_x_discrete(limits=c(&#39;Gb1&#39;,&#39;Gb2&#39;,&#39;Gb3&#39;, &#39;Gb4&#39;, &#39;Gb5&#39;, &#39;Gb6&#39;, &#39;Gb7&#39;, &#39;Gb8&#39;,</span></span>
<span id="cb42-142"><a href="microbiota.html#cb42-142"></a><span class="co"># &#39;Gb9&#39;, &#39;Gb10&#39;, &#39;Gb11&#39;, &#39;Gb12&#39;, &#39;Gb13&#39;, &#39;Gb14&#39;, &#39;Sf1&#39;, &#39;Sf2&#39;, &#39;Sf3&#39;, &#39;Sf4&#39;,</span></span>
<span id="cb42-143"><a href="microbiota.html#cb42-143"></a><span class="co"># &#39;Sf5&#39;, &#39;Sf6&#39;, &#39;Sf7&#39;, &#39;Sf8&#39;, &#39;Sf9&#39;, &#39;Sf10&#39;, &#39;Sf11&#39;, &#39;Sf12&#39;, &#39;Sf13&#39;, &#39;Sf14&#39;,</span></span>
<span id="cb42-144"><a href="microbiota.html#cb42-144"></a><span class="co"># &#39;Sf15&#39;, &#39;Wb1&#39;, &#39;Wb2&#39;, &#39;Wb3&#39;, &#39;Wb4&#39;, &#39;Wb5&#39;, &#39;Wb6&#39;, &#39;Wb7&#39;, &#39;Wb8&#39;, &#39;Wb9&#39;, &#39;Wb10&#39;,</span></span>
<span id="cb42-145"><a href="microbiota.html#cb42-145"></a><span class="co"># &#39;Wb11&#39;, &#39;Wb12&#39;, &#39;Wb13&#39;, &#39;Wb14&#39;, &#39;Wb15&#39;, &#39;Wb16&#39;))+ scale_fill_manual(&#39;&#39;, breaks</span></span>
<span id="cb42-146"><a href="microbiota.html#cb42-146"></a><span class="co"># = c(&#39;Acidobacteria&#39;, &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;,</span></span>
<span id="cb42-147"><a href="microbiota.html#cb42-147"></a><span class="co"># &#39;Chloroflexi&#39;, &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;,</span></span>
<span id="cb42-148"><a href="microbiota.html#cb42-148"></a><span class="co"># &#39;Firmicutes&#39;, &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;,</span></span>
<span id="cb42-149"><a href="microbiota.html#cb42-149"></a><span class="co"># &#39;Planctomycetes&#39;, &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;,</span></span>
<span id="cb42-150"><a href="microbiota.html#cb42-150"></a><span class="co"># &#39;Tectomicrobia&#39;, &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;), values =</span></span>
<span id="cb42-151"><a href="microbiota.html#cb42-151"></a><span class="co"># c(&#39;#b8c4f6&#39;,&#39;#ffaaaf&#39;,&#39;#3d1349&#39;,&#39;#ffffff&#39;,&#39;#01559d&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#019c51&#39;,&#39;#b10060&#39;,&#39;#49ca00&#39;,&#39;#dd8e00&#39;,&#39;#f282ff&#39;,&#39;#ffffff&#39;,&#39;#ff633f&#39;,&#39;#ec0040&#39;,&#39;#010b92&#39;,&#39;#cf00aa&#39;,&#39;#aba900&#39;,&#39;#ffffff&#39;,&#39;#fce300&#39;),</span></span>
<span id="cb42-152"><a href="microbiota.html#cb42-152"></a><span class="co"># labels = c(&#39;Acidobacteria&#39;, &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;,</span></span>
<span id="cb42-153"><a href="microbiota.html#cb42-153"></a><span class="co"># &#39;Chloroflexi&#39;, &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;,</span></span>
<span id="cb42-154"><a href="microbiota.html#cb42-154"></a><span class="co"># &#39;Firmicutes&#39;, &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;,</span></span>
<span id="cb42-155"><a href="microbiota.html#cb42-155"></a><span class="co"># &#39;Planctomycetes&#39;, &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;,</span></span>
<span id="cb42-156"><a href="microbiota.html#cb42-156"></a><span class="co"># &#39;Tectomicrobia&#39;, &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;))</span></span>
<span id="cb42-157"><a href="microbiota.html#cb42-157"></a></span>
<span id="cb42-158"><a href="microbiota.html#cb42-158"></a></span>
<span id="cb42-159"><a href="microbiota.html#cb42-159"></a><span class="co"># df_phylum[&#39;spec&#39;] &lt;- str_sub(df_phylum$Sample_ID,1,2) md &lt;-</span></span>
<span id="cb42-160"><a href="microbiota.html#cb42-160"></a><span class="co"># meta_data[,c(&#39;unified_ID&#39;, &#39;Depth&#39;)] colnames(md) &lt;- c(&#39;Sample_ID&#39;, &#39;Depth&#39;)</span></span>
<span id="cb42-161"><a href="microbiota.html#cb42-161"></a><span class="co"># df_phylum &lt;- left_join(df_phylum, md)</span></span>
<span id="cb42-162"><a href="microbiota.html#cb42-162"></a></span>
<span id="cb42-163"><a href="microbiota.html#cb42-163"></a><span class="co"># ggplot(df_phylum, aes(x=as.factor(Depth), y=variable, fill=Phylum))+</span></span>
<span id="cb42-164"><a href="microbiota.html#cb42-164"></a><span class="co"># geom_bar(stat=&#39;identity&#39;)+facet_wrap(.~spec, scales=&#39;free&#39;)+</span></span>
<span id="cb42-165"><a href="microbiota.html#cb42-165"></a><span class="co"># theme_classic()+theme(axis.text.x = element_text(angle = 90, hjust =</span></span>
<span id="cb42-166"><a href="microbiota.html#cb42-166"></a><span class="co"># 1),legend.position = &#39;bottom&#39;)+xlab(&#39;Samples ordered by depth&#39;)+ylab(&#39;Relative</span></span>
<span id="cb42-167"><a href="microbiota.html#cb42-167"></a><span class="co"># abundance&#39;)+ scale_fill_manual(&#39;&#39;, breaks = c(&#39;Acidobacteria&#39;,</span></span>
<span id="cb42-168"><a href="microbiota.html#cb42-168"></a><span class="co"># &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;, &#39;Chloroflexi&#39;,</span></span>
<span id="cb42-169"><a href="microbiota.html#cb42-169"></a><span class="co"># &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;, &#39;Firmicutes&#39;,</span></span>
<span id="cb42-170"><a href="microbiota.html#cb42-170"></a><span class="co"># &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;, &#39;Planctomycetes&#39;,</span></span>
<span id="cb42-171"><a href="microbiota.html#cb42-171"></a><span class="co"># &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;, &#39;Tectomicrobia&#39;,</span></span>
<span id="cb42-172"><a href="microbiota.html#cb42-172"></a><span class="co"># &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;), values =</span></span>
<span id="cb42-173"><a href="microbiota.html#cb42-173"></a><span class="co"># c(&#39;#b8c4f6&#39;,&#39;#ffaaaf&#39;,&#39;#3d1349&#39;,&#39;#ffffff&#39;,&#39;#01559d&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#019c51&#39;,&#39;#b10060&#39;,&#39;#49ca00&#39;,&#39;#dd8e00&#39;,&#39;#f282ff&#39;,&#39;#ffffff&#39;,&#39;#ff633f&#39;,&#39;#ec0040&#39;,&#39;#010b92&#39;,&#39;#cf00aa&#39;,&#39;#aba900&#39;,&#39;#ffffff&#39;,&#39;#fce300&#39;),</span></span>
<span id="cb42-174"><a href="microbiota.html#cb42-174"></a><span class="co"># labels = c(&#39;Acidobacteria&#39;, &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;,</span></span>
<span id="cb42-175"><a href="microbiota.html#cb42-175"></a><span class="co"># &#39;Chloroflexi&#39;, &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;,</span></span>
<span id="cb42-176"><a href="microbiota.html#cb42-176"></a><span class="co"># &#39;Firmicutes&#39;, &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;,</span></span>
<span id="cb42-177"><a href="microbiota.html#cb42-177"></a><span class="co"># &#39;Planctomycetes&#39;, &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;,</span></span>
<span id="cb42-178"><a href="microbiota.html#cb42-178"></a><span class="co"># &#39;Tectomicrobia&#39;, &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;) )</span></span>
<span id="cb42-179"><a href="microbiota.html#cb42-179"></a></span>
<span id="cb42-180"><a href="microbiota.html#cb42-180"></a><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Acidobacteria&quot;</span>, <span class="st">&quot;Actinobacteria&quot;</span>, </span>
<span id="cb42-181"><a href="microbiota.html#cb42-181"></a>    <span class="st">&quot;Bacteroidetes&quot;</span>, <span class="st">&quot;Chlamydiae&quot;</span>, <span class="st">&quot;Chloroflexi&quot;</span>, <span class="st">&quot;Cyanobacteria&quot;</span>, <span class="st">&quot;Deferribacteres&quot;</span>, </span>
<span id="cb42-182"><a href="microbiota.html#cb42-182"></a>    <span class="st">&quot;Deinococcus.Thermus&quot;</span>, <span class="st">&quot;Firmicutes&quot;</span>, <span class="st">&quot;Gemmatimonadetes&quot;</span>, <span class="st">&quot;Nitrospinae&quot;</span>, <span class="st">&quot;Nitrospirae&quot;</span>, </span>
<span id="cb42-183"><a href="microbiota.html#cb42-183"></a>    <span class="st">&quot;PAUC34f&quot;</span>, <span class="st">&quot;Planctomycetes&quot;</span>, <span class="st">&quot;Poribacteria&quot;</span>, <span class="st">&quot;Proteobacteria&quot;</span>, <span class="st">&quot;SBR1093&quot;</span>, <span class="st">&quot;Spirochaetae&quot;</span>, </span>
<span id="cb42-184"><a href="microbiota.html#cb42-184"></a>    <span class="st">&quot;Tectomicrobia&quot;</span>, <span class="st">&quot;Thaumarchaeota&quot;</span>, <span class="st">&quot;unclassified&quot;</span>, <span class="st">&quot;Verrucomicrobia&quot;</span>), <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#b8c4f6&quot;</span>, </span>
<span id="cb42-185"><a href="microbiota.html#cb42-185"></a>    <span class="st">&quot;#ffaaaf&quot;</span>, <span class="st">&quot;#3d1349&quot;</span>, <span class="st">&quot;#B6B2A9&quot;</span>, <span class="st">&quot;#01559d&quot;</span>, <span class="st">&quot;#CACAC8&quot;</span>, <span class="st">&quot;#E1DED7&quot;</span>, <span class="st">&quot;#CEC7C1&quot;</span>, </span>
<span id="cb42-186"><a href="microbiota.html#cb42-186"></a>    <span class="st">&quot;#9A9B9D&quot;</span>, <span class="st">&quot;#019c51&quot;</span>, <span class="st">&quot;#b10060&quot;</span>, <span class="st">&quot;#49ca00&quot;</span>, <span class="st">&quot;#dd8e00&quot;</span>, <span class="st">&quot;#f282ff&quot;</span>, <span class="st">&quot;#AFA79D&quot;</span>, </span>
<span id="cb42-187"><a href="microbiota.html#cb42-187"></a>    <span class="st">&quot;#ff633f&quot;</span>, <span class="st">&quot;#ec0040&quot;</span>, <span class="st">&quot;#010b92&quot;</span>, <span class="st">&quot;#cf00aa&quot;</span>, <span class="st">&quot;#aba900&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#fce300&quot;</span>), </span>
<span id="cb42-188"><a href="microbiota.html#cb42-188"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Acidobacteria&quot;</span>, <span class="st">&quot;Actinobacteria&quot;</span>, <span class="st">&quot;Bacteroidetes&quot;</span>, <span class="st">&quot;Chlamydiae&quot;</span>, </span>
<span id="cb42-189"><a href="microbiota.html#cb42-189"></a>        <span class="st">&quot;Chloroflexi&quot;</span>, <span class="st">&quot;Cyanobacteria&quot;</span>, <span class="st">&quot;Deferribacteres&quot;</span>, <span class="st">&quot;Deinococcus.Thermus&quot;</span>, </span>
<span id="cb42-190"><a href="microbiota.html#cb42-190"></a>        <span class="st">&quot;Firmicutes&quot;</span>, <span class="st">&quot;Gemmatimonadetes&quot;</span>, <span class="st">&quot;Nitrospinae&quot;</span>, <span class="st">&quot;Nitrospirae&quot;</span>, <span class="st">&quot;PAUC34f&quot;</span>, </span>
<span id="cb42-191"><a href="microbiota.html#cb42-191"></a>        <span class="st">&quot;Planctomycetes&quot;</span>, <span class="st">&quot;Poribacteria&quot;</span>, <span class="st">&quot;Proteobacteria&quot;</span>, <span class="st">&quot;SBR1093&quot;</span>, <span class="st">&quot;Spirochaetae&quot;</span>, </span>
<span id="cb42-192"><a href="microbiota.html#cb42-192"></a>        <span class="st">&quot;Tectomicrobia&quot;</span>, <span class="st">&quot;Thaumarchaeota&quot;</span>, <span class="st">&quot;unclassified&quot;</span>, <span class="st">&quot;Verrucomicrobia&quot;</span>))</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>We see in this bar plot that the relative abundance of phyla remains fairly stable across the different depths. Generally, the prokaryotic community of sponges is described as somewhat species specific and stable across virtually any measured gradient. At this taxonomic resolution, these findings hold true. The composition of the prokaryotic communities in the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> is similar across all samples, while the composition in the LMA sponge <em>W. bursa</em> differs in composition but also displaying only minor variations in phyla proportions.
The phyla left white/blank are present at very low abundance and we thought the figure might be visually easier without too many colours.</p>
<p>The phyla Chloroflexi, Actinobacteria, Acidobacteria, PAUC34f, and Gemmatimonadetes were described as HMA indicator phyla <span class="citation">(Moitinho-Silva et al. <a href="#ref-moitinho-silva_2017" role="doc-biblioref">2017</a>)</span> and are present in the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> (although Actinobacteria are also present in <em>W. bursa</em>).The phyla Proteobacteria, Bacteroidetes, Planctomycetes, and Firmicutes were disgnated LMA indicator phyla and are found in <em>W. bursa</em> (although Proteobacteria are also present in the HMA sponges).</p>
</div>
<div id="tabular-overview" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Tabular overview</h3>
<p>If you prefer numbers, this is what it breaks down to. You can sort the tables.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="microbiota.html#cb44-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb44-2"><a href="microbiota.html#cb44-2"></a></span>
<span id="cb44-3"><a href="microbiota.html#cb44-3"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb44-4"><a href="microbiota.html#cb44-4"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb44-5"><a href="microbiota.html#cb44-5"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb44-6"><a href="microbiota.html#cb44-6"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb44-7"><a href="microbiota.html#cb44-7"></a>    </span>
<span id="cb44-8"><a href="microbiota.html#cb44-8"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb44-9"><a href="microbiota.html#cb44-9"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb44-10"><a href="microbiota.html#cb44-10"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb44-11"><a href="microbiota.html#cb44-11"></a>    </span>
<span id="cb44-12"><a href="microbiota.html#cb44-12"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb44-13"><a href="microbiota.html#cb44-13"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb44-14"><a href="microbiota.html#cb44-14"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb44-15"><a href="microbiota.html#cb44-15"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb44-16"><a href="microbiota.html#cb44-16"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb44-17"><a href="microbiota.html#cb44-17"></a>}</span>
<span id="cb44-18"><a href="microbiota.html#cb44-18"></a></span>
<span id="cb44-19"><a href="microbiota.html#cb44-19"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb44-20"><a href="microbiota.html#cb44-20"></a></span>
<span id="cb44-21"><a href="microbiota.html#cb44-21"></a><span class="co"># calculate relative abundance of OTU across sponge samples</span></span>
<span id="cb44-22"><a href="microbiota.html#cb44-22"></a></span>
<span id="cb44-23"><a href="microbiota.html#cb44-23"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb44-24"><a href="microbiota.html#cb44-24"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb44-25"><a href="microbiota.html#cb44-25"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb44-26"><a href="microbiota.html#cb44-26"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb44-27"><a href="microbiota.html#cb44-27"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb44-28"><a href="microbiota.html#cb44-28"></a>    </span>
<span id="cb44-29"><a href="microbiota.html#cb44-29"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb44-30"><a href="microbiota.html#cb44-30"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb44-31"><a href="microbiota.html#cb44-31"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb44-32"><a href="microbiota.html#cb44-32"></a>    }</span>
<span id="cb44-33"><a href="microbiota.html#cb44-33"></a>    </span>
<span id="cb44-34"><a href="microbiota.html#cb44-34"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb44-35"><a href="microbiota.html#cb44-35"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb44-36"><a href="microbiota.html#cb44-36"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb44-37"><a href="microbiota.html#cb44-37"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb44-38"><a href="microbiota.html#cb44-38"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb44-39"><a href="microbiota.html#cb44-39"></a>}</span>
<span id="cb44-40"><a href="microbiota.html#cb44-40"></a></span>
<span id="cb44-41"><a href="microbiota.html#cb44-41"></a><span class="co"># gb_occurrence &lt;- overall_rabdc(micro_ds$gb) sf_occurrence &lt;-</span></span>
<span id="cb44-42"><a href="microbiota.html#cb44-42"></a><span class="co"># overall_rabdc(micro_ds$sf) wb_occurrence &lt;- overall_rabdc(micro_ds$wb)</span></span>
<span id="cb44-43"><a href="microbiota.html#cb44-43"></a><span class="co"># occurrence &lt;- list(gb=gb_occurrence, sf=sf_occurrence, wb=wb_occurrence)</span></span>
<span id="cb44-44"><a href="microbiota.html#cb44-44"></a></span>
<span id="cb44-45"><a href="microbiota.html#cb44-45"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb44-46"><a href="microbiota.html#cb44-46"></a></span>
<span id="cb44-47"><a href="microbiota.html#cb44-47"></a>aggregations &lt;-<span class="st"> </span><span class="cf">function</span>(taxonomy, occurrence) {</span>
<span id="cb44-48"><a href="microbiota.html#cb44-48"></a>    occurrence<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>gb)</span>
<span id="cb44-49"><a href="microbiota.html#cb44-49"></a>    occurrence<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>sf)</span>
<span id="cb44-50"><a href="microbiota.html#cb44-50"></a>    occurrence<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>wb)</span>
<span id="cb44-51"><a href="microbiota.html#cb44-51"></a>    </span>
<span id="cb44-52"><a href="microbiota.html#cb44-52"></a>    tax &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb44-53"><a href="microbiota.html#cb44-53"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb44-54"><a href="microbiota.html#cb44-54"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(tax)[<span class="dv">1</span>]</span>
<span id="cb44-55"><a href="microbiota.html#cb44-55"></a>    tax[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb44-56"><a href="microbiota.html#cb44-56"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb44-57"><a href="microbiota.html#cb44-57"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb44-58"><a href="microbiota.html#cb44-58"></a>        tax<span class="op">$</span>XOTU[n] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, tax<span class="op">$</span>OTU_ID[n])</span>
<span id="cb44-59"><a href="microbiota.html#cb44-59"></a>    }</span>
<span id="cb44-60"><a href="microbiota.html#cb44-60"></a>    </span>
<span id="cb44-61"><a href="microbiota.html#cb44-61"></a>    tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>gb[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb44-62"><a href="microbiota.html#cb44-62"></a>    tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>sf[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb44-63"><a href="microbiota.html#cb44-63"></a>    tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>wb[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb44-64"><a href="microbiota.html#cb44-64"></a>    </span>
<span id="cb44-65"><a href="microbiota.html#cb44-65"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> tax_gb, <span class="dt">sf =</span> tax_sf, <span class="dt">wb =</span> tax_wb)</span>
<span id="cb44-66"><a href="microbiota.html#cb44-66"></a>    </span>
<span id="cb44-67"><a href="microbiota.html#cb44-67"></a>    gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb44-68"><a href="microbiota.html#cb44-68"></a>    gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb44-69"><a href="microbiota.html#cb44-69"></a>    gb_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb44-70"><a href="microbiota.html#cb44-70"></a>    <span class="kw">colnames</span>(gb_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb44-71"><a href="microbiota.html#cb44-71"></a>    </span>
<span id="cb44-72"><a href="microbiota.html#cb44-72"></a>    gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb44-73"><a href="microbiota.html#cb44-73"></a>    gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb44-74"><a href="microbiota.html#cb44-74"></a>    gb_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb44-75"><a href="microbiota.html#cb44-75"></a>    <span class="kw">colnames</span>(gb_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb44-76"><a href="microbiota.html#cb44-76"></a>    </span>
<span id="cb44-77"><a href="microbiota.html#cb44-77"></a>    test1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, </span>
<span id="cb44-78"><a href="microbiota.html#cb44-78"></a>        <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb44-79"><a href="microbiota.html#cb44-79"></a>    <span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span>
<span id="cb44-80"><a href="microbiota.html#cb44-80"></a>    </span>
<span id="cb44-81"><a href="microbiota.html#cb44-81"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb44-82"><a href="microbiota.html#cb44-82"></a>}</span>
<span id="cb44-83"><a href="microbiota.html#cb44-83"></a></span>
<span id="cb44-84"><a href="microbiota.html#cb44-84"></a>taxes &lt;-<span class="st"> </span><span class="kw">aggregations</span>(taxonomy, occurrence)</span>
<span id="cb44-85"><a href="microbiota.html#cb44-85"></a></span>
<span id="cb44-86"><a href="microbiota.html#cb44-86"></a>cleaning &lt;-<span class="st"> </span><span class="cf">function</span>(taxes) {</span>
<span id="cb44-87"><a href="microbiota.html#cb44-87"></a>    gb &lt;-<span class="st"> </span>taxes<span class="op">$</span>gb</span>
<span id="cb44-88"><a href="microbiota.html#cb44-88"></a>    sf &lt;-<span class="st"> </span>taxes<span class="op">$</span>sf</span>
<span id="cb44-89"><a href="microbiota.html#cb44-89"></a>    wb &lt;-<span class="st"> </span>taxes<span class="op">$</span>wb</span>
<span id="cb44-90"><a href="microbiota.html#cb44-90"></a>    <span class="co"># Renaming &amp; removing whitespaces</span></span>
<span id="cb44-91"><a href="microbiota.html#cb44-91"></a>    gb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Phylum)))</span>
<span id="cb44-92"><a href="microbiota.html#cb44-92"></a>    sf<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Phylum)))</span>
<span id="cb44-93"><a href="microbiota.html#cb44-93"></a>    wb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Phylum)))</span>
<span id="cb44-94"><a href="microbiota.html#cb44-94"></a>    gb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Class)))</span>
<span id="cb44-95"><a href="microbiota.html#cb44-95"></a>    sf<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Class)))</span>
<span id="cb44-96"><a href="microbiota.html#cb44-96"></a>    wb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Class)))</span>
<span id="cb44-97"><a href="microbiota.html#cb44-97"></a>    <span class="co">## GB</span></span>
<span id="cb44-98"><a href="microbiota.html#cb44-98"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb44-99"><a href="microbiota.html#cb44-99"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb44-100"><a href="microbiota.html#cb44-100"></a>    gb<span class="op">$</span>Phylum[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb44-101"><a href="microbiota.html#cb44-101"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb44-102"><a href="microbiota.html#cb44-102"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb44-103"><a href="microbiota.html#cb44-103"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb44-104"><a href="microbiota.html#cb44-104"></a>    gb<span class="op">$</span>Class[gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Chloroflexi&quot;</span> <span class="op">&amp;</span><span class="st"> </span>gb<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> &quot;Chloroflexi_unclassified&quot;</span></span>
<span id="cb44-105"><a href="microbiota.html#cb44-105"></a>    <span class="co">## SF</span></span>
<span id="cb44-106"><a href="microbiota.html#cb44-106"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb44-107"><a href="microbiota.html#cb44-107"></a>    sf<span class="op">$</span>Phylum[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb44-108"><a href="microbiota.html#cb44-108"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb44-109"><a href="microbiota.html#cb44-109"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Proteobacteria&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sf<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;Proteobacteria_unclassified&quot;</span></span>
<span id="cb44-110"><a href="microbiota.html#cb44-110"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb44-111"><a href="microbiota.html#cb44-111"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb44-112"><a href="microbiota.html#cb44-112"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb44-113"><a href="microbiota.html#cb44-113"></a>    <span class="co">## WB</span></span>
<span id="cb44-114"><a href="microbiota.html#cb44-114"></a>    wb<span class="op">$</span>Class[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb44-115"><a href="microbiota.html#cb44-115"></a>    wb<span class="op">$</span>Phylum[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb44-116"><a href="microbiota.html#cb44-116"></a>    <span class="co"># merge back</span></span>
<span id="cb44-117"><a href="microbiota.html#cb44-117"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb, <span class="dt">sf =</span> sf, <span class="dt">wb =</span> wb)</span>
<span id="cb44-118"><a href="microbiota.html#cb44-118"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb44-119"><a href="microbiota.html#cb44-119"></a>}</span>
<span id="cb44-120"><a href="microbiota.html#cb44-120"></a></span>
<span id="cb44-121"><a href="microbiota.html#cb44-121"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb44-122"><a href="microbiota.html#cb44-122"></a></span>
<span id="cb44-123"><a href="microbiota.html#cb44-123"></a>phy_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))  <span class="co">#OTU count</span></span>
<span id="cb44-124"><a href="microbiota.html#cb44-124"></a>phy_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, </span>
<span id="cb44-125"><a href="microbiota.html#cb44-125"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))  <span class="co">#sums relative abundance</span></span>
<span id="cb44-126"><a href="microbiota.html#cb44-126"></a></span>
<span id="cb44-127"><a href="microbiota.html#cb44-127"></a>class_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb44-128"><a href="microbiota.html#cb44-128"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb44-129"><a href="microbiota.html#cb44-129"></a>class_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb44-130"><a href="microbiota.html#cb44-130"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span></code></pre></div>
<div id="g.-barretti-phyla-and-classes-present" class="section level4">
<h4><span class="header-section-number">3.5.2.1</span> <em>G. barretti</em>: Phyla and classes present</h4>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="microbiota.html#cb45-1"></a><span class="co"># https://rstudio.github.io/DT/</span></span>
<span id="cb45-2"><a href="microbiota.html#cb45-2"></a>gb_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>gb, phy_rabdc<span class="op">$</span>gb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb45-3"><a href="microbiota.html#cb45-3"></a><span class="kw">colnames</span>(gb_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>)</span>
<span id="cb45-4"><a href="microbiota.html#cb45-4"></a><span class="co"># gb_P$`cummulative average abundance` &lt;- round(c(gb_P$`cummulative average</span></span>
<span id="cb45-5"><a href="microbiota.html#cb45-5"></a><span class="co"># abundance`, 6))</span></span>
<span id="cb45-6"><a href="microbiota.html#cb45-6"></a>DT<span class="op">::</span><span class="kw">datatable</span>(gb_P, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-890ad79b0e940f1be4c6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-890ad79b0e940f1be4c6">{"x":{"filter":"none","data":[["Acidobacteria","Actinobacteria","Bacteroidetes","Chloroflexi","Deinococcus-Thermus","Gemmatimonadetes","Nitrospinae","Nitrospirae","PAUC34f","Poribacteria","Proteobacteria","SBR1093","Spirochaetae","Tectomicrobia","Thaumarchaeota","unclassified","Verrucomicrobia"],[111,29,3,139,1,32,3,2,6,2,68,1,4,2,9,7,1],[0.264941431090238,0.0842460797342462,0.00629929957644724,0.275071784071904,0.00289317970257434,0.0924848939914834,0.00546946423311415,0.0102462652978634,0.0181476956426156,0.00143759249628591,0.152814021070438,0.0227708137077518,0.0015659410178042,0.00372649801249384,0.0501133260165913,0.00733530349674407,0.000436410841404755]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Phylum<\/th>\n      <th>OTU count<\/th>\n      <th>cum. avg. abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="microbiota.html#cb46-1"></a>gb_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>gb, class_rabdc<span class="op">$</span>gb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb46-2"><a href="microbiota.html#cb46-2"></a><span class="kw">colnames</span>(gb_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb46-3"><a href="microbiota.html#cb46-3"></a><span class="co"># gb_C$`cummulative average abundance` &lt;- round(c(gb_C$`cummulative average</span></span>
<span id="cb46-4"><a href="microbiota.html#cb46-4"></a><span class="co"># abundance`, digits = 6))</span></span>
<span id="cb46-5"><a href="microbiota.html#cb46-5"></a>DT<span class="op">::</span><span class="kw">datatable</span>(gb_C, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-b403213c6893a034cc15" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b403213c6893a034cc15">{"x":{"filter":"none","data":[["Acidimicrobiia","Alphaproteobacteria","Anaerolineae","Bacteroidetes_Incertae_Sedis","BD2-11_terrestrial_group","Caldilineae","cD4-96","Chloroflexi_unclassified","Deinococci","Deltaproteobacteria","Gammaproteobacteria","Gemmatimonadetes","Holophagae","JG30-KF-CM66","JTB23","Marine_Group_I","MD2896-B214","MD2898-B26","Nitrospira","Opitutae","PAUC34f_unclassified","PAUC43f_marine_benthic_group","Poribacteria_unclassified","S085","SAR202_clade","SBR1093_unclassified","Solibacteres","Spirochaetes","SPOTSOCT00m83","Subgroup_11","Subgroup_12","Subgroup_13","Subgroup_15","Subgroup_17","Subgroup_2","Subgroup_21","Subgroup_26","Subgroup_5","Subgroup_6","Subgroup_9","Tectomicrobia_unclassified","Thermoleophilia","TK10","unclassified"],[24,25,19,3,29,4,1,1,1,8,29,1,2,15,5,9,2,1,2,1,6,2,2,6,75,1,11,4,1,2,1,5,3,2,2,16,4,2,46,15,2,5,18,7],[0.0739840145527607,0.0390005904393791,0.0482070884926763,0.00629929957644724,0.0842964083993767,0.0148264667246524,0.000219225505456683,0.0004288443174143,0.00289317970257434,0.0116819342805408,0.070373486556471,0.000390888048940581,0.0140614111670355,0.0338616857764079,0.0307588023562648,0.0501133260165913,0.00049247267640581,0.00497699155670834,0.0102462652978634,0.000436410841404755,0.0181476956426156,0.00779759754316616,0.00143759249628591,0.0144238860626124,0.130046252113444,0.0227708137077518,0.0147901722306825,0.0015659410178042,0.000999207437782005,0.0158603720656001,0.000289905064082157,0.00764605798243373,0.0041330054257542,0.00147702810615963,0.00331169059845213,0.0330821988436575,0.00817649607752723,0.00441643826982697,0.109013344556306,0.0486833107027202,0.00372649801249384,0.0102620651814855,0.0330583350792408,0.00733530349674407]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Class<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s.-fortis-phyla-and-classes-present" class="section level4">
<h4><span class="header-section-number">3.5.2.2</span> <em>S. fortis</em>: Phyla and classes present</h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="microbiota.html#cb47-1"></a>sf_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>sf, phy_rabdc<span class="op">$</span>sf[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb47-2"><a href="microbiota.html#cb47-2"></a><span class="kw">colnames</span>(sf_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>)</span>
<span id="cb47-3"><a href="microbiota.html#cb47-3"></a><span class="co"># sf_P$`cummulative average abundance` &lt;- round(c(sf_P$`cummulative average</span></span>
<span id="cb47-4"><a href="microbiota.html#cb47-4"></a><span class="co"># abundance`, digits = 6))</span></span>
<span id="cb47-5"><a href="microbiota.html#cb47-5"></a>DT<span class="op">::</span><span class="kw">datatable</span>(sf_P, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-f764898faa8bc3a3d1cc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f764898faa8bc3a3d1cc">{"x":{"filter":"none","data":[["Acidobacteria","Actinobacteria","Bacteroidetes","Chloroflexi","Deferribacteres","Deinococcus-Thermus","Firmicutes","Gemmatimonadetes","Nitrospinae","Nitrospirae","PAUC34f","Planctomycetes","Poribacteria","Proteobacteria","SBR1093","Spirochaetae","Tectomicrobia","Thaumarchaeota","unclassified","Verrucomicrobia"],[119,21,3,152,1,1,1,29,7,3,8,3,5,81,1,5,3,14,3,1],[0.238677738686968,0.0693342556977264,0.0107237163157949,0.306416127749244,0.000178502880778776,0.0025092262923236,0.000320550211882512,0.0645282665819597,0.0130718622825627,0.0129292544501288,0.0338805168591611,0.000775470437315722,0.00736784844051278,0.135133782193877,0.0205948095490131,0.0154965407039899,0.00903143516717622,0.0537437350216305,0.0028006697164809,0.00248569076147327]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Phylum<\/th>\n      <th>OTU count<\/th>\n      <th>cum. avg. abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="microbiota.html#cb48-1"></a>sf_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>sf, class_rabdc<span class="op">$</span>sf[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb48-2"><a href="microbiota.html#cb48-2"></a><span class="kw">colnames</span>(sf_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb48-3"><a href="microbiota.html#cb48-3"></a><span class="co"># sf_C$`cummulative average abundance` &lt;- round(c(sf_C$`cummulative average</span></span>
<span id="cb48-4"><a href="microbiota.html#cb48-4"></a><span class="co"># abundance`, digits = 6))</span></span>
<span id="cb48-5"><a href="microbiota.html#cb48-5"></a>DT<span class="op">::</span><span class="kw">datatable</span>(sf_C, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-d64026952bfadbdebe3f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d64026952bfadbdebe3f">{"x":{"filter":"none","data":[["Acidimicrobiia","Alphaproteobacteria","Anaerolineae","Bacilli","Bacteroidetes_Incertae_Sedis","BD2-11_terrestrial_group","Betaproteobacteria","Caldilineae","cD4-96","Deferribacteres_Incertae_Sedis","Deinococci","Deltaproteobacteria","Flavobacteriia","Gammaproteobacteria","Holophagae","JG30-KF-CM66","JTB23","MACA-EFT26","Marine_Group_I","MD2896-B214","MD2898-B26","Nitrospira","Opitutae","PAUC34f_unclassified","PAUC43f_marine_benthic_group","Planctomycetacia","Poribacteria_unclassified","Proteobacteria_unclassified","S085","SAR202_clade","SBR1093_unclassified","Solibacteres","Spirochaetes","SPOTSOCT00m83","Subgroup_11","Subgroup_12","Subgroup_13","Subgroup_15","Subgroup_17","Subgroup_2","Subgroup_21","Subgroup_26","Subgroup_5","Subgroup_6","Subgroup_9","Tectomicrobia_unclassified","Thermoleophilia","TK10","unclassified"],[17,23,14,1,2,26,1,4,1,1,1,6,1,42,2,11,6,1,14,2,5,3,1,8,3,3,5,1,4,96,1,15,5,1,1,3,7,2,3,2,18,2,3,42,19,3,4,22,3],[0.0596458249911138,0.0287869725087491,0.0216666993662345,0.000320550211882512,0.0104868434788265,0.0533001330830702,0.00105820994167432,0.0294432877074082,0.000188814887196095,0.000178502880778776,0.0025092262923236,0.0126067210663023,0.000236872836968404,0.0669805486348207,0.0106407282599732,0.0201981603147065,0.0219184124196273,0.000711345609766523,0.0537437350216305,0.00308096326228317,0.00999089902027953,0.0129292544501288,0.00248569076147327,0.0338805168591611,0.0112281334988895,0.000775470437315722,0.00736784844051278,0.000271454297575978,0.00716263734617863,0.18515714678954,0.0205948095490131,0.0301007087790878,0.0154965407039899,0.0028001177153612,0.0126648378893062,0.000742280992828754,0.00686166887637135,0.00157816173436267,0.000689454466613768,0.00170080531525615,0.0352999618017115,0.000941068929770098,0.00683928048137783,0.0710777186977769,0.0595410624625318,0.00903143516717622,0.00968843070661261,0.0425993813379804,0.0028006697164809]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Class<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="w.-bursa-phyla-and-classes-present" class="section level4">
<h4><span class="header-section-number">3.5.2.3</span> <em>W. bursa</em>: Phyla and classes present</h4>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="microbiota.html#cb49-1"></a>wb_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>wb, phy_rabdc<span class="op">$</span>wb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb49-2"><a href="microbiota.html#cb49-2"></a><span class="kw">colnames</span>(wb_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb49-3"><a href="microbiota.html#cb49-3"></a><span class="co"># wb_P$`cummulative average abundance` &lt;- round(c(wb_P$`cummulative average</span></span>
<span id="cb49-4"><a href="microbiota.html#cb49-4"></a><span class="co"># abundance`, digits = 6))</span></span>
<span id="cb49-5"><a href="microbiota.html#cb49-5"></a>DT<span class="op">::</span><span class="kw">datatable</span>(wb_P, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-1e971473edfd32cc7a40" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1e971473edfd32cc7a40">{"x":{"filter":"none","data":[["Actinobacteria","Bacteroidetes","Chlamydiae","Chloroflexi","Cyanobacteria","Nitrospinae","Planctomycetes","Proteobacteria","SBR1093","Spirochaetae","Thaumarchaeota","unclassified","Verrucomicrobia"],[7,12,1,1,3,1,21,65,1,2,6,5,10],[0.0380423667912802,0.0271417390724484,0.000502061054107066,0.0157039630496128,0.00490570956280944,0.0336527147276658,0.105202416163017,0.613784938356821,0.00152927793229885,0.00305799017423506,0.121077130674959,0.00425010206293762,0.0311495903778074]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Phylum<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="microbiota.html#cb50-1"></a>wb_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>wb, class_rabdc<span class="op">$</span>wb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb50-2"><a href="microbiota.html#cb50-2"></a><span class="kw">colnames</span>(wb_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb50-3"><a href="microbiota.html#cb50-3"></a><span class="co"># wb_C$`cummulative average abundance` &lt;- round(c(wb_C$`cummulative average</span></span>
<span id="cb50-4"><a href="microbiota.html#cb50-4"></a><span class="co"># abundance`, digits = 6))</span></span>
<span id="cb50-5"><a href="microbiota.html#cb50-5"></a>DT<span class="op">::</span><span class="kw">datatable</span>(wb_C, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-8e27bba1b306bca03b9f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8e27bba1b306bca03b9f">{"x":{"filter":"none","data":[["Acidimicrobiia","Actinobacteria","Alphaproteobacteria","Arctic97B-4_marine_group","Betaproteobacteria","Chlamydiae","Chloroplast","Deltaproteobacteria","Flavobacteriia","Gammaproteobacteria","JTB23","Marine_Group_I","ML635J-21","Nitrospinia","OM190","Phycisphaerae","Planctomycetacia","SAR202_clade","Spirochaetes","unclassified","uncultured_Desulfohalobiaceae_bacterium","Verrucomicrobiae"],[1,6,6,1,3,1,2,3,12,52,1,6,1,1,1,8,12,1,2,5,1,9],[0.000446394265347338,0.0375959725259329,0.02198602374512,0.00359729970671857,0.00382103946235601,0.000502061054107066,0.00433988694118431,0.00945650573887785,0.0271417390724484,0.565791775582376,0.0127295938280915,0.121077130674959,0.000565822621625134,0.0336527147276658,0.000618215323155031,0.00712087225822437,0.0974633285816377,0.0157039630496128,0.00305799017423506,0.00425010206293762,0.00152927793229885,0.0275522906710888]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Class<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="microbiota.html#cb51-1"></a><span class="kw">rm</span>(gb_P, sf_P, wb_P, gb_C, sf_C, wb_C)</span></code></pre></div>
</div>
</div>
<div id="statistical-comparison-at-phylum-and-class-level" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Statistical comparison at phylum and class level</h3>
</div>
</div>
<div id="depth-response-otu-perspective" class="section level2">
<h2><span class="header-section-number">3.6</span> Depth response: OTU perspective</h2>
<p>Summarising the OTU diversity by phylum or class only shows what was previously known. The composition of the spongesâ€™ prokaryotic community is stable. However, summarising doesnâ€™t do the data justice. We therefore correlate the average relative abundance of every OTU with depth. The Otus yielding a significant correlation with depth are shown by their respecive relative abundance across the depths.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="microbiota.html#cb52-1"></a><span class="co"># ====================== INC-DEC CORRELATION ================== Categorises the</span></span>
<span id="cb52-2"><a href="microbiota.html#cb52-2"></a><span class="co"># OTUs by their response to depth.</span></span>
<span id="cb52-3"><a href="microbiota.html#cb52-3"></a></span>
<span id="cb52-4"><a href="microbiota.html#cb52-4"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb52-5"><a href="microbiota.html#cb52-5"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb52-6"><a href="microbiota.html#cb52-6"></a></span>
<span id="cb52-7"><a href="microbiota.html#cb52-7"></a>meta_data_prep &lt;-<span class="st"> </span><span class="cf">function</span>(meta_data) {</span>
<span id="cb52-8"><a href="microbiota.html#cb52-8"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, </span>
<span id="cb52-9"><a href="microbiota.html#cb52-9"></a>        <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb52-10"><a href="microbiota.html#cb52-10"></a>    <span class="kw">colnames</span>(meta_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Temperature&quot;</span>, </span>
<span id="cb52-11"><a href="microbiota.html#cb52-11"></a>        <span class="st">&quot;Salinity&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb52-12"><a href="microbiota.html#cb52-12"></a>    meta_data &lt;-<span class="st"> </span>meta_data[<span class="op">!</span>(<span class="kw">str_sub</span>(meta_data<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;QC&quot;</span>), ]</span>
<span id="cb52-13"><a href="microbiota.html#cb52-13"></a>    meta_data[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(meta_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) </span>
<span id="cb52-14"><a href="microbiota.html#cb52-14"></a>        <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb52-15"><a href="microbiota.html#cb52-15"></a>    <span class="co"># Gb12, Gb20 and Gb21 are missing temperature and salinity. Imputing data from</span></span>
<span id="cb52-16"><a href="microbiota.html#cb52-16"></a>    <span class="co"># closeby samples:</span></span>
<span id="cb52-17"><a href="microbiota.html#cb52-17"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb52-18"><a href="microbiota.html#cb52-18"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb20&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb52-19"><a href="microbiota.html#cb52-19"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb21&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.56</span></span>
<span id="cb52-20"><a href="microbiota.html#cb52-20"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>] &lt;-<span class="st"> </span><span class="fl">3.71</span></span>
<span id="cb52-21"><a href="microbiota.html#cb52-21"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb20&quot;</span>] &lt;-<span class="st"> </span><span class="fl">3.65</span></span>
<span id="cb52-22"><a href="microbiota.html#cb52-22"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb21&quot;</span>] &lt;-<span class="st"> </span><span class="fl">2.32</span></span>
<span id="cb52-23"><a href="microbiota.html#cb52-23"></a>    meta_data[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(meta_data<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb52-24"><a href="microbiota.html#cb52-24"></a>    meta_data &lt;-<span class="st"> </span>meta_data[<span class="kw">order</span>(meta_data<span class="op">$</span>unified_ID), ]</span>
<span id="cb52-25"><a href="microbiota.html#cb52-25"></a>    <span class="kw">return</span>(meta_data)</span>
<span id="cb52-26"><a href="microbiota.html#cb52-26"></a>}</span>
<span id="cb52-27"><a href="microbiota.html#cb52-27"></a></span>
<span id="cb52-28"><a href="microbiota.html#cb52-28"></a>meta_data &lt;-<span class="st"> </span><span class="kw">meta_data_prep</span>(meta_data)</span>
<span id="cb52-29"><a href="microbiota.html#cb52-29"></a></span>
<span id="cb52-30"><a href="microbiota.html#cb52-30"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb52-31"><a href="microbiota.html#cb52-31"></a></span>
<span id="cb52-32"><a href="microbiota.html#cb52-32"></a>rel_abdc &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb52-33"><a href="microbiota.html#cb52-33"></a>    mic &lt;-<span class="st"> </span>micro</span>
<span id="cb52-34"><a href="microbiota.html#cb52-34"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb52-35"><a href="microbiota.html#cb52-35"></a>    mic[<span class="st">&quot;max&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, max)</span>
<span id="cb52-36"><a href="microbiota.html#cb52-36"></a>    </span>
<span id="cb52-37"><a href="microbiota.html#cb52-37"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb52-38"><a href="microbiota.html#cb52-38"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb52-39"><a href="microbiota.html#cb52-39"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb52-40"><a href="microbiota.html#cb52-40"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb52-41"><a href="microbiota.html#cb52-41"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>max[n])</span>
<span id="cb52-42"><a href="microbiota.html#cb52-42"></a>    }</span>
<span id="cb52-43"><a href="microbiota.html#cb52-43"></a>    mic<span class="op">$</span>max &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb52-44"><a href="microbiota.html#cb52-44"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb52-45"><a href="microbiota.html#cb52-45"></a>}</span>
<span id="cb52-46"><a href="microbiota.html#cb52-46"></a></span>
<span id="cb52-47"><a href="microbiota.html#cb52-47"></a>rabdc_gb &lt;-<span class="st"> </span><span class="kw">rel_abdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb52-48"><a href="microbiota.html#cb52-48"></a>rabdc_sf &lt;-<span class="st"> </span><span class="kw">rel_abdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb52-49"><a href="microbiota.html#cb52-49"></a>rabdc_wb &lt;-<span class="st"> </span><span class="kw">rel_abdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb52-50"><a href="microbiota.html#cb52-50"></a></span>
<span id="cb52-51"><a href="microbiota.html#cb52-51"></a>inc_dec &lt;-<span class="st"> </span><span class="cf">function</span>(rabdc_df, meta_data) {</span>
<span id="cb52-52"><a href="microbiota.html#cb52-52"></a>    </span>
<span id="cb52-53"><a href="microbiota.html#cb52-53"></a>    md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(rabdc_df), ]</span>
<span id="cb52-54"><a href="microbiota.html#cb52-54"></a>    inc_dec &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(rabdc_df))</span>
<span id="cb52-55"><a href="microbiota.html#cb52-55"></a>    <span class="kw">colnames</span>(inc_dec) &lt;-<span class="st"> &quot;XOTU&quot;</span></span>
<span id="cb52-56"><a href="microbiota.html#cb52-56"></a>    inc_dec[<span class="st">&quot;inc_dec_estimate&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb52-57"><a href="microbiota.html#cb52-57"></a>    inc_dec[<span class="st">&quot;inc_dec_p_val&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb52-58"><a href="microbiota.html#cb52-58"></a>    </span>
<span id="cb52-59"><a href="microbiota.html#cb52-59"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb52-60"><a href="microbiota.html#cb52-60"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(inc_dec)[<span class="dv">1</span>]</span>
<span id="cb52-61"><a href="microbiota.html#cb52-61"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb52-62"><a href="microbiota.html#cb52-62"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb52-63"><a href="microbiota.html#cb52-63"></a>        inc_dec<span class="op">$</span>inc_dec_estimate[n] &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="kw">as.numeric</span>(rabdc_df[n, ]), md<span class="op">$</span>Depth)<span class="op">$</span>estimate</span>
<span id="cb52-64"><a href="microbiota.html#cb52-64"></a>        inc_dec<span class="op">$</span>inc_dec_p_val[n] &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="kw">as.numeric</span>(rabdc_df[n, ]), md<span class="op">$</span>Depth)<span class="op">$</span>p.value</span>
<span id="cb52-65"><a href="microbiota.html#cb52-65"></a>    }</span>
<span id="cb52-66"><a href="microbiota.html#cb52-66"></a>    </span>
<span id="cb52-67"><a href="microbiota.html#cb52-67"></a>    inc_dec[<span class="st">&quot;classification&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb52-68"><a href="microbiota.html#cb52-68"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;dec.trend&quot;</span></span>
<span id="cb52-69"><a href="microbiota.html#cb52-69"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;inc.trend&quot;</span></span>
<span id="cb52-70"><a href="microbiota.html#cb52-70"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>inc_dec<span class="op">$</span>inc_dec_p <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> &quot;decreasing&quot;</span></span>
<span id="cb52-71"><a href="microbiota.html#cb52-71"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>inc_dec<span class="op">$</span>inc_dec_p <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> &quot;increasing&quot;</span></span>
<span id="cb52-72"><a href="microbiota.html#cb52-72"></a>    <span class="kw">return</span>(inc_dec)</span>
<span id="cb52-73"><a href="microbiota.html#cb52-73"></a>}</span>
<span id="cb52-74"><a href="microbiota.html#cb52-74"></a></span>
<span id="cb52-75"><a href="microbiota.html#cb52-75"></a>gb_response &lt;-<span class="st"> </span><span class="kw">inc_dec</span>(rabdc_gb, meta_data)</span>
<span id="cb52-76"><a href="microbiota.html#cb52-76"></a>sf_response &lt;-<span class="st"> </span><span class="kw">inc_dec</span>(rabdc_sf, meta_data)</span>
<span id="cb52-77"><a href="microbiota.html#cb52-77"></a>wb_response &lt;-<span class="st"> </span><span class="kw">inc_dec</span>(rabdc_wb, meta_data)</span>
<span id="cb52-78"><a href="microbiota.html#cb52-78"></a></span>
<span id="cb52-79"><a href="microbiota.html#cb52-79"></a><span class="co">### dfs to saving, join _reponse to rabdc_ and calculate vag &lt;/&gt;1000 m</span></span>
<span id="cb52-80"><a href="microbiota.html#cb52-80"></a></span>
<span id="cb52-81"><a href="microbiota.html#cb52-81"></a><span class="co"># For heatmaps gb</span></span>
<span id="cb52-82"><a href="microbiota.html#cb52-82"></a>rabdc_gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_gb)</span>
<span id="cb52-83"><a href="microbiota.html#cb52-83"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_gb, gb_response)</span>
<span id="cb52-84"><a href="microbiota.html#cb52-84"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(gb_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, </span>
<span id="cb52-85"><a href="microbiota.html#cb52-85"></a>    <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb52-86"><a href="microbiota.html#cb52-86"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb52-87"><a href="microbiota.html#cb52-87"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb52-88"><a href="microbiota.html#cb52-88"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_heatmap, md)</span>
<span id="cb52-89"><a href="microbiota.html#cb52-89"></a>gb_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(gb_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb52-90"><a href="microbiota.html#cb52-90"></a>gb_heatmap_i &lt;-<span class="st"> </span>gb_heatmap[gb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb52-91"><a href="microbiota.html#cb52-91"></a>gb_heatmap_d &lt;-<span class="st"> </span>gb_heatmap[gb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb52-92"><a href="microbiota.html#cb52-92"></a></span>
<span id="cb52-93"><a href="microbiota.html#cb52-93"></a><span class="co"># gb_i &lt;- ggplot(gb_heatmap_i, aes(x=as.factor(gb_heatmap_i$Depth),</span></span>
<span id="cb52-94"><a href="microbiota.html#cb52-94"></a><span class="co"># y=gb_heatmap_i$name, fill=gb_heatmap_i$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb52-95"><a href="microbiota.html#cb52-95"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;GB</span></span>
<span id="cb52-96"><a href="microbiota.html#cb52-96"></a><span class="co"># OTUs increasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb52-97"><a href="microbiota.html#cb52-97"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb52-98"><a href="microbiota.html#cb52-98"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb52-99"><a href="microbiota.html#cb52-99"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb52-100"><a href="microbiota.html#cb52-100"></a></span>
<span id="cb52-101"><a href="microbiota.html#cb52-101"></a><span class="co"># gb_d &lt;- ggplot(gb_heatmap_d, aes(x=as.factor(gb_heatmap_d$Depth),</span></span>
<span id="cb52-102"><a href="microbiota.html#cb52-102"></a><span class="co"># y=gb_heatmap_d$name, fill=gb_heatmap_d$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb52-103"><a href="microbiota.html#cb52-103"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;GB</span></span>
<span id="cb52-104"><a href="microbiota.html#cb52-104"></a><span class="co"># OTUs decreasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb52-105"><a href="microbiota.html#cb52-105"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb52-106"><a href="microbiota.html#cb52-106"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb52-107"><a href="microbiota.html#cb52-107"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb52-108"><a href="microbiota.html#cb52-108"></a></span>
<span id="cb52-109"><a href="microbiota.html#cb52-109"></a><span class="co"># sf</span></span>
<span id="cb52-110"><a href="microbiota.html#cb52-110"></a>rabdc_sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_sf)</span>
<span id="cb52-111"><a href="microbiota.html#cb52-111"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_sf, sf_response)</span>
<span id="cb52-112"><a href="microbiota.html#cb52-112"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(sf_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, </span>
<span id="cb52-113"><a href="microbiota.html#cb52-113"></a>    <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb52-114"><a href="microbiota.html#cb52-114"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb52-115"><a href="microbiota.html#cb52-115"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb52-116"><a href="microbiota.html#cb52-116"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_heatmap, md)</span>
<span id="cb52-117"><a href="microbiota.html#cb52-117"></a>sf_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(sf_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb52-118"><a href="microbiota.html#cb52-118"></a>sf_heatmap_i &lt;-<span class="st"> </span>sf_heatmap[sf_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb52-119"><a href="microbiota.html#cb52-119"></a>sf_heatmap_d &lt;-<span class="st"> </span>sf_heatmap[sf_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb52-120"><a href="microbiota.html#cb52-120"></a></span>
<span id="cb52-121"><a href="microbiota.html#cb52-121"></a><span class="co"># sf_i &lt;- ggplot(sf_heatmap_i, aes(x=as.factor(sf_heatmap_i$Depth),</span></span>
<span id="cb52-122"><a href="microbiota.html#cb52-122"></a><span class="co"># y=sf_heatmap_i$name, fill=sf_heatmap_i$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb52-123"><a href="microbiota.html#cb52-123"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;SF</span></span>
<span id="cb52-124"><a href="microbiota.html#cb52-124"></a><span class="co"># OTUs increasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb52-125"><a href="microbiota.html#cb52-125"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb52-126"><a href="microbiota.html#cb52-126"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb52-127"><a href="microbiota.html#cb52-127"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb52-128"><a href="microbiota.html#cb52-128"></a></span>
<span id="cb52-129"><a href="microbiota.html#cb52-129"></a><span class="co"># sf_d &lt;- ggplot(sf_heatmap_d, aes(x=as.factor(sf_heatmap_d$Depth),</span></span>
<span id="cb52-130"><a href="microbiota.html#cb52-130"></a><span class="co"># y=sf_heatmap_d$name, fill=sf_heatmap_d$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb52-131"><a href="microbiota.html#cb52-131"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;SF</span></span>
<span id="cb52-132"><a href="microbiota.html#cb52-132"></a><span class="co"># OTUs decreasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb52-133"><a href="microbiota.html#cb52-133"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb52-134"><a href="microbiota.html#cb52-134"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb52-135"><a href="microbiota.html#cb52-135"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb52-136"><a href="microbiota.html#cb52-136"></a></span>
<span id="cb52-137"><a href="microbiota.html#cb52-137"></a><span class="co"># wb</span></span>
<span id="cb52-138"><a href="microbiota.html#cb52-138"></a>rabdc_wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_wb)</span>
<span id="cb52-139"><a href="microbiota.html#cb52-139"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_wb, wb_response)</span>
<span id="cb52-140"><a href="microbiota.html#cb52-140"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(wb_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, </span>
<span id="cb52-141"><a href="microbiota.html#cb52-141"></a>    <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb52-142"><a href="microbiota.html#cb52-142"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb52-143"><a href="microbiota.html#cb52-143"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb52-144"><a href="microbiota.html#cb52-144"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(wb_heatmap, md)</span>
<span id="cb52-145"><a href="microbiota.html#cb52-145"></a>wb_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(wb_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb52-146"><a href="microbiota.html#cb52-146"></a>wb_heatmap_i &lt;-<span class="st"> </span>wb_heatmap[wb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb52-147"><a href="microbiota.html#cb52-147"></a>wb_heatmap_d &lt;-<span class="st"> </span>wb_heatmap[wb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb52-148"><a href="microbiota.html#cb52-148"></a></span>
<span id="cb52-149"><a href="microbiota.html#cb52-149"></a><span class="co"># wb_i &lt;- ggplot(wb_heatmap_i, aes(x=as.factor(wb_heatmap_i$Depth),</span></span>
<span id="cb52-150"><a href="microbiota.html#cb52-150"></a><span class="co"># y=wb_heatmap_i$name, fill=wb_heatmap_i$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb52-151"><a href="microbiota.html#cb52-151"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;WB</span></span>
<span id="cb52-152"><a href="microbiota.html#cb52-152"></a><span class="co"># OTUs increasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb52-153"><a href="microbiota.html#cb52-153"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb52-154"><a href="microbiota.html#cb52-154"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb52-155"><a href="microbiota.html#cb52-155"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb52-156"><a href="microbiota.html#cb52-156"></a></span>
<span id="cb52-157"><a href="microbiota.html#cb52-157"></a><span class="co"># wb_d &lt;- ggplot(wb_heatmap_d, aes(x=as.factor(wb_heatmap_d$Depth),</span></span>
<span id="cb52-158"><a href="microbiota.html#cb52-158"></a><span class="co"># y=wb_heatmap_d$name, fill=wb_heatmap_d$value))+geom_tile()+ theme(axis.text.x =</span></span>
<span id="cb52-159"><a href="microbiota.html#cb52-159"></a><span class="co"># element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;WB</span></span>
<span id="cb52-160"><a href="microbiota.html#cb52-160"></a><span class="co"># OTUs decreasing&#39;)+scale_fill_viridis_c(option =</span></span>
<span id="cb52-161"><a href="microbiota.html#cb52-161"></a><span class="co"># &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb52-162"><a href="microbiota.html#cb52-162"></a><span class="co"># panel.border=element_blank(),</span></span>
<span id="cb52-163"><a href="microbiota.html#cb52-163"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb52-164"><a href="microbiota.html#cb52-164"></a></span>
<span id="cb52-165"><a href="microbiota.html#cb52-165"></a><span class="co"># Facetting for the figure in the publication</span></span>
<span id="cb52-166"><a href="microbiota.html#cb52-166"></a>gb_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb52-167"><a href="microbiota.html#cb52-167"></a>sf_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb52-168"><a href="microbiota.html#cb52-168"></a>wb_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb52-169"><a href="microbiota.html#cb52-169"></a>increase &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_heatmap_i, sf_heatmap_i, wb_heatmap_i)</span>
<span id="cb52-170"><a href="microbiota.html#cb52-170"></a>inc &lt;-<span class="st"> </span><span class="kw">ggplot</span>(increase, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(Depth), <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span></span>
<span id="cb52-171"><a href="microbiota.html#cb52-171"></a><span class="st">    </span>spec, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, </span>
<span id="cb52-172"><a href="microbiota.html#cb52-172"></a>    <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;OTUs increasing&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb52-173"><a href="microbiota.html#cb52-173"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb52-174"><a href="microbiota.html#cb52-174"></a>        <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb52-175"><a href="microbiota.html#cb52-175"></a></span>
<span id="cb52-176"><a href="microbiota.html#cb52-176"></a>gb_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb52-177"><a href="microbiota.html#cb52-177"></a>sf_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb52-178"><a href="microbiota.html#cb52-178"></a>wb_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb52-179"><a href="microbiota.html#cb52-179"></a>decrease &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_heatmap_d, sf_heatmap_d, wb_heatmap_d)</span>
<span id="cb52-180"><a href="microbiota.html#cb52-180"></a>dec &lt;-<span class="st"> </span><span class="kw">ggplot</span>(decrease, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(Depth), <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span></span>
<span id="cb52-181"><a href="microbiota.html#cb52-181"></a><span class="st">    </span>spec, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">drop =</span> T) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb52-182"><a href="microbiota.html#cb52-182"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb52-183"><a href="microbiota.html#cb52-183"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;OTUs decreasing&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb52-184"><a href="microbiota.html#cb52-184"></a>    <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb52-185"><a href="microbiota.html#cb52-185"></a></span>
<span id="cb52-186"><a href="microbiota.html#cb52-186"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb52-187"><a href="microbiota.html#cb52-187"></a><span class="kw">grid.arrange</span>(inc, dec, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span id="fig:increade-decrease"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/increade-decrease-1.png" alt="OTUs significantly increasing and decreasing with depth in the three sponge species." width="672" />
<p class="caption">
Figure 3.10: OTUs significantly increasing and decreasing with depth in the three sponge species.
</p>
</div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="microbiota.html#cb53-1"></a>gb_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap_i<span class="op">$</span>name)), </span>
<span id="cb53-2"><a href="microbiota.html#cb53-2"></a>    <span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb53-3"><a href="microbiota.html#cb53-3"></a>sf_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap_i<span class="op">$</span>name)), </span>
<span id="cb53-4"><a href="microbiota.html#cb53-4"></a>    <span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb53-5"><a href="microbiota.html#cb53-5"></a>wb_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap_i<span class="op">$</span>name)), </span>
<span id="cb53-6"><a href="microbiota.html#cb53-6"></a>    <span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb53-7"><a href="microbiota.html#cb53-7"></a></span>
<span id="cb53-8"><a href="microbiota.html#cb53-8"></a>overview &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_nums, sf_nums, wb_nums)</span>
<span id="cb53-9"><a href="microbiota.html#cb53-9"></a><span class="kw">colnames</span>(overview) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Total&quot;</span>, <span class="st">&quot;increasing&quot;</span>, <span class="st">&quot;decreasing&quot;</span>)</span>
<span id="cb53-10"><a href="microbiota.html#cb53-10"></a><span class="kw">rownames</span>(overview) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;G. barretti microbiota&quot;</span>, <span class="st">&quot;S. fortis microbiota&quot;</span>, <span class="st">&quot;W. bursa microbiota&quot;</span>)</span>
<span id="cb53-11"><a href="microbiota.html#cb53-11"></a>overview &lt;-<span class="st"> </span><span class="kw">data.frame</span>(overview)</span>
<span id="cb53-12"><a href="microbiota.html#cb53-12"></a>overview[<span class="st">&quot;unaffected&quot;</span>] &lt;-<span class="st"> </span>overview<span class="op">$</span>Total <span class="op">-</span><span class="st"> </span>(overview<span class="op">$</span>increasing <span class="op">+</span><span class="st"> </span>overview<span class="op">$</span>decreasing)</span>
<span id="cb53-13"><a href="microbiota.html#cb53-13"></a></span>
<span id="cb53-14"><a href="microbiota.html#cb53-14"></a><span class="kw">kable</span>(overview, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Total&quot;</span>, <span class="st">&quot;N OTUs increasing&quot;</span>, <span class="st">&quot;N OTUs decreasing&quot;</span>, </span>
<span id="cb53-15"><a href="microbiota.html#cb53-15"></a>    <span class="st">&quot;N OTUs unaffected&quot;</span>), <span class="dt">escape =</span> F, <span class="dt">align =</span> <span class="st">&quot;c&quot;</span>, <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Microbiota response to depth&quot;</span>, </span>
<span id="cb53-16"><a href="microbiota.html#cb53-16"></a>    <span class="st">&quot;html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>, </span>
<span id="cb53-17"><a href="microbiota.html#cb53-17"></a>    <span class="dt">latex_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="dt">full_width =</span> F))</span></code></pre></div>
<table class="table table-hover table-condensed table-responsive table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:increade-decrease">Table 3.4: </span>Microbiota response to depth
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Total
</th>
<th style="text-align:center;">
N OTUs increasing
</th>
<th style="text-align:center;">
N OTUs decreasing
</th>
<th style="text-align:center;">
N OTUs unaffected
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
G. barretti microbiota
</td>
<td style="text-align:center;">
420
</td>
<td style="text-align:center;">
82
</td>
<td style="text-align:center;">
58
</td>
<td style="text-align:center;">
280
</td>
</tr>
<tr>
<td style="text-align:left;">
S. fortis microbiota
</td>
<td style="text-align:center;">
461
</td>
<td style="text-align:center;">
72
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
357
</td>
</tr>
<tr>
<td style="text-align:left;">
W. bursa microbiota
</td>
<td style="text-align:center;">
135
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
111
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="microbiota.html#cb54-1"></a><span class="co"># overview &lt;- overview[,c(2:4)] overview[&#39;response&#39;] &lt;- rownames(overview) plot</span></span>
<span id="cb54-2"><a href="microbiota.html#cb54-2"></a><span class="co"># &lt;- melt(overview)</span></span>
<span id="cb54-3"><a href="microbiota.html#cb54-3"></a></span>
<span id="cb54-4"><a href="microbiota.html#cb54-4"></a><span class="co"># stacked &lt;- ggplot(plot, aes(x=response, y=value, fill=variable)) +</span></span>
<span id="cb54-5"><a href="microbiota.html#cb54-5"></a><span class="co"># geom_bar(position=&#39;stack&#39;, stat=&#39;identity&#39;)+ theme_minimal()+ggtitle(&#39;Stacked</span></span>
<span id="cb54-6"><a href="microbiota.html#cb54-6"></a><span class="co"># counts&#39;)+xlab(&#39;Sponge species&#39;)+ylab(&#39;OTU count&#39;)+ theme(axis.text.x =</span></span>
<span id="cb54-7"><a href="microbiota.html#cb54-7"></a><span class="co"># element_text(angle = 90, hjust = 1))</span></span>
<span id="cb54-8"><a href="microbiota.html#cb54-8"></a></span>
<span id="cb54-9"><a href="microbiota.html#cb54-9"></a><span class="co"># perc &lt;- ggplot(plot, aes(x=response, y=value, fill=variable)) +</span></span>
<span id="cb54-10"><a href="microbiota.html#cb54-10"></a><span class="co"># geom_bar(position=&#39;fill&#39;, stat=&#39;identity&#39;)+</span></span>
<span id="cb54-11"><a href="microbiota.html#cb54-11"></a><span class="co"># theme_minimal()+ggtitle(&#39;Percentages&#39;)+xlab(&#39;Sponge species&#39;)+ylab(&#39;relative</span></span>
<span id="cb54-12"><a href="microbiota.html#cb54-12"></a><span class="co"># OTU count&#39;)+ theme(axis.text.x = element_text(angle = 90, hjust = 1))</span></span>
<span id="cb54-13"><a href="microbiota.html#cb54-13"></a></span>
<span id="cb54-14"><a href="microbiota.html#cb54-14"></a><span class="co"># grid.arrange(stacked, perc, nrow=2) write.csv(gb_response, &#39;gb_response.csv&#39;)</span></span>
<span id="cb54-15"><a href="microbiota.html#cb54-15"></a><span class="co"># write.csv(sf_response, &#39;sf_response.csv&#39;) write.csv(wb_response,</span></span>
<span id="cb54-16"><a href="microbiota.html#cb54-16"></a><span class="co"># &#39;wb_response.csv&#39;)</span></span></code></pre></div>
<p>In this Fig.<a href="microbiota.html#fig:increade-decrease">3.10</a> as well as in Tab. <a href="microbiota.html#tab:increade-decrease">3.4</a>, we see that at the OTU level, we observe shifts. While sometimes more gradual, there seem to OTUs exclusievely present in the â€œshallowâ€ or the â€œdeepâ€ samples in all three sponges. In fact, in <em>G. barretti</em> and <em>S. fortis</em>, the number of OTUs increasing with depth (â€œdeep water mass microbiomeâ€) is greater than the number of OTUs decreasing. This leads us to believe that the deep water mass contains microbes yet to discover.</p>
</div>
<div id="sequence-similarity" class="section level2">
<h2><span class="header-section-number">3.7</span> Sequence similarity</h2>
<p>We produced fasta files, i.e.Â files containing the DNA sequences of the OTUs in the three sponges. The fasta header contains the following information: â€œOTU numberâ€_â€œdepth responseâ€_â€œphylumâ€_â€œclassâ€. The depth response is coded as â€œincreasingâ€ or â€œdecreasingâ€ if there is a significant correlation (<em>p</em><span class="math inline">\(\leq\)</span> 0.05) with depth and as â€œinc. trendâ€ or â€œdec. trendâ€ if the correlation is not significant (<em>p</em><span class="math inline">\(\geq\)</span> 0.05).
The fasta sequences were aligned with <a href="https://mafft.cbrc.jp/alignment/server/">MAFFT</a>. From the aligned seqeunces, we calculated the sequence similarity comparing all versus all, and retain in a file all comparisons yielding a sequence similarity <span class="math inline">\(\geq\)</span> 97%.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="microbiota.html#cb55-1"></a><span class="co"># Load one file at a time</span></span>
<span id="cb55-2"><a href="microbiota.html#cb55-2"></a>ali &lt;-<span class="st"> </span><span class="kw">read.alignment</span>(<span class="st">&quot;data/gb_reads_for_phylogeny_MAFFT.fasta&quot;</span>, <span class="st">&quot;fasta&quot;</span>)</span>
<span id="cb55-3"><a href="microbiota.html#cb55-3"></a>ali &lt;-<span class="st"> </span><span class="kw">read.alignment</span>(<span class="st">&quot;data/sf_reads_for_phylogeny_MAFFT.fasta&quot;</span>, <span class="st">&quot;fasta&quot;</span>)</span>
<span id="cb55-4"><a href="microbiota.html#cb55-4"></a>ali &lt;-<span class="st"> </span><span class="kw">read.alignment</span>(<span class="st">&quot;data/wb_reads_for_phylogeny_MAFFT.fasta&quot;</span>, <span class="st">&quot;fasta&quot;</span>)</span>
<span id="cb55-5"><a href="microbiota.html#cb55-5"></a></span>
<span id="cb55-6"><a href="microbiota.html#cb55-6"></a><span class="co"># FUN calculate pairwise distance, melt, keeps only entries with &gt;97% and &lt;1</span></span>
<span id="cb55-7"><a href="microbiota.html#cb55-7"></a><span class="co"># similarity with significant opposing trends in both partners.</span></span>
<span id="cb55-8"><a href="microbiota.html#cb55-8"></a>pw_dist &lt;-<span class="st"> </span><span class="cf">function</span>(ali) {</span>
<span id="cb55-9"><a href="microbiota.html#cb55-9"></a>    dist &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist.alignment</span>(ali, <span class="dt">matrix =</span> <span class="st">&quot;similarity&quot;</span>))  <span class="co">#https://www.researchgate.net/post/Homology_similarity_and_identity-can_anyone_help_with_these_terms</span></span>
<span id="cb55-10"><a href="microbiota.html#cb55-10"></a>    <span class="co"># dist.alignment: matrix contains the squared root of the pairwise distances. For</span></span>
<span id="cb55-11"><a href="microbiota.html#cb55-11"></a>    <span class="co"># example, if identity between 2 sequences is 80 the squared root of (1.0 - 0.8)</span></span>
<span id="cb55-12"><a href="microbiota.html#cb55-12"></a>    <span class="co"># i.e. 0.4472136.</span></span>
<span id="cb55-13"><a href="microbiota.html#cb55-13"></a>    dist &lt;-<span class="st"> </span>dist<span class="op">^</span><span class="dv">2</span></span>
<span id="cb55-14"><a href="microbiota.html#cb55-14"></a>    dist &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>dist</span>
<span id="cb55-15"><a href="microbiota.html#cb55-15"></a>    <span class="co"># dist is now &#39;%&#39; identity, 1=100 %</span></span>
<span id="cb55-16"><a href="microbiota.html#cb55-16"></a>    dist &lt;-<span class="st"> </span><span class="kw">melt</span>(dist)</span>
<span id="cb55-17"><a href="microbiota.html#cb55-17"></a>    <span class="co"># Remove irrelevant entries, i.e. self-comparison and similarities below the</span></span>
<span id="cb55-18"><a href="microbiota.html#cb55-18"></a>    <span class="co"># threshold, this step now speeds up later steps, but not mandatory</span></span>
<span id="cb55-19"><a href="microbiota.html#cb55-19"></a>    dist &lt;-<span class="st"> </span>dist[dist<span class="op">$</span>value <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.97</span>, ]</span>
<span id="cb55-20"><a href="microbiota.html#cb55-20"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>value <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ]</span>
<span id="cb55-21"><a href="microbiota.html#cb55-21"></a>    <span class="co"># This removes AB - BA duplicates but still contains self comprisons, AA, BB,CC</span></span>
<span id="cb55-22"><a href="microbiota.html#cb55-22"></a>    <span class="co"># etc.</span></span>
<span id="cb55-23"><a href="microbiota.html#cb55-23"></a>    cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Var1&quot;</span>, <span class="st">&quot;Var2&quot;</span>)</span>
<span id="cb55-24"><a href="microbiota.html#cb55-24"></a>    newdf &lt;-<span class="st"> </span>dist[, cols]</span>
<span id="cb55-25"><a href="microbiota.html#cb55-25"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(newdf)) {</span>
<span id="cb55-26"><a href="microbiota.html#cb55-26"></a>        newdf[i, ] =<span class="st"> </span><span class="kw">sort</span>(newdf[i, cols])</span>
<span id="cb55-27"><a href="microbiota.html#cb55-27"></a>    }</span>
<span id="cb55-28"><a href="microbiota.html#cb55-28"></a>    newdf &lt;-<span class="st"> </span>newdf[<span class="op">!</span><span class="kw">duplicated</span>(newdf), ]</span>
<span id="cb55-29"><a href="microbiota.html#cb55-29"></a>    <span class="co"># add back similarity values to the remaining comparisons/pairs</span></span>
<span id="cb55-30"><a href="microbiota.html#cb55-30"></a>    dist &lt;-<span class="st"> </span><span class="kw">left_join</span>(newdf, dist, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">Var1 =</span> <span class="st">&quot;Var1&quot;</span>, <span class="dt">Var2 =</span> <span class="st">&quot;Var2&quot;</span>))</span>
<span id="cb55-31"><a href="microbiota.html#cb55-31"></a>    dist[<span class="st">&quot;Var1_response&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(dist<span class="op">$</span>Var1, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb55-32"><a href="microbiota.html#cb55-32"></a>    dist[<span class="st">&quot;Var2_response&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(dist<span class="op">$</span>Var2, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb55-33"><a href="microbiota.html#cb55-33"></a>    <span class="co"># remove not significant comparisons</span></span>
<span id="cb55-34"><a href="microbiota.html#cb55-34"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>Var1_response <span class="op">==</span><span class="st"> &quot;dec.tr&quot;</span>, ]  <span class="co"># can be toggled off</span></span>
<span id="cb55-35"><a href="microbiota.html#cb55-35"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>Var1_response <span class="op">==</span><span class="st"> &quot;inc.tr&quot;</span>, ]  <span class="co"># can be toggled off</span></span>
<span id="cb55-36"><a href="microbiota.html#cb55-36"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>Var2_response <span class="op">==</span><span class="st"> &quot;dec.tr&quot;</span>, ]  <span class="co"># can be toggled off</span></span>
<span id="cb55-37"><a href="microbiota.html#cb55-37"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>Var2_response <span class="op">==</span><span class="st"> &quot;inc.tr&quot;</span>, ]  <span class="co"># can be toggled off</span></span>
<span id="cb55-38"><a href="microbiota.html#cb55-38"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>Var2_response <span class="op">==</span><span class="st"> </span>dist<span class="op">$</span>Var1_response, ]</span>
<span id="cb55-39"><a href="microbiota.html#cb55-39"></a>    <span class="co"># order</span></span>
<span id="cb55-40"><a href="microbiota.html#cb55-40"></a>    dist &lt;-<span class="st"> </span>dist[<span class="kw">order</span>(dist<span class="op">$</span>Var1_response, dist<span class="op">$</span>Var2_response), ]</span>
<span id="cb55-41"><a href="microbiota.html#cb55-41"></a>    <span class="kw">return</span>(dist)</span>
<span id="cb55-42"><a href="microbiota.html#cb55-42"></a>}</span>
<span id="cb55-43"><a href="microbiota.html#cb55-43"></a></span>
<span id="cb55-44"><a href="microbiota.html#cb55-44"></a>dist &lt;-<span class="st"> </span><span class="kw">pw_dist</span>(ali)</span>
<span id="cb55-45"><a href="microbiota.html#cb55-45"></a>dist</span>
<span id="cb55-46"><a href="microbiota.html#cb55-46"></a></span>
<span id="cb55-47"><a href="microbiota.html#cb55-47"></a><span class="co"># create csv file</span></span>
<span id="cb55-48"><a href="microbiota.html#cb55-48"></a><span class="kw">write.csv</span>(dist, <span class="st">&quot;~/Documents/Metabolomics/Depth_Gradient_study/R_depth_study/Phylogeny/gb_similarity.csv&quot;</span>)  <span class="co"># GB</span></span>
<span id="cb55-49"><a href="microbiota.html#cb55-49"></a><span class="kw">write.csv</span>(dist, <span class="st">&quot;~/Documents/Metabolomics/Depth_Gradient_study/R_depth_study/Phylogeny/sf_similarity.csv&quot;</span>)  <span class="co"># SF</span></span>
<span id="cb55-50"><a href="microbiota.html#cb55-50"></a><span class="kw">write.csv</span>(dist, <span class="st">&quot;~/Documents/Metabolomics/Depth_Gradient_study/R_depth_study/Phylogeny/wb_similarity.csv&quot;</span>)  <span class="co"># WB</span></span></code></pre></div>
<p>In <em>G. barretti</em> there are 34 pairs of OTUs with a sequence similarity <span class="math inline">\(\geq\)</span> 97% and opposing responses to depth, in <em>S. fortis</em> there are 11 pairs while in <em>W. bursa</em>, there are none.</p>
</div>
<div id="phylogeny" class="section level2">
<h2><span class="header-section-number">3.8</span> Phylogeny</h2>
<p>The MAFFT aligend fasta sequences of <em>G. barretti</em> OTUs were used to infer a phylogeny under maximum likelihood model in RaxML/Bayesian statistics.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="microbiota.html#cb56-1"></a><span class="co"># ====================== OCCURRENCE ============== REL ABDC On original data</span></span>
<span id="cb56-2"><a href="microbiota.html#cb56-2"></a><span class="co"># sets, NOT SQRT transformed (Y tho?) micros is sqrt transformed</span></span>
<span id="cb56-3"><a href="microbiota.html#cb56-3"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb56-4"><a href="microbiota.html#cb56-4"></a></span>
<span id="cb56-5"><a href="microbiota.html#cb56-5"></a><span class="co"># RUN occurrence gb_occurrence &lt;- overall_rabdc((micro_ds$gb**2)) #INDRA&#39;s way</span></span>
<span id="cb56-6"><a href="microbiota.html#cb56-6"></a><span class="co"># exponentiate (**2) to reverse sqrt sf_occurrence &lt;-</span></span>
<span id="cb56-7"><a href="microbiota.html#cb56-7"></a><span class="co"># overall_rabdc((micro_ds$sf**2)) wb_occurrence &lt;-</span></span>
<span id="cb56-8"><a href="microbiota.html#cb56-8"></a><span class="co"># overall_rabdc((micro_ds$wb**2))</span></span>
<span id="cb56-9"><a href="microbiota.html#cb56-9"></a></span>
<span id="cb56-10"><a href="microbiota.html#cb56-10"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb56-11"><a href="microbiota.html#cb56-11"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb56-12"><a href="microbiota.html#cb56-12"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb56-13"><a href="microbiota.html#cb56-13"></a></span>
<span id="cb56-14"><a href="microbiota.html#cb56-14"></a><span class="co"># only file dump write.csv(gb_occurrence, &#39;gb_occurrence_avg_rel_abdc_OTU.csv&#39;)</span></span>
<span id="cb56-15"><a href="microbiota.html#cb56-15"></a><span class="co"># write.csv(sf_occurrence, &#39;sf_occurrence_avg_rel_abdc_OTU.csv&#39;)</span></span>
<span id="cb56-16"><a href="microbiota.html#cb56-16"></a><span class="co"># write.csv(wb_occurrence, &#39;wb_occurrence_avg_rel_abdc_OTU.csv&#39;)</span></span>
<span id="cb56-17"><a href="microbiota.html#cb56-17"></a></span>
<span id="cb56-18"><a href="microbiota.html#cb56-18"></a><span class="kw">aggregate</span>(gb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(gb_occurrence<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-19"><a href="microbiota.html#cb56-19"></a><span class="kw">aggregate</span>(sf_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(sf_occurrence<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-20"><a href="microbiota.html#cb56-20"></a><span class="kw">aggregate</span>(wb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(wb_occurrence<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-21"><a href="microbiota.html#cb56-21"></a></span>
<span id="cb56-22"><a href="microbiota.html#cb56-22"></a><span class="co"># combined file dump gb_occurrence[&#39;XOTU&#39;] &lt;- rownames(gb_occurrence)</span></span>
<span id="cb56-23"><a href="microbiota.html#cb56-23"></a><span class="co"># sf_occurrence[&#39;XOTU&#39;] &lt;- rownames(sf_occurrence) wb_occurrence[&#39;XOTU&#39;] &lt;-</span></span>
<span id="cb56-24"><a href="microbiota.html#cb56-24"></a><span class="co"># rownames(wb_occurrence) gb_data &lt;- full_join(gb_response,</span></span>
<span id="cb56-25"><a href="microbiota.html#cb56-25"></a><span class="co"># gb_occurrence[,c(&#39;XOTU&#39;, &#39;avg_rel_abdc&#39;, &#39;occurrence&#39;)]) sf_data &lt;-</span></span>
<span id="cb56-26"><a href="microbiota.html#cb56-26"></a><span class="co"># full_join(sf_response, sf_occurrence[,c(&#39;XOTU&#39;, &#39;avg_rel_abdc&#39;, &#39;occurrence&#39;)])</span></span>
<span id="cb56-27"><a href="microbiota.html#cb56-27"></a><span class="co"># wb_data &lt;- full_join(wb_response, wb_occurrence[,c(&#39;XOTU&#39;, &#39;avg_rel_abdc&#39;,</span></span>
<span id="cb56-28"><a href="microbiota.html#cb56-28"></a><span class="co"># &#39;occurrence&#39;)]) taxonomy[&#39;dummy&#39;] &lt;- c(&#39;X&#39;) taxonomy[&#39;XOTU&#39;] &lt;-</span></span>
<span id="cb56-29"><a href="microbiota.html#cb56-29"></a><span class="co"># str_c(taxonomy$dummy, taxonomy$OTU_ID) taxonomy$dummy &lt;- NULL gb_data &lt;-</span></span>
<span id="cb56-30"><a href="microbiota.html#cb56-30"></a><span class="co"># left_join(gb_data, taxonomy) sf_data &lt;- left_join(sf_data, taxonomy) wb_data &lt;-</span></span>
<span id="cb56-31"><a href="microbiota.html#cb56-31"></a><span class="co"># left_join(wb_data, taxonomy) write.csv(gb_data, &#39;gb_data.csv&#39;)</span></span>
<span id="cb56-32"><a href="microbiota.html#cb56-32"></a><span class="co"># write.csv(sf_data, &#39;sf_data.csv&#39;) write.csv(wb_data, &#39;wb_data.csv&#39;)</span></span>
<span id="cb56-33"><a href="microbiota.html#cb56-33"></a></span>
<span id="cb56-34"><a href="microbiota.html#cb56-34"></a></span>
<span id="cb56-35"><a href="microbiota.html#cb56-35"></a></span>
<span id="cb56-36"><a href="microbiota.html#cb56-36"></a><span class="co"># quick_comparison</span></span>
<span id="cb56-37"><a href="microbiota.html#cb56-37"></a>gb_occurrence &lt;-<span class="st"> </span>gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb56-38"><a href="microbiota.html#cb56-38"></a>sf_occurrence &lt;-<span class="st"> </span>sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb56-39"><a href="microbiota.html#cb56-39"></a>wb_occurrence &lt;-<span class="st"> </span>wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb56-40"><a href="microbiota.html#cb56-40"></a></span>
<span id="cb56-41"><a href="microbiota.html#cb56-41"></a><span class="kw">colnames</span>(gb_occurrence) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gb.avg_rabdc&quot;</span>, <span class="st">&quot;gb.occurr&quot;</span>)</span>
<span id="cb56-42"><a href="microbiota.html#cb56-42"></a><span class="kw">colnames</span>(sf_occurrence) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sf.avg_rabdc&quot;</span>, <span class="st">&quot;sf.occurr&quot;</span>)</span>
<span id="cb56-43"><a href="microbiota.html#cb56-43"></a><span class="kw">colnames</span>(wb_occurrence) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;wb.avg_rabdc&quot;</span>, <span class="st">&quot;wb.occurr&quot;</span>)</span>
<span id="cb56-44"><a href="microbiota.html#cb56-44"></a></span>
<span id="cb56-45"><a href="microbiota.html#cb56-45"></a>gb_occurrence[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(gb_occurrence)</span>
<span id="cb56-46"><a href="microbiota.html#cb56-46"></a>sf_occurrence[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(sf_occurrence)</span>
<span id="cb56-47"><a href="microbiota.html#cb56-47"></a>wb_occurrence[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(wb_occurrence)</span>
<span id="cb56-48"><a href="microbiota.html#cb56-48"></a></span>
<span id="cb56-49"><a href="microbiota.html#cb56-49"></a><span class="kw">aggregate</span>(gb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(gb_occurrence<span class="op">$</span>gb.occurr), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-50"><a href="microbiota.html#cb56-50"></a><span class="kw">aggregate</span>(sf_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(sf_occurrence<span class="op">$</span>sf.occurr), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-51"><a href="microbiota.html#cb56-51"></a><span class="kw">aggregate</span>(wb_occurrence, <span class="dt">by =</span> <span class="kw">list</span>(wb_occurrence<span class="op">$</span>wb.occurr), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-52"><a href="microbiota.html#cb56-52"></a></span>
<span id="cb56-53"><a href="microbiota.html#cb56-53"></a>occurrence_sqrt &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb_occurrence, sf_occurrence)</span>
<span id="cb56-54"><a href="microbiota.html#cb56-54"></a>occurrence_sqrt &lt;-<span class="st"> </span><span class="kw">full_join</span>(occurrence_sqrt, wb_occurrence)</span>
<span id="cb56-55"><a href="microbiota.html#cb56-55"></a><span class="kw">head</span>(occurrence_sqrt)</span>
<span id="cb56-56"><a href="microbiota.html#cb56-56"></a></span>
<span id="cb56-57"><a href="microbiota.html#cb56-57"></a>occurrence_exp.raw &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb_occurrence, sf_occurrence)</span>
<span id="cb56-58"><a href="microbiota.html#cb56-58"></a>occurrence_exp.raw &lt;-<span class="st"> </span><span class="kw">full_join</span>(occurrence_exp.raw, wb_occurrence)</span>
<span id="cb56-59"><a href="microbiota.html#cb56-59"></a><span class="kw">head</span>(occurrence_exp.raw)</span>
<span id="cb56-60"><a href="microbiota.html#cb56-60"></a></span>
<span id="cb56-61"><a href="microbiota.html#cb56-61"></a><span class="co"># ====================== overview phylum class ========== For figures (OTU</span></span>
<span id="cb56-62"><a href="microbiota.html#cb56-62"></a><span class="co"># relative abdc heatmaps), and inc-dec correlations. Requires OTU_prep_sqrt.</span></span>
<span id="cb56-63"><a href="microbiota.html#cb56-63"></a></span>
<span id="cb56-64"><a href="microbiota.html#cb56-64"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb56-65"><a href="microbiota.html#cb56-65"></a><span class="co"># RUN calculate relative abundance of OTU across sponge samples</span></span>
<span id="cb56-66"><a href="microbiota.html#cb56-66"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb56-67"><a href="microbiota.html#cb56-67"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb56-68"><a href="microbiota.html#cb56-68"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb56-69"><a href="microbiota.html#cb56-69"></a></span>
<span id="cb56-70"><a href="microbiota.html#cb56-70"></a>occurrence &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb_occurrence, <span class="dt">sf =</span> sf_occurrence, <span class="dt">wb =</span> wb_occurrence)</span>
<span id="cb56-71"><a href="microbiota.html#cb56-71"></a>taxes &lt;-<span class="st"> </span><span class="kw">aggregations</span>(taxonomy, occurrence)</span>
<span id="cb56-72"><a href="microbiota.html#cb56-72"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb56-73"><a href="microbiota.html#cb56-73"></a></span>
<span id="cb56-74"><a href="microbiota.html#cb56-74"></a>phy_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))  <span class="co">#OTU count</span></span>
<span id="cb56-75"><a href="microbiota.html#cb56-75"></a>phy_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, </span>
<span id="cb56-76"><a href="microbiota.html#cb56-76"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))  <span class="co">#sums relative abundance</span></span>
<span id="cb56-77"><a href="microbiota.html#cb56-77"></a></span>
<span id="cb56-78"><a href="microbiota.html#cb56-78"></a>class_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb56-79"><a href="microbiota.html#cb56-79"></a>    <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb56-80"><a href="microbiota.html#cb56-80"></a>class_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, </span>
<span id="cb56-81"><a href="microbiota.html#cb56-81"></a>    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span>
<span id="cb56-82"><a href="microbiota.html#cb56-82"></a><span class="co"># all collected in Excel file. Done. Microbiome_aggregation_phylum_class.xlsx ,</span></span>
<span id="cb56-83"><a href="microbiota.html#cb56-83"></a><span class="co"># in &#39;/writing/&#39;.</span></span>
<span id="cb56-84"><a href="microbiota.html#cb56-84"></a></span>
<span id="cb56-85"><a href="microbiota.html#cb56-85"></a><span class="co"># Statistic comparison based on averages of relative abundance of phyla and</span></span>
<span id="cb56-86"><a href="microbiota.html#cb56-86"></a><span class="co"># classes CLASS</span></span>
<span id="cb56-87"><a href="microbiota.html#cb56-87"></a>class &lt;-<span class="st"> </span><span class="kw">full_join</span>(class_rabdc<span class="op">$</span>gb, class_rabdc<span class="op">$</span>sf, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>))</span>
<span id="cb56-88"><a href="microbiota.html#cb56-88"></a>class &lt;-<span class="st"> </span><span class="kw">full_join</span>(class, class_rabdc<span class="op">$</span>wb, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>))</span>
<span id="cb56-89"><a href="microbiota.html#cb56-89"></a><span class="kw">colnames</span>(class) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;gb_avg&quot;</span>, <span class="st">&quot;sf_avg&quot;</span>, <span class="st">&quot;wb_avg&quot;</span>)</span>
<span id="cb56-90"><a href="microbiota.html#cb56-90"></a></span>
<span id="cb56-91"><a href="microbiota.html#cb56-91"></a>class<span class="op">$</span>gb_avg[<span class="kw">is.na</span>(class<span class="op">$</span>gb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-92"><a href="microbiota.html#cb56-92"></a>class<span class="op">$</span>sf_avg[<span class="kw">is.na</span>(class<span class="op">$</span>sf_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-93"><a href="microbiota.html#cb56-93"></a>class<span class="op">$</span>wb_avg[<span class="kw">is.na</span>(class<span class="op">$</span>wb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-94"><a href="microbiota.html#cb56-94"></a></span>
<span id="cb56-95"><a href="microbiota.html#cb56-95"></a><span class="kw">head</span>(class)</span>
<span id="cb56-96"><a href="microbiota.html#cb56-96"></a><span class="kw">kruskal.test</span>(class[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)])  <span class="co">#p-value = 3.364e-05 # all three</span></span>
<span id="cb56-97"><a href="microbiota.html#cb56-97"></a><span class="kw">kruskal.test</span>(class[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)])  <span class="co">#p-value = 0.6594    # gb &amp; sf</span></span>
<span id="cb56-98"><a href="microbiota.html#cb56-98"></a></span>
<span id="cb56-99"><a href="microbiota.html#cb56-99"></a><span class="co"># PHYLUM</span></span>
<span id="cb56-100"><a href="microbiota.html#cb56-100"></a>phylum &lt;-<span class="st"> </span><span class="kw">full_join</span>(phy_rabdc<span class="op">$</span>gb, phy_rabdc<span class="op">$</span>sf, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>))</span>
<span id="cb56-101"><a href="microbiota.html#cb56-101"></a>phylum &lt;-<span class="st"> </span><span class="kw">full_join</span>(phylum, phy_rabdc<span class="op">$</span>wb, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>))</span>
<span id="cb56-102"><a href="microbiota.html#cb56-102"></a><span class="kw">colnames</span>(phylum) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;gb_avg&quot;</span>, <span class="st">&quot;sf_avg&quot;</span>, <span class="st">&quot;wb_avg&quot;</span>)</span>
<span id="cb56-103"><a href="microbiota.html#cb56-103"></a></span>
<span id="cb56-104"><a href="microbiota.html#cb56-104"></a>phylum<span class="op">$</span>gb_avg[<span class="kw">is.na</span>(phylum<span class="op">$</span>gb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-105"><a href="microbiota.html#cb56-105"></a>phylum<span class="op">$</span>sf_avg[<span class="kw">is.na</span>(phylum<span class="op">$</span>sf_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-106"><a href="microbiota.html#cb56-106"></a>phylum<span class="op">$</span>wb_avg[<span class="kw">is.na</span>(phylum<span class="op">$</span>wb_avg)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-107"><a href="microbiota.html#cb56-107"></a></span>
<span id="cb56-108"><a href="microbiota.html#cb56-108"></a><span class="kw">head</span>(phylum)</span>
<span id="cb56-109"><a href="microbiota.html#cb56-109"></a><span class="kw">kruskal.test</span>(phylum[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)])  <span class="co">#p-value = 0.2915 # all three</span></span>
<span id="cb56-110"><a href="microbiota.html#cb56-110"></a><span class="kw">kruskal.test</span>(phylum[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)])  <span class="co">#p-value = 0.5102    # gb &amp; sf</span></span>
<span id="cb56-111"><a href="microbiota.html#cb56-111"></a></span>
<span id="cb56-112"><a href="microbiota.html#cb56-112"></a><span class="co"># ======================= Testing differences at phylum and class level</span></span>
<span id="cb56-113"><a href="microbiota.html#cb56-113"></a><span class="co"># ===========</span></span>
<span id="cb56-114"><a href="microbiota.html#cb56-114"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb56-115"><a href="microbiota.html#cb56-115"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb56-116"><a href="microbiota.html#cb56-116"></a></span>
<span id="cb56-117"><a href="microbiota.html#cb56-117"></a><span class="co"># PHYLUM</span></span>
<span id="cb56-118"><a href="microbiota.html#cb56-118"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb56-119"><a href="microbiota.html#cb56-119"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb56-120"><a href="microbiota.html#cb56-120"></a></span>
<span id="cb56-121"><a href="microbiota.html#cb56-121"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb56-122"><a href="microbiota.html#cb56-122"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb56-123"><a href="microbiota.html#cb56-123"></a>    x</span>
<span id="cb56-124"><a href="microbiota.html#cb56-124"></a>})</span>
<span id="cb56-125"><a href="microbiota.html#cb56-125"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb56-126"><a href="microbiota.html#cb56-126"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb56-127"><a href="microbiota.html#cb56-127"></a>    x</span>
<span id="cb56-128"><a href="microbiota.html#cb56-128"></a>})</span>
<span id="cb56-129"><a href="microbiota.html#cb56-129"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb56-130"><a href="microbiota.html#cb56-130"></a>    x[<span class="st">&quot;Class&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb56-131"><a href="microbiota.html#cb56-131"></a>    x</span>
<span id="cb56-132"><a href="microbiota.html#cb56-132"></a>})</span>
<span id="cb56-133"><a href="microbiota.html#cb56-133"></a><span class="kw">head</span>(taxes)</span>
<span id="cb56-134"><a href="microbiota.html#cb56-134"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb56-135"><a href="microbiota.html#cb56-135"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb56-136"><a href="microbiota.html#cb56-136"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb56-137"><a href="microbiota.html#cb56-137"></a></span>
<span id="cb56-138"><a href="microbiota.html#cb56-138"></a><span class="co"># for this to work, dono&#39;t run: taxes &lt;- lapply(taxes, function(x) {x[&#39;Class&#39;] &lt;-</span></span>
<span id="cb56-139"><a href="microbiota.html#cb56-139"></a><span class="co"># NULL; x}) gb &lt;- aggregate(taxes$gb[,3:dim(taxes$gb)[2]],</span></span>
<span id="cb56-140"><a href="microbiota.html#cb56-140"></a><span class="co"># list(taxes$gb[,&#39;Phylum&#39;], taxes$gb[,&#39;Class&#39;]), sum) #works sf &lt;-</span></span>
<span id="cb56-141"><a href="microbiota.html#cb56-141"></a><span class="co"># aggregate(taxes$sf[,3:dim(taxes$sf)[2]], list(taxes$sf[,&#39;Phylum&#39;],</span></span>
<span id="cb56-142"><a href="microbiota.html#cb56-142"></a><span class="co"># taxes$sf[,&#39;Class&#39;]), sum) #works wb &lt;- aggregate(taxes$wb[,3:dim(taxes$wb)[2]],</span></span>
<span id="cb56-143"><a href="microbiota.html#cb56-143"></a><span class="co"># list(taxes$wb[,&#39;Phylum&#39;], taxes$wb[,&#39;Class&#39;]), sum) #works</span></span>
<span id="cb56-144"><a href="microbiota.html#cb56-144"></a></span>
<span id="cb56-145"><a href="microbiota.html#cb56-145"></a></span>
<span id="cb56-146"><a href="microbiota.html#cb56-146"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb56-147"><a href="microbiota.html#cb56-147"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_phy, wb)</span>
<span id="cb56-148"><a href="microbiota.html#cb56-148"></a>taxes_phy[<span class="kw">is.na</span>(taxes_phy)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-149"><a href="microbiota.html#cb56-149"></a><span class="kw">head</span>(taxes_phy)</span>
<span id="cb56-150"><a href="microbiota.html#cb56-150"></a></span>
<span id="cb56-151"><a href="microbiota.html#cb56-151"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_phy, sum)</span></span>
<span id="cb56-152"><a href="microbiota.html#cb56-152"></a><span class="kw">rownames</span>(taxes_phy) &lt;-<span class="st"> </span>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb56-153"><a href="microbiota.html#cb56-153"></a>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb56-154"><a href="microbiota.html#cb56-154"></a></span>
<span id="cb56-155"><a href="microbiota.html#cb56-155"></a>taxes_phy_t &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_phy))</span>
<span id="cb56-156"><a href="microbiota.html#cb56-156"></a>specs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(taxes_phy_t))</span>
<span id="cb56-157"><a href="microbiota.html#cb56-157"></a><span class="kw">colnames</span>(specs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>)</span>
<span id="cb56-158"><a href="microbiota.html#cb56-158"></a>specs[<span class="st">&quot;species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(specs<span class="op">$</span>Sample_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb56-159"><a href="microbiota.html#cb56-159"></a></span>
<span id="cb56-160"><a href="microbiota.html#cb56-160"></a><span class="co"># Permutational anova</span></span>
<span id="cb56-161"><a href="microbiota.html#cb56-161"></a><span class="kw">adonis</span>(taxes_phy_t <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species)  <span class="co">#all three species //significant</span></span>
<span id="cb56-162"><a href="microbiota.html#cb56-162"></a><span class="kw">adonis</span>(taxes_phy_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ] <span class="op">~</span><span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), <span class="dv">2</span>])  <span class="co">#only Gb and Sf //significant</span></span>
<span id="cb56-163"><a href="microbiota.html#cb56-163"></a></span>
<span id="cb56-164"><a href="microbiota.html#cb56-164"></a><span class="co"># Compare variation of relative abundance of each phylum/class among/within the</span></span>
<span id="cb56-165"><a href="microbiota.html#cb56-165"></a><span class="co"># two/three groups ANOVA (three groups)</span></span>
<span id="cb56-166"><a href="microbiota.html#cb56-166"></a><span class="kw">apply</span>(taxes_phy_t, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb56-167"><a href="microbiota.html#cb56-167"></a>    <span class="kw">summary</span>(<span class="kw">aov</span>(x <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species))</span>
<span id="cb56-168"><a href="microbiota.html#cb56-168"></a>})</span>
<span id="cb56-169"><a href="microbiota.html#cb56-169"></a><span class="co"># of course they&#39;re all different, this includes Weberella.</span></span>
<span id="cb56-170"><a href="microbiota.html#cb56-170"></a></span>
<span id="cb56-171"><a href="microbiota.html#cb56-171"></a><span class="co"># Mann-Whittney U aka Wilcoxon rank sum test(two groups, gb vs sf)</span></span>
<span id="cb56-172"><a href="microbiota.html#cb56-172"></a>gbsf_phy &lt;-<span class="st"> </span>taxes_phy_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb56-173"><a href="microbiota.html#cb56-173"></a>gbsf_spec &lt;-<span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb56-174"><a href="microbiota.html#cb56-174"></a><span class="kw">apply</span>(gbsf_phy, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb56-175"><a href="microbiota.html#cb56-175"></a>    <span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species)</span>
<span id="cb56-176"><a href="microbiota.html#cb56-176"></a>})</span>
<span id="cb56-177"><a href="microbiota.html#cb56-177"></a><span class="kw">apply</span>(gbsf_phy, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb56-178"><a href="microbiota.html#cb56-178"></a>    (<span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species))[<span class="st">&quot;p.value&quot;</span>]</span>
<span id="cb56-179"><a href="microbiota.html#cb56-179"></a>})  <span class="co">#This is really the result we want</span></span>
<span id="cb56-180"><a href="microbiota.html#cb56-180"></a></span>
<span id="cb56-181"><a href="microbiota.html#cb56-181"></a><span class="co"># CLASS</span></span>
<span id="cb56-182"><a href="microbiota.html#cb56-182"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb56-183"><a href="microbiota.html#cb56-183"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb56-184"><a href="microbiota.html#cb56-184"></a></span>
<span id="cb56-185"><a href="microbiota.html#cb56-185"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb56-186"><a href="microbiota.html#cb56-186"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb56-187"><a href="microbiota.html#cb56-187"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb56-188"><a href="microbiota.html#cb56-188"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb56-189"><a href="microbiota.html#cb56-189"></a>    x</span>
<span id="cb56-190"><a href="microbiota.html#cb56-190"></a>})</span>
<span id="cb56-191"><a href="microbiota.html#cb56-191"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb56-192"><a href="microbiota.html#cb56-192"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb56-193"><a href="microbiota.html#cb56-193"></a>    x</span>
<span id="cb56-194"><a href="microbiota.html#cb56-194"></a>})</span>
<span id="cb56-195"><a href="microbiota.html#cb56-195"></a></span>
<span id="cb56-196"><a href="microbiota.html#cb56-196"></a><span class="co"># ================out=================== gb &lt;- taxes$gb sf &lt;- taxes$sf wb &lt;-</span></span>
<span id="cb56-197"><a href="microbiota.html#cb56-197"></a><span class="co"># taxes$wb Renaming &amp; removing whitespaces gb$Phylum &lt;-</span></span>
<span id="cb56-198"><a href="microbiota.html#cb56-198"></a><span class="co"># as.character(str_trim(as.character(gb$Phylum))) sf$Phylum &lt;-</span></span>
<span id="cb56-199"><a href="microbiota.html#cb56-199"></a><span class="co"># as.character(str_trim(as.character(sf$Phylum))) wb$Phylum &lt;-</span></span>
<span id="cb56-200"><a href="microbiota.html#cb56-200"></a><span class="co"># as.character(str_trim(as.character(wb$Phylum))) gb$Class &lt;-</span></span>
<span id="cb56-201"><a href="microbiota.html#cb56-201"></a><span class="co"># as.character(str_trim(as.character(gb$Class))) sf$Class &lt;-</span></span>
<span id="cb56-202"><a href="microbiota.html#cb56-202"></a><span class="co"># as.character(str_trim(as.character(sf$Class))) wb$Class &lt;-</span></span>
<span id="cb56-203"><a href="microbiota.html#cb56-203"></a><span class="co"># as.character(str_trim(as.character(wb$Class))) GB</span></span>
<span id="cb56-204"><a href="microbiota.html#cb56-204"></a><span class="co"># gb$Class[(gb$Phylum==&#39;PAUC34f&#39;)] &lt;- &#39;PAUC34f_unclassified&#39;</span></span>
<span id="cb56-205"><a href="microbiota.html#cb56-205"></a><span class="co"># gb$Class[(gb$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39; gb$Phylum[(gb$Phylum==&#39;&#39;)] &lt;-</span></span>
<span id="cb56-206"><a href="microbiota.html#cb56-206"></a><span class="co"># &#39;unclassified&#39; gb$Class[(gb$Phylum==&#39;Tectomicrobia&#39;)] &lt;-</span></span>
<span id="cb56-207"><a href="microbiota.html#cb56-207"></a><span class="co"># &#39;Tectomicrobia_unclassified&#39; gb$Class[(gb$Phylum==&#39;SBR1093&#39;)] &lt;-</span></span>
<span id="cb56-208"><a href="microbiota.html#cb56-208"></a><span class="co"># &#39;SBR1093_unclassified&#39; gb$Class[(gb$Phylum==&#39;Poribacteria&#39;)] &lt;-</span></span>
<span id="cb56-209"><a href="microbiota.html#cb56-209"></a><span class="co"># &#39;Poribacteria_unclassified&#39; gb$Class[gb$Phylum==&#39;Chloroflexi&#39; &amp; gb$Class==&#39;&#39;]</span></span>
<span id="cb56-210"><a href="microbiota.html#cb56-210"></a><span class="co"># &lt;- &#39;Chloroflexi_unclassified&#39; SF sf$Class[(sf$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39;</span></span>
<span id="cb56-211"><a href="microbiota.html#cb56-211"></a><span class="co"># sf$Phylum[(sf$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39; sf$Class[(sf$Phylum==&#39;PAUC34f&#39;)]</span></span>
<span id="cb56-212"><a href="microbiota.html#cb56-212"></a><span class="co"># &lt;- &#39;PAUC34f_unclassified&#39; sf$Class[(sf$Phylum==&#39;Proteobacteria&#39; &amp;</span></span>
<span id="cb56-213"><a href="microbiota.html#cb56-213"></a><span class="co"># sf$Class==&#39;&#39;)] &lt;- &#39;Proteobacteria_unclassified&#39;</span></span>
<span id="cb56-214"><a href="microbiota.html#cb56-214"></a><span class="co"># sf$Class[(sf$Phylum==&#39;Tectomicrobia&#39;)] &lt;- &#39;Tectomicrobia_unclassified&#39;</span></span>
<span id="cb56-215"><a href="microbiota.html#cb56-215"></a><span class="co"># sf$Class[(sf$Phylum==&#39;SBR1093&#39;)] &lt;- &#39;SBR1093_unclassified&#39;</span></span>
<span id="cb56-216"><a href="microbiota.html#cb56-216"></a><span class="co"># sf$Class[(sf$Phylum==&#39;Poribacteria&#39;)] &lt;- &#39;Poribacteria_unclassified&#39; WB</span></span>
<span id="cb56-217"><a href="microbiota.html#cb56-217"></a><span class="co"># wb$Class[(wb$Phylum==&#39;&#39;)] &lt;- &#39;unclassified&#39; wb$Phylum[(wb$Phylum==&#39;&#39;)] &lt;-</span></span>
<span id="cb56-218"><a href="microbiota.html#cb56-218"></a><span class="co"># &#39;unclassified&#39; merge back taxes &lt;- list(gb=gb, sf=sf, wb=wb)</span></span>
<span id="cb56-219"><a href="microbiota.html#cb56-219"></a><span class="co"># =========================================</span></span>
<span id="cb56-220"><a href="microbiota.html#cb56-220"></a></span>
<span id="cb56-221"><a href="microbiota.html#cb56-221"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb56-222"><a href="microbiota.html#cb56-222"></a>    x[<span class="st">&quot;Phylum&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb56-223"><a href="microbiota.html#cb56-223"></a>    x</span>
<span id="cb56-224"><a href="microbiota.html#cb56-224"></a>})</span>
<span id="cb56-225"><a href="microbiota.html#cb56-225"></a><span class="kw">head</span>(taxes)</span>
<span id="cb56-226"><a href="microbiota.html#cb56-226"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Class&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb56-227"><a href="microbiota.html#cb56-227"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Class&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb56-228"><a href="microbiota.html#cb56-228"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Class&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb56-229"><a href="microbiota.html#cb56-229"></a></span>
<span id="cb56-230"><a href="microbiota.html#cb56-230"></a>taxes_cla &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb56-231"><a href="microbiota.html#cb56-231"></a>taxes_cla &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_cla, wb)</span>
<span id="cb56-232"><a href="microbiota.html#cb56-232"></a>taxes_cla[<span class="kw">is.na</span>(taxes_cla)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb56-233"><a href="microbiota.html#cb56-233"></a><span class="kw">head</span>(taxes_cla)</span>
<span id="cb56-234"><a href="microbiota.html#cb56-234"></a></span>
<span id="cb56-235"><a href="microbiota.html#cb56-235"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_cla, sum)</span></span>
<span id="cb56-236"><a href="microbiota.html#cb56-236"></a><span class="kw">rownames</span>(taxes_cla) &lt;-<span class="st"> </span>taxes_cla<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb56-237"><a href="microbiota.html#cb56-237"></a>taxes_cla<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb56-238"><a href="microbiota.html#cb56-238"></a></span>
<span id="cb56-239"><a href="microbiota.html#cb56-239"></a>taxes_cla_t &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_cla))</span>
<span id="cb56-240"><a href="microbiota.html#cb56-240"></a>specs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(taxes_cla_t))</span>
<span id="cb56-241"><a href="microbiota.html#cb56-241"></a><span class="kw">colnames</span>(specs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>)</span>
<span id="cb56-242"><a href="microbiota.html#cb56-242"></a>specs[<span class="st">&quot;species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(specs<span class="op">$</span>Sample_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb56-243"><a href="microbiota.html#cb56-243"></a></span>
<span id="cb56-244"><a href="microbiota.html#cb56-244"></a><span class="co"># Permutational anova</span></span>
<span id="cb56-245"><a href="microbiota.html#cb56-245"></a><span class="kw">adonis</span>(taxes_cla_t <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species)  <span class="co">#all three species //significant</span></span>
<span id="cb56-246"><a href="microbiota.html#cb56-246"></a><span class="kw">adonis</span>(taxes_cla_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ] <span class="op">~</span><span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), <span class="dv">2</span>])  <span class="co">#only Gb and Sf //significant</span></span>
<span id="cb56-247"><a href="microbiota.html#cb56-247"></a></span>
<span id="cb56-248"><a href="microbiota.html#cb56-248"></a><span class="co"># Compare variation of relative abundance of each clalum/class among/within the</span></span>
<span id="cb56-249"><a href="microbiota.html#cb56-249"></a><span class="co"># two/three groups ANOVA (three groups)</span></span>
<span id="cb56-250"><a href="microbiota.html#cb56-250"></a><span class="kw">apply</span>(taxes_cla_t, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb56-251"><a href="microbiota.html#cb56-251"></a>    <span class="kw">summary</span>(<span class="kw">aov</span>(x <span class="op">~</span><span class="st"> </span>specs<span class="op">$</span>species))</span>
<span id="cb56-252"><a href="microbiota.html#cb56-252"></a>})</span>
<span id="cb56-253"><a href="microbiota.html#cb56-253"></a><span class="co"># of course they&#39;re all different, this includes Weberella.</span></span>
<span id="cb56-254"><a href="microbiota.html#cb56-254"></a></span>
<span id="cb56-255"><a href="microbiota.html#cb56-255"></a><span class="co"># Mann-Whittney U aka Wilcoxon rank sum test(two groups, gb vs sf)</span></span>
<span id="cb56-256"><a href="microbiota.html#cb56-256"></a>gbsf_cla &lt;-<span class="st"> </span>taxes_cla_t[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb56-257"><a href="microbiota.html#cb56-257"></a>gbsf_spec &lt;-<span class="st"> </span>specs[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), ]</span>
<span id="cb56-258"><a href="microbiota.html#cb56-258"></a><span class="kw">apply</span>(gbsf_cla, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb56-259"><a href="microbiota.html#cb56-259"></a>    <span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species)</span>
<span id="cb56-260"><a href="microbiota.html#cb56-260"></a>})</span>
<span id="cb56-261"><a href="microbiota.html#cb56-261"></a><span class="kw">apply</span>(gbsf_cla, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb56-262"><a href="microbiota.html#cb56-262"></a>    (<span class="kw">wilcox.test</span>(x <span class="op">~</span><span class="st"> </span>gbsf_spec<span class="op">$</span>species))[<span class="st">&quot;p.value&quot;</span>]</span>
<span id="cb56-263"><a href="microbiota.html#cb56-263"></a>})</span>
<span id="cb56-264"><a href="microbiota.html#cb56-264"></a></span>
<span id="cb56-265"><a href="microbiota.html#cb56-265"></a><span class="co">### =========================================== For plotting</span></span>
<span id="cb56-266"><a href="microbiota.html#cb56-266"></a><span class="co">### ================================</span></span>
<span id="cb56-267"><a href="microbiota.html#cb56-267"></a></span>
<span id="cb56-268"><a href="microbiota.html#cb56-268"></a><span class="co"># YAS!</span></span>
<span id="cb56-269"><a href="microbiota.html#cb56-269"></a>taxes_phy_m &lt;-<span class="st"> </span>taxes_phy_t</span>
<span id="cb56-270"><a href="microbiota.html#cb56-270"></a>taxes_phy_m[<span class="st">&quot;Sample_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(taxes_phy_m)</span>
<span id="cb56-271"><a href="microbiota.html#cb56-271"></a>taxes_phy_m &lt;-<span class="st"> </span><span class="kw">melt</span>(taxes_phy_m, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>))</span>
<span id="cb56-272"><a href="microbiota.html#cb56-272"></a>taxes_phy_m[<span class="st">&quot;Phylum&quot;</span>] &lt;-<span class="st"> </span>taxes_phy_m<span class="op">$</span>variable</span>
<span id="cb56-273"><a href="microbiota.html#cb56-273"></a><span class="co"># taxes_phy_m$Phylum[taxes_phy_m$Phylum==&#39;classified&#39;] &lt;- &#39;unclassified&#39;</span></span>
<span id="cb56-274"><a href="microbiota.html#cb56-274"></a>taxes_phy_m</span>
<span id="cb56-275"><a href="microbiota.html#cb56-275"></a></span>
<span id="cb56-276"><a href="microbiota.html#cb56-276"></a><span class="kw">unique</span>(taxes_phy_m<span class="op">$</span>Phylum)</span>
<span id="cb56-277"><a href="microbiota.html#cb56-277"></a></span>
<span id="cb56-278"><a href="microbiota.html#cb56-278"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb56-279"><a href="microbiota.html#cb56-279"></a>phylum_palette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#b8c4f6&quot;</span>, <span class="st">&quot;#ffaaaf&quot;</span>, <span class="st">&quot;#3d1349&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#01559d&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, </span>
<span id="cb56-280"><a href="microbiota.html#cb56-280"></a>    <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#019c51&quot;</span>, <span class="st">&quot;#b10060&quot;</span>, <span class="st">&quot;#49ca00&quot;</span>, <span class="st">&quot;#dd8e00&quot;</span>, </span>
<span id="cb56-281"><a href="microbiota.html#cb56-281"></a>    <span class="st">&quot;#f282ff&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#ff633f&quot;</span>, <span class="st">&quot;#ec0040&quot;</span>, <span class="st">&quot;#010b92&quot;</span>, <span class="st">&quot;#cf00aa&quot;</span>, <span class="st">&quot;#aba900&quot;</span>, </span>
<span id="cb56-282"><a href="microbiota.html#cb56-282"></a>    <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#fce300&quot;</span>)</span>
<span id="cb56-283"><a href="microbiota.html#cb56-283"></a><span class="kw">ggplot</span>(taxes_phy_m, <span class="kw">aes</span>(<span class="dt">x =</span> Sample_ID, <span class="dt">y =</span> value, <span class="dt">fill =</span> Phylum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb56-284"><a href="microbiota.html#cb56-284"></a><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb56-285"><a href="microbiota.html#cb56-285"></a><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">&quot;Gb1&quot;</span>, <span class="st">&quot;Gb2&quot;</span>, <span class="st">&quot;Gb3&quot;</span>, <span class="st">&quot;Gb4&quot;</span>, <span class="st">&quot;Gb5&quot;</span>, <span class="st">&quot;Gb6&quot;</span>, </span>
<span id="cb56-286"><a href="microbiota.html#cb56-286"></a>    <span class="st">&quot;Gb7&quot;</span>, <span class="st">&quot;Gb8&quot;</span>, <span class="st">&quot;Gb9&quot;</span>, <span class="st">&quot;Gb10&quot;</span>, <span class="st">&quot;Gb11&quot;</span>, <span class="st">&quot;Gb12&quot;</span>, <span class="st">&quot;Gb13&quot;</span>, <span class="st">&quot;Gb14&quot;</span>, <span class="st">&quot;Sf1&quot;</span>, <span class="st">&quot;Sf2&quot;</span>, <span class="st">&quot;Sf3&quot;</span>, </span>
<span id="cb56-287"><a href="microbiota.html#cb56-287"></a>    <span class="st">&quot;Sf4&quot;</span>, <span class="st">&quot;Sf5&quot;</span>, <span class="st">&quot;Sf6&quot;</span>, <span class="st">&quot;Sf7&quot;</span>, <span class="st">&quot;Sf8&quot;</span>, <span class="st">&quot;Sf9&quot;</span>, <span class="st">&quot;Sf10&quot;</span>, <span class="st">&quot;Sf11&quot;</span>, <span class="st">&quot;Sf12&quot;</span>, <span class="st">&quot;Sf13&quot;</span>, <span class="st">&quot;Sf14&quot;</span>, </span>
<span id="cb56-288"><a href="microbiota.html#cb56-288"></a>    <span class="st">&quot;Sf15&quot;</span>, <span class="st">&quot;Wb1&quot;</span>, <span class="st">&quot;Wb2&quot;</span>, <span class="st">&quot;Wb3&quot;</span>, <span class="st">&quot;Wb4&quot;</span>, <span class="st">&quot;Wb5&quot;</span>, <span class="st">&quot;Wb6&quot;</span>, <span class="st">&quot;Wb7&quot;</span>, <span class="st">&quot;Wb8&quot;</span>, <span class="st">&quot;Wb9&quot;</span>, <span class="st">&quot;Wb10&quot;</span>, </span>
<span id="cb56-289"><a href="microbiota.html#cb56-289"></a>    <span class="st">&quot;Wb11&quot;</span>, <span class="st">&quot;Wb12&quot;</span>, <span class="st">&quot;Wb13&quot;</span>, <span class="st">&quot;Wb14&quot;</span>, <span class="st">&quot;Wb15&quot;</span>, <span class="st">&quot;Wb16&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Samples ordered by depth&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb56-290"><a href="microbiota.html#cb56-290"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Relative abundance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> phylum_palette)</span>
<span id="cb56-291"><a href="microbiota.html#cb56-291"></a></span>
<span id="cb56-292"><a href="microbiota.html#cb56-292"></a><span class="co"># ======</span><span class="re">END</span><span class="co">=================================</span></span>
<span id="cb56-293"><a href="microbiota.html#cb56-293"></a></span>
<span id="cb56-294"><a href="microbiota.html#cb56-294"></a></span>
<span id="cb56-295"><a href="microbiota.html#cb56-295"></a><span class="co">### ===== For Venn diagramms =============================</span></span>
<span id="cb56-296"><a href="microbiota.html#cb56-296"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb56-297"><a href="microbiota.html#cb56-297"></a></span>
<span id="cb56-298"><a href="microbiota.html#cb56-298"></a>gb_otus &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_ds<span class="op">$</span>gb))</span>
<span id="cb56-299"><a href="microbiota.html#cb56-299"></a><span class="kw">colnames</span>(gb_otus) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb56-300"><a href="microbiota.html#cb56-300"></a>sf_otus &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_ds<span class="op">$</span>sf))</span>
<span id="cb56-301"><a href="microbiota.html#cb56-301"></a><span class="kw">colnames</span>(sf_otus) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb56-302"><a href="microbiota.html#cb56-302"></a>wb_otus &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_ds<span class="op">$</span>wb))</span>
<span id="cb56-303"><a href="microbiota.html#cb56-303"></a><span class="kw">colnames</span>(wb_otus) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb56-304"><a href="microbiota.html#cb56-304"></a></span>
<span id="cb56-305"><a href="microbiota.html#cb56-305"></a><span class="kw">dim</span>(<span class="kw">intersect</span>(gb_otus, sf_otus))[<span class="dv">1</span>]  <span class="co"># 361</span></span>
<span id="cb56-306"><a href="microbiota.html#cb56-306"></a><span class="kw">dim</span>(<span class="kw">intersect</span>(gb_otus, wb_otus))[<span class="dv">1</span>]  <span class="co"># 2</span></span>
<span id="cb56-307"><a href="microbiota.html#cb56-307"></a><span class="kw">dim</span>(<span class="kw">intersect</span>(sf_otus, wb_otus))[<span class="dv">1</span>]  <span class="co"># 8</span></span>
<span id="cb56-308"><a href="microbiota.html#cb56-308"></a></span>
<span id="cb56-309"><a href="microbiota.html#cb56-309"></a><span class="kw">length</span>(<span class="kw">intersect</span>(<span class="kw">intersect</span>(gb_otus, wb_otus), <span class="kw">intersect</span>(sf_otus, wb_otus)))  <span class="co"># 1</span></span>
<span id="cb56-310"><a href="microbiota.html#cb56-310"></a><span class="co"># ==========================================================</span></span>
<span id="cb56-311"><a href="microbiota.html#cb56-311"></a></span>
<span id="cb56-312"><a href="microbiota.html#cb56-312"></a></span>
<span id="cb56-313"><a href="microbiota.html#cb56-313"></a><span class="co"># levels(taxes_phy$Group.1)[1] &lt;- &#39;unclassified&#39;</span></span>
<span id="cb56-314"><a href="microbiota.html#cb56-314"></a></span>
<span id="cb56-315"><a href="microbiota.html#cb56-315"></a><span class="co">### old stuff , could be deleted I belive===========</span></span>
<span id="cb56-316"><a href="microbiota.html#cb56-316"></a></span>
<span id="cb56-317"><a href="microbiota.html#cb56-317"></a>tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb56-318"><a href="microbiota.html#cb56-318"></a>tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb56-319"><a href="microbiota.html#cb56-319"></a>tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb56-320"><a href="microbiota.html#cb56-320"></a></span>
<span id="cb56-321"><a href="microbiota.html#cb56-321"></a></span>
<span id="cb56-322"><a href="microbiota.html#cb56-322"></a>gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-323"><a href="microbiota.html#cb56-323"></a>gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb56-324"><a href="microbiota.html#cb56-324"></a>gb_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb56-325"><a href="microbiota.html#cb56-325"></a><span class="kw">colnames</span>(gb_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb56-326"><a href="microbiota.html#cb56-326"></a></span>
<span id="cb56-327"><a href="microbiota.html#cb56-327"></a>gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-328"><a href="microbiota.html#cb56-328"></a>gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb56-329"><a href="microbiota.html#cb56-329"></a>gb_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb56-330"><a href="microbiota.html#cb56-330"></a><span class="kw">colnames</span>(gb_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb56-331"><a href="microbiota.html#cb56-331"></a></span>
<span id="cb56-332"><a href="microbiota.html#cb56-332"></a>sf1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-333"><a href="microbiota.html#cb56-333"></a>sf2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb56-334"><a href="microbiota.html#cb56-334"></a>sf_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(sf1, sf2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb56-335"><a href="microbiota.html#cb56-335"></a><span class="kw">colnames</span>(sf_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb56-336"><a href="microbiota.html#cb56-336"></a></span>
<span id="cb56-337"><a href="microbiota.html#cb56-337"></a>sf1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb56-338"><a href="microbiota.html#cb56-338"></a>sf2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_sf<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_sf<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb56-339"><a href="microbiota.html#cb56-339"></a>sf_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(sf1, sf2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb56-340"><a href="microbiota.html#cb56-340"></a><span class="kw">colnames</span>(sf_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span></code></pre></div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-moitinho-silva_2017">
<p>Moitinho-Silva, L, G Steinert, S Nielsen, C C P Hardoim, Y-C Wu, G P McCormack, S LÃ³pez-Legentil, et al. 2017. â€œPredicting the Hma-Lma Status in Marine Sponges by Machine Learning.â€ <em>Frontiers in Microbiology</em> 8: 752. <a href="https://doi.org/10.3389/fmicb.2017.00752">https://doi.org/10.3389/fmicb.2017.00752</a>.</p>
</div>
<div id="ref-R-vegan">
<p>Oksanen, Jari, F. Guillaume Blanchet, Michael Friendly, Roeland Kindt, Pierre Legendre, Dan McGlinn, Peter R. Minchin, et al. 2019. <em>Vegan: Community Ecology Package</em>. <a href="https://CRAN.R-project.org/package=vegan">https://CRAN.R-project.org/package=vegan</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metabolomics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="inter-omics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.pdf", "Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
