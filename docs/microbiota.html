<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</title>
  <meta name="description" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Microbiota | Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges" />
  
  
  

<meta name="author" content="Karin Steffen" />


<meta name="date" content="2020-06-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metabolomics.html"/>
<link rel="next" href="inter-omics.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SUPPLEMENTARY MATERIAL</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Content</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#experimental-setup"><i class="fa fa-check"></i><b>1.1</b> Experimental setup</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#map"><i class="fa fa-check"></i><b>1.1.1</b> Map</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#water-masses"><i class="fa fa-check"></i><b>1.1.2</b> Water masses</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#sponges"><i class="fa fa-check"></i><b>1.1.3</b> Sponges</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#sample-metadata-analysis"><i class="fa fa-check"></i><b>1.2</b> Sample metadata analysis</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#index_cor_vif"><i class="fa fa-check"></i><b>1.2.1</b> Correlations, visual inspection and variance inflation factors (VIF) across all samples</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#correlations-visual-inspection-and-variance-inflation-factors-vif-across-g.-barretti-samples"><i class="fa fa-check"></i><b>1.2.2</b> Correlations, visual inspection and variance inflation factors (VIF) across <em>G. barretti</em> samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="metabolomics.html"><a href="metabolomics.html"><i class="fa fa-check"></i><b>2</b> Metabolomics</a><ul>
<li class="chapter" data-level="2.1" data-path="metabolomics.html"><a href="metabolomics.html#experimental-methods-and-detailed-description"><i class="fa fa-check"></i><b>2.1</b> Experimental methods and detailed description</a></li>
<li class="chapter" data-level="2.2" data-path="metabolomics.html"><a href="metabolomics.html#data-processing"><i class="fa fa-check"></i><b>2.2</b> Data processing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="metabolomics.html"><a href="metabolomics.html#peak-picking-with-xcms-and-annotation-with-camera"><i class="fa fa-check"></i><b>2.2.1</b> Peak picking with XCMS and annotation with CAMERA</a></li>
<li class="chapter" data-level="2.2.2" data-path="metabolomics.html"><a href="metabolomics.html#hilic-hydrophilic-interaction-chromatography-column-with-positive-esi-electron-spray-ionisation"><i class="fa fa-check"></i><b>2.2.2</b> HILIC (Hydrophilic interaction chromatography) column with positive ESI (electron spray ionisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="metabolomics.html"><a href="metabolomics.html#hilic-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.3</b> HILIC Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.4" data-path="metabolomics.html"><a href="metabolomics.html#rp-reversed-phase-chromatography-with-positive-esi"><i class="fa fa-check"></i><b>2.2.4</b> RP (Reversed phase) Chromatography with positive ESI</a></li>
<li class="chapter" data-level="2.2.5" data-path="metabolomics.html"><a href="metabolomics.html#rp-chromatography-with-negative-esi"><i class="fa fa-check"></i><b>2.2.5</b> RP Chromatography with negative ESI</a></li>
<li class="chapter" data-level="2.2.6" data-path="metabolomics.html"><a href="metabolomics.html#filtering-of-the-raw-data-set"><i class="fa fa-check"></i><b>2.2.6</b> Filtering of the raw data set</a></li>
<li class="chapter" data-level="2.2.7" data-path="metabolomics.html"><a href="metabolomics.html#data-quality-control"><i class="fa fa-check"></i><b>2.2.7</b> Data quality control</a></li>
<li class="chapter" data-level="2.2.8" data-path="metabolomics.html"><a href="metabolomics.html#summary-of-data-processing"><i class="fa fa-check"></i><b>2.2.8</b> Summary of data processing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="metabolomics.html"><a href="metabolomics.html#chromatorgrams"><i class="fa fa-check"></i><b>2.3</b> Chromatorgrams</a></li>
<li class="chapter" data-level="2.4" data-path="metabolomics.html"><a href="metabolomics.html#multivariate-analyses"><i class="fa fa-check"></i><b>2.4</b> Multivariate analyses</a></li>
<li class="chapter" data-level="2.5" data-path="metabolomics.html"><a href="metabolomics.html#vips"><i class="fa fa-check"></i><b>2.5</b> VIPS</a></li>
<li class="chapter" data-level="2.6" data-path="metabolomics.html"><a href="metabolomics.html#metabolites-and-correlations"><i class="fa fa-check"></i><b>2.6</b> Metabolites and correlations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="microbiota.html"><a href="microbiota.html"><i class="fa fa-check"></i><b>3</b> Microbiota</a><ul>
<li class="chapter" data-level="3.1" data-path="microbiota.html"><a href="microbiota.html#otu-table-overview"><i class="fa fa-check"></i><b>3.1</b> OTU table overview</a></li>
<li class="chapter" data-level="3.2" data-path="microbiota.html"><a href="microbiota.html#alpha-diversity"><i class="fa fa-check"></i><b>3.2</b> Alpha diversity</a></li>
<li class="chapter" data-level="3.3" data-path="microbiota.html"><a href="microbiota.html#beta-diversity"><i class="fa fa-check"></i><b>3.3</b> Beta diversity</a></li>
<li class="chapter" data-level="3.4" data-path="microbiota.html"><a href="microbiota.html#EnvMod"><i class="fa fa-check"></i><b>3.4</b> Environmental modelling</a><ul>
<li class="chapter" data-level="3.4.1" data-path="microbiota.html"><a href="microbiota.html#constrained"><i class="fa fa-check"></i><b>3.4.1</b> Constrained modelling approach Automatic stepwise model building</a></li>
<li class="chapter" data-level="3.4.2" data-path="microbiota.html"><a href="microbiota.html#unconstrained"><i class="fa fa-check"></i><b>3.4.2</b> Unconstrained modelling approach</a></li>
<li class="chapter" data-level="3.4.3" data-path="microbiota.html"><a href="microbiota.html#Hclust"><i class="fa fa-check"></i><b>3.4.3</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="3.4.4" data-path="microbiota.html"><a href="microbiota.html#watermasses"><i class="fa fa-check"></i><b>3.4.4</b> Oceanographic setting: water masses</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="microbiota.html"><a href="microbiota.html#relative-abundances"><i class="fa fa-check"></i><b>3.5</b> Relative abundances</a><ul>
<li class="chapter" data-level="3.5.1" data-path="microbiota.html"><a href="microbiota.html#bar-plots"><i class="fa fa-check"></i><b>3.5.1</b> Bar plots</a></li>
<li class="chapter" data-level="3.5.2" data-path="microbiota.html"><a href="microbiota.html#tabular-overview"><i class="fa fa-check"></i><b>3.5.2</b> Tabular overview</a></li>
<li class="chapter" data-level="3.5.3" data-path="microbiota.html"><a href="microbiota.html#statistical-comparison-at-phylum-and-class-level"><i class="fa fa-check"></i><b>3.5.3</b> Statistical comparison at phylum and class level</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="microbiota.html"><a href="microbiota.html#depth-response-otu-perspective"><i class="fa fa-check"></i><b>3.6</b> Depth response: OTU perspective</a></li>
<li class="chapter" data-level="3.7" data-path="microbiota.html"><a href="microbiota.html#sequence-similarity"><i class="fa fa-check"></i><b>3.7</b> Sequence similarity</a></li>
<li class="chapter" data-level="3.8" data-path="microbiota.html"><a href="microbiota.html#annotated-phylogeny"><i class="fa fa-check"></i><b>3.8</b> Annotated phylogeny</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inter-omics.html"><a href="inter-omics.html"><i class="fa fa-check"></i><b>4</b> Inter-omics</a><ul>
<li class="chapter" data-level="4.1" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-and-procrustes-rotations"><i class="fa fa-check"></i><b>4.1</b> Mantel test and procrustes rotations</a><ul>
<li class="chapter" data-level="4.1.1" data-path="inter-omics.html"><a href="inter-omics.html#libraries-and-functions"><i class="fa fa-check"></i><b>4.1.1</b> Libraries and functions</a></li>
<li class="chapter" data-level="4.1.2" data-path="inter-omics.html"><a href="inter-omics.html#data-sets"><i class="fa fa-check"></i><b>4.1.2</b> Data sets</a></li>
<li class="chapter" data-level="4.1.3" data-path="inter-omics.html"><a href="inter-omics.html#mantel-test-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.3</b> Mantel test code and tabular output</a></li>
<li class="chapter" data-level="4.1.4" data-path="inter-omics.html"><a href="inter-omics.html#procrustes-rotation-and-protest-code-and-tabular-output"><i class="fa fa-check"></i><b>4.1.4</b> Procrustes rotation and protest code and tabular output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inter-omics.html"><a href="inter-omics.html#correlating-barettin-and-prokaryotic-relative-abundance"><i class="fa fa-check"></i><b>4.2</b> Correlating barettin and prokaryotic relative abundance</a></li>
<li class="chapter" data-level="4.3" data-path="inter-omics.html"><a href="inter-omics.html#microbial-interaction-network"><i class="fa fa-check"></i><b>4.3</b> Microbial interaction network</a><ul>
<li class="chapter" data-level="4.3.1" data-path="inter-omics.html"><a href="inter-omics.html#generating-network-based-on-different-algorithms"><i class="fa fa-check"></i><b>4.3.1</b> Generating network based on different algorithms</a></li>
<li class="chapter" data-level="4.3.2" data-path="inter-omics.html"><a href="inter-omics.html#consolidation-of-the-different-networks"><i class="fa fa-check"></i><b>4.3.2</b> Consolidation of the different networks</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="inter-omics.html"><a href="inter-omics.html#shortlist"><i class="fa fa-check"></i><b>4.4</b> Shortlist</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="funding-disclaimer.html"><a href="funding-disclaimer.html"><i class="fa fa-check"></i><b>5</b> Funding disclaimer</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Oceanographic setting influences the prokaryote community and metabolome in deep-sea sponges</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="microbiota" class="section level1">
<h1><span class="header-section-number">3</span> Microbiota</h1>
<div id="otu-table-overview" class="section level2">
<h2><span class="header-section-number">3.1</span> OTU table overview</h2>
<p>Letâ€™s start by taking a look at the OTU table and get an overall impression of our data.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="microbiota.html#cb79-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb79-2"><a href="microbiota.html#cb79-2"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb79-3"><a href="microbiota.html#cb79-3"></a><span class="kw">library</span>(stringr)</span>
<span id="cb79-4"><a href="microbiota.html#cb79-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb79-5"><a href="microbiota.html#cb79-5"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb79-6"><a href="microbiota.html#cb79-6"></a><span class="kw">library</span>(forcats)</span>
<span id="cb79-7"><a href="microbiota.html#cb79-7"></a></span>
<span id="cb79-8"><a href="microbiota.html#cb79-8"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb79-9"><a href="microbiota.html#cb79-9"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb79-10"><a href="microbiota.html#cb79-10"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb79-11"><a href="microbiota.html#cb79-11"></a><span class="kw">library</span>(DT)</span>
<span id="cb79-12"><a href="microbiota.html#cb79-12"></a></span>
<span id="cb79-13"><a href="microbiota.html#cb79-13"></a><span class="kw">library</span>(vegan)</span>
<span id="cb79-14"><a href="microbiota.html#cb79-14"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb79-15"><a href="microbiota.html#cb79-15"></a><span class="kw">library</span>(picante)</span>
<span id="cb79-16"><a href="microbiota.html#cb79-16"></a><span class="kw">library</span>(seqinr)</span>
<span id="cb79-17"><a href="microbiota.html#cb79-17"></a></span>
<span id="cb79-18"><a href="microbiota.html#cb79-18"></a><span class="kw">library</span>(gtools)</span>
<span id="cb79-19"><a href="microbiota.html#cb79-19"></a><span class="co"># install.packages(&#39;webshot&#39;) webshot::install_phantomjs()</span></span>
<span id="cb79-20"><a href="microbiota.html#cb79-20"></a><span class="kw">set.seed</span>(<span class="dv">1984</span>)</span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="microbiota.html#cb80-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb80-2"><a href="microbiota.html#cb80-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb80-3"><a href="microbiota.html#cb80-3"></a></span>
<span id="cb80-4"><a href="microbiota.html#cb80-4"></a><span class="co"># meta_data &lt;- meta_data[!str_sub(meta_data$unified_ID,1,2)==&#39;QC&#39;,] # remove QC samples</span></span>
<span id="cb80-5"><a href="microbiota.html#cb80-5"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb80-6"><a href="microbiota.html#cb80-6"></a></span>
<span id="cb80-7"><a href="microbiota.html#cb80-7"></a>microbiome &lt;-<span class="st"> </span>microbiome[<span class="kw">order</span>(microbiome<span class="op">$</span>Sample_ID), ]</span>
<span id="cb80-8"><a href="microbiota.html#cb80-8"></a>meta_data &lt;-<span class="st"> </span>meta_data[<span class="kw">order</span>(meta_data<span class="op">$</span>unified_ID), ]</span>
<span id="cb80-9"><a href="microbiota.html#cb80-9"></a></span>
<span id="cb80-10"><a href="microbiota.html#cb80-10"></a><span class="co"># dropping factors from full data:</span></span>
<span id="cb80-11"><a href="microbiota.html#cb80-11"></a>meta_data[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(meta_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb80-12"><a href="microbiota.html#cb80-12"></a>microbiome[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(microbiome, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb80-13"><a href="microbiota.html#cb80-13"></a></span>
<span id="cb80-14"><a href="microbiota.html#cb80-14"></a><span class="co"># all(meta_data$unified_ID==microbiome$Sample_ID)</span></span>
<span id="cb80-15"><a href="microbiota.html#cb80-15"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb80-16"><a href="microbiota.html#cb80-16"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb80-17"><a href="microbiota.html#cb80-17"></a></span>
<span id="cb80-18"><a href="microbiota.html#cb80-18"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)  <span class="co">#total_OTUs = Cummulative read count</span></span>
<span id="cb80-19"><a href="microbiota.html#cb80-19"></a>micro_fig1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb80-20"><a href="microbiota.html#cb80-20"></a>micro_fig1[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb80-21"><a href="microbiota.html#cb80-21"></a>micro_fig1[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;none&quot;</span></span>
<span id="cb80-22"><a href="microbiota.html#cb80-22"></a></span>
<span id="cb80-23"><a href="microbiota.html#cb80-23"></a>microbiome<span class="op">$</span>total_OTUs &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb80-24"><a href="microbiota.html#cb80-24"></a>microbiome &lt;-<span class="st"> </span><span class="kw">sqrt</span>(microbiome)</span>
<span id="cb80-25"><a href="microbiota.html#cb80-25"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)</span>
<span id="cb80-26"><a href="microbiota.html#cb80-26"></a></span>
<span id="cb80-27"><a href="microbiota.html#cb80-27"></a>micro_fig2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb80-28"><a href="microbiota.html#cb80-28"></a>micro_fig2[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb80-29"><a href="microbiota.html#cb80-29"></a>micro_fig2[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;sqrt&quot;</span></span>
<span id="cb80-30"><a href="microbiota.html#cb80-30"></a></span>
<span id="cb80-31"><a href="microbiota.html#cb80-31"></a>microbiome<span class="op">$</span>total_OTUs &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb80-32"><a href="microbiota.html#cb80-32"></a>microbiome &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(microbiome)</span>
<span id="cb80-33"><a href="microbiota.html#cb80-33"></a>microbiome[<span class="st">&quot;total_OTUs&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(microbiome, <span class="dv">1</span>, sum)</span>
<span id="cb80-34"><a href="microbiota.html#cb80-34"></a></span>
<span id="cb80-35"><a href="microbiota.html#cb80-35"></a>micro_fig3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(microbiome[, <span class="st">&quot;total_OTUs&quot;</span>])</span>
<span id="cb80-36"><a href="microbiota.html#cb80-36"></a>micro_fig3[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb80-37"><a href="microbiota.html#cb80-37"></a>micro_fig3[<span class="st">&quot;normalisation&quot;</span>] &lt;-<span class="st"> &quot;sqrt wisconsin&quot;</span></span>
<span id="cb80-38"><a href="microbiota.html#cb80-38"></a></span>
<span id="cb80-39"><a href="microbiota.html#cb80-39"></a>micro_fig &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_fig1, micro_fig2, micro_fig3)</span>
<span id="cb80-40"><a href="microbiota.html#cb80-40"></a><span class="kw">colnames</span>(micro_fig) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;total_OTUs&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;normalisation&quot;</span>)</span>
<span id="cb80-41"><a href="microbiota.html#cb80-41"></a>micro_fig[<span class="st">&quot;Species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(micro_fig<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb80-42"><a href="microbiota.html#cb80-42"></a></span>
<span id="cb80-43"><a href="microbiota.html#cb80-43"></a><span class="kw">ggplot</span>(micro_fig, <span class="kw">aes</span>(<span class="dt">x =</span> unified_ID, <span class="dt">y =</span> total_OTUs)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(normalisation), <span class="kw">vars</span>(Species), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Samples&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Number of OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb80-44"><a href="microbiota.html#cb80-44"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cummulative read count after normalisation&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:filtering-pca"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/filtering-pca-1.png" alt="Read count overview of the OTU table before and after the normalisation applied in the data analysis for this study." width="672" />
<p class="caption">
Figure 3.1: Read count overview of the OTU table before and after the normalisation applied in the data analysis for this study.
</p>
</div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="microbiota.html#cb81-1"></a><span class="co"># see https://chrischizinski.github.io/SNR_R_Group/2016-08-10-Data-Transformations</span></span></code></pre></div>
<p>Do the normalisations have affect how well we can discriminate between the microbiota?</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="microbiota.html#cb82-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb82-2"><a href="microbiota.html#cb82-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb82-3"><a href="microbiota.html#cb82-3"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb82-4"><a href="microbiota.html#cb82-4"></a></span>
<span id="cb82-5"><a href="microbiota.html#cb82-5"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb82-6"><a href="microbiota.html#cb82-6"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb82-7"><a href="microbiota.html#cb82-7"></a></span>
<span id="cb82-8"><a href="microbiota.html#cb82-8"></a>pca_plot &lt;-<span class="st"> </span><span class="cf">function</span>(microbiome, meta_data, my_title) {</span>
<span id="cb82-9"><a href="microbiota.html#cb82-9"></a>    micro.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(microbiome, <span class="dt">scale =</span> T)</span>
<span id="cb82-10"><a href="microbiota.html#cb82-10"></a>    k &lt;-<span class="st"> </span><span class="kw">summary</span>(micro.pca)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb82-11"><a href="microbiota.html#cb82-11"></a>    micro_pca_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(micro.pca<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb82-12"><a href="microbiota.html#cb82-12"></a>    micro_pca_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(micro_pca_df))</span>
<span id="cb82-13"><a href="microbiota.html#cb82-13"></a>    x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb82-14"><a href="microbiota.html#cb82-14"></a>    y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb82-15"><a href="microbiota.html#cb82-15"></a>    micro_pca_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(micro_pca_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, </span>
<span id="cb82-16"><a href="microbiota.html#cb82-16"></a>        <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb82-17"><a href="microbiota.html#cb82-17"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(micro_pca_df, <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">shape =</span> <span class="kw">factor</span>(Species))) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(x1) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(y1) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">shape =</span> <span class="st">&quot;Species&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb82-18"><a href="microbiota.html#cb82-18"></a><span class="st">        </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb82-19"><a href="microbiota.html#cb82-19"></a>    <span class="kw">return</span>(p)</span>
<span id="cb82-20"><a href="microbiota.html#cb82-20"></a>}</span>
<span id="cb82-21"><a href="microbiota.html#cb82-21"></a></span>
<span id="cb82-22"><a href="microbiota.html#cb82-22"></a>untransformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(microbiome, meta_data, <span class="st">&quot;untransformed&quot;</span>)</span>
<span id="cb82-23"><a href="microbiota.html#cb82-23"></a>sqrt_transformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(<span class="kw">sqrt</span>(microbiome), meta_data, <span class="st">&quot;sqrt&quot;</span>)</span>
<span id="cb82-24"><a href="microbiota.html#cb82-24"></a>sqrt_wisc_transformed &lt;-<span class="st"> </span><span class="kw">pca_plot</span>(<span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(microbiome)), meta_data, <span class="st">&quot;sqrt and wisconsin&quot;</span>)</span>
<span id="cb82-25"><a href="microbiota.html#cb82-25"></a></span>
<span id="cb82-26"><a href="microbiota.html#cb82-26"></a><span class="kw">grid.arrange</span>(untransformed, sqrt_transformed, sqrt_wisc_transformed, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">top =</span> <span class="st">&quot;PCA: Impact of normalisation on discrimination of the microbiota&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:microbiome-pca"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/microbiome-pca-1.png" alt="PCA of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb" width="672" />
<p class="caption">
Figure 3.2: PCA of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb
</p>
</div>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="microbiota.html#cb83-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb83-2"><a href="microbiota.html#cb83-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb83-3"><a href="microbiota.html#cb83-3"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb83-4"><a href="microbiota.html#cb83-4"></a></span>
<span id="cb83-5"><a href="microbiota.html#cb83-5"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb83-6"><a href="microbiota.html#cb83-6"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb83-7"><a href="microbiota.html#cb83-7"></a></span>
<span id="cb83-8"><a href="microbiota.html#cb83-8"></a>nmds_plot &lt;-<span class="st"> </span><span class="cf">function</span>(microbiome, meta_data, my_title) {</span>
<span id="cb83-9"><a href="microbiota.html#cb83-9"></a>    micro.mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(microbiome, <span class="dt">k =</span> <span class="dv">2</span>, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb83-10"><a href="microbiota.html#cb83-10"></a>    nmds_points &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(micro.mds<span class="op">$</span>points)</span>
<span id="cb83-11"><a href="microbiota.html#cb83-11"></a>    samples &lt;-<span class="st"> </span><span class="kw">data.frame</span>(nmds_points<span class="op">$</span>MDS1, nmds_points<span class="op">$</span>MDS2)</span>
<span id="cb83-12"><a href="microbiota.html#cb83-12"></a>    samples[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb83-13"><a href="microbiota.html#cb83-13"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb83-14"><a href="microbiota.html#cb83-14"></a>    samples &lt;-<span class="st"> </span><span class="kw">left_join</span>(samples, meta_data)</span>
<span id="cb83-15"><a href="microbiota.html#cb83-15"></a>    stress &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Stress=&quot;</span>, <span class="kw">round</span>(micro.mds<span class="op">$</span>stress, <span class="dt">digits =</span> <span class="dv">3</span>))</span>
<span id="cb83-16"><a href="microbiota.html#cb83-16"></a>    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(samples, <span class="kw">aes</span>(<span class="dt">x =</span> nmds_points.MDS1, <span class="dt">y =</span> nmds_points.MDS2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Species, <span class="dt">alpha =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(my_title) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">shape =</span> <span class="st">&quot;Sponge species&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb83-17"><a href="microbiota.html#cb83-17"></a><span class="st">        </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;NMDS 1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;NMDS 2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">label =</span> stress)</span>
<span id="cb83-18"><a href="microbiota.html#cb83-18"></a>    <span class="kw">return</span>(p)</span>
<span id="cb83-19"><a href="microbiota.html#cb83-19"></a>}</span>
<span id="cb83-20"><a href="microbiota.html#cb83-20"></a></span>
<span id="cb83-21"><a href="microbiota.html#cb83-21"></a>untransformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(microbiome, meta_data, <span class="st">&quot;untransformed&quot;</span>)</span>
<span id="cb83-22"><a href="microbiota.html#cb83-22"></a>sqrt_transformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(<span class="kw">sqrt</span>(microbiome), meta_data, <span class="st">&quot;sqrt&quot;</span>)</span>
<span id="cb83-23"><a href="microbiota.html#cb83-23"></a>sqrt_wisc_transformed &lt;-<span class="st"> </span><span class="kw">nmds_plot</span>(<span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(microbiome)), meta_data, <span class="st">&quot;sqrt and wisconsin&quot;</span>)</span>
<span id="cb83-24"><a href="microbiota.html#cb83-24"></a></span>
<span id="cb83-25"><a href="microbiota.html#cb83-25"></a><span class="kw">grid.arrange</span>(untransformed, sqrt_transformed, sqrt_wisc_transformed, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">top =</span> <span class="st">&quot;NMDS: Impact of normalisation on discrimination of the microbiota&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:nmds"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/nmds-1.png" alt="NMDS of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb" width="672" />
<p class="caption">
Figure 3.3: NMDS of the data sets with and without transformation/normalisation. Circles are Gb, triangles are Sf, squares are Wb
</p>
</div>
<p>It seems that we donâ€™t lose any relevant information and the normalisations in fact increase the discriminatory power.</p>
</div>
<div id="alpha-diversity" class="section level2">
<h2><span class="header-section-number">3.2</span> Alpha diversity</h2>
<p>The microbiota are composed of 420 OTUs in <em>G. barretti</em>, 461 OTUs in <em>S. fortis</em> and 135 OTUs in <em>W. bursa</em>. While <em>G. barretti</em> and <em>S. fortis</em> share 316, respectively they each only share 2 and 8 OTUs with <em>W. bursa</em>. Only a single OTU (OTU4 or X1969004, an Archaeon) is shared among the three sponge hosts.</p>
<p>How does that reflect in their diversities? Below we show Shannon diversity, species richness (SR) and Faithâ€™s phylogenetic distance (PD).</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="microbiota.html#cb84-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb84-2"><a href="microbiota.html#cb84-2"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb84-3"><a href="microbiota.html#cb84-3"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb84-4"><a href="microbiota.html#cb84-4"></a><span class="kw">library</span>(picante)</span>
<span id="cb84-5"><a href="microbiota.html#cb84-5"></a></span>
<span id="cb84-6"><a href="microbiota.html#cb84-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb84-7"><a href="microbiota.html#cb84-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb84-8"><a href="microbiota.html#cb84-8"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb84-9"><a href="microbiota.html#cb84-9"></a>tree &lt;-<span class="st"> </span><span class="kw">read.nexus</span>(<span class="st">&quot;data/infile.nex.con.X.tre&quot;</span>)</span>
<span id="cb84-10"><a href="microbiota.html#cb84-10"></a></span>
<span id="cb84-11"><a href="microbiota.html#cb84-11"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome<span class="op">$</span>Sample_ID</span>
<span id="cb84-12"><a href="microbiota.html#cb84-12"></a>microbiome<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb84-13"><a href="microbiota.html#cb84-13"></a>otumat &lt;-<span class="st"> </span><span class="kw">t</span>(microbiome)</span>
<span id="cb84-14"><a href="microbiota.html#cb84-14"></a>otumat &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(<span class="kw">sqrt</span>(otumat))</span>
<span id="cb84-15"><a href="microbiota.html#cb84-15"></a><span class="kw">colnames</span>(otumat) &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb84-16"><a href="microbiota.html#cb84-16"></a><span class="kw">rownames</span>(taxonomy) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, taxonomy<span class="op">$</span>OTU_ID)</span>
<span id="cb84-17"><a href="microbiota.html#cb84-17"></a>taxonomy<span class="op">$</span>OTU_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb84-18"><a href="microbiota.html#cb84-18"></a><span class="co"># all(rownames(taxonomy)==rownames(otumat))</span></span>
<span id="cb84-19"><a href="microbiota.html#cb84-19"></a></span>
<span id="cb84-20"><a href="microbiota.html#cb84-20"></a><span class="co"># relative abundance</span></span>
<span id="cb84-21"><a href="microbiota.html#cb84-21"></a>otumat &lt;-<span class="st"> </span><span class="kw">apply</span>(otumat, <span class="dv">2</span>, <span class="cf">function</span>(i) i<span class="op">/</span><span class="kw">sum</span>(i))</span>
<span id="cb84-22"><a href="microbiota.html#cb84-22"></a>OTU &lt;-<span class="st"> </span><span class="kw">otu_table</span>(otumat, <span class="dt">taxa_are_rows =</span> <span class="ot">TRUE</span>)</span>
<span id="cb84-23"><a href="microbiota.html#cb84-23"></a><span class="co"># remove low abundance taxa OTU &lt;- filter_taxa(OTU, function(x) mean(x) &gt; 0.0025, TRUE)</span></span>
<span id="cb84-24"><a href="microbiota.html#cb84-24"></a>taxmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(taxonomy)</span>
<span id="cb84-25"><a href="microbiota.html#cb84-25"></a>TAX &lt;-<span class="st"> </span><span class="kw">tax_table</span>(taxmat)</span>
<span id="cb84-26"><a href="microbiota.html#cb84-26"></a>biom_data &lt;-<span class="st"> </span><span class="kw">phyloseq</span>(OTU, TAX)</span>
<span id="cb84-27"><a href="microbiota.html#cb84-27"></a><span class="co"># Merge into phyloseq object</span></span>
<span id="cb84-28"><a href="microbiota.html#cb84-28"></a>pso &lt;-<span class="st"> </span><span class="kw">merge_phyloseq</span>(biom_data, tree)  <span class="co">#merging a phyloseq and a tree file</span></span>
<span id="cb84-29"><a href="microbiota.html#cb84-29"></a>pso &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(<span class="kw">taxa_sums</span>(pso) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, pso)</span>
<span id="cb84-30"><a href="microbiota.html#cb84-30"></a></span>
<span id="cb84-31"><a href="microbiota.html#cb84-31"></a><span class="co"># Calculate Phylogenetic Distance (PD) of the dataset, ALPHA DIVERSITY</span></span>
<span id="cb84-32"><a href="microbiota.html#cb84-32"></a>otu_table_pso &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(pso<span class="op">@</span>otu_table)</span>
<span id="cb84-33"><a href="microbiota.html#cb84-33"></a>df.pd &lt;-<span class="st"> </span><span class="kw">pd</span>(<span class="kw">t</span>(otu_table_pso), tree, <span class="dt">include.root =</span> F)</span>
<span id="cb84-34"><a href="microbiota.html#cb84-34"></a>df.pd[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df.pd)</span>
<span id="cb84-35"><a href="microbiota.html#cb84-35"></a><span class="co"># df.pd: PD = Faith&#39;s Phylogenetic diversity, SR= species richness</span></span>
<span id="cb84-36"><a href="microbiota.html#cb84-36"></a>div &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(vegan<span class="op">::</span><span class="kw">diversity</span>(<span class="kw">t</span>(otumat), <span class="dt">index =</span> <span class="st">&quot;shannon&quot;</span>))</span>
<span id="cb84-37"><a href="microbiota.html#cb84-37"></a>div[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(<span class="kw">rownames</span>(div), <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb84-38"><a href="microbiota.html#cb84-38"></a><span class="kw">colnames</span>(div) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Shannon_diversity&quot;</span>, <span class="st">&quot;spec&quot;</span>)</span>
<span id="cb84-39"><a href="microbiota.html#cb84-39"></a>div[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(div)</span>
<span id="cb84-40"><a href="microbiota.html#cb84-40"></a>div_indices &lt;-<span class="st"> </span><span class="kw">full_join</span>(div, df.pd)</span>
<span id="cb84-41"><a href="microbiota.html#cb84-41"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb84-42"><a href="microbiota.html#cb84-42"></a>div_indices &lt;-<span class="st"> </span><span class="kw">left_join</span>(div_indices, md)</span>
<span id="cb84-43"><a href="microbiota.html#cb84-43"></a></span>
<span id="cb84-44"><a href="microbiota.html#cb84-44"></a>div_indices &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(div_indices, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>))</span>
<span id="cb84-45"><a href="microbiota.html#cb84-45"></a><span class="kw">ggplot</span>(div_indices, <span class="kw">aes</span>(<span class="dt">x =</span> Depth, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(variable), <span class="kw">vars</span>(spec), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb84-46"><a href="microbiota.html#cb84-46"></a>    <span class="dt">hjust =</span> <span class="dv">1</span>), <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Diversity metrics&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Sample depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<div class="figure"><span id="fig:a-diversities"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/a-diversities-1.png" alt="Microbiota diversity indices grouped by sponge species and ordered by sample depth." width="672" />
<p class="caption">
Figure 3.4: Microbiota diversity indices grouped by sponge species and ordered by sample depth.
</p>
</div>
<p>We see that the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> not only have more OTUs but also a higher diversity in their prokaryotic communities then the LMA sponge <em>W. bursa</em>.</p>
</div>
<div id="beta-diversity" class="section level2">
<h2><span class="header-section-number">3.3</span> Beta diversity</h2>
<p>In a way, the Fig. <a href="microbiota.html#fig:microbiome-pca">3.2</a> and <a href="microbiota.html#fig:nmds">3.3</a> have already shown us the beta diversity in our samples. Looking more into the data, we found that the two dimensional representation can be misleading at times and so we provide the first three axes components for exploration below.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="microbiota.html#cb85-1"></a><span class="kw">library</span>(plot3D)</span>
<span id="cb85-2"><a href="microbiota.html#cb85-2"></a><span class="kw">library</span>(rgl)</span>
<span id="cb85-3"><a href="microbiota.html#cb85-3"></a><span class="kw">library</span>(plotly)</span>
<span id="cb85-4"><a href="microbiota.html#cb85-4"></a></span>
<span id="cb85-5"><a href="microbiota.html#cb85-5"></a><span class="co">### PCA</span></span>
<span id="cb85-6"><a href="microbiota.html#cb85-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb85-7"><a href="microbiota.html#cb85-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb85-8"><a href="microbiota.html#cb85-8"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb85-9"><a href="microbiota.html#cb85-9"></a></span>
<span id="cb85-10"><a href="microbiota.html#cb85-10"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb85-11"><a href="microbiota.html#cb85-11"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb85-12"><a href="microbiota.html#cb85-12"></a>microbiome &lt;-<span class="st"> </span><span class="kw">sqrt</span>(microbiome)</span>
<span id="cb85-13"><a href="microbiota.html#cb85-13"></a>micro.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(microbiome, <span class="dt">scale =</span> T)</span>
<span id="cb85-14"><a href="microbiota.html#cb85-14"></a>k &lt;-<span class="st"> </span><span class="kw">summary</span>(micro.pca)[[<span class="st">&quot;importance&quot;</span>]]</span>
<span id="cb85-15"><a href="microbiota.html#cb85-15"></a>micro_pca_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(micro.pca<span class="op">$</span>x)  <span class="co">#scores, i.e. principal components of the sponge sample </span></span>
<span id="cb85-16"><a href="microbiota.html#cb85-16"></a>micro_pca_df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">rownames</span>(micro_pca_df))</span>
<span id="cb85-17"><a href="microbiota.html#cb85-17"></a>x1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC1&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb85-18"><a href="microbiota.html#cb85-18"></a>y1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC2&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb85-19"><a href="microbiota.html#cb85-19"></a>z1 &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;PC3&quot;</span>, <span class="kw">round</span>(k[<span class="dv">2</span>, <span class="dv">3</span>], <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb85-20"><a href="microbiota.html#cb85-20"></a>micro_pca_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(micro_pca_df[, <span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)], meta_data[, <span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, </span>
<span id="cb85-21"><a href="microbiota.html#cb85-21"></a>    <span class="st">&quot;unified_ID&quot;</span>)])</span>
<span id="cb85-22"><a href="microbiota.html#cb85-22"></a></span>
<span id="cb85-23"><a href="microbiota.html#cb85-23"></a><span class="co">## rgl/plot3D: static 3D plot with(micro_pca_df, text3D(PC1, PC2, PC3, colvar = micro_pca_df$Depth, theta = 60, phi = 20, xlab = x1, ylab = y1, zlab =z1, main = &#39;3D microbiome</span></span>
<span id="cb85-24"><a href="microbiota.html#cb85-24"></a><span class="co">## PCA&#39;, labels = micro_pca_df$unified_ID, cex = 0.9, bty = &#39;g&#39;, ticktype = &#39;detailed&#39;, d = 2, clab = c(&#39;Depth [m]&#39;), adj = 0.5, font = 2))</span></span>
<span id="cb85-25"><a href="microbiota.html#cb85-25"></a></span>
<span id="cb85-26"><a href="microbiota.html#cb85-26"></a><span class="co">## plotly</span></span>
<span id="cb85-27"><a href="microbiota.html#cb85-27"></a>axx &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> x1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb85-28"><a href="microbiota.html#cb85-28"></a></span>
<span id="cb85-29"><a href="microbiota.html#cb85-29"></a>axy &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> y1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb85-30"><a href="microbiota.html#cb85-30"></a></span>
<span id="cb85-31"><a href="microbiota.html#cb85-31"></a>axz &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> z1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb85-32"><a href="microbiota.html#cb85-32"></a></span>
<span id="cb85-33"><a href="microbiota.html#cb85-33"></a>mic_i &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(micro_pca_df, <span class="dt">x =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC1, <span class="dt">y =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC2, <span class="dt">z =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>PC3, <span class="dt">symbol =</span> <span class="op">~</span>Species, <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;circle&quot;</span>), <span class="dt">color =</span> <span class="op">~</span>micro_pca_df<span class="op">$</span>Depth) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-34"><a href="microbiota.html#cb85-34"></a><span class="st">    </span><span class="kw">add_markers</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layout</span>(<span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> axx, <span class="dt">yaxis =</span> axy, <span class="dt">zaxis =</span> axz))</span>
<span id="cb85-35"><a href="microbiota.html#cb85-35"></a>mic_i</span></code></pre></div>
<div class="figure"><span id="fig:b-divPCA"></span>
<div id="htmlwidget-f43ce07f55160cdc8d73" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f43ce07f55160cdc8d73">{"x":{"visdat":{"27f0436d9772":["function () ","plotlyVisDat"]},"cur_data":"27f0436d9772","attrs":{"27f0436d9772":{"x":{},"y":{},"z":{},"color":{},"symbol":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"symbols":["diamond","x","circle"],"type":"scatter3d","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC1 18.5 %","showbackground":true},"yaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC2 9.8 %","showbackground":true},"zaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"PC3 8.1 %","showbackground":true}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-9.16017959106023,-9.12603414651757,-9.7203032613347,-7.81092384946648,-13.0783141579715,-11.4452930543219,-10.8754192788506,-9.09296069724172,-8.56932990321382,-7.44482056110354,-4.05319775249838,-12.6423140534378,-13.8091240789086,-21.8941070191161],"y":[11.6817254313368,11.7967413086439,1.3066169790786,1.82562208673323,-2.38547391078717,-1.21053959258772,8.3578063062921,12.8114901307763,11.3583046784118,10.2223526029249,7.43887849413778,13.498381637086,10.0454283127158,12.8663402789811],"z":[-5.9560418711539,-2.27781454238503,12.4733599737255,15.8620779791857,17.874159481195,22.9744899085815,-6.12395945156392,-5.97023704180219,-1.12722862952476,1.90880706351532,-4.10188826527539,-1.83669505665996,-3.17910089934022,-1.71845346354704],"type":"scatter3d","mode":"markers","name":"Geodia barretti","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744],"symbol":"diamond","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744]}},"frame":null},{"x":[-5.85130984524605,-4.35717099193864,-2.31314110328321,-9.76163755990342,-6.68975749081645,-12.1300774175099,-7.76157208182746,-2.6265551244536,-2.95785642347056,0.614339473933696,-5.23302503060812,-2.81840842435754,-8.16251916457826,-1.50874172279474,-6.34357020985989],"y":[-5.47469052438565,-12.1200687789487,-8.71497180140628,-11.9865866390643,-11.6526148253503,-17.0640375442191,-17.7632871749541,2.34118706123219,-4.58179094488733,1.49038592101216,-2.15157254350234,-6.65397046738693,-12.2793618339286,-7.91724009273525,-15.7139655834283],"z":[-15.3887130482298,-4.88739726613558,-1.76922522269387,7.95634228981677,3.042543154274,11.6270979023578,-0.880237819921141,-5.26216122675088,-1.69472816392325,-1.50882290203579,-5.28185068529196,-7.54451229733588,-16.3081422848649,-9.59160499629076,-9.49996512011797],"type":"scatter3d","mode":"markers","name":"Stryphnus fortis","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036],"symbol":"x","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036]}},"frame":null},{"x":[16.8814203804402,12.6174296015981,13.7076741757058,13.8646435852252,13.4827780838861,14.9483497646355,12.3535565451072,15.2360985336132,14.7830922816336,18.9679358276459,12.2362612341106,14.1915396044443,12.8500746008627,12.3435959334409,12.466391305313,15.692483064095],"y":[1.94266996753728,0.985959450626294,1.21444310505017,1.21273227181074,1.1417859464487,1.39688715303184,0.858537844864689,1.38199729370228,1.43249715507745,2.39024003039716,0.939097910413294,1.26433935575974,1.05533285666276,0.925731151210875,0.927091403989006,1.55956813162713],"z":[1.87480403704825,0.79032739413262,1.10128899911075,1.0521807372603,0.950861406425429,1.19272340863659,0.561618756173645,1.1110741030316,1.33859931883458,2.48136512675343,0.772166944219673,1.2637042579897,0.98603522670514,0.715889248500856,0.611163081805662,1.3861004555646],"type":"scatter3d","mode":"markers","name":"Weberella bursa","marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728],"symbol":"circle","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728]}},"frame":null},{"x":[-21.8941070191161,18.9679358276459],"y":[-17.7632871749541,13.498381637086],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"micro_pca_df$Depth","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[244,1476],"line":{"color":"rgba(214,39,40,1)"}},"z":[-16.3081422848649,22.9744899085815],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.5: PCA of the met
</p>
</div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="microbiota.html#cb86-1"></a><span class="co"># for saving locally f&lt;- basename(tempfile(&#39;PCA_microbiome_plotly&#39;, &#39;.&#39;, &#39;.html&#39;)) on.exit(unlink(f), add = TRUE) html &lt;- htmlwidgets::saveWidget(mic_i, f)</span></span>
<span id="cb86-2"><a href="microbiota.html#cb86-2"></a></span>
<span id="cb86-3"><a href="microbiota.html#cb86-3"></a><span class="kw">rm</span>(mic_i, f, html, k, x1, y1, z1, micro.pca, axx, axy, axz, micro_pca_df)</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="microbiota.html#cb87-1"></a><span class="kw">library</span>(plot3D)</span>
<span id="cb87-2"><a href="microbiota.html#cb87-2"></a><span class="kw">library</span>(rgl)</span>
<span id="cb87-3"><a href="microbiota.html#cb87-3"></a><span class="kw">library</span>(plotly)</span>
<span id="cb87-4"><a href="microbiota.html#cb87-4"></a></span>
<span id="cb87-5"><a href="microbiota.html#cb87-5"></a><span class="co">### NMDS</span></span>
<span id="cb87-6"><a href="microbiota.html#cb87-6"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb87-7"><a href="microbiota.html#cb87-7"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb87-8"><a href="microbiota.html#cb87-8"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb87-9"><a href="microbiota.html#cb87-9"></a></span>
<span id="cb87-10"><a href="microbiota.html#cb87-10"></a><span class="kw">rownames</span>(microbiome) &lt;-<span class="st"> </span>microbiome[, <span class="dv">1</span>]</span>
<span id="cb87-11"><a href="microbiota.html#cb87-11"></a>microbiome[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb87-12"><a href="microbiota.html#cb87-12"></a><span class="co"># microbiome &lt;- sqrt(microbiome)</span></span>
<span id="cb87-13"><a href="microbiota.html#cb87-13"></a></span>
<span id="cb87-14"><a href="microbiota.html#cb87-14"></a>micro.mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(microbiome, <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb87-15"><a href="microbiota.html#cb87-15"></a>nmds_points &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(micro.mds<span class="op">$</span>points)</span>
<span id="cb87-16"><a href="microbiota.html#cb87-16"></a>samples &lt;-<span class="st"> </span><span class="kw">data.frame</span>(nmds_points<span class="op">$</span>MDS1, nmds_points<span class="op">$</span>MDS2, nmds_points<span class="op">$</span>MDS3)</span>
<span id="cb87-17"><a href="microbiota.html#cb87-17"></a>samples[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(microbiome)</span>
<span id="cb87-18"><a href="microbiota.html#cb87-18"></a>meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb87-19"><a href="microbiota.html#cb87-19"></a>samples &lt;-<span class="st"> </span><span class="kw">left_join</span>(samples, meta_data)</span>
<span id="cb87-20"><a href="microbiota.html#cb87-20"></a><span class="kw">colnames</span>(samples) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;PC3&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Species&quot;</span>)</span>
<span id="cb87-21"><a href="microbiota.html#cb87-21"></a>stress &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Stress=&quot;</span>, <span class="kw">round</span>(micro.mds<span class="op">$</span>stress, <span class="dt">digits =</span> <span class="dv">6</span>))</span>
<span id="cb87-22"><a href="microbiota.html#cb87-22"></a>x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MDS1&quot;</span>)</span>
<span id="cb87-23"><a href="microbiota.html#cb87-23"></a>y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MDS2&quot;</span>)</span>
<span id="cb87-24"><a href="microbiota.html#cb87-24"></a>z1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MDS3&quot;</span>)</span>
<span id="cb87-25"><a href="microbiota.html#cb87-25"></a></span>
<span id="cb87-26"><a href="microbiota.html#cb87-26"></a><span class="co"># rgl/plot3D with(samples, text3D(PC1, PC2, PC3, colvar = samples$Depth, theta = 60, phi = 20, xlab = x1, ylab = y1, zlab =z1, main = &#39;3D microbiome NMDS&#39;, labels =</span></span>
<span id="cb87-27"><a href="microbiota.html#cb87-27"></a><span class="co"># samples$unified_ID, cex = 0.9, bty = &#39;g&#39;, ticktype = &#39;detailed&#39;, d = 2, clab = c(&#39;Depth [m]&#39;), adj = 0.5, font = 2))</span></span>
<span id="cb87-28"><a href="microbiota.html#cb87-28"></a></span>
<span id="cb87-29"><a href="microbiota.html#cb87-29"></a><span class="co">## plotly</span></span>
<span id="cb87-30"><a href="microbiota.html#cb87-30"></a>axx &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> x1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb87-31"><a href="microbiota.html#cb87-31"></a></span>
<span id="cb87-32"><a href="microbiota.html#cb87-32"></a>axy &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> y1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb87-33"><a href="microbiota.html#cb87-33"></a></span>
<span id="cb87-34"><a href="microbiota.html#cb87-34"></a>axz &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">backgroundcolor =</span> <span class="st">&quot;rgb(211,211,211)&quot;</span>, <span class="dt">gridcolor =</span> <span class="st">&quot;rgb(255,255,255)&quot;</span>, <span class="dt">title =</span> z1, <span class="dt">showbackground =</span> <span class="ot">TRUE</span>)</span>
<span id="cb87-35"><a href="microbiota.html#cb87-35"></a></span>
<span id="cb87-36"><a href="microbiota.html#cb87-36"></a>mic_i &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(samples, <span class="dt">x =</span> <span class="op">~</span>samples<span class="op">$</span>PC1, <span class="dt">y =</span> <span class="op">~</span>samples<span class="op">$</span>PC2, <span class="dt">z =</span> <span class="op">~</span>samples<span class="op">$</span>PC3, <span class="dt">symbol =</span> <span class="op">~</span>Species, <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;circle&quot;</span>), <span class="dt">color =</span> samples<span class="op">$</span>Depth) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_markers</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-37"><a href="microbiota.html#cb87-37"></a><span class="st">    </span><span class="kw">layout</span>(<span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> axx, <span class="dt">yaxis =</span> axy, <span class="dt">zaxis =</span> axz))</span>
<span id="cb87-38"><a href="microbiota.html#cb87-38"></a>mic_i</span></code></pre></div>
<div class="figure"><span id="fig:b-divNMDS"></span>
<div id="htmlwidget-6a2e495448c9250962b4" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-6a2e495448c9250962b4">{"x":{"visdat":{"27f010a5f386":["function () ","plotlyVisDat"]},"cur_data":"27f010a5f386","attrs":{"27f010a5f386":{"x":{},"y":{},"z":{},"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744,483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036,244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728],"symbol":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"symbols":["diamond","x","circle"],"type":"scatter3d","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"MDS1","showbackground":true},"yaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"MDS2","showbackground":true},"zaxis":{"backgroundcolor":"rgb(211,211,211)","gridcolor":"rgb(255,255,255)","title":"MDS3","showbackground":true}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-533.711503289832,-533.70847654356,-533.713255840618,-533.713584964895,-533.670516348698,-533.670443274733,-533.728022146739,-533.723215961153,-533.706939589803,-533.720327454463,-533.719369769575,-533.715337881018,-533.714572636178,-533.708396176852],"y":[0.409311416996973,0.38280141152043,0.0418701415635253,0.0945008602720799,-0.0871083708466786,0.00438425258354429,0.181422096139267,0.588736251617814,0.564287151047826,0.32874481375345,0.333949106160711,0.300986224800745,0.173585343870552,0.184187060671305],"z":[0.10010030742237,-0.0980487284843345,-0.460609627762284,-0.575885930422054,-0.463150889447498,-0.628464638700243,0.00482974033320997,0.0985071245371557,-0.142104206553223,-0.274198366658479,0.0972131670006563,-0.10745720291923,-0.0701127916660412,-0.105244012157873],"type":"scatter3d","mode":"markers","name":"Geodia barretti","marker":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744],"symbol":"diamond","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[407,801,1213,1238,1332,1427,440,483,514,561,563,667,700,744]}},"frame":null},{"x":[-533.731571346295,-533.715542290046,-533.62123948063,-533.704620103817,-533.71328272068,-533.712669331135,-533.713856854653,-533.401159103221,-533.758685520143,-533.381318406932,-533.386700069223,-533.697973018623,-533.331396763115,-533.715211511206,-533.71162405194],"y":[-0.179899169117972,-0.426773855811695,-0.336191617633213,-0.32464379415845,-0.362894574247622,-0.425179241571249,-0.554147459068452,0.20321065124012,-0.0162311176405473,0.423459487262724,-0.0221802394469079,-0.224779787899505,-0.437830958730351,-0.356214169603758,-0.461275531168088],"z":[0.399758385548787,0.0953820233036108,0.0183265244345065,-0.212905338933412,-0.100671784561678,-0.289402403684974,-0.0671046502329305,0.238621607386196,0.492966620155701,0.510793278482771,0.200324118487363,0.23495609547872,0.561183407009165,0.366529766765409,0.176157008464338],"type":"scatter3d","mode":"markers","name":"Stryphnus fortis","marker":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036],"symbol":"x","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[483,1128,1189,1324,1427,1448,1476,572,627,733,829,899,887,916,1036]}},"frame":null},{"x":[967.226608599058,967.311086430771,967.236552956281,967.275437132646,967.275961123644,967.230985269509,967.282374138881,967.270846069357,967.255675077997,967.277529179432,967.262687282268,967.237778932369,967.238181382795,967.27394424504,967.288002824625,967.277161805106],"y":[-1.02281957991734,0.535437963573454,-0.72839966549761,0.0800136440926063,0.103802015178625,-0.0252847008941561,0.81338750812467,-0.103621043061104,-0.492023012766726,-1.15006497297879,0.252669535102914,-0.0581154932854448,-0.339565979316177,0.843152205287901,1.66107128295023,-0.369726089149642],"z":[1.34912100501793,-0.0531388923855049,-0.747239619643618,-0.560226679647344,-0.230331435038835,-0.967805847316926,-0.177504101413335,-0.733143624900259,0.92275288520994,-0.126286502495902,0.730703892679691,0.00509829901106807,0.0535574895023325,0.173792634291558,0.685711786236785,-0.325349891733284],"type":"scatter3d","mode":"markers","name":"Weberella bursa","marker":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728],"symbol":"circle","line":{"colorbar":{"title":"","ticklen":2},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[244,820,876,918,1061,1104,1107,1271,331,441,471,487,560,632,668,728]}},"frame":null},{"x":[-533.758685520143,967.311086430771],"y":[-1.15006497297879,1.66107128295023],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":244,"cmax":1476,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[244,1476],"line":{"color":"rgba(214,39,40,1)"}},"z":[-0.967805847316926,1.34912100501793],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.6: NMDS based on Bray-Curtis dissimilarity.
</p>
</div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="microbiota.html#cb88-1"></a><span class="co"># for saving locally f&lt;- basename(tempfile(&#39;NMDS_microbiome_plotly&#39;, &#39;.&#39;, &#39;.html&#39;)) on.exit(unlink(f), add = TRUE) html &lt;- htmlwidgets::saveWidget(mic_i, f)</span></span>
<span id="cb88-2"><a href="microbiota.html#cb88-2"></a></span>
<span id="cb88-3"><a href="microbiota.html#cb88-3"></a><span class="kw">rm</span>(mic_i, f, html, k, x1, y1, z1, micro.mds, axx, axy, axz, samples, nmds_points)</span></code></pre></div>
<p>NMDS Stress= 8.6e-05.</p>
<p>In some of the downstream analyses, we distinguish between common/abundant OTUs and rare OTUs. We use a cutoff of 0.25% average relative abundance per OTU for the classification. That implies drastically modifying the original numbers of OTUs per sponge as outlined below.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="microbiota.html#cb89-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb89-2"><a href="microbiota.html#cb89-2"></a>emp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/SpongeEMP.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb89-3"><a href="microbiota.html#cb89-3"></a></span>
<span id="cb89-4"><a href="microbiota.html#cb89-4"></a>emp[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;X196900&quot;</span>)</span>
<span id="cb89-5"><a href="microbiota.html#cb89-5"></a><span class="co"># The full data set had the entries listed by sponge host, so there are 62 duplicates in the OTU list length(emp$XOTU_id) # 207 length(unique(emp$XOTU_id)) # 145</span></span>
<span id="cb89-6"><a href="microbiota.html#cb89-6"></a>emp[<span class="st">&quot;num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb89-7"><a href="microbiota.html#cb89-7"></a>emp &lt;-<span class="st"> </span>emp[<span class="kw">order</span>(emp<span class="op">$</span>num), ]</span>
<span id="cb89-8"><a href="microbiota.html#cb89-8"></a>emp[<span class="st">&quot;dup&quot;</span>] &lt;-<span class="st"> </span><span class="kw">duplicated</span>(emp<span class="op">$</span>num)</span>
<span id="cb89-9"><a href="microbiota.html#cb89-9"></a><span class="co"># dim(emp[emp$dup==&#39;TRUE&#39;,]) #62</span></span>
<span id="cb89-10"><a href="microbiota.html#cb89-10"></a>emp &lt;-<span class="st"> </span>emp[emp<span class="op">$</span>dup <span class="op">==</span><span class="st"> &quot;FALSE&quot;</span>, ]</span>
<span id="cb89-11"><a href="microbiota.html#cb89-11"></a>emp[, <span class="kw">c</span>(<span class="st">&quot;sponge&quot;</span>, <span class="st">&quot;num&quot;</span>, <span class="st">&quot;dup&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb89-12"><a href="microbiota.html#cb89-12"></a></span>
<span id="cb89-13"><a href="microbiota.html#cb89-13"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb89-14"><a href="microbiota.html#cb89-14"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb89-15"><a href="microbiota.html#cb89-15"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb89-16"><a href="microbiota.html#cb89-16"></a>    <span class="co"># micro &lt;- sqrt(micro)</span></span>
<span id="cb89-17"><a href="microbiota.html#cb89-17"></a>    </span>
<span id="cb89-18"><a href="microbiota.html#cb89-18"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb89-19"><a href="microbiota.html#cb89-19"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb89-20"><a href="microbiota.html#cb89-20"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb89-21"><a href="microbiota.html#cb89-21"></a>    </span>
<span id="cb89-22"><a href="microbiota.html#cb89-22"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]  <span class="co">#removes columns that only contain 0</span></span>
<span id="cb89-23"><a href="microbiota.html#cb89-23"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb89-24"><a href="microbiota.html#cb89-24"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb89-25"><a href="microbiota.html#cb89-25"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb89-26"><a href="microbiota.html#cb89-26"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb89-27"><a href="microbiota.html#cb89-27"></a>}</span>
<span id="cb89-28"><a href="microbiota.html#cb89-28"></a></span>
<span id="cb89-29"><a href="microbiota.html#cb89-29"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb89-30"><a href="microbiota.html#cb89-30"></a></span>
<span id="cb89-31"><a href="microbiota.html#cb89-31"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb89-32"><a href="microbiota.html#cb89-32"></a>    mic &lt;-<span class="st"> </span>micro</span>
<span id="cb89-33"><a href="microbiota.html#cb89-33"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb89-34"><a href="microbiota.html#cb89-34"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb89-35"><a href="microbiota.html#cb89-35"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb89-36"><a href="microbiota.html#cb89-36"></a>    </span>
<span id="cb89-37"><a href="microbiota.html#cb89-37"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb89-38"><a href="microbiota.html#cb89-38"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb89-39"><a href="microbiota.html#cb89-39"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb89-40"><a href="microbiota.html#cb89-40"></a>    }</span>
<span id="cb89-41"><a href="microbiota.html#cb89-41"></a>    </span>
<span id="cb89-42"><a href="microbiota.html#cb89-42"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb89-43"><a href="microbiota.html#cb89-43"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb89-44"><a href="microbiota.html#cb89-44"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb89-45"><a href="microbiota.html#cb89-45"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb89-46"><a href="microbiota.html#cb89-46"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb89-47"><a href="microbiota.html#cb89-47"></a>}</span>
<span id="cb89-48"><a href="microbiota.html#cb89-48"></a></span>
<span id="cb89-49"><a href="microbiota.html#cb89-49"></a>gb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb89-50"><a href="microbiota.html#cb89-50"></a>sf_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb89-51"><a href="microbiota.html#cb89-51"></a>wb_occurrence &lt;-<span class="st"> </span><span class="kw">overall_rabdc</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb89-52"><a href="microbiota.html#cb89-52"></a></span>
<span id="cb89-53"><a href="microbiota.html#cb89-53"></a>gb_occurrence &lt;-<span class="st"> </span>gb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb89-54"><a href="microbiota.html#cb89-54"></a>gb_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(gb_occurrence)</span>
<span id="cb89-55"><a href="microbiota.html#cb89-55"></a>gb_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_occurrence, emp)</span>
<span id="cb89-56"><a href="microbiota.html#cb89-56"></a></span>
<span id="cb89-57"><a href="microbiota.html#cb89-57"></a>sf_occurrence &lt;-<span class="st"> </span>sf_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb89-58"><a href="microbiota.html#cb89-58"></a>sf_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(sf_occurrence)</span>
<span id="cb89-59"><a href="microbiota.html#cb89-59"></a>sf_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_occurrence, emp)</span>
<span id="cb89-60"><a href="microbiota.html#cb89-60"></a></span>
<span id="cb89-61"><a href="microbiota.html#cb89-61"></a>wb_occurrence &lt;-<span class="st"> </span>wb_occurrence[, <span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>)]</span>
<span id="cb89-62"><a href="microbiota.html#cb89-62"></a>wb_occurrence[<span class="st">&quot;XOTU_id&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(wb_occurrence)</span>
<span id="cb89-63"><a href="microbiota.html#cb89-63"></a>wb_occ_emp &lt;-<span class="st"> </span><span class="kw">left_join</span>(wb_occurrence, emp)</span>
<span id="cb89-64"><a href="microbiota.html#cb89-64"></a></span>
<span id="cb89-65"><a href="microbiota.html#cb89-65"></a>gb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(gb_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(gb_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb89-66"><a href="microbiota.html#cb89-66"></a>sf_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(sf_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(sf_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb89-67"><a href="microbiota.html#cb89-67"></a>wb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wb_occ_emp<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(wb_occ_emp<span class="op">$</span>occurrence), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb89-68"><a href="microbiota.html#cb89-68"></a></span>
<span id="cb89-69"><a href="microbiota.html#cb89-69"></a>aggr &lt;-<span class="st"> </span><span class="kw">cbind</span>(gb_aggr, sf_aggr<span class="op">$</span>x, wb_aggr<span class="op">$</span>x)</span>
<span id="cb89-70"><a href="microbiota.html#cb89-70"></a><span class="kw">colnames</span>(aggr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count Gb&quot;</span>, <span class="st">&quot;count Sf&quot;</span>, <span class="st">&quot;count Wb&quot;</span>)</span>
<span id="cb89-71"><a href="microbiota.html#cb89-71"></a></span>
<span id="cb89-72"><a href="microbiota.html#cb89-72"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb89-73"><a href="microbiota.html#cb89-73"></a><span class="kw">kable</span>(aggr, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count (Gb)&quot;</span>, <span class="st">&quot;count (Sf)&quot;</span>, <span class="st">&quot;count (Wb)&quot;</span>), <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Number of OTUs being excluded and retained in the three sponges&#39; microbiota when filtering for average relative abundance &gt; 0.25%.&quot;</span>, </span>
<span id="cb89-74"><a href="microbiota.html#cb89-74"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:filtering-low-abdc-1">Table 3.1: </span>Number of OTUs being excluded and retained in the three spongesâ€™ microbiota when filtering for average relative abundance &gt; 0.25%.
</caption>
<thead>
<tr>
<th style="text-align:left;">
OTU classification
</th>
<th style="text-align:right;">
count (Gb)
</th>
<th style="text-align:right;">
count (Sf)
</th>
<th style="text-align:right;">
count (Wb)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
common
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
rare
</td>
<td style="text-align:right;">
324
</td>
<td style="text-align:right;">
372
</td>
<td style="text-align:right;">
115
</td>
</tr>
</tbody>
</table>
<p>That means, for <em>G. barretti</em> we exclude 77.1 % of OTUs, for <em>S. fortis</em> 80.7 % and for <em>W. bursa</em> 85.2%.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="microbiota.html#cb90-1"></a>gb_common &lt;-<span class="st"> </span>gb_occ_emp[gb_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb90-2"><a href="microbiota.html#cb90-2"></a>sf_common &lt;-<span class="st"> </span>sf_occ_emp[sf_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb90-3"><a href="microbiota.html#cb90-3"></a>wb_common &lt;-<span class="st"> </span>wb_occ_emp[wb_occ_emp<span class="op">$</span>occurrence <span class="op">==</span><span class="st"> &quot;common&quot;</span>, ]</span>
<span id="cb90-4"><a href="microbiota.html#cb90-4"></a></span>
<span id="cb90-5"><a href="microbiota.html#cb90-5"></a>gb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(gb_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(gb_common<span class="op">$</span>spongeEMP_enriched), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb90-6"><a href="microbiota.html#cb90-6"></a>sf_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(sf_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(sf_common<span class="op">$</span>spongeEMP_enriched), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb90-7"><a href="microbiota.html#cb90-7"></a>wb_aggr &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wb_common<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(wb_common<span class="op">$</span>spongeEMP_enriched), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb90-8"><a href="microbiota.html#cb90-8"></a></span>
<span id="cb90-9"><a href="microbiota.html#cb90-9"></a>aggr &lt;-<span class="st"> </span><span class="kw">cbind</span>(gb_aggr, sf_aggr<span class="op">$</span>x)</span>
<span id="cb90-10"><a href="microbiota.html#cb90-10"></a>aggr &lt;-<span class="st"> </span><span class="kw">left_join</span>(aggr, wb_aggr, <span class="dt">by =</span> <span class="st">&quot;Group.1&quot;</span>)</span>
<span id="cb90-11"><a href="microbiota.html#cb90-11"></a><span class="kw">colnames</span>(aggr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;EMP OTU count&quot;</span>, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Wb&quot;</span>)</span>
<span id="cb90-12"><a href="microbiota.html#cb90-12"></a></span>
<span id="cb90-13"><a href="microbiota.html#cb90-13"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb90-14"><a href="microbiota.html#cb90-14"></a><span class="kw">kable</span>(aggr, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;OTU classification&quot;</span>, <span class="st">&quot;count (Gb)&quot;</span>, <span class="st">&quot;count (Sf)&quot;</span>, <span class="st">&quot;count (Wb)&quot;</span>), <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Number of common/abundant OTUs found in the SpongeEMP data base&quot;</span>, </span>
<span id="cb90-15"><a href="microbiota.html#cb90-15"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:filtering-low-abdc-2">Table 3.2: </span>Number of common/abundant OTUs found in the SpongeEMP data base
</caption>
<thead>
<tr>
<th style="text-align:left;">
OTU classification
</th>
<th style="text-align:right;">
count (Gb)
</th>
<th style="text-align:right;">
count (Sf)
</th>
<th style="text-align:right;">
count (Wb)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
yes
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table>
</div>
<div id="EnvMod" class="section level2">
<h2><span class="header-section-number">3.4</span> Environmental modelling</h2>
<p>In order to investigate whether and which of the environmental parameter might â€œexplainâ€/correlate with variation the the microbiota, we apply <a href="microbiota.html#constrained">constrained</a> and <a href="microbiota.html#unconstrained">unconstrained</a> ecological data analysis methods.</p>
<div id="constrained" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Constrained modelling approach Automatic stepwise model building</h3>
<p>We use canonical correspondence analysis as method for ordination. According to the manual for the R package vegan, â€œa good dissimilarity index for multidimensional scaling should have a high rank-order similarity with gradient separationâ€ <span class="citation">(Oksanen et al. <a href="#ref-R-vegan" role="doc-biblioref">2019</a>)</span>. Thus interpreting the results of Tab <a href="microbiota.html#tab:rankindex">3.3</a>, we find that square root transformation and Wisconsin standardisation increase the rank correlation between the microbial community dissimilarity matrix and the environmental gradient separation in all three sponge microbiota for a number of ecological dissimilarity indices.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="microbiota.html#cb91-1"></a><span class="kw">library</span>(vegan)</span>
<span id="cb91-2"><a href="microbiota.html#cb91-2"></a></span>
<span id="cb91-3"><a href="microbiota.html#cb91-3"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb91-4"><a href="microbiota.html#cb91-4"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb91-5"><a href="microbiota.html#cb91-5"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb91-6"><a href="microbiota.html#cb91-6"></a></span>
<span id="cb91-7"><a href="microbiota.html#cb91-7"></a><span class="co"># Gb12 has no salinity and temperature: impute from Gb11 &amp; Gb13: Salinity:34.92; Temp:3.59</span></span>
<span id="cb91-8"><a href="microbiota.html#cb91-8"></a>row &lt;-<span class="st"> </span><span class="kw">which</span>(meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>)</span>
<span id="cb91-9"><a href="microbiota.html#cb91-9"></a>temp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBottomTemp_Cdeg&quot;</span>)</span>
<span id="cb91-10"><a href="microbiota.html#cb91-10"></a>sal &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBotSalinity_PSU&quot;</span>)</span>
<span id="cb91-11"><a href="microbiota.html#cb91-11"></a>meta_data[row, temp] &lt;-<span class="st"> </span><span class="fl">3.59</span></span>
<span id="cb91-12"><a href="microbiota.html#cb91-12"></a>meta_data[row, sal] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb91-13"><a href="microbiota.html#cb91-13"></a><span class="kw">rm</span>(row, temp, sal)</span>
<span id="cb91-14"><a href="microbiota.html#cb91-14"></a></span>
<span id="cb91-15"><a href="microbiota.html#cb91-15"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb91-16"><a href="microbiota.html#cb91-16"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb91-17"><a href="microbiota.html#cb91-17"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb91-18"><a href="microbiota.html#cb91-18"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb91-19"><a href="microbiota.html#cb91-19"></a>    </span>
<span id="cb91-20"><a href="microbiota.html#cb91-20"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb91-21"><a href="microbiota.html#cb91-21"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb91-22"><a href="microbiota.html#cb91-22"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb91-23"><a href="microbiota.html#cb91-23"></a>    </span>
<span id="cb91-24"><a href="microbiota.html#cb91-24"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb91-25"><a href="microbiota.html#cb91-25"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb91-26"><a href="microbiota.html#cb91-26"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb91-27"><a href="microbiota.html#cb91-27"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb91-28"><a href="microbiota.html#cb91-28"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb91-29"><a href="microbiota.html#cb91-29"></a>}</span>
<span id="cb91-30"><a href="microbiota.html#cb91-30"></a></span>
<span id="cb91-31"><a href="microbiota.html#cb91-31"></a>microbiomes &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb91-32"><a href="microbiota.html#cb91-32"></a></span>
<span id="cb91-33"><a href="microbiota.html#cb91-33"></a>md_prep &lt;-<span class="st"> </span><span class="cf">function</span>(microbiomes, meta_data) {</span>
<span id="cb91-34"><a href="microbiota.html#cb91-34"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb91-35"><a href="microbiota.html#cb91-35"></a>    </span>
<span id="cb91-36"><a href="microbiota.html#cb91-36"></a>    gb &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>gb</span>
<span id="cb91-37"><a href="microbiota.html#cb91-37"></a>    sf &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>sf</span>
<span id="cb91-38"><a href="microbiota.html#cb91-38"></a>    wb &lt;-<span class="st"> </span>microbiomes<span class="op">$</span>wb</span>
<span id="cb91-39"><a href="microbiota.html#cb91-39"></a>    </span>
<span id="cb91-40"><a href="microbiota.html#cb91-40"></a>    gb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(gb), ]</span>
<span id="cb91-41"><a href="microbiota.html#cb91-41"></a>    <span class="kw">rownames</span>(gb_md) &lt;-<span class="st"> </span>gb_md<span class="op">$</span>unified_ID</span>
<span id="cb91-42"><a href="microbiota.html#cb91-42"></a>    gb_md &lt;-<span class="st"> </span>gb_md[<span class="kw">order</span>(gb_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb91-43"><a href="microbiota.html#cb91-43"></a>    <span class="kw">all</span>(<span class="kw">rownames</span>(microbiomes<span class="op">$</span>gb) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(gb_md))</span>
<span id="cb91-44"><a href="microbiota.html#cb91-44"></a>    gb_md &lt;-<span class="st"> </span>gb_md[, <span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb91-45"><a href="microbiota.html#cb91-45"></a>    </span>
<span id="cb91-46"><a href="microbiota.html#cb91-46"></a>    sf_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(sf), ]</span>
<span id="cb91-47"><a href="microbiota.html#cb91-47"></a>    <span class="kw">rownames</span>(sf_md) &lt;-<span class="st"> </span>sf_md<span class="op">$</span>unified_ID</span>
<span id="cb91-48"><a href="microbiota.html#cb91-48"></a>    sf_md &lt;-<span class="st"> </span>sf_md[<span class="kw">order</span>(sf_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb91-49"><a href="microbiota.html#cb91-49"></a>    sf_md<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb91-50"><a href="microbiota.html#cb91-50"></a>    wb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(wb), ]</span>
<span id="cb91-51"><a href="microbiota.html#cb91-51"></a>    <span class="kw">rownames</span>(wb_md) &lt;-<span class="st"> </span>wb_md<span class="op">$</span>unified_ID</span>
<span id="cb91-52"><a href="microbiota.html#cb91-52"></a>    wb_md &lt;-<span class="st"> </span>wb_md[<span class="kw">order</span>(wb_md<span class="op">$</span>unified_ID), ]</span>
<span id="cb91-53"><a href="microbiota.html#cb91-53"></a>    wb_md<span class="op">$</span>unified_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb91-54"><a href="microbiota.html#cb91-54"></a>    </span>
<span id="cb91-55"><a href="microbiota.html#cb91-55"></a>    mds &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb_md =</span> gb_md, <span class="dt">sf_md =</span> sf_md, <span class="dt">wb_md =</span> wb_md)</span>
<span id="cb91-56"><a href="microbiota.html#cb91-56"></a>    <span class="kw">return</span>(mds)</span>
<span id="cb91-57"><a href="microbiota.html#cb91-57"></a>}</span>
<span id="cb91-58"><a href="microbiota.html#cb91-58"></a></span>
<span id="cb91-59"><a href="microbiota.html#cb91-59"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb91-60"><a href="microbiota.html#cb91-60"></a></span>
<span id="cb91-61"><a href="microbiota.html#cb91-61"></a><span class="co"># Standardization If there is a large difference between smallest non-zero abundance and largest abundance, we want to reduce this difference. Usually square root transformation</span></span>
<span id="cb91-62"><a href="microbiota.html#cb91-62"></a><span class="co"># is sufficient to balance the data. Wisconsin double standardization often improves the gradient detection ability of dissimilarity indices.</span></span>
<span id="cb91-63"><a href="microbiota.html#cb91-63"></a></span>
<span id="cb91-64"><a href="microbiota.html#cb91-64"></a><span class="co"># Which dissimilarity index is best?</span></span>
<span id="cb91-65"><a href="microbiota.html#cb91-65"></a>gb_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), (microbiomes<span class="op">$</span>gb)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#unstandardized</span></span>
<span id="cb91-66"><a href="microbiota.html#cb91-66"></a>gb_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), microbiomes<span class="op">$</span>gb, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#sqrt</span></span>
<span id="cb91-67"><a href="microbiota.html#cb91-67"></a>gb_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>gb_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))  <span class="co">#sqrt and wisconsin</span></span>
<span id="cb91-68"><a href="microbiota.html#cb91-68"></a></span>
<span id="cb91-69"><a href="microbiota.html#cb91-69"></a>sf_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), (microbiomes<span class="op">$</span>sf)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb91-70"><a href="microbiota.html#cb91-70"></a>sf_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), microbiomes<span class="op">$</span>sf, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb91-71"><a href="microbiota.html#cb91-71"></a>sf_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>sf_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb91-72"><a href="microbiota.html#cb91-72"></a></span>
<span id="cb91-73"><a href="microbiota.html#cb91-73"></a>wb_ri1 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), (microbiomes<span class="op">$</span>wb)<span class="op">^</span><span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb91-74"><a href="microbiota.html#cb91-74"></a>wb_ri2 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), microbiomes<span class="op">$</span>wb, <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb91-75"><a href="microbiota.html#cb91-75"></a>wb_ri3 &lt;-<span class="st"> </span><span class="kw">rankindex</span>(<span class="kw">scale</span>(mds<span class="op">$</span>wb_md), <span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb), <span class="kw">c</span>(<span class="st">&quot;euc&quot;</span>, <span class="st">&quot;man&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="st">&quot;jac&quot;</span>, <span class="st">&quot;kul&quot;</span>))</span>
<span id="cb91-76"><a href="microbiota.html#cb91-76"></a></span>
<span id="cb91-77"><a href="microbiota.html#cb91-77"></a>rankindices &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_ri1, gb_ri2, gb_ri3, sf_ri1, sf_ri2, sf_ri3, wb_ri1, wb_ri2, wb_ri3)</span>
<span id="cb91-78"><a href="microbiota.html#cb91-78"></a>rankindices &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rankindices)</span>
<span id="cb91-79"><a href="microbiota.html#cb91-79"></a>rankindices[<span class="st">&quot;Sponge species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;G. barretti&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;S. fortis&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;W. bursa&quot;</span>, <span class="dv">3</span>))</span>
<span id="cb91-80"><a href="microbiota.html#cb91-80"></a>rankindices[<span class="st">&quot;Normalisation&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;sqrt&quot;</span>, <span class="st">&quot;sqrt &amp; wisconsin&quot;</span>), <span class="dv">3</span>))</span>
<span id="cb91-81"><a href="microbiota.html#cb91-81"></a></span>
<span id="cb91-82"><a href="microbiota.html#cb91-82"></a><span class="kw">options</span>(<span class="dt">kableExtra.html.bsTable =</span> T)</span>
<span id="cb91-83"><a href="microbiota.html#cb91-83"></a><span class="kw">kable</span>(rankindices, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Euclidean&quot;</span>, <span class="st">&quot;Manhattan&quot;</span>, <span class="st">&quot;Brayâ€“Curtis&quot;</span>, <span class="st">&quot;Jaccard&quot;</span>, <span class="st">&quot;Kulczynski&quot;</span>, <span class="st">&quot;Sponge species&quot;</span>, <span class="st">&quot;Normalisation&quot;</span>), <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Rank correlation between dissimilarity indices and gradient separation. The higher the number the stronger the correlation, i.e. the better the fit.&quot;</span>, </span>
<span id="cb91-84"><a href="microbiota.html#cb91-84"></a>    <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;bordered&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="dt">full_width =</span> F, <span class="dt">latex_options =</span> <span class="kw">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table table-striped table-hover table-bordered table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:rankindex">Table 3.3: </span>Rank correlation between dissimilarity indices and gradient separation. The higher the number the stronger the correlation, i.e.Â the better the fit.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Euclidean
</th>
<th style="text-align:right;">
Manhattan
</th>
<th style="text-align:right;">
Brayâ€“Curtis
</th>
<th style="text-align:right;">
Jaccard
</th>
<th style="text-align:right;">
Kulczynski
</th>
<th style="text-align:left;">
Sponge species
</th>
<th style="text-align:left;">
Normalisation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.0512024
</td>
<td style="text-align:right;">
-0.0445135
</td>
<td style="text-align:right;">
0.3979615
</td>
<td style="text-align:right;">
0.3979615
</td>
<td style="text-align:right;">
0.4509158
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0930562
</td>
<td style="text-align:right;">
0.1658067
</td>
<td style="text-align:right;">
0.3967033
</td>
<td style="text-align:right;">
0.3967033
</td>
<td style="text-align:right;">
0.4010193
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4072305
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:right;">
0.4026915
</td>
<td style="text-align:left;">
G. barretti
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0816401
</td>
<td style="text-align:right;">
0.1826975
</td>
<td style="text-align:right;">
0.3111549
</td>
<td style="text-align:right;">
0.3111549
</td>
<td style="text-align:right;">
0.4108128
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3285092
</td>
<td style="text-align:right;">
0.3476778
</td>
<td style="text-align:right;">
0.4620775
</td>
<td style="text-align:right;">
0.4620775
</td>
<td style="text-align:right;">
0.4877255
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5056811
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:right;">
0.5471905
</td>
<td style="text-align:left;">
S. fortis
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0280922
</td>
<td style="text-align:right;">
0.0994375
</td>
<td style="text-align:right;">
0.0008681
</td>
<td style="text-align:right;">
0.0008681
</td>
<td style="text-align:right;">
0.0048476
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
none
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0376971
</td>
<td style="text-align:right;">
0.4854434
</td>
<td style="text-align:right;">
0.2801306
</td>
<td style="text-align:right;">
0.2801306
</td>
<td style="text-align:right;">
0.2656573
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
sqrt
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.0833252
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:right;">
0.3617890
</td>
<td style="text-align:left;">
W. bursa
</td>
<td style="text-align:left;">
sqrt &amp; wisconsin
</td>
</tr>
</tbody>
</table>
<p>We adapt the microbial data sets accordingly applying square root transformation and Wisconsin standardisation of the microbiota in all subsequent ecological analyses. Then, we build a model (null model) without any environmental parameters, and one (full model) with the maximum number of environmental parameters (terms) possible so that none of them have a VIF &gt; 10. Finally, we use the stepwise model building function <code>ordistep</code> to determine, which of the environmental parameters is a significant constraint for the microbiomes. The function compares the null model and adds and removes terms from the full model to find (combinations of) significant constraints. The significance of the parameters is then tested in an ANOVA.</p>
<p><strong><em>G. barretti</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the ANOVA of the suggested model.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="microbiota.html#cb92-1"></a><span class="co"># mod0 has no terms, intercept only mod1 includes all terms possible with a VIF &lt; 10. Available: &#39;Depth&#39;, &#39;Latitude&#39;, &#39;Longitude&#39;, &#39;MeanBottomTemp_Cdeg&#39;, &#39;MeanBotSalinity_PSU&#39;,</span></span>
<span id="cb92-2"><a href="microbiota.html#cb92-2"></a><span class="co"># &#39;YEAR&#39;</span></span>
<span id="cb92-3"><a href="microbiota.html#cb92-3"></a></span>
<span id="cb92-4"><a href="microbiota.html#cb92-4"></a><span class="co">## Gb</span></span>
<span id="cb92-5"><a href="microbiota.html#cb92-5"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>gb_md)</span>
<span id="cb92-6"><a href="microbiota.html#cb92-6"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>MeanBottomTemp_Cdeg <span class="op">+</span><span class="st"> </span>YEAR, mds<span class="op">$</span>gb_md)</span>
<span id="cb92-7"><a href="microbiota.html#cb92-7"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude MeanBottomTemp_Cdeg                YEAR 
##            1.230382            1.775034            1.929029            1.651565</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="microbiota.html#cb94-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)  <span class="co">#0</span></span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="microbiota.html#cb95-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 6.7097 3.4066  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="microbiota.html#cb97-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$gb) ~ Depth, data = mds$gb_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1   0.34451 3.4066  0.001 ***
## Residual 12   1.21355                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong><em>S. fortis</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the ANOVA of the suggested model.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="microbiota.html#cb99-1"></a><span class="co">## Sf</span></span>
<span id="cb99-2"><a href="microbiota.html#cb99-2"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>sf_md)</span>
<span id="cb99-3"><a href="microbiota.html#cb99-3"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>YEAR <span class="op">+</span><span class="st"> </span>MeanBotSalinity_PSU <span class="op">+</span><span class="st"> </span>Longitude, mds<span class="op">$</span>sf_md)</span>
<span id="cb99-4"><a href="microbiota.html#cb99-4"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude                YEAR MeanBotSalinity_PSU           Longitude 
##            4.218950            5.079261            1.082453            3.648340            5.071690</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="microbiota.html#cb101-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="microbiota.html#cb102-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##         Df    AIC      F Pr(&gt;F)   
## + Depth  1 13.547 2.1462  0.005 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="microbiota.html#cb104-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$sf) ~ Depth, data = mds$sf_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     1   0.31199 2.1462  0.001 ***
## Residual 13   1.88978                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong><em>W. bursa</em></strong>: first the VIFs of all terms included in the full model, second the result of the stepwise model building, third the ANOVA of the suggested model.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="microbiota.html#cb106-1"></a><span class="co">## Wb</span></span>
<span id="cb106-2"><a href="microbiota.html#cb106-2"></a>mod0 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, mds<span class="op">$</span>wb_md)</span>
<span id="cb106-3"><a href="microbiota.html#cb106-3"></a>mod1 &lt;-<span class="st"> </span><span class="kw">cca</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb) <span class="op">~</span><span class="st"> </span>Depth <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>MeanBottomTemp_Cdeg <span class="op">+</span><span class="st"> </span>YEAR, mds<span class="op">$</span>wb_md)</span>
<span id="cb106-4"><a href="microbiota.html#cb106-4"></a><span class="kw">vif.cca</span>(mod1)</span></code></pre></div>
<pre><code>##               Depth            Latitude MeanBottomTemp_Cdeg                YEAR 
##            2.216302            1.217879            2.402357            1.153565</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="microbiota.html#cb108-1"></a>mod &lt;-<span class="st"> </span><span class="kw">ordistep</span>(mod0, <span class="dt">scope =</span> <span class="kw">formula</span>(mod1), <span class="dt">trace =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="microbiota.html#cb109-1"></a>mod<span class="op">$</span>anova</span></code></pre></div>
<pre><code>##            Df    AIC      F Pr(&gt;F)   
## + Depth     1 25.701 1.6576  0.005 **
## + Latitude  1 25.993 1.4649  0.030 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="microbiota.html#cb111-1"></a><span class="kw">anova</span>(mod)</span></code></pre></div>
<pre><code>## Permutation test for cca under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: cca(formula = wisconsin(microbiomes$wb) ~ Depth + Latitude, data = mds$wb_md)
##          Df ChiSquare      F Pr(&gt;F)    
## Model     2    0.8527 1.5888  0.001 ***
## Residual 13    3.4888                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>For all <em>G. barretti</em> and <em>S. fortis</em> depth is a significant constraint of the microbial community. For <em>W. bursa</em> we find temperature to be a significant constraint.</p>
</div>
<div id="unconstrained" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Unconstrained modelling approach</h3>
<p>In an alternative approach, we fit environmental vectors onto an ordination of the microbiota. This method allows to include all environmental parameters (regardless of collinearity). Length of the arrow indicates strength of the predictor (environmental parameter).</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="microbiota.html#cb113-1"></a><span class="kw">set.seed</span>(<span class="dv">1984</span>)</span>
<span id="cb113-2"><a href="microbiota.html#cb113-2"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb113-3"><a href="microbiota.html#cb113-3"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb113-4"><a href="microbiota.html#cb113-4"></a></span>
<span id="cb113-5"><a href="microbiota.html#cb113-5"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb113-6"><a href="microbiota.html#cb113-6"></a>row &lt;-<span class="st"> </span><span class="kw">which</span>(meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>)</span>
<span id="cb113-7"><a href="microbiota.html#cb113-7"></a>temp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBottomTemp_Cdeg&quot;</span>)</span>
<span id="cb113-8"><a href="microbiota.html#cb113-8"></a>sal &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(meta_data) <span class="op">==</span><span class="st"> &quot;MeanBotSalinity_PSU&quot;</span>)</span>
<span id="cb113-9"><a href="microbiota.html#cb113-9"></a>meta_data[row, temp] &lt;-<span class="st"> </span><span class="fl">3.59</span></span>
<span id="cb113-10"><a href="microbiota.html#cb113-10"></a>meta_data[row, sal] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb113-11"><a href="microbiota.html#cb113-11"></a><span class="kw">rm</span>(row, temp, sal)</span>
<span id="cb113-12"><a href="microbiota.html#cb113-12"></a></span>
<span id="cb113-13"><a href="microbiota.html#cb113-13"></a>microbiomes &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb113-14"><a href="microbiota.html#cb113-14"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb113-15"><a href="microbiota.html#cb113-15"></a></span>
<span id="cb113-16"><a href="microbiota.html#cb113-16"></a><span class="kw">colnames</span>(mds<span class="op">$</span>gb_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb113-17"><a href="microbiota.html#cb113-17"></a><span class="kw">colnames</span>(mds<span class="op">$</span>sf_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb113-18"><a href="microbiota.html#cb113-18"></a><span class="kw">colnames</span>(mds<span class="op">$</span>wb_md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Lon&quot;</span>, <span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Sal&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb113-19"><a href="microbiota.html#cb113-19"></a></span>
<span id="cb113-20"><a href="microbiota.html#cb113-20"></a><span class="co"># Gb</span></span>
<span id="cb113-21"><a href="microbiota.html#cb113-21"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb))  <span class="co">#distance matrix</span></span>
<span id="cb113-22"><a href="microbiota.html#cb113-22"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb113-23"><a href="microbiota.html#cb113-23"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>gb_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows; STRATA?</span></span>
<span id="cb113-24"><a href="microbiota.html#cb113-24"></a>ef</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##          NMDS1    NMDS2     r2 Pr(&gt;r)    
## Depth  0.96701 -0.25474 0.8945  0.001 ***
## Lat    0.16703  0.98595 0.1627  0.411    
## Lon    0.77996  0.62583 0.4251  0.047 *  
## Temp  -0.00596 -0.99998 0.2302  0.240    
## Sal    0.70615 -0.70806 0.5171  0.025 *  
## Year   0.53961  0.84192 0.1444  0.418    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="microbiota.html#cb115-1"></a><span class="co"># r Goodness of fit statistic: Squared correlation coefficient I will report r^2 i.e. goodness of fit rather than correlaiton because correlation with a distance matrix is not</span></span>
<span id="cb115-2"><a href="microbiota.html#cb115-2"></a><span class="co"># meaningful for understanding</span></span>
<span id="cb115-3"><a href="microbiota.html#cb115-3"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co">#plot</span></span>
<span id="cb115-4"><a href="microbiota.html#cb115-4"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co">#arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-1"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-1-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of _G. barretti_ microbiome." width="672" />
<p class="caption">
Figure 3.7: Fitting significant (p&lt;0.05) environmental vectors onto ordination of <em>G. barretti</em> microbiome.
</p>
</div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="microbiota.html#cb116-1"></a><span class="kw">set.seed</span>(<span class="dv">1984</span>)</span>
<span id="cb116-2"><a href="microbiota.html#cb116-2"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf))  <span class="co"># distance matrix</span></span>
<span id="cb116-3"><a href="microbiota.html#cb116-3"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb116-4"><a href="microbiota.html#cb116-4"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>sf_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows</span></span>
<span id="cb116-5"><a href="microbiota.html#cb116-5"></a>ef</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##          NMDS1    NMDS2     r2 Pr(&gt;r)   
## Depth  0.84791  0.53014 0.6976  0.002 **
## Lat    0.13416  0.99096 0.1261  0.393   
## Lon    0.68725  0.72642 0.6101  0.007 **
## Temp  -0.09375 -0.99560 0.3200  0.107   
## Sal    0.84644 -0.53249 0.1908  0.258   
## Year   0.96551  0.26038 0.0114  0.932   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="microbiota.html#cb118-1"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co"># plot</span></span>
<span id="cb118-2"><a href="microbiota.html#cb118-2"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co"># arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-2"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-2-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of _S. fortis_ microbiome." width="672" />
<p class="caption">
Figure 3.8: Fitting significant (p&lt;0.05) environmental vectors onto ordination of <em>S. fortis</em> microbiome.
</p>
</div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="microbiota.html#cb119-1"></a><span class="kw">set.seed</span>(<span class="dv">1984</span>)</span>
<span id="cb119-2"><a href="microbiota.html#cb119-2"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb))  <span class="co"># distance matrix</span></span>
<span id="cb119-3"><a href="microbiota.html#cb119-3"></a>ordi_micro &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(dist_micro, <span class="dt">trace =</span> F)  <span class="co"># ordination</span></span>
<span id="cb119-4"><a href="microbiota.html#cb119-4"></a>ef &lt;-<span class="st"> </span><span class="kw">envfit</span>(ordi_micro, mds<span class="op">$</span>wb_md, <span class="dt">permutations =</span> <span class="dv">999</span>)  <span class="co"># fitting arrows</span></span>
<span id="cb119-5"><a href="microbiota.html#cb119-5"></a>ef</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##          NMDS1    NMDS2     r2 Pr(&gt;r)    
## Depth  0.15403  0.98807 0.7720  0.001 ***
## Lat    0.73298  0.68025 0.2144  0.196    
## Lon    0.28260  0.95924 0.5937  0.006 ** 
## Temp   0.14099  0.99001 0.7231  0.003 ** 
## Sal    0.21497  0.97662 0.8490  0.001 ***
## Year  -0.21466 -0.97669 0.0422  0.749    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="microbiota.html#cb121-1"></a><span class="kw">plot</span>(ordi_micro, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)  <span class="co"># plot</span></span>
<span id="cb121-2"><a href="microbiota.html#cb121-2"></a><span class="kw">plot</span>(ef, <span class="dt">p.max =</span> <span class="fl">0.05</span>)  <span class="co"># arrows</span></span></code></pre></div>
<div class="figure"><span id="fig:envfit-3"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/envfit-3-1.png" alt="Fitting significant (p&lt;0.05) environmental vectors onto ordination of _W. bursa_ microbiome." width="672" />
<p class="caption">
Figure 3.9: Fitting significant (p&lt;0.05) environmental vectors onto ordination of <em>W. bursa</em> microbiome.
</p>
</div>
</div>
<div id="Hclust" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Hierarchical clustering</h3>
<p>So far, weâ€™ve treated depth as a linear variable. With these clustering method, weâ€™re asking whether there are particular groups standing out.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="microbiota.html#cb122-1"></a><span class="co">## Clustering</span></span>
<span id="cb122-2"><a href="microbiota.html#cb122-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb122-3"><a href="microbiota.html#cb122-3"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>gb))  <span class="co">#distance matrix</span></span>
<span id="cb122-4"><a href="microbiota.html#cb122-4"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb122-5"><a href="microbiota.html#cb122-5"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Gb&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span>
<span id="cb122-6"><a href="microbiota.html#cb122-6"></a><span class="kw">rect.hclust</span>(clua, <span class="dv">2</span>)</span>
<span id="cb122-7"><a href="microbiota.html#cb122-7"></a>grp1 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb122-8"><a href="microbiota.html#cb122-8"></a></span>
<span id="cb122-9"><a href="microbiota.html#cb122-9"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>sf))  <span class="co">#distance matrix</span></span>
<span id="cb122-10"><a href="microbiota.html#cb122-10"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb122-11"><a href="microbiota.html#cb122-11"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Sf&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span>
<span id="cb122-12"><a href="microbiota.html#cb122-12"></a>grp2 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb122-13"><a href="microbiota.html#cb122-13"></a></span>
<span id="cb122-14"><a href="microbiota.html#cb122-14"></a>dist_micro &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(microbiomes<span class="op">$</span>wb))  <span class="co">#distance matrix</span></span>
<span id="cb122-15"><a href="microbiota.html#cb122-15"></a>clua &lt;-<span class="st"> </span><span class="kw">hclust</span>(dist_micro, <span class="st">&quot;average&quot;</span>)  <span class="co">#average= UPGMA</span></span>
<span id="cb122-16"><a href="microbiota.html#cb122-16"></a><span class="kw">plot</span>(clua, <span class="dt">sub =</span> <span class="st">&quot;Wb&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;UPGMA&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:hclust"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/hclust-1.png" alt="Hclust" width="672" />
<p class="caption">
Figure 3.10: Hclust
</p>
</div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="microbiota.html#cb123-1"></a>grp3 &lt;-<span class="st"> </span><span class="kw">cutree</span>(clua, <span class="dv">2</span>)</span>
<span id="cb123-2"><a href="microbiota.html#cb123-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb123-3"><a href="microbiota.html#cb123-3"></a></span>
<span id="cb123-4"><a href="microbiota.html#cb123-4"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$gb)) plot(ord, display = &#39;sites&#39;) ordihull(ord, grp1, lty = 2, col = &#39;red&#39;)</span></span>
<span id="cb123-5"><a href="microbiota.html#cb123-5"></a></span>
<span id="cb123-6"><a href="microbiota.html#cb123-6"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$sf)) plot(ord, display = &#39;sites&#39;) ordihull(ord, grp2, lty = 2, col = &#39;red&#39;)</span></span>
<span id="cb123-7"><a href="microbiota.html#cb123-7"></a></span>
<span id="cb123-8"><a href="microbiota.html#cb123-8"></a><span class="co"># ord &lt;- cca(wisconsin(microbiomes$wb)) plot(ord, display = &#39;sites&#39;) ordihull(ord, grp3, lty = 2, col = &#39;red&#39;)</span></span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="microbiota.html#cb124-1"></a><span class="kw">library</span>(pheatmap)</span>
<span id="cb124-2"><a href="microbiota.html#cb124-2"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb124-3"><a href="microbiota.html#cb124-3"></a><span class="kw">library</span>(viridis)</span>
<span id="cb124-4"><a href="microbiota.html#cb124-4"></a></span>
<span id="cb124-5"><a href="microbiota.html#cb124-5"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb124-6"><a href="microbiota.html#cb124-6"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb124-7"><a href="microbiota.html#cb124-7"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb124-8"><a href="microbiota.html#cb124-8"></a></span>
<span id="cb124-9"><a href="microbiota.html#cb124-9"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb124-10"><a href="microbiota.html#cb124-10"></a>mds &lt;-<span class="st"> </span><span class="kw">md_prep</span>(microbiomes, meta_data)</span>
<span id="cb124-11"><a href="microbiota.html#cb124-11"></a>gb_md &lt;-<span class="st"> </span>mds<span class="op">$</span>gb_md</span>
<span id="cb124-12"><a href="microbiota.html#cb124-12"></a>sf_md &lt;-<span class="st"> </span>mds<span class="op">$</span>sf_md</span>
<span id="cb124-13"><a href="microbiota.html#cb124-13"></a>wb_md &lt;-<span class="st"> </span>mds<span class="op">$</span>wb_md</span>
<span id="cb124-14"><a href="microbiota.html#cb124-14"></a></span>
<span id="cb124-15"><a href="microbiota.html#cb124-15"></a>gb_md[<span class="st">&quot;depth_category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(gb_md<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;shallow&quot;</span>, <span class="st">&quot;deep&quot;</span>)</span>
<span id="cb124-16"><a href="microbiota.html#cb124-16"></a>sf_md[<span class="st">&quot;depth_category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(sf_md<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;shallow&quot;</span>, <span class="st">&quot;deep&quot;</span>)</span>
<span id="cb124-17"><a href="microbiota.html#cb124-17"></a>wb_md[<span class="st">&quot;depth_category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(wb_md<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;shallow&quot;</span>, <span class="st">&quot;deep&quot;</span>)</span>
<span id="cb124-18"><a href="microbiota.html#cb124-18"></a></span>
<span id="cb124-19"><a href="microbiota.html#cb124-19"></a></span>
<span id="cb124-20"><a href="microbiota.html#cb124-20"></a>k &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(micro_ds<span class="op">$</span>gb))</span>
<span id="cb124-21"><a href="microbiota.html#cb124-21"></a>mat_col &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">group =</span> gb_md<span class="op">$</span>depth_category)</span>
<span id="cb124-22"><a href="microbiota.html#cb124-22"></a><span class="kw">rownames</span>(mat_col) &lt;-<span class="st"> </span><span class="kw">rownames</span>(micro_ds<span class="op">$</span>gb)</span>
<span id="cb124-23"><a href="microbiota.html#cb124-23"></a>col_groups &lt;-<span class="st"> </span>gb_md<span class="op">$</span>depth_category</span>
<span id="cb124-24"><a href="microbiota.html#cb124-24"></a>mat_colors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">group =</span> <span class="kw">c</span>(<span class="st">&quot;gold&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>))</span>
<span id="cb124-25"><a href="microbiota.html#cb124-25"></a><span class="kw">names</span>(mat_colors<span class="op">$</span>group) &lt;-<span class="st"> </span><span class="kw">unique</span>(col_groups)</span>
<span id="cb124-26"><a href="microbiota.html#cb124-26"></a></span>
<span id="cb124-27"><a href="microbiota.html#cb124-27"></a><span class="kw">pheatmap</span>(k, <span class="dt">color =</span> <span class="kw">magma</span>(<span class="dv">10</span>), <span class="dt">border_color =</span> <span class="ot">NA</span>, <span class="dt">show_colnames =</span> <span class="ot">FALSE</span>, <span class="dt">show_rownames =</span> <span class="ot">FALSE</span>, <span class="dt">annotation_col =</span> mat_col, <span class="dt">annotation_colors =</span> mat_colors, <span class="dt">drop_levels =</span> <span class="ot">TRUE</span>, <span class="dt">fontsize =</span> <span class="dv">10</span>, </span>
<span id="cb124-28"><a href="microbiota.html#cb124-28"></a>    <span class="dt">main =</span> <span class="st">&quot;G. barretti heatmap&quot;</span>)</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/heatmaps-dist-1.png" width="672" /></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="microbiota.html#cb125-1"></a>k &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(micro_ds<span class="op">$</span>sf))</span>
<span id="cb125-2"><a href="microbiota.html#cb125-2"></a>mat_col &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">group =</span> sf_md<span class="op">$</span>depth_category)</span>
<span id="cb125-3"><a href="microbiota.html#cb125-3"></a><span class="kw">rownames</span>(mat_col) &lt;-<span class="st"> </span><span class="kw">rownames</span>(micro_ds<span class="op">$</span>sf)</span>
<span id="cb125-4"><a href="microbiota.html#cb125-4"></a>col_groups &lt;-<span class="st"> </span>sf_md<span class="op">$</span>depth_category</span>
<span id="cb125-5"><a href="microbiota.html#cb125-5"></a>mat_colors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">group =</span> <span class="kw">c</span>(<span class="st">&quot;gold&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>))</span>
<span id="cb125-6"><a href="microbiota.html#cb125-6"></a><span class="kw">names</span>(mat_colors<span class="op">$</span>group) &lt;-<span class="st"> </span><span class="kw">unique</span>(col_groups)</span>
<span id="cb125-7"><a href="microbiota.html#cb125-7"></a></span>
<span id="cb125-8"><a href="microbiota.html#cb125-8"></a><span class="kw">pheatmap</span>(k, <span class="dt">color =</span> <span class="kw">magma</span>(<span class="dv">10</span>), <span class="dt">border_color =</span> <span class="ot">NA</span>, <span class="dt">show_colnames =</span> <span class="ot">FALSE</span>, <span class="dt">show_rownames =</span> <span class="ot">FALSE</span>, <span class="dt">annotation_col =</span> mat_col, <span class="dt">annotation_colors =</span> mat_colors, <span class="dt">drop_levels =</span> <span class="ot">TRUE</span>, <span class="dt">fontsize =</span> <span class="dv">10</span>, </span>
<span id="cb125-9"><a href="microbiota.html#cb125-9"></a>    <span class="dt">main =</span> <span class="st">&quot;S. fortis heatmap&quot;</span>)</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/heatmaps-dist-2.png" width="672" /></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="microbiota.html#cb126-1"></a>k &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">wisconsin</span>(micro_ds<span class="op">$</span>wb))</span>
<span id="cb126-2"><a href="microbiota.html#cb126-2"></a>mat_col &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">group =</span> wb_md<span class="op">$</span>depth_category)</span>
<span id="cb126-3"><a href="microbiota.html#cb126-3"></a><span class="kw">rownames</span>(mat_col) &lt;-<span class="st"> </span><span class="kw">rownames</span>(micro_ds<span class="op">$</span>wb)</span>
<span id="cb126-4"><a href="microbiota.html#cb126-4"></a>col_groups &lt;-<span class="st"> </span>wb_md<span class="op">$</span>depth_category</span>
<span id="cb126-5"><a href="microbiota.html#cb126-5"></a>mat_colors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">group =</span> <span class="kw">c</span>(<span class="st">&quot;gold&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>))</span>
<span id="cb126-6"><a href="microbiota.html#cb126-6"></a><span class="kw">names</span>(mat_colors<span class="op">$</span>group) &lt;-<span class="st"> </span><span class="kw">unique</span>(col_groups)</span>
<span id="cb126-7"><a href="microbiota.html#cb126-7"></a></span>
<span id="cb126-8"><a href="microbiota.html#cb126-8"></a><span class="kw">pheatmap</span>(k, <span class="dt">color =</span> <span class="kw">magma</span>(<span class="dv">10</span>), <span class="dt">border_color =</span> <span class="ot">NA</span>, <span class="dt">show_colnames =</span> <span class="ot">TRUE</span>, <span class="dt">show_rownames =</span> <span class="ot">TRUE</span>, <span class="dt">annotation_col =</span> mat_col, <span class="dt">annotation_colors =</span> mat_colors, <span class="dt">drop_levels =</span> <span class="ot">TRUE</span>, <span class="dt">fontsize =</span> <span class="dv">10</span>, </span>
<span id="cb126-9"><a href="microbiota.html#cb126-9"></a>    <span class="dt">main =</span> <span class="st">&quot;W. bursa heatmap&quot;</span>)</span></code></pre></div>
<p><img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/heatmaps-dist-3.png" width="672" /></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="microbiota.html#cb127-1"></a><span class="co"># library(dendsort) sort_hclust &lt;- function(...) as.hclust(dendsort(as.dendrogram(...))) mat_cluster_rows &lt;- sort_hclust(hclust(dist(k))) mat_cluster_cols &lt;- hclust(dist(t(k)))</span></span>
<span id="cb127-2"><a href="microbiota.html#cb127-2"></a><span class="co"># mat_cluster_cols &lt;- sort_hclust(mat_cluster_cols) mat_breaks &lt;- seq(min(k), max(k), length.out = 10)</span></span>
<span id="cb127-3"><a href="microbiota.html#cb127-3"></a></span>
<span id="cb127-4"><a href="microbiota.html#cb127-4"></a><span class="co"># pheatmap( mat = k, color = inferno(length(mat_breaks) - 1), breaks = mat_breaks, border_color = NA, cluster_cols = mat_cluster_cols, cluster_rows = mat_cluster_rows,</span></span>
<span id="cb127-5"><a href="microbiota.html#cb127-5"></a><span class="co"># show_colnames = TRUE, show_rownames = TRUE, annotation_col = mat_col, annotation_colors = mat_colors, drop_levels = TRUE, fontsize = 14, main = &#39;Sorted heatmap&#39; )</span></span></code></pre></div>
</div>
<div id="watermasses" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Oceanographic setting: water masses</h3>
<p>Finally, we test whether there are statistic differences in the prokaryotic community compositions between above and below 1000 m depth.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="microbiota.html#cb128-1"></a><span class="co"># ========== Testing differences of microbiome in different water masses ===========</span></span>
<span id="cb128-2"><a href="microbiota.html#cb128-2"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb128-3"><a href="microbiota.html#cb128-3"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb128-4"><a href="microbiota.html#cb128-4"></a>meta_data &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span>microbiome<span class="op">$</span>Sample_ID, ]</span>
<span id="cb128-5"><a href="microbiota.html#cb128-5"></a></span>
<span id="cb128-6"><a href="microbiota.html#cb128-6"></a><span class="co"># No data transformation/normalisation, as Vegantutor (Oksanen, 2013) p. 32 doesn&#39;t do it either.  betadiver (x, ...); x = community data matrix</span></span>
<span id="cb128-7"><a href="microbiota.html#cb128-7"></a></span>
<span id="cb128-8"><a href="microbiota.html#cb128-8"></a>OTU_prep &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb128-9"><a href="microbiota.html#cb128-9"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb128-10"><a href="microbiota.html#cb128-10"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb128-11"><a href="microbiota.html#cb128-11"></a>    <span class="co"># micro &lt;- sqrt(micro)</span></span>
<span id="cb128-12"><a href="microbiota.html#cb128-12"></a>    </span>
<span id="cb128-13"><a href="microbiota.html#cb128-13"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb128-14"><a href="microbiota.html#cb128-14"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb128-15"><a href="microbiota.html#cb128-15"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb128-16"><a href="microbiota.html#cb128-16"></a>    </span>
<span id="cb128-17"><a href="microbiota.html#cb128-17"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb128-18"><a href="microbiota.html#cb128-18"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb128-19"><a href="microbiota.html#cb128-19"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb128-20"><a href="microbiota.html#cb128-20"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb128-21"><a href="microbiota.html#cb128-21"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb128-22"><a href="microbiota.html#cb128-22"></a>}</span>
<span id="cb128-23"><a href="microbiota.html#cb128-23"></a></span>
<span id="cb128-24"><a href="microbiota.html#cb128-24"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep</span>(microbiome)</span>
<span id="cb128-25"><a href="microbiota.html#cb128-25"></a>meta_data &lt;-<span class="st"> </span><span class="kw">meta_data_prep</span>(meta_data)</span>
<span id="cb128-26"><a href="microbiota.html#cb128-26"></a></span>
<span id="cb128-27"><a href="microbiota.html#cb128-27"></a><span class="co"># Gb</span></span>
<span id="cb128-28"><a href="microbiota.html#cb128-28"></a>gb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(micro_ds<span class="op">$</span>gb), ]</span>
<span id="cb128-29"><a href="microbiota.html#cb128-29"></a>gb_md[<span class="st">&quot;depth_category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(gb_md<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;shallow&quot;</span>, <span class="st">&quot;deep&quot;</span>)</span>
<span id="cb128-30"><a href="microbiota.html#cb128-30"></a><span class="co"># all(rownames(micro_ds$gb)==gb_md$unified_ID)</span></span>
<span id="cb128-31"><a href="microbiota.html#cb128-31"></a>bd &lt;-<span class="st"> </span><span class="kw">betadiver</span>(micro_ds<span class="op">$</span>gb, <span class="st">&quot;z&quot;</span>)</span>
<span id="cb128-32"><a href="microbiota.html#cb128-32"></a><span class="kw">adonis</span>(bd <span class="op">~</span><span class="st"> </span>gb_md<span class="op">$</span>depth_category)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = bd ~ gb_md$depth_category) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##                      Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)   
## gb_md$depth_category  1   0.48654 0.48654  9.6668 0.44616  0.004 **
## Residuals            12   0.60398 0.05033         0.55384          
## Total                13   1.09052                 1.00000          
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="microbiota.html#cb130-1"></a><span class="co"># Sf</span></span>
<span id="cb130-2"><a href="microbiota.html#cb130-2"></a>sf_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(micro_ds<span class="op">$</span>sf), ]</span>
<span id="cb130-3"><a href="microbiota.html#cb130-3"></a>sf_md[<span class="st">&quot;depth_category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(sf_md<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;shallow&quot;</span>, <span class="st">&quot;deep&quot;</span>)</span>
<span id="cb130-4"><a href="microbiota.html#cb130-4"></a><span class="co"># all(rownames(micro_ds$sf)==sf_md$unified_ID)</span></span>
<span id="cb130-5"><a href="microbiota.html#cb130-5"></a>bd &lt;-<span class="st"> </span><span class="kw">betadiver</span>(micro_ds<span class="op">$</span>sf, <span class="st">&quot;z&quot;</span>)</span>
<span id="cb130-6"><a href="microbiota.html#cb130-6"></a><span class="kw">adonis</span>(bd <span class="op">~</span><span class="st"> </span>sf_md<span class="op">$</span>depth_category)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = bd ~ sf_md$depth_category) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##                      Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
## sf_md$depth_category  1    0.3649  0.3649    4.05 0.23753  0.001 ***
## Residuals            13    1.1713  0.0901         0.76247           
## Total                14    1.5362                 1.00000           
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="microbiota.html#cb132-1"></a><span class="co"># Wb</span></span>
<span id="cb132-2"><a href="microbiota.html#cb132-2"></a>wb_md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(micro_ds<span class="op">$</span>wb), ]</span>
<span id="cb132-3"><a href="microbiota.html#cb132-3"></a>wb_md[<span class="st">&quot;depth_category&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(wb_md<span class="op">$</span>Depth <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;shallow&quot;</span>, <span class="st">&quot;deep&quot;</span>)</span>
<span id="cb132-4"><a href="microbiota.html#cb132-4"></a><span class="co"># all(rownames(micro_ds$wb)==wb_md$unified_ID)</span></span>
<span id="cb132-5"><a href="microbiota.html#cb132-5"></a>bd &lt;-<span class="st"> </span><span class="kw">betadiver</span>(micro_ds<span class="op">$</span>wb, <span class="st">&quot;z&quot;</span>)</span>
<span id="cb132-6"><a href="microbiota.html#cb132-6"></a><span class="kw">adonis</span>(bd <span class="op">~</span><span class="st"> </span>wb_md<span class="op">$</span>depth_category)</span></code></pre></div>
<pre><code>## 
## Call:
## adonis(formula = bd ~ wb_md$depth_category) 
## 
## Permutation: free
## Number of permutations: 999
## 
## Terms added sequentially (first to last)
## 
##                      Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)
## wb_md$depth_category  1   0.27974 0.27974    1.37 0.08914  0.135
## Residuals            14   2.85866 0.20419         0.91086       
## Total                15   3.13841                 1.00000</code></pre>
<p>To summarise, in this section on <a href="microbiota.html#EnvMod">environmental modelling</a>, weâ€™ve shown that the prokaryotic communities in <em>G. barretti</em> and <em>S. fortis</em> seem to be influenced by depth both in <a href="microbiota.html#constrained">contrained</a> and <a href="microbiota.html#unconstrained">unconstrained</a> methods. For <em>W. bursa</em> we get mixed results. Hence at this point, the picture of a depth effect on LMA sponge prokaryotic communities remains ambiguous.<br />
Our intention with the <a href="##Hclust">hierarchical clustering</a> was to see if we could group the variation in the community composition in order to see if we can take hints from that about which aspect of the (a)biotic environment most likely causes/links to the changes. For <em>G. barretti</em>, we see the two main clusters representing the â€œshallowâ€ (Gb1-Gb10: 407-801 m) versus the â€œdeepâ€ (Gb11-Gb14: 1213-1427 m) specimens. These two groups match the two water masses detected in this part of the North Atlantic. The clustering also yiels a distinct clade/group of deep specimens in <em>S. fortis</em> (Sf9-Sf15: 1036-1476 m). Again, this highlights the distinctiveness of the prokatyotic commmunity of the deep specimens, potentially linked to the differences in the surrounding water masses. In <em>W. bursa</em> the specimens originating from depths greater than 1000 m (Wb13-Wb16) cluster with shallow samples and thus, we cannot deduce any stratifying effect of depth or water masses on its microbiome.</p>
<p>This section has given us a general impression that depth affects (mainly HMA) sponge prokarytoic community compositions. But can we be more specific and identify which OTUs are behind those patterns?</p>
</div>
</div>
<div id="relative-abundances" class="section level2">
<h2><span class="header-section-number">3.5</span> Relative abundances</h2>
<div id="bar-plots" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Bar plots</h3>
<p>Enough of the anonymous modelling and data fitting, letâ€™s take a look at the taxonomy of the OTUs to see who is there.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="microbiota.html#cb134-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb134-2"><a href="microbiota.html#cb134-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/PANGAEA_Final.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb134-3"><a href="microbiota.html#cb134-3"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb134-4"><a href="microbiota.html#cb134-4"></a></span>
<span id="cb134-5"><a href="microbiota.html#cb134-5"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb134-6"><a href="microbiota.html#cb134-6"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb134-7"><a href="microbiota.html#cb134-7"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb134-8"><a href="microbiota.html#cb134-8"></a>    <span class="co"># micro &lt;- sqrt(micro) # can be toggled on/off</span></span>
<span id="cb134-9"><a href="microbiota.html#cb134-9"></a>    </span>
<span id="cb134-10"><a href="microbiota.html#cb134-10"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb134-11"><a href="microbiota.html#cb134-11"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb134-12"><a href="microbiota.html#cb134-12"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb134-13"><a href="microbiota.html#cb134-13"></a>    </span>
<span id="cb134-14"><a href="microbiota.html#cb134-14"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb134-15"><a href="microbiota.html#cb134-15"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb134-16"><a href="microbiota.html#cb134-16"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb134-17"><a href="microbiota.html#cb134-17"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb134-18"><a href="microbiota.html#cb134-18"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb134-19"><a href="microbiota.html#cb134-19"></a>}</span>
<span id="cb134-20"><a href="microbiota.html#cb134-20"></a></span>
<span id="cb134-21"><a href="microbiota.html#cb134-21"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb134-22"><a href="microbiota.html#cb134-22"></a></span>
<span id="cb134-23"><a href="microbiota.html#cb134-23"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb134-24"><a href="microbiota.html#cb134-24"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb134-25"><a href="microbiota.html#cb134-25"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb134-26"><a href="microbiota.html#cb134-26"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb134-27"><a href="microbiota.html#cb134-27"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb134-28"><a href="microbiota.html#cb134-28"></a>    </span>
<span id="cb134-29"><a href="microbiota.html#cb134-29"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb134-30"><a href="microbiota.html#cb134-30"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb134-31"><a href="microbiota.html#cb134-31"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb134-32"><a href="microbiota.html#cb134-32"></a>    }</span>
<span id="cb134-33"><a href="microbiota.html#cb134-33"></a>    </span>
<span id="cb134-34"><a href="microbiota.html#cb134-34"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb134-35"><a href="microbiota.html#cb134-35"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb134-36"><a href="microbiota.html#cb134-36"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb134-37"><a href="microbiota.html#cb134-37"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb134-38"><a href="microbiota.html#cb134-38"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb134-39"><a href="microbiota.html#cb134-39"></a>}</span>
<span id="cb134-40"><a href="microbiota.html#cb134-40"></a></span>
<span id="cb134-41"><a href="microbiota.html#cb134-41"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb134-42"><a href="microbiota.html#cb134-42"></a></span>
<span id="cb134-43"><a href="microbiota.html#cb134-43"></a><span class="co"># PHYLUM</span></span>
<span id="cb134-44"><a href="microbiota.html#cb134-44"></a>adonis_prep &lt;-<span class="st"> </span><span class="cf">function</span>(taxonomy, occurrence) {</span>
<span id="cb134-45"><a href="microbiota.html#cb134-45"></a>    occurrence<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>gb)</span>
<span id="cb134-46"><a href="microbiota.html#cb134-46"></a>    occurrence<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>sf)</span>
<span id="cb134-47"><a href="microbiota.html#cb134-47"></a>    occurrence<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>wb)</span>
<span id="cb134-48"><a href="microbiota.html#cb134-48"></a>    </span>
<span id="cb134-49"><a href="microbiota.html#cb134-49"></a>    tax &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb134-50"><a href="microbiota.html#cb134-50"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb134-51"><a href="microbiota.html#cb134-51"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(tax)[<span class="dv">1</span>]</span>
<span id="cb134-52"><a href="microbiota.html#cb134-52"></a>    tax[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb134-53"><a href="microbiota.html#cb134-53"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb134-54"><a href="microbiota.html#cb134-54"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb134-55"><a href="microbiota.html#cb134-55"></a>        tax<span class="op">$</span>XOTU[n] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, tax<span class="op">$</span>OTU_ID[n])</span>
<span id="cb134-56"><a href="microbiota.html#cb134-56"></a>    }</span>
<span id="cb134-57"><a href="microbiota.html#cb134-57"></a>    </span>
<span id="cb134-58"><a href="microbiota.html#cb134-58"></a>    tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>gb)</span>
<span id="cb134-59"><a href="microbiota.html#cb134-59"></a>    tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>sf)</span>
<span id="cb134-60"><a href="microbiota.html#cb134-60"></a>    tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>wb)</span>
<span id="cb134-61"><a href="microbiota.html#cb134-61"></a>    </span>
<span id="cb134-62"><a href="microbiota.html#cb134-62"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> tax_gb, <span class="dt">sf =</span> tax_sf, <span class="dt">wb =</span> tax_wb)</span>
<span id="cb134-63"><a href="microbiota.html#cb134-63"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb134-64"><a href="microbiota.html#cb134-64"></a>}</span>
<span id="cb134-65"><a href="microbiota.html#cb134-65"></a></span>
<span id="cb134-66"><a href="microbiota.html#cb134-66"></a>taxes &lt;-<span class="st"> </span><span class="kw">adonis_prep</span>(taxonomy, occurrence)</span>
<span id="cb134-67"><a href="microbiota.html#cb134-67"></a></span>
<span id="cb134-68"><a href="microbiota.html#cb134-68"></a>cleaning &lt;-<span class="st"> </span><span class="cf">function</span>(taxes) {</span>
<span id="cb134-69"><a href="microbiota.html#cb134-69"></a>    gb &lt;-<span class="st"> </span>taxes<span class="op">$</span>gb</span>
<span id="cb134-70"><a href="microbiota.html#cb134-70"></a>    sf &lt;-<span class="st"> </span>taxes<span class="op">$</span>sf</span>
<span id="cb134-71"><a href="microbiota.html#cb134-71"></a>    wb &lt;-<span class="st"> </span>taxes<span class="op">$</span>wb</span>
<span id="cb134-72"><a href="microbiota.html#cb134-72"></a>    <span class="co"># Renaming &amp; removing whitespaces</span></span>
<span id="cb134-73"><a href="microbiota.html#cb134-73"></a>    gb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Phylum)))</span>
<span id="cb134-74"><a href="microbiota.html#cb134-74"></a>    sf<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Phylum)))</span>
<span id="cb134-75"><a href="microbiota.html#cb134-75"></a>    wb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Phylum)))</span>
<span id="cb134-76"><a href="microbiota.html#cb134-76"></a>    gb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Class)))</span>
<span id="cb134-77"><a href="microbiota.html#cb134-77"></a>    sf<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Class)))</span>
<span id="cb134-78"><a href="microbiota.html#cb134-78"></a>    wb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Class)))</span>
<span id="cb134-79"><a href="microbiota.html#cb134-79"></a>    <span class="co">## GB</span></span>
<span id="cb134-80"><a href="microbiota.html#cb134-80"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb134-81"><a href="microbiota.html#cb134-81"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb134-82"><a href="microbiota.html#cb134-82"></a>    gb<span class="op">$</span>Phylum[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb134-83"><a href="microbiota.html#cb134-83"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb134-84"><a href="microbiota.html#cb134-84"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb134-85"><a href="microbiota.html#cb134-85"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb134-86"><a href="microbiota.html#cb134-86"></a>    gb<span class="op">$</span>Class[gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Chloroflexi&quot;</span> <span class="op">&amp;</span><span class="st"> </span>gb<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> &quot;Chloroflexi_unclassified&quot;</span></span>
<span id="cb134-87"><a href="microbiota.html#cb134-87"></a>    <span class="co">## SF</span></span>
<span id="cb134-88"><a href="microbiota.html#cb134-88"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb134-89"><a href="microbiota.html#cb134-89"></a>    sf<span class="op">$</span>Phylum[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb134-90"><a href="microbiota.html#cb134-90"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb134-91"><a href="microbiota.html#cb134-91"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Proteobacteria&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sf<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;Proteobacteria_unclassified&quot;</span></span>
<span id="cb134-92"><a href="microbiota.html#cb134-92"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb134-93"><a href="microbiota.html#cb134-93"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb134-94"><a href="microbiota.html#cb134-94"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb134-95"><a href="microbiota.html#cb134-95"></a>    <span class="co">## WB</span></span>
<span id="cb134-96"><a href="microbiota.html#cb134-96"></a>    wb<span class="op">$</span>Class[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb134-97"><a href="microbiota.html#cb134-97"></a>    wb<span class="op">$</span>Phylum[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb134-98"><a href="microbiota.html#cb134-98"></a>    <span class="co"># merge back</span></span>
<span id="cb134-99"><a href="microbiota.html#cb134-99"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb, <span class="dt">sf =</span> sf, <span class="dt">wb =</span> wb)</span>
<span id="cb134-100"><a href="microbiota.html#cb134-100"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb134-101"><a href="microbiota.html#cb134-101"></a>}</span>
<span id="cb134-102"><a href="microbiota.html#cb134-102"></a></span>
<span id="cb134-103"><a href="microbiota.html#cb134-103"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb134-104"><a href="microbiota.html#cb134-104"></a></span>
<span id="cb134-105"><a href="microbiota.html#cb134-105"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb134-106"><a href="microbiota.html#cb134-106"></a>    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>x<span class="op">$</span>XOTU</span>
<span id="cb134-107"><a href="microbiota.html#cb134-107"></a>    x</span>
<span id="cb134-108"><a href="microbiota.html#cb134-108"></a>})</span>
<span id="cb134-109"><a href="microbiota.html#cb134-109"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb134-110"><a href="microbiota.html#cb134-110"></a>    x[<span class="kw">c</span>(<span class="st">&quot;avg_rel_abdc&quot;</span>, <span class="st">&quot;occurrence&quot;</span>, <span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;XOTU&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb134-111"><a href="microbiota.html#cb134-111"></a>    x</span>
<span id="cb134-112"><a href="microbiota.html#cb134-112"></a>})</span>
<span id="cb134-113"><a href="microbiota.html#cb134-113"></a>taxes &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) {</span>
<span id="cb134-114"><a href="microbiota.html#cb134-114"></a>    x[<span class="st">&quot;Class&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb134-115"><a href="microbiota.html#cb134-115"></a>    x</span>
<span id="cb134-116"><a href="microbiota.html#cb134-116"></a>})</span>
<span id="cb134-117"><a href="microbiota.html#cb134-117"></a></span>
<span id="cb134-118"><a href="microbiota.html#cb134-118"></a></span>
<span id="cb134-119"><a href="microbiota.html#cb134-119"></a><span class="co"># aggregate sum of relative abundance per phylum in each sponge sample</span></span>
<span id="cb134-120"><a href="microbiota.html#cb134-120"></a>gb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>gb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>gb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>gb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb134-121"><a href="microbiota.html#cb134-121"></a>sf &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>sf[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>sf)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>sf[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb134-122"><a href="microbiota.html#cb134-122"></a>wb &lt;-<span class="st"> </span><span class="kw">aggregate</span>(taxes<span class="op">$</span>wb[, <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(taxes<span class="op">$</span>wb)[<span class="dv">2</span>]], <span class="kw">list</span>(taxes<span class="op">$</span>wb[, <span class="st">&quot;Phylum&quot;</span>]), sum)  <span class="co">#works</span></span>
<span id="cb134-123"><a href="microbiota.html#cb134-123"></a></span>
<span id="cb134-124"><a href="microbiota.html#cb134-124"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb, sf)</span>
<span id="cb134-125"><a href="microbiota.html#cb134-125"></a>taxes_phy &lt;-<span class="st"> </span><span class="kw">full_join</span>(taxes_phy, wb)</span>
<span id="cb134-126"><a href="microbiota.html#cb134-126"></a>taxes_phy[<span class="kw">is.na</span>(taxes_phy)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb134-127"><a href="microbiota.html#cb134-127"></a></span>
<span id="cb134-128"><a href="microbiota.html#cb134-128"></a><span class="co"># check there are no weird names aggregate(.~ Group.1, data=taxes_phy, sum)</span></span>
<span id="cb134-129"><a href="microbiota.html#cb134-129"></a></span>
<span id="cb134-130"><a href="microbiota.html#cb134-130"></a><span class="kw">rownames</span>(taxes_phy) &lt;-<span class="st"> </span>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span></span>
<span id="cb134-131"><a href="microbiota.html#cb134-131"></a>taxes_phy<span class="op">$</span>Group<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb134-132"><a href="microbiota.html#cb134-132"></a>df_phylum &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(taxes_phy))  <span class="co">#taxes_phy_t &lt;- df_phylum</span></span>
<span id="cb134-133"><a href="microbiota.html#cb134-133"></a>df_phylum[<span class="st">&quot;Sample_ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df_phylum)</span>
<span id="cb134-134"><a href="microbiota.html#cb134-134"></a>df_phylum &lt;-<span class="st"> </span><span class="kw">melt</span>(df_phylum, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>))</span>
<span id="cb134-135"><a href="microbiota.html#cb134-135"></a><span class="kw">colnames</span>(df_phylum) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sample_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;variable&quot;</span>)</span>
<span id="cb134-136"><a href="microbiota.html#cb134-136"></a></span>
<span id="cb134-137"><a href="microbiota.html#cb134-137"></a><span class="kw">ggplot</span>(df_phylum, <span class="kw">aes</span>(<span class="dt">x =</span> Sample_ID, <span class="dt">y =</span> variable, <span class="dt">fill =</span> Phylum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>), <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-138"><a href="microbiota.html#cb134-138"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Samples ordered by depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Relative abundance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">&quot;Gb1&quot;</span>, <span class="st">&quot;Gb2&quot;</span>, <span class="st">&quot;Gb3&quot;</span>, <span class="st">&quot;Gb4&quot;</span>, <span class="st">&quot;Gb5&quot;</span>, <span class="st">&quot;Gb6&quot;</span>, <span class="st">&quot;Gb7&quot;</span>, <span class="st">&quot;Gb8&quot;</span>, <span class="st">&quot;Gb9&quot;</span>, <span class="st">&quot;Gb10&quot;</span>, <span class="st">&quot;Gb11&quot;</span>, <span class="st">&quot;Gb12&quot;</span>, </span>
<span id="cb134-139"><a href="microbiota.html#cb134-139"></a>    <span class="st">&quot;Gb13&quot;</span>, <span class="st">&quot;Gb14&quot;</span>, <span class="st">&quot;Sf1&quot;</span>, <span class="st">&quot;Sf2&quot;</span>, <span class="st">&quot;Sf3&quot;</span>, <span class="st">&quot;Sf4&quot;</span>, <span class="st">&quot;Sf5&quot;</span>, <span class="st">&quot;Sf6&quot;</span>, <span class="st">&quot;Sf7&quot;</span>, <span class="st">&quot;Sf8&quot;</span>, <span class="st">&quot;Sf9&quot;</span>, <span class="st">&quot;Sf10&quot;</span>, <span class="st">&quot;Sf11&quot;</span>, <span class="st">&quot;Sf12&quot;</span>, <span class="st">&quot;Sf13&quot;</span>, <span class="st">&quot;Sf14&quot;</span>, <span class="st">&quot;Sf15&quot;</span>, <span class="st">&quot;Wb1&quot;</span>, <span class="st">&quot;Wb2&quot;</span>, <span class="st">&quot;Wb3&quot;</span>, <span class="st">&quot;Wb4&quot;</span>, <span class="st">&quot;Wb5&quot;</span>, <span class="st">&quot;Wb6&quot;</span>, <span class="st">&quot;Wb7&quot;</span>, </span>
<span id="cb134-140"><a href="microbiota.html#cb134-140"></a>    <span class="st">&quot;Wb8&quot;</span>, <span class="st">&quot;Wb9&quot;</span>, <span class="st">&quot;Wb10&quot;</span>, <span class="st">&quot;Wb11&quot;</span>, <span class="st">&quot;Wb12&quot;</span>, <span class="st">&quot;Wb13&quot;</span>, <span class="st">&quot;Wb14&quot;</span>, <span class="st">&quot;Wb15&quot;</span>, <span class="st">&quot;Wb16&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Acidobacteria&quot;</span>, <span class="st">&quot;Actinobacteria&quot;</span>, <span class="st">&quot;Bacteroidetes&quot;</span>, <span class="st">&quot;Chlamydiae&quot;</span>, <span class="st">&quot;Chloroflexi&quot;</span>, </span>
<span id="cb134-141"><a href="microbiota.html#cb134-141"></a>    <span class="st">&quot;Cyanobacteria&quot;</span>, <span class="st">&quot;Deferribacteres&quot;</span>, <span class="st">&quot;Deinococcus.Thermus&quot;</span>, <span class="st">&quot;Firmicutes&quot;</span>, <span class="st">&quot;Gemmatimonadetes&quot;</span>, <span class="st">&quot;Nitrospinae&quot;</span>, <span class="st">&quot;Nitrospirae&quot;</span>, <span class="st">&quot;PAUC34f&quot;</span>, <span class="st">&quot;Planctomycetes&quot;</span>, <span class="st">&quot;Poribacteria&quot;</span>, <span class="st">&quot;Proteobacteria&quot;</span>, </span>
<span id="cb134-142"><a href="microbiota.html#cb134-142"></a>    <span class="st">&quot;SBR1093&quot;</span>, <span class="st">&quot;Spirochaetae&quot;</span>, <span class="st">&quot;Tectomicrobia&quot;</span>, <span class="st">&quot;Thaumarchaeota&quot;</span>, <span class="st">&quot;unclassified&quot;</span>, <span class="st">&quot;Verrucomicrobia&quot;</span>), <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#b8c4f6&quot;</span>, <span class="st">&quot;#ffaaaf&quot;</span>, <span class="st">&quot;#3d1349&quot;</span>, <span class="st">&quot;#B6B2A9&quot;</span>, <span class="st">&quot;#01559d&quot;</span>, <span class="st">&quot;#CACAC8&quot;</span>, </span>
<span id="cb134-143"><a href="microbiota.html#cb134-143"></a>    <span class="st">&quot;#E1DED7&quot;</span>, <span class="st">&quot;#CEC7C1&quot;</span>, <span class="st">&quot;#9A9B9D&quot;</span>, <span class="st">&quot;#019c51&quot;</span>, <span class="st">&quot;#b10060&quot;</span>, <span class="st">&quot;#49ca00&quot;</span>, <span class="st">&quot;#dd8e00&quot;</span>, <span class="st">&quot;#f282ff&quot;</span>, <span class="st">&quot;#AFA79D&quot;</span>, <span class="st">&quot;#ff633f&quot;</span>, <span class="st">&quot;#ec0040&quot;</span>, <span class="st">&quot;#010b92&quot;</span>, <span class="st">&quot;#cf00aa&quot;</span>, <span class="st">&quot;#aba900&quot;</span>, <span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#fce300&quot;</span>), </span>
<span id="cb134-144"><a href="microbiota.html#cb134-144"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Acidobacteria&quot;</span>, <span class="st">&quot;Actinobacteria&quot;</span>, <span class="st">&quot;Bacteroidetes&quot;</span>, <span class="st">&quot;Chlamydiae&quot;</span>, <span class="st">&quot;Chloroflexi&quot;</span>, <span class="st">&quot;Cyanobacteria&quot;</span>, <span class="st">&quot;Deferribacteres&quot;</span>, <span class="st">&quot;Deinococcus.Thermus&quot;</span>, <span class="st">&quot;Firmicutes&quot;</span>, <span class="st">&quot;Gemmatimonadetes&quot;</span>, </span>
<span id="cb134-145"><a href="microbiota.html#cb134-145"></a>        <span class="st">&quot;Nitrospinae&quot;</span>, <span class="st">&quot;Nitrospirae&quot;</span>, <span class="st">&quot;PAUC34f&quot;</span>, <span class="st">&quot;Planctomycetes&quot;</span>, <span class="st">&quot;Poribacteria&quot;</span>, <span class="st">&quot;Proteobacteria&quot;</span>, <span class="st">&quot;SBR1093&quot;</span>, <span class="st">&quot;Spirochaetae&quot;</span>, <span class="st">&quot;Tectomicrobia&quot;</span>, <span class="st">&quot;Thaumarchaeota&quot;</span>, <span class="st">&quot;unclassified&quot;</span>, </span>
<span id="cb134-146"><a href="microbiota.html#cb134-146"></a>        <span class="st">&quot;Verrucomicrobia&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:rel-abdc-plot"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/rel-abdc-plot-1.png" alt="Relative abundance of prokaryotic phyla per sponge sample." width="672" />
<p class="caption">
Figure 3.11: Relative abundance of prokaryotic phyla per sponge sample.
</p>
</div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="microbiota.html#cb135-1"></a><span class="co"># facet df_phylum[&#39;spec&#39;] &lt;- str_sub(df_phylum$Sample_ID,1,2) md &lt;- meta_data[,c(&#39;unified_ID&#39;, &#39;Depth&#39;)] colnames(md) &lt;- c(&#39;Sample_ID&#39;, &#39;Depth&#39;) df_phylum &lt;- left_join(df_phylum,</span></span>
<span id="cb135-2"><a href="microbiota.html#cb135-2"></a><span class="co"># md)</span></span>
<span id="cb135-3"><a href="microbiota.html#cb135-3"></a></span>
<span id="cb135-4"><a href="microbiota.html#cb135-4"></a><span class="co"># ggplot(df_phylum, aes(x=as.factor(Depth), y=variable, fill=Phylum))+geom_bar(stat=&#39;identity&#39;)+facet_wrap(.~spec, scales=&#39;free&#39;)+theme_classic()+theme(axis.text.x =</span></span>
<span id="cb135-5"><a href="microbiota.html#cb135-5"></a><span class="co"># element_text(angle = 90, hjust = 1),legend.position = &#39;bottom&#39;)+xlab(&#39;Samples ordered by depth&#39;)+ylab(&#39;Relative abundance&#39;)+scale_fill_manual(&#39;&#39;, breaks = c(&#39;Acidobacteria&#39;,</span></span>
<span id="cb135-6"><a href="microbiota.html#cb135-6"></a><span class="co"># &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;, &#39;Chloroflexi&#39;, &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;, &#39;Firmicutes&#39;, &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;,</span></span>
<span id="cb135-7"><a href="microbiota.html#cb135-7"></a><span class="co"># &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;, &#39;Planctomycetes&#39;, &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;, &#39;Tectomicrobia&#39;, &#39;Thaumarchaeota&#39;, &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;),</span></span>
<span id="cb135-8"><a href="microbiota.html#cb135-8"></a><span class="co"># values =</span></span>
<span id="cb135-9"><a href="microbiota.html#cb135-9"></a><span class="co"># c(&#39;#b8c4f6&#39;,&#39;#ffaaaf&#39;,&#39;#3d1349&#39;,&#39;#ffffff&#39;,&#39;#01559d&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#ffffff&#39;,&#39;#019c51&#39;,&#39;#b10060&#39;,&#39;#49ca00&#39;,&#39;#dd8e00&#39;,&#39;#f282ff&#39;,&#39;#ffffff&#39;,&#39;#ff633f&#39;,&#39;#ec0040&#39;,&#39;#010b92&#39;,&#39;#cf00aa&#39;,&#39;#aba900&#39;,&#39;#ffffff&#39;,&#39;#fce300&#39;),</span></span>
<span id="cb135-10"><a href="microbiota.html#cb135-10"></a><span class="co"># labels = c(&#39;Acidobacteria&#39;, &#39;Actinobacteria&#39;, &#39;Bacteroidetes&#39;, &#39;Chlamydiae&#39;, &#39;Chloroflexi&#39;, &#39;Cyanobacteria&#39;, &#39;Deferribacteres&#39;, &#39;Deinococcus.Thermus&#39;, &#39;Firmicutes&#39;,</span></span>
<span id="cb135-11"><a href="microbiota.html#cb135-11"></a><span class="co"># &#39;Gemmatimonadetes&#39;, &#39;Nitrospinae&#39;, &#39;Nitrospirae&#39;, &#39;PAUC34f&#39;, &#39;Planctomycetes&#39;, &#39;Poribacteria&#39;, &#39;Proteobacteria&#39;, &#39;SBR1093&#39;, &#39;Spirochaetae&#39;, &#39;Tectomicrobia&#39;, &#39;Thaumarchaeota&#39;,</span></span>
<span id="cb135-12"><a href="microbiota.html#cb135-12"></a><span class="co"># &#39;unclassified&#39;, &#39;Verrucomicrobia&#39;) )</span></span></code></pre></div>
<p>We see in this bar plot that the relative abundance of phyla remains fairly stable across the different depths. Generally, the prokaryotic community of sponges is described as somewhat species specific and stable across virtually any measured gradient. At this taxonomic resolution, these findings hold true. The composition of the prokaryotic communities in the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> is similar across all samples, while the composition in the LMA sponge <em>W. bursa</em> differs in composition but also displaying only minor variations in phyla proportions.
The phyla left white/blank are present at very low abundance and we thought the figure might be visually easier without too many colours.</p>
<p>The phyla Chloroflexi, Actinobacteria, Acidobacteria, PAUC34f, and Gemmatimonadetes were described as HMA indicator phyla <span class="citation">(Moitinho-Silva et al. <a href="#ref-moitinho-silva_2017" role="doc-biblioref">2017</a>)</span> and are present in the HMA sponges <em>G. barretti</em> and <em>S. fortis</em> (although Actinobacteria are also present in <em>W. bursa</em>).The phyla Proteobacteria, Bacteroidetes, Planctomycetes, and Firmicutes were disgnated LMA indicator phyla and are found in <em>W. bursa</em> (although Proteobacteria are also present in the HMA sponges).</p>
</div>
<div id="tabular-overview" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Tabular overview</h3>
<p>If you prefer numbers, this is what it breaks down to. You can sort the tables.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="microbiota.html#cb136-1"></a>microbiome &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb136-2"><a href="microbiota.html#cb136-2"></a></span>
<span id="cb136-3"><a href="microbiota.html#cb136-3"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb136-4"><a href="microbiota.html#cb136-4"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb136-5"><a href="microbiota.html#cb136-5"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb136-6"><a href="microbiota.html#cb136-6"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)</span>
<span id="cb136-7"><a href="microbiota.html#cb136-7"></a>    </span>
<span id="cb136-8"><a href="microbiota.html#cb136-8"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb136-9"><a href="microbiota.html#cb136-9"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb136-10"><a href="microbiota.html#cb136-10"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb136-11"><a href="microbiota.html#cb136-11"></a>    </span>
<span id="cb136-12"><a href="microbiota.html#cb136-12"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb136-13"><a href="microbiota.html#cb136-13"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb136-14"><a href="microbiota.html#cb136-14"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb136-15"><a href="microbiota.html#cb136-15"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb136-16"><a href="microbiota.html#cb136-16"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb136-17"><a href="microbiota.html#cb136-17"></a>}</span>
<span id="cb136-18"><a href="microbiota.html#cb136-18"></a></span>
<span id="cb136-19"><a href="microbiota.html#cb136-19"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(microbiome)</span>
<span id="cb136-20"><a href="microbiota.html#cb136-20"></a></span>
<span id="cb136-21"><a href="microbiota.html#cb136-21"></a><span class="co"># calculate relative abundance of OTU across sponge samples</span></span>
<span id="cb136-22"><a href="microbiota.html#cb136-22"></a></span>
<span id="cb136-23"><a href="microbiota.html#cb136-23"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb136-24"><a href="microbiota.html#cb136-24"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb136-25"><a href="microbiota.html#cb136-25"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb136-26"><a href="microbiota.html#cb136-26"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb136-27"><a href="microbiota.html#cb136-27"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb136-28"><a href="microbiota.html#cb136-28"></a>    </span>
<span id="cb136-29"><a href="microbiota.html#cb136-29"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb136-30"><a href="microbiota.html#cb136-30"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb136-31"><a href="microbiota.html#cb136-31"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb136-32"><a href="microbiota.html#cb136-32"></a>    }</span>
<span id="cb136-33"><a href="microbiota.html#cb136-33"></a>    </span>
<span id="cb136-34"><a href="microbiota.html#cb136-34"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb136-35"><a href="microbiota.html#cb136-35"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb136-36"><a href="microbiota.html#cb136-36"></a>    mic[<span class="st">&quot;avg_rel_abdc&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, mean)</span>
<span id="cb136-37"><a href="microbiota.html#cb136-37"></a>    mic[<span class="st">&quot;occurrence&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mic<span class="op">$</span>avg <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0025</span>, <span class="st">&quot;common&quot;</span>, <span class="st">&quot;rare&quot;</span>)</span>
<span id="cb136-38"><a href="microbiota.html#cb136-38"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb136-39"><a href="microbiota.html#cb136-39"></a>}</span>
<span id="cb136-40"><a href="microbiota.html#cb136-40"></a></span>
<span id="cb136-41"><a href="microbiota.html#cb136-41"></a><span class="co"># gb_occurrence &lt;- overall_rabdc(micro_ds$gb) sf_occurrence &lt;- overall_rabdc(micro_ds$sf) wb_occurrence &lt;- overall_rabdc(micro_ds$wb) occurrence &lt;- list(gb=gb_occurrence,</span></span>
<span id="cb136-42"><a href="microbiota.html#cb136-42"></a><span class="co"># sf=sf_occurrence, wb=wb_occurrence)</span></span>
<span id="cb136-43"><a href="microbiota.html#cb136-43"></a></span>
<span id="cb136-44"><a href="microbiota.html#cb136-44"></a>occurrence &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb136-45"><a href="microbiota.html#cb136-45"></a></span>
<span id="cb136-46"><a href="microbiota.html#cb136-46"></a>aggregations &lt;-<span class="st"> </span><span class="cf">function</span>(taxonomy, occurrence) {</span>
<span id="cb136-47"><a href="microbiota.html#cb136-47"></a>    occurrence<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>gb)</span>
<span id="cb136-48"><a href="microbiota.html#cb136-48"></a>    occurrence<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>sf)</span>
<span id="cb136-49"><a href="microbiota.html#cb136-49"></a>    occurrence<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(occurrence<span class="op">$</span>wb)</span>
<span id="cb136-50"><a href="microbiota.html#cb136-50"></a>    </span>
<span id="cb136-51"><a href="microbiota.html#cb136-51"></a>    tax &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb136-52"><a href="microbiota.html#cb136-52"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb136-53"><a href="microbiota.html#cb136-53"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(tax)[<span class="dv">1</span>]</span>
<span id="cb136-54"><a href="microbiota.html#cb136-54"></a>    tax[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb136-55"><a href="microbiota.html#cb136-55"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb136-56"><a href="microbiota.html#cb136-56"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb136-57"><a href="microbiota.html#cb136-57"></a>        tax<span class="op">$</span>XOTU[n] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, tax<span class="op">$</span>OTU_ID[n])</span>
<span id="cb136-58"><a href="microbiota.html#cb136-58"></a>    }</span>
<span id="cb136-59"><a href="microbiota.html#cb136-59"></a>    </span>
<span id="cb136-60"><a href="microbiota.html#cb136-60"></a>    tax_gb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>gb[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb136-61"><a href="microbiota.html#cb136-61"></a>    tax_sf &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>sf[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb136-62"><a href="microbiota.html#cb136-62"></a>    tax_wb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(tax, occurrence<span class="op">$</span>wb[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb136-63"><a href="microbiota.html#cb136-63"></a>    </span>
<span id="cb136-64"><a href="microbiota.html#cb136-64"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> tax_gb, <span class="dt">sf =</span> tax_sf, <span class="dt">wb =</span> tax_wb)</span>
<span id="cb136-65"><a href="microbiota.html#cb136-65"></a>    </span>
<span id="cb136-66"><a href="microbiota.html#cb136-66"></a>    gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Phylum, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb136-67"><a href="microbiota.html#cb136-67"></a>    gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Phylum), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb136-68"><a href="microbiota.html#cb136-68"></a>    gb_p &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb136-69"><a href="microbiota.html#cb136-69"></a>    <span class="kw">colnames</span>(gb_p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb136-70"><a href="microbiota.html#cb136-70"></a>    </span>
<span id="cb136-71"><a href="microbiota.html#cb136-71"></a>    gb1 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>Class, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb136-72"><a href="microbiota.html#cb136-72"></a>    gb2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(tax_gb<span class="op">$</span>avg_rel_abdc, <span class="dt">by =</span> <span class="kw">list</span>(tax_gb<span class="op">$</span>Class), <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb136-73"><a href="microbiota.html#cb136-73"></a>    gb_c &lt;-<span class="st"> </span><span class="kw">full_join</span>(gb1, gb2, <span class="dt">by =</span> (<span class="st">&quot;Group.1&quot;</span> =<span class="st"> &quot;Group.1&quot;</span>))</span>
<span id="cb136-74"><a href="microbiota.html#cb136-74"></a>    <span class="kw">colnames</span>(gb_c) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU_number&quot;</span>, <span class="st">&quot;avg_rel_abdc&quot;</span>)</span>
<span id="cb136-75"><a href="microbiota.html#cb136-75"></a>    </span>
<span id="cb136-76"><a href="microbiota.html#cb136-76"></a>    test1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb136-77"><a href="microbiota.html#cb136-77"></a>    <span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span>
<span id="cb136-78"><a href="microbiota.html#cb136-78"></a>    </span>
<span id="cb136-79"><a href="microbiota.html#cb136-79"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb136-80"><a href="microbiota.html#cb136-80"></a>}</span>
<span id="cb136-81"><a href="microbiota.html#cb136-81"></a></span>
<span id="cb136-82"><a href="microbiota.html#cb136-82"></a>taxes &lt;-<span class="st"> </span><span class="kw">aggregations</span>(taxonomy, occurrence)</span>
<span id="cb136-83"><a href="microbiota.html#cb136-83"></a></span>
<span id="cb136-84"><a href="microbiota.html#cb136-84"></a>cleaning &lt;-<span class="st"> </span><span class="cf">function</span>(taxes) {</span>
<span id="cb136-85"><a href="microbiota.html#cb136-85"></a>    gb &lt;-<span class="st"> </span>taxes<span class="op">$</span>gb</span>
<span id="cb136-86"><a href="microbiota.html#cb136-86"></a>    sf &lt;-<span class="st"> </span>taxes<span class="op">$</span>sf</span>
<span id="cb136-87"><a href="microbiota.html#cb136-87"></a>    wb &lt;-<span class="st"> </span>taxes<span class="op">$</span>wb</span>
<span id="cb136-88"><a href="microbiota.html#cb136-88"></a>    <span class="co"># Renaming &amp; removing whitespaces</span></span>
<span id="cb136-89"><a href="microbiota.html#cb136-89"></a>    gb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Phylum)))</span>
<span id="cb136-90"><a href="microbiota.html#cb136-90"></a>    sf<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Phylum)))</span>
<span id="cb136-91"><a href="microbiota.html#cb136-91"></a>    wb<span class="op">$</span>Phylum &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Phylum)))</span>
<span id="cb136-92"><a href="microbiota.html#cb136-92"></a>    gb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(gb<span class="op">$</span>Class)))</span>
<span id="cb136-93"><a href="microbiota.html#cb136-93"></a>    sf<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(sf<span class="op">$</span>Class)))</span>
<span id="cb136-94"><a href="microbiota.html#cb136-94"></a>    wb<span class="op">$</span>Class &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">str_trim</span>(<span class="kw">as.character</span>(wb<span class="op">$</span>Class)))</span>
<span id="cb136-95"><a href="microbiota.html#cb136-95"></a>    <span class="co">## GB</span></span>
<span id="cb136-96"><a href="microbiota.html#cb136-96"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb136-97"><a href="microbiota.html#cb136-97"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb136-98"><a href="microbiota.html#cb136-98"></a>    gb<span class="op">$</span>Phylum[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb136-99"><a href="microbiota.html#cb136-99"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb136-100"><a href="microbiota.html#cb136-100"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb136-101"><a href="microbiota.html#cb136-101"></a>    gb<span class="op">$</span>Class[(gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb136-102"><a href="microbiota.html#cb136-102"></a>    gb<span class="op">$</span>Class[gb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Chloroflexi&quot;</span> <span class="op">&amp;</span><span class="st"> </span>gb<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> &quot;Chloroflexi_unclassified&quot;</span></span>
<span id="cb136-103"><a href="microbiota.html#cb136-103"></a>    <span class="co">## SF</span></span>
<span id="cb136-104"><a href="microbiota.html#cb136-104"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb136-105"><a href="microbiota.html#cb136-105"></a>    sf<span class="op">$</span>Phylum[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb136-106"><a href="microbiota.html#cb136-106"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;PAUC34f&quot;</span>)] &lt;-<span class="st"> &quot;PAUC34f_unclassified&quot;</span></span>
<span id="cb136-107"><a href="microbiota.html#cb136-107"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Proteobacteria&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sf<span class="op">$</span>Class <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;Proteobacteria_unclassified&quot;</span></span>
<span id="cb136-108"><a href="microbiota.html#cb136-108"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Tectomicrobia&quot;</span>)] &lt;-<span class="st"> &quot;Tectomicrobia_unclassified&quot;</span></span>
<span id="cb136-109"><a href="microbiota.html#cb136-109"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;SBR1093&quot;</span>)] &lt;-<span class="st"> &quot;SBR1093_unclassified&quot;</span></span>
<span id="cb136-110"><a href="microbiota.html#cb136-110"></a>    sf<span class="op">$</span>Class[(sf<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;Poribacteria&quot;</span>)] &lt;-<span class="st"> &quot;Poribacteria_unclassified&quot;</span></span>
<span id="cb136-111"><a href="microbiota.html#cb136-111"></a>    <span class="co">## WB</span></span>
<span id="cb136-112"><a href="microbiota.html#cb136-112"></a>    wb<span class="op">$</span>Class[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb136-113"><a href="microbiota.html#cb136-113"></a>    wb<span class="op">$</span>Phylum[(wb<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>)] &lt;-<span class="st"> &quot;unclassified&quot;</span></span>
<span id="cb136-114"><a href="microbiota.html#cb136-114"></a>    <span class="co"># merge back</span></span>
<span id="cb136-115"><a href="microbiota.html#cb136-115"></a>    taxes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb, <span class="dt">sf =</span> sf, <span class="dt">wb =</span> wb)</span>
<span id="cb136-116"><a href="microbiota.html#cb136-116"></a>    <span class="kw">return</span>(taxes)</span>
<span id="cb136-117"><a href="microbiota.html#cb136-117"></a>}</span>
<span id="cb136-118"><a href="microbiota.html#cb136-118"></a></span>
<span id="cb136-119"><a href="microbiota.html#cb136-119"></a>taxes &lt;-<span class="st"> </span><span class="kw">cleaning</span>(taxes)</span>
<span id="cb136-120"><a href="microbiota.html#cb136-120"></a></span>
<span id="cb136-121"><a href="microbiota.html#cb136-121"></a>phy_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))  <span class="co">#OTU count</span></span>
<span id="cb136-122"><a href="microbiota.html#cb136-122"></a>phy_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Phylum, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))  <span class="co">#sums relative abundance</span></span>
<span id="cb136-123"><a href="microbiota.html#cb136-123"></a></span>
<span id="cb136-124"><a href="microbiota.html#cb136-124"></a>class_OTU &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;length&quot;</span>))</span>
<span id="cb136-125"><a href="microbiota.html#cb136-125"></a>class_rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxes, <span class="cf">function</span>(x) <span class="kw">aggregate</span>(avg_rel_abdc <span class="op">~</span><span class="st"> </span>Class, <span class="dt">data =</span> x, <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>))</span></code></pre></div>
<div id="g.-barretti-phyla-and-classes-present" class="section level4">
<h4><span class="header-section-number">3.5.2.1</span> <em>G. barretti</em>: Phyla and classes present</h4>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="microbiota.html#cb137-1"></a><span class="co"># https://rstudio.github.io/DT/</span></span>
<span id="cb137-2"><a href="microbiota.html#cb137-2"></a>gb_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>gb, phy_rabdc<span class="op">$</span>gb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb137-3"><a href="microbiota.html#cb137-3"></a><span class="kw">colnames</span>(gb_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>)</span>
<span id="cb137-4"><a href="microbiota.html#cb137-4"></a><span class="co"># gb_P$`cummulative average abundance` &lt;- round(c(gb_P$`cummulative average abundance`, 6))</span></span>
<span id="cb137-5"><a href="microbiota.html#cb137-5"></a>DT<span class="op">::</span><span class="kw">datatable</span>(gb_P, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-fa8a4838df256b445d1a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fa8a4838df256b445d1a">{"x":{"filter":"none","data":[["Acidobacteria","Actinobacteria","Bacteroidetes","Chloroflexi","Deinococcus-Thermus","Gemmatimonadetes","Nitrospinae","Nitrospirae","PAUC34f","Poribacteria","Proteobacteria","SBR1093","Spirochaetae","Tectomicrobia","Thaumarchaeota","unclassified","Verrucomicrobia"],[111,29,3,139,1,32,3,2,6,2,68,1,4,2,9,7,1],[0.264941431090238,0.0842460797342462,0.00629929957644724,0.275071784071904,0.00289317970257434,0.0924848939914834,0.00546946423311415,0.0102462652978634,0.0181476956426156,0.00143759249628591,0.152814021070438,0.0227708137077518,0.0015659410178042,0.00372649801249384,0.0501133260165913,0.00733530349674407,0.000436410841404755]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Phylum<\/th>\n      <th>OTU count<\/th>\n      <th>cum. avg. abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="microbiota.html#cb138-1"></a>gb_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>gb, class_rabdc<span class="op">$</span>gb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb138-2"><a href="microbiota.html#cb138-2"></a><span class="kw">colnames</span>(gb_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb138-3"><a href="microbiota.html#cb138-3"></a><span class="co"># gb_C$`cummulative average abundance` &lt;- round(c(gb_C$`cummulative average abundance`, digits = 6))</span></span>
<span id="cb138-4"><a href="microbiota.html#cb138-4"></a>DT<span class="op">::</span><span class="kw">datatable</span>(gb_C, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-85856585114b6e0b3ff1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-85856585114b6e0b3ff1">{"x":{"filter":"none","data":[["Acidimicrobiia","Alphaproteobacteria","Anaerolineae","Bacteroidetes_Incertae_Sedis","BD2-11_terrestrial_group","Caldilineae","cD4-96","Chloroflexi_unclassified","Deinococci","Deltaproteobacteria","Gammaproteobacteria","Gemmatimonadetes","Holophagae","JG30-KF-CM66","JTB23","Marine_Group_I","MD2896-B214","MD2898-B26","Nitrospira","Opitutae","PAUC34f_unclassified","PAUC43f_marine_benthic_group","Poribacteria_unclassified","S085","SAR202_clade","SBR1093_unclassified","Solibacteres","Spirochaetes","SPOTSOCT00m83","Subgroup_11","Subgroup_12","Subgroup_13","Subgroup_15","Subgroup_17","Subgroup_2","Subgroup_21","Subgroup_26","Subgroup_5","Subgroup_6","Subgroup_9","Tectomicrobia_unclassified","Thermoleophilia","TK10","unclassified"],[24,25,19,3,29,4,1,1,1,8,29,1,2,15,5,9,2,1,2,1,6,2,2,6,75,1,11,4,1,2,1,5,3,2,2,16,4,2,46,15,2,5,18,7],[0.0739840145527607,0.0390005904393791,0.0482070884926763,0.00629929957644724,0.0842964083993767,0.0148264667246524,0.000219225505456683,0.0004288443174143,0.00289317970257434,0.0116819342805408,0.070373486556471,0.000390888048940581,0.0140614111670355,0.0338616857764079,0.0307588023562648,0.0501133260165913,0.00049247267640581,0.00497699155670834,0.0102462652978634,0.000436410841404755,0.0181476956426156,0.00779759754316616,0.00143759249628591,0.0144238860626124,0.130046252113444,0.0227708137077518,0.0147901722306825,0.0015659410178042,0.000999207437782005,0.0158603720656001,0.000289905064082157,0.00764605798243373,0.0041330054257542,0.00147702810615963,0.00331169059845213,0.0330821988436575,0.00817649607752723,0.00441643826982697,0.109013344556306,0.0486833107027202,0.00372649801249384,0.0102620651814855,0.0330583350792408,0.00733530349674407]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Class<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s.-fortis-phyla-and-classes-present" class="section level4">
<h4><span class="header-section-number">3.5.2.2</span> <em>S. fortis</em>: Phyla and classes present</h4>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="microbiota.html#cb139-1"></a>sf_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>sf, phy_rabdc<span class="op">$</span>sf[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb139-2"><a href="microbiota.html#cb139-2"></a><span class="kw">colnames</span>(sf_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cum. avg. abundance&quot;</span>)</span>
<span id="cb139-3"><a href="microbiota.html#cb139-3"></a><span class="co"># sf_P$`cummulative average abundance` &lt;- round(c(sf_P$`cummulative average abundance`, digits = 6))</span></span>
<span id="cb139-4"><a href="microbiota.html#cb139-4"></a>DT<span class="op">::</span><span class="kw">datatable</span>(sf_P, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-06307a2ae05a08ba790d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-06307a2ae05a08ba790d">{"x":{"filter":"none","data":[["Acidobacteria","Actinobacteria","Bacteroidetes","Chloroflexi","Deferribacteres","Deinococcus-Thermus","Firmicutes","Gemmatimonadetes","Nitrospinae","Nitrospirae","PAUC34f","Planctomycetes","Poribacteria","Proteobacteria","SBR1093","Spirochaetae","Tectomicrobia","Thaumarchaeota","unclassified","Verrucomicrobia"],[119,21,3,152,1,1,1,29,7,3,8,3,5,81,1,5,3,14,3,1],[0.238677738686968,0.0693342556977264,0.0107237163157949,0.306416127749244,0.000178502880778776,0.0025092262923236,0.000320550211882512,0.0645282665819597,0.0130718622825627,0.0129292544501288,0.0338805168591611,0.000775470437315722,0.00736784844051278,0.135133782193877,0.0205948095490131,0.0154965407039899,0.00903143516717622,0.0537437350216305,0.0028006697164809,0.00248569076147327]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Phylum<\/th>\n      <th>OTU count<\/th>\n      <th>cum. avg. abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="microbiota.html#cb140-1"></a>sf_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>sf, class_rabdc<span class="op">$</span>sf[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb140-2"><a href="microbiota.html#cb140-2"></a><span class="kw">colnames</span>(sf_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb140-3"><a href="microbiota.html#cb140-3"></a><span class="co"># sf_C$`cummulative average abundance` &lt;- round(c(sf_C$`cummulative average abundance`, digits = 6))</span></span>
<span id="cb140-4"><a href="microbiota.html#cb140-4"></a>DT<span class="op">::</span><span class="kw">datatable</span>(sf_C, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-12c458129c55f10be001" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-12c458129c55f10be001">{"x":{"filter":"none","data":[["Acidimicrobiia","Alphaproteobacteria","Anaerolineae","Bacilli","Bacteroidetes_Incertae_Sedis","BD2-11_terrestrial_group","Betaproteobacteria","Caldilineae","cD4-96","Deferribacteres_Incertae_Sedis","Deinococci","Deltaproteobacteria","Flavobacteriia","Gammaproteobacteria","Holophagae","JG30-KF-CM66","JTB23","MACA-EFT26","Marine_Group_I","MD2896-B214","MD2898-B26","Nitrospira","Opitutae","PAUC34f_unclassified","PAUC43f_marine_benthic_group","Planctomycetacia","Poribacteria_unclassified","Proteobacteria_unclassified","S085","SAR202_clade","SBR1093_unclassified","Solibacteres","Spirochaetes","SPOTSOCT00m83","Subgroup_11","Subgroup_12","Subgroup_13","Subgroup_15","Subgroup_17","Subgroup_2","Subgroup_21","Subgroup_26","Subgroup_5","Subgroup_6","Subgroup_9","Tectomicrobia_unclassified","Thermoleophilia","TK10","unclassified"],[17,23,14,1,2,26,1,4,1,1,1,6,1,42,2,11,6,1,14,2,5,3,1,8,3,3,5,1,4,96,1,15,5,1,1,3,7,2,3,2,18,2,3,42,19,3,4,22,3],[0.0596458249911138,0.0287869725087491,0.0216666993662345,0.000320550211882512,0.0104868434788265,0.0533001330830702,0.00105820994167432,0.0294432877074082,0.000188814887196095,0.000178502880778776,0.0025092262923236,0.0126067210663023,0.000236872836968404,0.0669805486348207,0.0106407282599732,0.0201981603147065,0.0219184124196273,0.000711345609766523,0.0537437350216305,0.00308096326228317,0.00999089902027953,0.0129292544501288,0.00248569076147327,0.0338805168591611,0.0112281334988895,0.000775470437315722,0.00736784844051278,0.000271454297575978,0.00716263734617863,0.18515714678954,0.0205948095490131,0.0301007087790878,0.0154965407039899,0.0028001177153612,0.0126648378893062,0.000742280992828754,0.00686166887637135,0.00157816173436267,0.000689454466613768,0.00170080531525615,0.0352999618017115,0.000941068929770098,0.00683928048137783,0.0710777186977769,0.0595410624625318,0.00903143516717622,0.00968843070661261,0.0425993813379804,0.0028006697164809]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Class<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="w.-bursa-phyla-and-classes-present" class="section level4">
<h4><span class="header-section-number">3.5.2.3</span> <em>W. bursa</em>: Phyla and classes present</h4>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="microbiota.html#cb141-1"></a>wb_P &lt;-<span class="st"> </span><span class="kw">cbind</span>(phy_OTU<span class="op">$</span>wb, phy_rabdc<span class="op">$</span>wb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb141-2"><a href="microbiota.html#cb141-2"></a><span class="kw">colnames</span>(wb_P) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb141-3"><a href="microbiota.html#cb141-3"></a><span class="co"># wb_P$`cummulative average abundance` &lt;- round(c(wb_P$`cummulative average abundance`, digits = 6))</span></span>
<span id="cb141-4"><a href="microbiota.html#cb141-4"></a>DT<span class="op">::</span><span class="kw">datatable</span>(wb_P, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-9b500dba04ae7a4fb777" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9b500dba04ae7a4fb777">{"x":{"filter":"none","data":[["Actinobacteria","Bacteroidetes","Chlamydiae","Chloroflexi","Cyanobacteria","Nitrospinae","Planctomycetes","Proteobacteria","SBR1093","Spirochaetae","Thaumarchaeota","unclassified","Verrucomicrobia"],[7,12,1,1,3,1,21,65,1,2,6,5,10],[0.0380423667912802,0.0271417390724484,0.000502061054107066,0.0157039630496128,0.00490570956280944,0.0336527147276658,0.105202416163017,0.613784938356821,0.00152927793229885,0.00305799017423506,0.121077130674959,0.00425010206293762,0.0311495903778074]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Phylum<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="microbiota.html#cb142-1"></a>wb_C &lt;-<span class="st"> </span><span class="kw">cbind</span>(class_OTU<span class="op">$</span>wb, class_rabdc<span class="op">$</span>wb[, (<span class="st">&quot;avg_rel_abdc&quot;</span>)])</span>
<span id="cb142-2"><a href="microbiota.html#cb142-2"></a><span class="kw">colnames</span>(wb_C) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>, <span class="st">&quot;OTU count&quot;</span>, <span class="st">&quot;cummulative average abundance&quot;</span>)</span>
<span id="cb142-3"><a href="microbiota.html#cb142-3"></a><span class="co"># wb_C$`cummulative average abundance` &lt;- round(c(wb_C$`cummulative average abundance`, digits = 6))</span></span>
<span id="cb142-4"><a href="microbiota.html#cb142-4"></a>DT<span class="op">::</span><span class="kw">datatable</span>(wb_C, <span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-189decaf318987ec54b9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-189decaf318987ec54b9">{"x":{"filter":"none","data":[["Acidimicrobiia","Actinobacteria","Alphaproteobacteria","Arctic97B-4_marine_group","Betaproteobacteria","Chlamydiae","Chloroplast","Deltaproteobacteria","Flavobacteriia","Gammaproteobacteria","JTB23","Marine_Group_I","ML635J-21","Nitrospinia","OM190","Phycisphaerae","Planctomycetacia","SAR202_clade","Spirochaetes","unclassified","uncultured_Desulfohalobiaceae_bacterium","Verrucomicrobiae"],[1,6,6,1,3,1,2,3,12,52,1,6,1,1,1,8,12,1,2,5,1,9],[0.000446394265347338,0.0375959725259329,0.02198602374512,0.00359729970671857,0.00382103946235601,0.000502061054107066,0.00433988694118431,0.00945650573887785,0.0271417390724484,0.565791775582376,0.0127295938280915,0.121077130674959,0.000565822621625134,0.0336527147276658,0.000618215323155031,0.00712087225822437,0.0974633285816377,0.0157039630496128,0.00305799017423506,0.00425010206293762,0.00152927793229885,0.0275522906710888]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Class<\/th>\n      <th>OTU count<\/th>\n      <th>cummulative average abundance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="microbiota.html#cb143-1"></a><span class="kw">rm</span>(gb_P, sf_P, wb_P, gb_C, sf_C, wb_C)</span></code></pre></div>
</div>
</div>
<div id="statistical-comparison-at-phylum-and-class-level" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Statistical comparison at phylum and class level</h3>
</div>
</div>
<div id="depth-response-otu-perspective" class="section level2">
<h2><span class="header-section-number">3.6</span> Depth response: OTU perspective</h2>
<p>Summarising the OTU diversity by phylum or class only shows what was previously known. The composition of the spongesâ€™ prokaryotic community is stable. However, summarising doesnâ€™t do the data justice. We therefore correlate the average relative abundance of every OTU with depth. The Otus yielding a significant correlation with depth are shown by their respecive relative abundance across the depths.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="microbiota.html#cb144-1"></a><span class="co"># ====================== INC-DEC CORRELATION ================== Categorises the OTUs by their response to depth.</span></span>
<span id="cb144-2"><a href="microbiota.html#cb144-2"></a></span>
<span id="cb144-3"><a href="microbiota.html#cb144-3"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb144-4"><a href="microbiota.html#cb144-4"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb144-5"><a href="microbiota.html#cb144-5"></a></span>
<span id="cb144-6"><a href="microbiota.html#cb144-6"></a>meta_data_prep &lt;-<span class="st"> </span><span class="cf">function</span>(meta_data) {</span>
<span id="cb144-7"><a href="microbiota.html#cb144-7"></a>    meta_data &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;MeanBottomTemp_Cdeg&quot;</span>, <span class="st">&quot;MeanBotSalinity_PSU&quot;</span>, <span class="st">&quot;YEAR&quot;</span>)]</span>
<span id="cb144-8"><a href="microbiota.html#cb144-8"></a>    <span class="kw">colnames</span>(meta_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>, <span class="st">&quot;Latitude&quot;</span>, <span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Temperature&quot;</span>, <span class="st">&quot;Salinity&quot;</span>, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb144-9"><a href="microbiota.html#cb144-9"></a>    meta_data &lt;-<span class="st"> </span>meta_data[<span class="op">!</span>(<span class="kw">str_sub</span>(meta_data<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;QC&quot;</span>), ]</span>
<span id="cb144-10"><a href="microbiota.html#cb144-10"></a>    meta_data[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(meta_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.factor</span>(x)) </span>
<span id="cb144-11"><a href="microbiota.html#cb144-11"></a>        <span class="kw">factor</span>(x) <span class="cf">else</span> x)</span>
<span id="cb144-12"><a href="microbiota.html#cb144-12"></a>    <span class="co"># Gb12, Gb20 and Gb21 are missing temperature and salinity. Imputing data from closeby samples:</span></span>
<span id="cb144-13"><a href="microbiota.html#cb144-13"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb144-14"><a href="microbiota.html#cb144-14"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb20&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.92</span></span>
<span id="cb144-15"><a href="microbiota.html#cb144-15"></a>    meta_data<span class="op">$</span>Salinity[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb21&quot;</span>] &lt;-<span class="st"> </span><span class="fl">34.56</span></span>
<span id="cb144-16"><a href="microbiota.html#cb144-16"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb12&quot;</span>] &lt;-<span class="st"> </span><span class="fl">3.71</span></span>
<span id="cb144-17"><a href="microbiota.html#cb144-17"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb20&quot;</span>] &lt;-<span class="st"> </span><span class="fl">3.65</span></span>
<span id="cb144-18"><a href="microbiota.html#cb144-18"></a>    meta_data<span class="op">$</span>Temperature[meta_data<span class="op">$</span>unified_ID <span class="op">==</span><span class="st"> &quot;Gb21&quot;</span>] &lt;-<span class="st"> </span><span class="fl">2.32</span></span>
<span id="cb144-19"><a href="microbiota.html#cb144-19"></a>    meta_data[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(meta_data<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb144-20"><a href="microbiota.html#cb144-20"></a>    meta_data &lt;-<span class="st"> </span>meta_data[<span class="kw">order</span>(meta_data<span class="op">$</span>unified_ID), ]</span>
<span id="cb144-21"><a href="microbiota.html#cb144-21"></a>    <span class="kw">return</span>(meta_data)</span>
<span id="cb144-22"><a href="microbiota.html#cb144-22"></a>}</span>
<span id="cb144-23"><a href="microbiota.html#cb144-23"></a></span>
<span id="cb144-24"><a href="microbiota.html#cb144-24"></a>meta_data &lt;-<span class="st"> </span><span class="kw">meta_data_prep</span>(meta_data)</span>
<span id="cb144-25"><a href="microbiota.html#cb144-25"></a></span>
<span id="cb144-26"><a href="microbiota.html#cb144-26"></a>OTU_prep_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb144-27"><a href="microbiota.html#cb144-27"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb144-28"><a href="microbiota.html#cb144-28"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb144-29"><a href="microbiota.html#cb144-29"></a>    micro &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro)  <span class="co">#sqrt could be toggled on/off here</span></span>
<span id="cb144-30"><a href="microbiota.html#cb144-30"></a>    </span>
<span id="cb144-31"><a href="microbiota.html#cb144-31"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb144-32"><a href="microbiota.html#cb144-32"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb144-33"><a href="microbiota.html#cb144-33"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb144-34"><a href="microbiota.html#cb144-34"></a>    </span>
<span id="cb144-35"><a href="microbiota.html#cb144-35"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb144-36"><a href="microbiota.html#cb144-36"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb144-37"><a href="microbiota.html#cb144-37"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb144-38"><a href="microbiota.html#cb144-38"></a>    micros &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> micro_gb, <span class="dt">sf =</span> micro_sf, <span class="dt">wb =</span> micro_wb)</span>
<span id="cb144-39"><a href="microbiota.html#cb144-39"></a>    <span class="kw">return</span>(micros)</span>
<span id="cb144-40"><a href="microbiota.html#cb144-40"></a>}</span>
<span id="cb144-41"><a href="microbiota.html#cb144-41"></a></span>
<span id="cb144-42"><a href="microbiota.html#cb144-42"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb144-43"><a href="microbiota.html#cb144-43"></a></span>
<span id="cb144-44"><a href="microbiota.html#cb144-44"></a><span class="co">### </span></span>
<span id="cb144-45"><a href="microbiota.html#cb144-45"></a>overall_rabdc &lt;-<span class="st"> </span><span class="cf">function</span>(micros) {</span>
<span id="cb144-46"><a href="microbiota.html#cb144-46"></a>    mic &lt;-<span class="st"> </span>micros</span>
<span id="cb144-47"><a href="microbiota.html#cb144-47"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb144-48"><a href="microbiota.html#cb144-48"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb144-49"><a href="microbiota.html#cb144-49"></a>    mic[<span class="st">&quot;rowsum&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, sum)</span>
<span id="cb144-50"><a href="microbiota.html#cb144-50"></a>    </span>
<span id="cb144-51"><a href="microbiota.html#cb144-51"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb144-52"><a href="microbiota.html#cb144-52"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb144-53"><a href="microbiota.html#cb144-53"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>rowsum[n])</span>
<span id="cb144-54"><a href="microbiota.html#cb144-54"></a>    }</span>
<span id="cb144-55"><a href="microbiota.html#cb144-55"></a>    </span>
<span id="cb144-56"><a href="microbiota.html#cb144-56"></a>    mic<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb144-57"><a href="microbiota.html#cb144-57"></a>    mic &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(mic))</span>
<span id="cb144-58"><a href="microbiota.html#cb144-58"></a>    <span class="co"># mic[&#39;avg_rel_abdc&#39;] &lt;- apply(mic, 1, mean) mic[&#39;occurrence&#39;] &lt;- ifelse(mic$avg&gt;0.0025, &#39;common&#39;, &#39;rare&#39;)</span></span>
<span id="cb144-59"><a href="microbiota.html#cb144-59"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb144-60"><a href="microbiota.html#cb144-60"></a>}</span>
<span id="cb144-61"><a href="microbiota.html#cb144-61"></a></span>
<span id="cb144-62"><a href="microbiota.html#cb144-62"></a>rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb144-63"><a href="microbiota.html#cb144-63"></a></span>
<span id="cb144-64"><a href="microbiota.html#cb144-64"></a><span class="co"># CORRELATION</span></span>
<span id="cb144-65"><a href="microbiota.html#cb144-65"></a></span>
<span id="cb144-66"><a href="microbiota.html#cb144-66"></a>inc_dec &lt;-<span class="st"> </span><span class="cf">function</span>(rabdc_df, meta_data) {</span>
<span id="cb144-67"><a href="microbiota.html#cb144-67"></a>    </span>
<span id="cb144-68"><a href="microbiota.html#cb144-68"></a>    md &lt;-<span class="st"> </span>meta_data[meta_data<span class="op">$</span>unified_ID <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(rabdc_df), ]</span>
<span id="cb144-69"><a href="microbiota.html#cb144-69"></a>    inc_dec &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rownames</span>(rabdc_df))</span>
<span id="cb144-70"><a href="microbiota.html#cb144-70"></a>    <span class="kw">colnames</span>(inc_dec) &lt;-<span class="st"> &quot;XOTU&quot;</span></span>
<span id="cb144-71"><a href="microbiota.html#cb144-71"></a>    inc_dec[<span class="st">&quot;inc_dec_estimate&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb144-72"><a href="microbiota.html#cb144-72"></a>    inc_dec[<span class="st">&quot;inc_dec_p_val&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb144-73"><a href="microbiota.html#cb144-73"></a>    inc_dec[<span class="st">&quot;fdr&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb144-74"><a href="microbiota.html#cb144-74"></a>    </span>
<span id="cb144-75"><a href="microbiota.html#cb144-75"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb144-76"><a href="microbiota.html#cb144-76"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(inc_dec)[<span class="dv">1</span>]</span>
<span id="cb144-77"><a href="microbiota.html#cb144-77"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb144-78"><a href="microbiota.html#cb144-78"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb144-79"><a href="microbiota.html#cb144-79"></a>        inc_dec<span class="op">$</span>inc_dec_estimate[n] &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="kw">as.numeric</span>(rabdc_df[n, ]), md<span class="op">$</span>Depth)<span class="op">$</span>estimate</span>
<span id="cb144-80"><a href="microbiota.html#cb144-80"></a>        inc_dec<span class="op">$</span>inc_dec_p_val[n] &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="kw">as.numeric</span>(rabdc_df[n, ]), md<span class="op">$</span>Depth)<span class="op">$</span>p.value</span>
<span id="cb144-81"><a href="microbiota.html#cb144-81"></a>    }</span>
<span id="cb144-82"><a href="microbiota.html#cb144-82"></a>    </span>
<span id="cb144-83"><a href="microbiota.html#cb144-83"></a>    inc_dec[<span class="st">&quot;classification&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb144-84"><a href="microbiota.html#cb144-84"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;dec.trend&quot;</span></span>
<span id="cb144-85"><a href="microbiota.html#cb144-85"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;inc.trend&quot;</span></span>
<span id="cb144-86"><a href="microbiota.html#cb144-86"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>inc_dec<span class="op">$</span>inc_dec_p <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> &quot;decreasing&quot;</span></span>
<span id="cb144-87"><a href="microbiota.html#cb144-87"></a>    inc_dec<span class="op">$</span>classification[inc_dec<span class="op">$</span>inc_dec_estimate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>inc_dec<span class="op">$</span>inc_dec_p <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> &quot;increasing&quot;</span></span>
<span id="cb144-88"><a href="microbiota.html#cb144-88"></a>    inc_dec<span class="op">$</span>fdr &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(inc_dec<span class="op">$</span>inc_dec_p_val, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</span>
<span id="cb144-89"><a href="microbiota.html#cb144-89"></a>    <span class="kw">return</span>(inc_dec)</span>
<span id="cb144-90"><a href="microbiota.html#cb144-90"></a>}</span>
<span id="cb144-91"><a href="microbiota.html#cb144-91"></a></span>
<span id="cb144-92"><a href="microbiota.html#cb144-92"></a>response &lt;-<span class="st"> </span><span class="kw">lapply</span>(rabdc, inc_dec, <span class="dt">meta_data =</span> meta_data)</span>
<span id="cb144-93"><a href="microbiota.html#cb144-93"></a></span>
<span id="cb144-94"><a href="microbiota.html#cb144-94"></a>scale_viz &lt;-<span class="st"> </span><span class="cf">function</span>(micro) {</span>
<span id="cb144-95"><a href="microbiota.html#cb144-95"></a>    mic &lt;-<span class="st"> </span>micro</span>
<span id="cb144-96"><a href="microbiota.html#cb144-96"></a>    mic[<span class="st">&quot;max&quot;</span>] &lt;-<span class="st"> </span><span class="kw">apply</span>(mic, <span class="dv">1</span>, max)</span>
<span id="cb144-97"><a href="microbiota.html#cb144-97"></a>    </span>
<span id="cb144-98"><a href="microbiota.html#cb144-98"></a>    n &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb144-99"><a href="microbiota.html#cb144-99"></a>    k &lt;-<span class="st"> </span><span class="kw">dim</span>(mic)[<span class="dv">1</span>]</span>
<span id="cb144-100"><a href="microbiota.html#cb144-100"></a>    <span class="cf">while</span> (n <span class="op">&lt;</span><span class="st"> </span>k) {</span>
<span id="cb144-101"><a href="microbiota.html#cb144-101"></a>        n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb144-102"><a href="microbiota.html#cb144-102"></a>        mic[n, ] &lt;-<span class="st"> </span>mic[n, ]<span class="op">/</span>(mic<span class="op">$</span>max[n])</span>
<span id="cb144-103"><a href="microbiota.html#cb144-103"></a>    }</span>
<span id="cb144-104"><a href="microbiota.html#cb144-104"></a>    mic<span class="op">$</span>max &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb144-105"><a href="microbiota.html#cb144-105"></a>    <span class="kw">return</span>(mic)</span>
<span id="cb144-106"><a href="microbiota.html#cb144-106"></a>}</span>
<span id="cb144-107"><a href="microbiota.html#cb144-107"></a></span>
<span id="cb144-108"><a href="microbiota.html#cb144-108"></a>rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(rabdc, scale_viz)  <span class="co">#to scale between {0,1} for visualisation</span></span>
<span id="cb144-109"><a href="microbiota.html#cb144-109"></a></span>
<span id="cb144-110"><a href="microbiota.html#cb144-110"></a>rabdc_gb &lt;-<span class="st"> </span>rabdc<span class="op">$</span>gb</span>
<span id="cb144-111"><a href="microbiota.html#cb144-111"></a>rabdc_sf &lt;-<span class="st"> </span>rabdc<span class="op">$</span>sf</span>
<span id="cb144-112"><a href="microbiota.html#cb144-112"></a>rabdc_wb &lt;-<span class="st"> </span>rabdc<span class="op">$</span>wb</span>
<span id="cb144-113"><a href="microbiota.html#cb144-113"></a></span>
<span id="cb144-114"><a href="microbiota.html#cb144-114"></a>gb_response &lt;-<span class="st"> </span>response<span class="op">$</span>gb</span>
<span id="cb144-115"><a href="microbiota.html#cb144-115"></a>sf_response &lt;-<span class="st"> </span>response<span class="op">$</span>sf</span>
<span id="cb144-116"><a href="microbiota.html#cb144-116"></a>wb_response &lt;-<span class="st"> </span>response<span class="op">$</span>wb</span>
<span id="cb144-117"><a href="microbiota.html#cb144-117"></a></span>
<span id="cb144-118"><a href="microbiota.html#cb144-118"></a><span class="co"># gb</span></span>
<span id="cb144-119"><a href="microbiota.html#cb144-119"></a></span>
<span id="cb144-120"><a href="microbiota.html#cb144-120"></a>rabdc_gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_gb)</span>
<span id="cb144-121"><a href="microbiota.html#cb144-121"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_gb, gb_response)</span>
<span id="cb144-122"><a href="microbiota.html#cb144-122"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(gb_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb144-123"><a href="microbiota.html#cb144-123"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb144-124"><a href="microbiota.html#cb144-124"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb144-125"><a href="microbiota.html#cb144-125"></a>gb_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_heatmap, md)</span>
<span id="cb144-126"><a href="microbiota.html#cb144-126"></a>gb_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(gb_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb144-127"><a href="microbiota.html#cb144-127"></a>gb_heatmap_i &lt;-<span class="st"> </span>gb_heatmap[gb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb144-128"><a href="microbiota.html#cb144-128"></a>gb_heatmap_d &lt;-<span class="st"> </span>gb_heatmap[gb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb144-129"><a href="microbiota.html#cb144-129"></a></span>
<span id="cb144-130"><a href="microbiota.html#cb144-130"></a><span class="co"># gb_i &lt;- ggplot(gb_heatmap_i, aes(x=as.factor(gb_heatmap_i$Depth), y=gb_heatmap_i$name, fill=gb_heatmap_i$value))+geom_tile()+ theme(axis.text.x = element_text(angle = 90, hjust</span></span>
<span id="cb144-131"><a href="microbiota.html#cb144-131"></a><span class="co"># = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;GB OTUs increasing&#39;)+scale_fill_viridis_c(option = &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb144-132"><a href="microbiota.html#cb144-132"></a><span class="co"># panel.border=element_blank(), legend.title=element_blank(),legend.position=&#39;bottom&#39;) gb_d &lt;- ggplot(gb_heatmap_d, aes(x=as.factor(gb_heatmap_d$Depth), y=gb_heatmap_d$name,</span></span>
<span id="cb144-133"><a href="microbiota.html#cb144-133"></a><span class="co"># fill=gb_heatmap_d$value))+geom_tile()+ theme(axis.text.x = element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;GB OTUs</span></span>
<span id="cb144-134"><a href="microbiota.html#cb144-134"></a><span class="co"># decreasing&#39;)+scale_fill_viridis_c(option = &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(), panel.border=element_blank(),</span></span>
<span id="cb144-135"><a href="microbiota.html#cb144-135"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb144-136"><a href="microbiota.html#cb144-136"></a></span>
<span id="cb144-137"><a href="microbiota.html#cb144-137"></a><span class="co"># sf</span></span>
<span id="cb144-138"><a href="microbiota.html#cb144-138"></a>rabdc_sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_sf)</span>
<span id="cb144-139"><a href="microbiota.html#cb144-139"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_sf, sf_response)</span>
<span id="cb144-140"><a href="microbiota.html#cb144-140"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(sf_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb144-141"><a href="microbiota.html#cb144-141"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb144-142"><a href="microbiota.html#cb144-142"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb144-143"><a href="microbiota.html#cb144-143"></a>sf_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_heatmap, md)</span>
<span id="cb144-144"><a href="microbiota.html#cb144-144"></a>sf_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(sf_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb144-145"><a href="microbiota.html#cb144-145"></a>sf_heatmap_i &lt;-<span class="st"> </span>sf_heatmap[sf_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb144-146"><a href="microbiota.html#cb144-146"></a>sf_heatmap_d &lt;-<span class="st"> </span>sf_heatmap[sf_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb144-147"><a href="microbiota.html#cb144-147"></a></span>
<span id="cb144-148"><a href="microbiota.html#cb144-148"></a><span class="co"># sf_i &lt;- ggplot(sf_heatmap_i, aes(x=as.factor(sf_heatmap_i$Depth), y=sf_heatmap_i$name, fill=sf_heatmap_i$value))+geom_tile()+ theme(axis.text.x = element_text(angle = 90, hjust</span></span>
<span id="cb144-149"><a href="microbiota.html#cb144-149"></a><span class="co"># = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;SF OTUs increasing&#39;)+scale_fill_viridis_c(option = &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb144-150"><a href="microbiota.html#cb144-150"></a><span class="co"># panel.border=element_blank(), legend.title=element_blank(),legend.position=&#39;bottom&#39;) sf_d &lt;- ggplot(sf_heatmap_d, aes(x=as.factor(sf_heatmap_d$Depth), y=sf_heatmap_d$name,</span></span>
<span id="cb144-151"><a href="microbiota.html#cb144-151"></a><span class="co"># fill=sf_heatmap_d$value))+geom_tile()+ theme(axis.text.x = element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;SF OTUs</span></span>
<span id="cb144-152"><a href="microbiota.html#cb144-152"></a><span class="co"># decreasing&#39;)+scale_fill_viridis_c(option = &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(), panel.border=element_blank(),</span></span>
<span id="cb144-153"><a href="microbiota.html#cb144-153"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb144-154"><a href="microbiota.html#cb144-154"></a></span>
<span id="cb144-155"><a href="microbiota.html#cb144-155"></a><span class="co"># wb</span></span>
<span id="cb144-156"><a href="microbiota.html#cb144-156"></a>rabdc_wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc_wb)</span>
<span id="cb144-157"><a href="microbiota.html#cb144-157"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">full_join</span>(rabdc_wb, wb_response)</span>
<span id="cb144-158"><a href="microbiota.html#cb144-158"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">melt</span>(wb_heatmap, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;inc_dec_estimate&quot;</span>, <span class="st">&quot;inc_dec_p_val&quot;</span>, <span class="st">&quot;classification&quot;</span>))</span>
<span id="cb144-159"><a href="microbiota.html#cb144-159"></a>md &lt;-<span class="st"> </span>meta_data[, <span class="kw">c</span>(<span class="st">&quot;unified_ID&quot;</span>, <span class="st">&quot;Depth&quot;</span>)]</span>
<span id="cb144-160"><a href="microbiota.html#cb144-160"></a><span class="kw">colnames</span>(md) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Depth&quot;</span>)</span>
<span id="cb144-161"><a href="microbiota.html#cb144-161"></a>wb_heatmap &lt;-<span class="st"> </span><span class="kw">left_join</span>(wb_heatmap, md)</span>
<span id="cb144-162"><a href="microbiota.html#cb144-162"></a>wb_heatmap[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(wb_heatmap<span class="op">$</span>XOTU, <span class="dv">-3</span>)</span>
<span id="cb144-163"><a href="microbiota.html#cb144-163"></a>wb_heatmap_i &lt;-<span class="st"> </span>wb_heatmap[wb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>, ]</span>
<span id="cb144-164"><a href="microbiota.html#cb144-164"></a>wb_heatmap_d &lt;-<span class="st"> </span>wb_heatmap[wb_heatmap<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb144-165"><a href="microbiota.html#cb144-165"></a></span>
<span id="cb144-166"><a href="microbiota.html#cb144-166"></a><span class="co"># wb_i &lt;- ggplot(wb_heatmap_i, aes(x=as.factor(wb_heatmap_i$Depth), y=wb_heatmap_i$name, fill=wb_heatmap_i$value))+geom_tile()+ theme(axis.text.x = element_text(angle = 90, hjust</span></span>
<span id="cb144-167"><a href="microbiota.html#cb144-167"></a><span class="co"># = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;WB OTUs increasing&#39;)+scale_fill_viridis_c(option = &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(),</span></span>
<span id="cb144-168"><a href="microbiota.html#cb144-168"></a><span class="co"># panel.border=element_blank(), legend.title=element_blank(),legend.position=&#39;bottom&#39;) wb_d &lt;- ggplot(wb_heatmap_d, aes(x=as.factor(wb_heatmap_d$Depth), y=wb_heatmap_d$name,</span></span>
<span id="cb144-169"><a href="microbiota.html#cb144-169"></a><span class="co"># fill=wb_heatmap_d$value))+geom_tile()+ theme(axis.text.x = element_text(angle = 90, hjust = 1))+xlab(&#39;Depth&#39;)+ylab(&#39;OTUs&#39;)+ggtitle(&#39;WB OTUs</span></span>
<span id="cb144-170"><a href="microbiota.html#cb144-170"></a><span class="co"># decreasing&#39;)+scale_fill_viridis_c(option = &#39;plasma&#39;)+coord_equal()+theme(plot.background=element_blank(), panel.border=element_blank(),</span></span>
<span id="cb144-171"><a href="microbiota.html#cb144-171"></a><span class="co"># legend.title=element_blank(),legend.position=&#39;bottom&#39;)</span></span>
<span id="cb144-172"><a href="microbiota.html#cb144-172"></a></span>
<span id="cb144-173"><a href="microbiota.html#cb144-173"></a><span class="co"># Facetting for the figure in the publication</span></span>
<span id="cb144-174"><a href="microbiota.html#cb144-174"></a>gb_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb144-175"><a href="microbiota.html#cb144-175"></a>sf_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb144-176"><a href="microbiota.html#cb144-176"></a>wb_heatmap_i[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb144-177"><a href="microbiota.html#cb144-177"></a>increase &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_heatmap_i, sf_heatmap_i, wb_heatmap_i)</span>
<span id="cb144-178"><a href="microbiota.html#cb144-178"></a>inc &lt;-<span class="st"> </span><span class="kw">ggplot</span>(increase, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(Depth), <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>spec, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, </span>
<span id="cb144-179"><a href="microbiota.html#cb144-179"></a>    <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;OTUs increasing&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb144-180"><a href="microbiota.html#cb144-180"></a>    <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb144-181"><a href="microbiota.html#cb144-181"></a></span>
<span id="cb144-182"><a href="microbiota.html#cb144-182"></a>gb_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>)</span>
<span id="cb144-183"><a href="microbiota.html#cb144-183"></a>sf_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stryphnus fortis&quot;</span>)</span>
<span id="cb144-184"><a href="microbiota.html#cb144-184"></a>wb_heatmap_d[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb144-185"><a href="microbiota.html#cb144-185"></a>decrease &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_heatmap_d, sf_heatmap_d, wb_heatmap_d)</span>
<span id="cb144-186"><a href="microbiota.html#cb144-186"></a>dec &lt;-<span class="st"> </span><span class="kw">ggplot</span>(decrease, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(Depth), <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>spec, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">drop =</span> T) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, </span>
<span id="cb144-187"><a href="microbiota.html#cb144-187"></a>    <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Depth&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;OTUs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;OTUs decreasing&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb144-188"><a href="microbiota.html#cb144-188"></a>    <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb144-189"><a href="microbiota.html#cb144-189"></a></span>
<span id="cb144-190"><a href="microbiota.html#cb144-190"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb144-191"><a href="microbiota.html#cb144-191"></a><span class="kw">grid.arrange</span>(inc, dec, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span id="fig:increade-decrease"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/increade-decrease-1.png" alt="OTUs significantly increasing and decreasing with depth in the three sponge species." width="672" />
<p class="caption">
Figure 3.12: OTUs significantly increasing and decreasing with depth in the three sponge species.
</p>
</div>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="microbiota.html#cb145-1"></a>gb_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap_i<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(gb_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb145-2"><a href="microbiota.html#cb145-2"></a>sf_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap_i<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(sf_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb145-3"><a href="microbiota.html#cb145-3"></a>wb_nums &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap_i<span class="op">$</span>name)), <span class="kw">length</span>(<span class="kw">unique</span>(wb_heatmap_d<span class="op">$</span>name)))</span>
<span id="cb145-4"><a href="microbiota.html#cb145-4"></a></span>
<span id="cb145-5"><a href="microbiota.html#cb145-5"></a>overview &lt;-<span class="st"> </span><span class="kw">rbind</span>(gb_nums, sf_nums, wb_nums)</span>
<span id="cb145-6"><a href="microbiota.html#cb145-6"></a><span class="kw">colnames</span>(overview) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Total&quot;</span>, <span class="st">&quot;increasing&quot;</span>, <span class="st">&quot;decreasing&quot;</span>)</span>
<span id="cb145-7"><a href="microbiota.html#cb145-7"></a><span class="kw">rownames</span>(overview) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;G. barretti microbiota&quot;</span>, <span class="st">&quot;S. fortis microbiota&quot;</span>, <span class="st">&quot;W. bursa microbiota&quot;</span>)</span>
<span id="cb145-8"><a href="microbiota.html#cb145-8"></a>overview &lt;-<span class="st"> </span><span class="kw">data.frame</span>(overview)</span>
<span id="cb145-9"><a href="microbiota.html#cb145-9"></a>overview[<span class="st">&quot;unaffected&quot;</span>] &lt;-<span class="st"> </span>overview<span class="op">$</span>Total <span class="op">-</span><span class="st"> </span>(overview<span class="op">$</span>increasing <span class="op">+</span><span class="st"> </span>overview<span class="op">$</span>decreasing)</span>
<span id="cb145-10"><a href="microbiota.html#cb145-10"></a></span>
<span id="cb145-11"><a href="microbiota.html#cb145-11"></a><span class="kw">kable</span>(overview, <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Total&quot;</span>, <span class="st">&quot;N OTUs increasing&quot;</span>, <span class="st">&quot;N OTUs decreasing&quot;</span>, <span class="st">&quot;N OTUs unaffected&quot;</span>), <span class="dt">escape =</span> F, <span class="dt">align =</span> <span class="st">&quot;c&quot;</span>, <span class="dt">booktabs =</span> T, <span class="dt">caption =</span> <span class="st">&quot;Microbiota response to depth&quot;</span>, </span>
<span id="cb145-12"><a href="microbiota.html#cb145-12"></a>    <span class="st">&quot;html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>, <span class="dt">latex_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="dt">full_width =</span> F))</span></code></pre></div>
<table class="table table-hover table-condensed table-responsive table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:increade-decrease">Table 3.4: </span>Microbiota response to depth
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Total
</th>
<th style="text-align:center;">
N OTUs increasing
</th>
<th style="text-align:center;">
N OTUs decreasing
</th>
<th style="text-align:center;">
N OTUs unaffected
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
G. barretti microbiota
</td>
<td style="text-align:center;">
420
</td>
<td style="text-align:center;">
86
</td>
<td style="text-align:center;">
63
</td>
<td style="text-align:center;">
271
</td>
</tr>
<tr>
<td style="text-align:left;">
S. fortis microbiota
</td>
<td style="text-align:center;">
461
</td>
<td style="text-align:center;">
62
</td>
<td style="text-align:center;">
37
</td>
<td style="text-align:center;">
362
</td>
</tr>
<tr>
<td style="text-align:left;">
W. bursa microbiota
</td>
<td style="text-align:center;">
135
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
112
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="microbiota.html#cb146-1"></a><span class="kw">write.csv</span>(gb_response, <span class="st">&quot;data/gb_response.csv&quot;</span>)</span>
<span id="cb146-2"><a href="microbiota.html#cb146-2"></a><span class="kw">write.csv</span>(sf_response, <span class="st">&quot;data/sf_response.csv&quot;</span>)</span>
<span id="cb146-3"><a href="microbiota.html#cb146-3"></a><span class="kw">write.csv</span>(wb_response, <span class="st">&quot;data/wb_response.csv&quot;</span>)</span></code></pre></div>
<p>Weâ€™ve shown that thre is a substantial fraction of OTUs changing with depth in the three sponges. How much do these OTUs contribute the the respecive samplesâ€™ microbiota? (Are these just rare OTU?)</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="microbiota.html#cb147-1"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb147-2"><a href="microbiota.html#cb147-2"></a>meta_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Steffen_et_al_metadata_PANGAEA.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb147-3"><a href="microbiota.html#cb147-3"></a></span>
<span id="cb147-4"><a href="microbiota.html#cb147-4"></a>meta_data &lt;-<span class="st"> </span><span class="kw">meta_data_prep</span>(meta_data)</span>
<span id="cb147-5"><a href="microbiota.html#cb147-5"></a>micro_ds &lt;-<span class="st"> </span><span class="kw">OTU_prep_sqrt</span>(micro)</span>
<span id="cb147-6"><a href="microbiota.html#cb147-6"></a>rabdc &lt;-<span class="st"> </span><span class="kw">lapply</span>(micro_ds, overall_rabdc)</span>
<span id="cb147-7"><a href="microbiota.html#cb147-7"></a>response &lt;-<span class="st"> </span><span class="kw">lapply</span>(rabdc, inc_dec, <span class="dt">meta_data =</span> meta_data)</span>
<span id="cb147-8"><a href="microbiota.html#cb147-8"></a><span class="co"># until here same as in previous chunk (increade-decrease)</span></span>
<span id="cb147-9"><a href="microbiota.html#cb147-9"></a></span>
<span id="cb147-10"><a href="microbiota.html#cb147-10"></a><span class="co"># How much in terms of relative abundance do OTUs increasing/decreasing contribute?</span></span>
<span id="cb147-11"><a href="microbiota.html#cb147-11"></a>resp_subset &lt;-<span class="st"> </span>response<span class="op">$</span>gb</span>
<span id="cb147-12"><a href="microbiota.html#cb147-12"></a>resp_subset &lt;-<span class="st"> </span>resp_subset[resp_subset<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span> <span class="op">|</span><span class="st"> </span>resp_subset<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb147-13"><a href="microbiota.html#cb147-13"></a>rabdc<span class="op">$</span>gb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc<span class="op">$</span>gb)</span>
<span id="cb147-14"><a href="microbiota.html#cb147-14"></a>changes &lt;-<span class="st"> </span><span class="kw">left_join</span>(resp_subset, rabdc<span class="op">$</span>gb)</span>
<span id="cb147-15"><a href="microbiota.html#cb147-15"></a><span class="kw">apply</span>(changes[, <span class="dv">6</span><span class="op">:</span><span class="dv">19</span>], <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>##       Gb1      Gb10      Gb11      Gb12      Gb13      Gb14       Gb2       Gb3       Gb4       Gb5       Gb6       Gb7       Gb8       Gb9 
## 0.4679053 0.4411581 0.4345952 0.4582772 0.4704101 0.4945428 0.3999313 0.4571735 0.4597044 0.4270513 0.4573897 0.4399143 0.4510839 0.4368421</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="microbiota.html#cb149-1"></a>q &lt;-<span class="st"> </span><span class="kw">apply</span>(changes[, <span class="dv">6</span><span class="op">:</span><span class="dv">19</span>], <span class="dv">2</span>, sum)</span>
<span id="cb149-2"><a href="microbiota.html#cb149-2"></a></span>
<span id="cb149-3"><a href="microbiota.html#cb149-3"></a>resp_subset &lt;-<span class="st"> </span>response<span class="op">$</span>sf</span>
<span id="cb149-4"><a href="microbiota.html#cb149-4"></a>resp_subset &lt;-<span class="st"> </span>resp_subset[resp_subset<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span> <span class="op">|</span><span class="st"> </span>resp_subset<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb149-5"><a href="microbiota.html#cb149-5"></a>rabdc<span class="op">$</span>sf[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc<span class="op">$</span>sf)</span>
<span id="cb149-6"><a href="microbiota.html#cb149-6"></a>changes &lt;-<span class="st"> </span><span class="kw">left_join</span>(resp_subset, rabdc<span class="op">$</span>sf)</span>
<span id="cb149-7"><a href="microbiota.html#cb149-7"></a><span class="kw">apply</span>(changes[, <span class="dv">6</span><span class="op">:</span><span class="dv">20</span>], <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>##       Sf1      Sf10      Sf11      Sf12      Sf13      Sf14      Sf15       Sf2       Sf3       Sf4       Sf5       Sf6       Sf7       Sf8       Sf9 
## 0.2000647 0.2239502 0.2180442 0.2386535 0.2624164 0.2961391 0.2657806 0.2339318 0.1792833 0.1874675 0.1782178 0.1864880 0.1414710 0.1749049 0.1950652</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="microbiota.html#cb151-1"></a>w &lt;-<span class="st"> </span><span class="kw">apply</span>(changes[, <span class="dv">6</span><span class="op">:</span><span class="dv">20</span>], <span class="dv">2</span>, sum)</span>
<span id="cb151-2"><a href="microbiota.html#cb151-2"></a></span>
<span id="cb151-3"><a href="microbiota.html#cb151-3"></a>resp_subset &lt;-<span class="st"> </span>response<span class="op">$</span>wb</span>
<span id="cb151-4"><a href="microbiota.html#cb151-4"></a>resp_subset &lt;-<span class="st"> </span>resp_subset[resp_subset<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span> <span class="op">|</span><span class="st"> </span>resp_subset<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>, ]</span>
<span id="cb151-5"><a href="microbiota.html#cb151-5"></a>rabdc<span class="op">$</span>wb[<span class="st">&quot;XOTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(rabdc<span class="op">$</span>wb)</span>
<span id="cb151-6"><a href="microbiota.html#cb151-6"></a>changes &lt;-<span class="st"> </span><span class="kw">left_join</span>(resp_subset, rabdc<span class="op">$</span>wb)</span>
<span id="cb151-7"><a href="microbiota.html#cb151-7"></a><span class="kw">apply</span>(changes[, <span class="dv">6</span><span class="op">:</span><span class="dv">21</span>], <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>##        Wb1       Wb10       Wb11       Wb12       Wb13       Wb14       Wb15       Wb16        Wb2        Wb3        Wb4        Wb5        Wb6        Wb7        Wb8        Wb9 
## 0.28250794 0.08677336 0.10016788 0.10674218 0.10963458 0.15246853 0.14389634 0.21255564 0.23991810 0.15771368 0.12690033 0.12182423 0.09622011 0.06991101 0.04877248 0.10178304</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="microbiota.html#cb153-1"></a>e &lt;-<span class="st"> </span><span class="kw">apply</span>(changes[, <span class="dv">6</span><span class="op">:</span><span class="dv">21</span>], <span class="dv">2</span>, sum)</span></code></pre></div>
<p>It turns out they contribute substantially: in <em>G. barretti</em> mean 0.45 (0.023 SD), in <em>S. fortis</em> mean 0.212 (0.042 SD), in <em>W. bursa</em> mean 0.135 (0.063 SD).</p>
<p>In Fig.<a href="microbiota.html#fig:increade-decrease">3.12</a> as well as in Tab. <a href="microbiota.html#tab:increade-decrease">3.4</a>, we see that at the OTU level, we observe shifts. While sometimes more gradual, there seem to OTUs exclusively present in the â€œshallowâ€ or the â€œdeepâ€ samples in all three sponges. In fact, in <em>G. barretti</em> and <em>S. fortis</em>, the number of OTUs increasing with depth (â€œdeep water mass microbiomeâ€) is greater than the number of OTUs decreasing. This leads us to believe that the deep water mass contains microbes yet to discover. The OTUs increasing and decreasing also represent substantial parts of the three sponge microbiota.</p>
</div>
<div id="sequence-similarity" class="section level2">
<h2><span class="header-section-number">3.7</span> Sequence similarity</h2>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="microbiota.html#cb154-1"></a><span class="kw">library</span>(seqinr)</span>
<span id="cb154-2"><a href="microbiota.html#cb154-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb154-3"><a href="microbiota.html#cb154-3"></a></span>
<span id="cb154-4"><a href="microbiota.html#cb154-4"></a><span class="co"># fasta files generation</span></span>
<span id="cb154-5"><a href="microbiota.html#cb154-5"></a>micro &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/OTU_all_R.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb154-6"><a href="microbiota.html#cb154-6"></a>fastas &lt;-<span class="st"> </span><span class="kw">read.fasta</span>(<span class="st">&quot;data/all_otus_artic_691.fasta&quot;</span>)</span>
<span id="cb154-7"><a href="microbiota.html#cb154-7"></a></span>
<span id="cb154-8"><a href="microbiota.html#cb154-8"></a>split_fastas &lt;-<span class="st"> </span><span class="cf">function</span>(micro, fastas) {</span>
<span id="cb154-9"><a href="microbiota.html#cb154-9"></a>    <span class="kw">rownames</span>(micro) &lt;-<span class="st"> </span>micro<span class="op">$</span>Sample_ID</span>
<span id="cb154-10"><a href="microbiota.html#cb154-10"></a>    micro<span class="op">$</span>Sample_ID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb154-11"><a href="microbiota.html#cb154-11"></a>    </span>
<span id="cb154-12"><a href="microbiota.html#cb154-12"></a>    micro_gb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>), ]</span>
<span id="cb154-13"><a href="microbiota.html#cb154-13"></a>    micro_sf &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>), ]</span>
<span id="cb154-14"><a href="microbiota.html#cb154-14"></a>    micro_wb &lt;-<span class="st"> </span>micro[(<span class="kw">str_sub</span>(<span class="kw">rownames</span>(micro), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>), ]</span>
<span id="cb154-15"><a href="microbiota.html#cb154-15"></a>    </span>
<span id="cb154-16"><a href="microbiota.html#cb154-16"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb154-17"><a href="microbiota.html#cb154-17"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb154-18"><a href="microbiota.html#cb154-18"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb154-19"><a href="microbiota.html#cb154-19"></a>    </span>
<span id="cb154-20"><a href="microbiota.html#cb154-20"></a>    micro_gb &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_gb))</span>
<span id="cb154-21"><a href="microbiota.html#cb154-21"></a>    micro_sf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_sf))</span>
<span id="cb154-22"><a href="microbiota.html#cb154-22"></a>    micro_wb &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colnames</span>(micro_wb))</span>
<span id="cb154-23"><a href="microbiota.html#cb154-23"></a>    </span>
<span id="cb154-24"><a href="microbiota.html#cb154-24"></a>    <span class="kw">colnames</span>(micro_gb) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb154-25"><a href="microbiota.html#cb154-25"></a>    <span class="kw">colnames</span>(micro_sf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb154-26"><a href="microbiota.html#cb154-26"></a>    <span class="kw">colnames</span>(micro_wb) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>)</span>
<span id="cb154-27"><a href="microbiota.html#cb154-27"></a>    </span>
<span id="cb154-28"><a href="microbiota.html#cb154-28"></a>    micro_gb[<span class="st">&quot;OTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(micro_gb<span class="op">$</span>XOTU, <span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb154-29"><a href="microbiota.html#cb154-29"></a>    micro_sf[<span class="st">&quot;OTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(micro_sf<span class="op">$</span>XOTU, <span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb154-30"><a href="microbiota.html#cb154-30"></a>    micro_wb[<span class="st">&quot;OTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(micro_wb<span class="op">$</span>XOTU, <span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb154-31"><a href="microbiota.html#cb154-31"></a>    </span>
<span id="cb154-32"><a href="microbiota.html#cb154-32"></a>    gb_fastas &lt;-<span class="st"> </span>fastas[<span class="kw">names</span>(fastas) <span class="op">%in%</span><span class="st"> </span>micro_gb<span class="op">$</span>OTU]</span>
<span id="cb154-33"><a href="microbiota.html#cb154-33"></a>    sf_fastas &lt;-<span class="st"> </span>fastas[<span class="kw">names</span>(fastas) <span class="op">%in%</span><span class="st"> </span>micro_sf<span class="op">$</span>OTU]</span>
<span id="cb154-34"><a href="microbiota.html#cb154-34"></a>    wb_fastas &lt;-<span class="st"> </span>fastas[<span class="kw">names</span>(fastas) <span class="op">%in%</span><span class="st"> </span>micro_wb<span class="op">$</span>OTU]</span>
<span id="cb154-35"><a href="microbiota.html#cb154-35"></a>    </span>
<span id="cb154-36"><a href="microbiota.html#cb154-36"></a>    fasta_sets &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> gb_fastas, <span class="dt">sf =</span> sf_fastas, <span class="dt">wb =</span> wb_fastas)</span>
<span id="cb154-37"><a href="microbiota.html#cb154-37"></a>    <span class="kw">return</span>(fasta_sets)</span>
<span id="cb154-38"><a href="microbiota.html#cb154-38"></a>}</span>
<span id="cb154-39"><a href="microbiota.html#cb154-39"></a></span>
<span id="cb154-40"><a href="microbiota.html#cb154-40"></a>fasta_sets &lt;-<span class="st"> </span><span class="kw">split_fastas</span>(micro, fastas)</span>
<span id="cb154-41"><a href="microbiota.html#cb154-41"></a></span>
<span id="cb154-42"><a href="microbiota.html#cb154-42"></a><span class="kw">write.fasta</span>(<span class="dt">sequences =</span> fasta_sets<span class="op">$</span>gb, <span class="dt">names =</span> <span class="kw">names</span>(fasta_sets<span class="op">$</span>gb), <span class="dt">file.out =</span> <span class="st">&quot;data/gb_OTU_seqs.fasta&quot;</span>)</span>
<span id="cb154-43"><a href="microbiota.html#cb154-43"></a><span class="kw">write.fasta</span>(<span class="dt">sequences =</span> fasta_sets<span class="op">$</span>sf, <span class="dt">names =</span> <span class="kw">names</span>(fasta_sets<span class="op">$</span>sf), <span class="dt">file.out =</span> <span class="st">&quot;data/sf_OTU_seqs.fasta&quot;</span>)</span>
<span id="cb154-44"><a href="microbiota.html#cb154-44"></a><span class="kw">write.fasta</span>(<span class="dt">sequences =</span> fasta_sets<span class="op">$</span>wb, <span class="dt">names =</span> <span class="kw">names</span>(fasta_sets<span class="op">$</span>wb), <span class="dt">file.out =</span> <span class="st">&quot;data/wb_OTU_seqs.fasta&quot;</span>)</span>
<span id="cb154-45"><a href="microbiota.html#cb154-45"></a></span>
<span id="cb154-46"><a href="microbiota.html#cb154-46"></a><span class="kw">rm</span>(fatsta_sets, micro, fastas)</span></code></pre></div>
<p>We produced fasta files, i.e.Â files containing the DNA sequences of the OTUs in the three sponges. The fasta sequences were aligned with <a href="https://mafft.cbrc.jp/alignment/server/">MAFFT</a>. From the aligned seqeunces, we calculated the sequence similarity comparing all versus all, and retain in a file all comparisons yielding a sequence similarity <span class="math inline">\(\geq\)</span> 97%.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="microbiota.html#cb155-1"></a><span class="co"># Load one set of files at a time</span></span>
<span id="cb155-2"><a href="microbiota.html#cb155-2"></a>ali &lt;-<span class="st"> </span><span class="kw">read.alignment</span>(<span class="st">&quot;data/gb_reads_for_phylogeny_MAFFT.fasta&quot;</span>, <span class="st">&quot;fasta&quot;</span>)</span>
<span id="cb155-3"><a href="microbiota.html#cb155-3"></a>anno &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_OTUs_overall_rabdc_annotated.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb155-4"><a href="microbiota.html#cb155-4"></a></span>
<span id="cb155-5"><a href="microbiota.html#cb155-5"></a><span class="co"># ali &lt;- read.alignment(&#39;data/sf_reads_for_phylogeny_MAFFT.fasta&#39;, &#39;fasta&#39;) anno &lt;- read.csv(&#39;data/sf_OTUs_overall_rabdc_annotated.csv&#39;, header=T, sep=&#39;,&#39;)</span></span>
<span id="cb155-6"><a href="microbiota.html#cb155-6"></a></span>
<span id="cb155-7"><a href="microbiota.html#cb155-7"></a><span class="co"># ali &lt;- read.alignment(&#39;data/wb_reads_for_phylogeny_MAFFT.fasta&#39;, &#39;fasta&#39;) anno &lt;- read.csv(&#39;data/wb_OTUs_overall_rabdc_annotated.csv&#39;, header=T, sep=&#39;,&#39;)</span></span>
<span id="cb155-8"><a href="microbiota.html#cb155-8"></a></span>
<span id="cb155-9"><a href="microbiota.html#cb155-9"></a></span>
<span id="cb155-10"><a href="microbiota.html#cb155-10"></a><span class="co"># FUN calculate pairwise distance, melt, keeps only entries with &gt;97% and &lt;1 similarity with significant opposing trends in both partners.</span></span>
<span id="cb155-11"><a href="microbiota.html#cb155-11"></a>pw_dist &lt;-<span class="st"> </span><span class="cf">function</span>(ali, anno) {</span>
<span id="cb155-12"><a href="microbiota.html#cb155-12"></a>    dist &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist.alignment</span>(ali, <span class="dt">matrix =</span> <span class="st">&quot;similarity&quot;</span>))  <span class="co">#https://www.researchgate.net/post/Homology_similarity_and_identity-can_anyone_help_with_these_terms</span></span>
<span id="cb155-13"><a href="microbiota.html#cb155-13"></a>    <span class="co"># dist.alignment: matrix contains the squared root of the pairwise distances. For example, if identity between 2 sequences is 80 the squared root of (1.0 - 0.8) i.e. 0.4472136.</span></span>
<span id="cb155-14"><a href="microbiota.html#cb155-14"></a>    dist &lt;-<span class="st"> </span>dist<span class="op">^</span><span class="dv">2</span></span>
<span id="cb155-15"><a href="microbiota.html#cb155-15"></a>    dist &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>dist</span>
<span id="cb155-16"><a href="microbiota.html#cb155-16"></a>    <span class="co"># dist is now &#39;%&#39; identity, 1=100 %</span></span>
<span id="cb155-17"><a href="microbiota.html#cb155-17"></a>    dist &lt;-<span class="st"> </span><span class="kw">melt</span>(dist)</span>
<span id="cb155-18"><a href="microbiota.html#cb155-18"></a>    <span class="co"># Remove irrelevant entries, i.e. self-comparison and similarities below the threshold, this step now speeds up later steps, but not mandatory</span></span>
<span id="cb155-19"><a href="microbiota.html#cb155-19"></a>    dist &lt;-<span class="st"> </span>dist[dist<span class="op">$</span>value <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.97</span>, ]</span>
<span id="cb155-20"><a href="microbiota.html#cb155-20"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>value <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ]</span>
<span id="cb155-21"><a href="microbiota.html#cb155-21"></a>    </span>
<span id="cb155-22"><a href="microbiota.html#cb155-22"></a>    <span class="co"># This removes AB - BA duplicates</span></span>
<span id="cb155-23"><a href="microbiota.html#cb155-23"></a>    cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Var1&quot;</span>, <span class="st">&quot;Var2&quot;</span>)</span>
<span id="cb155-24"><a href="microbiota.html#cb155-24"></a>    newdf &lt;-<span class="st"> </span>dist[, cols]</span>
<span id="cb155-25"><a href="microbiota.html#cb155-25"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(newdf)) {</span>
<span id="cb155-26"><a href="microbiota.html#cb155-26"></a>        newdf[i, ] =<span class="st"> </span><span class="kw">sort</span>(newdf[i, cols])</span>
<span id="cb155-27"><a href="microbiota.html#cb155-27"></a>    }</span>
<span id="cb155-28"><a href="microbiota.html#cb155-28"></a>    newdf &lt;-<span class="st"> </span>newdf[<span class="op">!</span><span class="kw">duplicated</span>(newdf), ]</span>
<span id="cb155-29"><a href="microbiota.html#cb155-29"></a>    </span>
<span id="cb155-30"><a href="microbiota.html#cb155-30"></a>    <span class="co"># add back similarity values to the remaining comparisons/pairs</span></span>
<span id="cb155-31"><a href="microbiota.html#cb155-31"></a>    dist &lt;-<span class="st"> </span><span class="kw">left_join</span>(newdf, dist, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">Var1 =</span> <span class="st">&quot;Var1&quot;</span>, <span class="dt">Var2 =</span> <span class="st">&quot;Var2&quot;</span>))</span>
<span id="cb155-32"><a href="microbiota.html#cb155-32"></a>    </span>
<span id="cb155-33"><a href="microbiota.html#cb155-33"></a>    <span class="co"># annotate OTUs</span></span>
<span id="cb155-34"><a href="microbiota.html#cb155-34"></a>    anno[<span class="st">&quot;OTU_num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(anno<span class="op">$</span>XOTU, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb155-35"><a href="microbiota.html#cb155-35"></a>    anno &lt;-<span class="st"> </span>anno[, <span class="kw">c</span>(<span class="st">&quot;OTU_num&quot;</span>, <span class="st">&quot;shallow_mean&quot;</span>, <span class="st">&quot;deep_mean&quot;</span>, <span class="st">&quot;ttest_pval&quot;</span>, <span class="st">&quot;ttest_fdr&quot;</span>)]</span>
<span id="cb155-36"><a href="microbiota.html#cb155-36"></a>    anno[<span class="st">&quot;cat&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;none&quot;</span>)</span>
<span id="cb155-37"><a href="microbiota.html#cb155-37"></a>    anno<span class="op">$</span>cat[anno<span class="op">$</span>ttest_fdr <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st"> </span>anno<span class="op">$</span>shallow_mean <span class="op">&gt;</span><span class="st"> </span>anno<span class="op">$</span>deep_mean] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;shallow&quot;</span>)  <span class="co"># can be set to &#39;ttest_pval&#39; instead</span></span>
<span id="cb155-38"><a href="microbiota.html#cb155-38"></a>    anno<span class="op">$</span>cat[anno<span class="op">$</span>ttest_fdr <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st"> </span>anno<span class="op">$</span>shallow_mean <span class="op">&lt;</span><span class="st"> </span>anno<span class="op">$</span>deep_mean] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;deep&quot;</span>)  <span class="co"># can be set to &#39;ttest_pval&#39; instead</span></span>
<span id="cb155-39"><a href="microbiota.html#cb155-39"></a>    anno &lt;-<span class="st"> </span>anno[, <span class="kw">c</span>(<span class="st">&quot;OTU_num&quot;</span>, <span class="st">&quot;cat&quot;</span>)]</span>
<span id="cb155-40"><a href="microbiota.html#cb155-40"></a>    anno<span class="op">$</span>OTU_num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(anno<span class="op">$</span>OTU_num)</span>
<span id="cb155-41"><a href="microbiota.html#cb155-41"></a>    <span class="kw">colnames</span>(anno) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Var1&quot;</span>, <span class="st">&quot;Var1_cat&quot;</span>)</span>
<span id="cb155-42"><a href="microbiota.html#cb155-42"></a>    dist &lt;-<span class="st"> </span><span class="kw">left_join</span>(dist, anno)</span>
<span id="cb155-43"><a href="microbiota.html#cb155-43"></a>    <span class="kw">colnames</span>(anno) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Var2&quot;</span>, <span class="st">&quot;Var2_cat&quot;</span>)</span>
<span id="cb155-44"><a href="microbiota.html#cb155-44"></a>    dist &lt;-<span class="st"> </span><span class="kw">left_join</span>(dist, anno)</span>
<span id="cb155-45"><a href="microbiota.html#cb155-45"></a>    </span>
<span id="cb155-46"><a href="microbiota.html#cb155-46"></a>    <span class="co"># remove not significant comparisons</span></span>
<span id="cb155-47"><a href="microbiota.html#cb155-47"></a>    dist &lt;-<span class="st"> </span>dist[<span class="op">!</span>dist<span class="op">$</span>Var1_cat <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>dist<span class="op">$</span>Var2_cat <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>dist<span class="op">$</span>Var1_cat <span class="op">==</span><span class="st"> </span>dist<span class="op">$</span>Var2_cat, ]</span>
<span id="cb155-48"><a href="microbiota.html#cb155-48"></a>    <span class="co"># order</span></span>
<span id="cb155-49"><a href="microbiota.html#cb155-49"></a>    dist &lt;-<span class="st"> </span>dist[<span class="kw">order</span>(dist<span class="op">$</span>Var1_cat, dist<span class="op">$</span>Var2_cat), ]</span>
<span id="cb155-50"><a href="microbiota.html#cb155-50"></a>    <span class="kw">return</span>(dist)</span>
<span id="cb155-51"><a href="microbiota.html#cb155-51"></a>}</span>
<span id="cb155-52"><a href="microbiota.html#cb155-52"></a></span>
<span id="cb155-53"><a href="microbiota.html#cb155-53"></a>dist &lt;-<span class="st"> </span><span class="kw">pw_dist</span>(ali, anno)</span>
<span id="cb155-54"><a href="microbiota.html#cb155-54"></a></span>
<span id="cb155-55"><a href="microbiota.html#cb155-55"></a><span class="co"># create csv file write.csv(dist, &#39;data/gb_similarity.csv&#39;, row.names = F) # GB write.csv(dist, &#39;data/sf_similarity.csv&#39;, row.names = F) # SF In W. bursa, none of the OTUs are</span></span>
<span id="cb155-56"><a href="microbiota.html#cb155-56"></a><span class="co"># different (ttest_fdr &lt; 0.05) comparing shallow and deep specimens</span></span>
<span id="cb155-57"><a href="microbiota.html#cb155-57"></a><span class="kw">rm</span>(ali, anno, dist)</span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="microbiota.html#cb156-1"></a><span class="co"># Sister OTUs / Ecotypes</span></span>
<span id="cb156-2"><a href="microbiota.html#cb156-2"></a>dist_gb &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_similarity.csv&quot;</span>)</span>
<span id="cb156-3"><a href="microbiota.html#cb156-3"></a>dist_gb<span class="op">$</span>Var1 &lt;-<span class="st"> </span><span class="kw">str_replace</span>(dist_gb<span class="op">$</span>Var1, <span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb156-4"><a href="microbiota.html#cb156-4"></a>dist_gb<span class="op">$</span>Var2 &lt;-<span class="st"> </span><span class="kw">str_replace</span>(dist_gb<span class="op">$</span>Var2, <span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb156-5"><a href="microbiota.html#cb156-5"></a><span class="kw">colnames</span>(dist_gb) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU1&quot;</span>, <span class="st">&quot;OTU2&quot;</span>, <span class="st">&quot;sequence similarity&quot;</span>, <span class="st">&quot;category OTU1&quot;</span>, <span class="st">&quot;category OTU2&quot;</span>)</span>
<span id="cb156-6"><a href="microbiota.html#cb156-6"></a>dist_gb</span></code></pre></div>
<pre><code>##         OTU1      OTU2 sequence similarity category OTU1 category OTU2
## 1  196900323 196900418           0.9857143          deep       shallow
## 2  196900236 196900310           0.9714286          deep       shallow
## 3  196900280 196900363           0.9928571          deep       shallow
## 4  196900231 196900367           0.9928571       shallow          deep
## 5  196900589 196900596           0.9928571       shallow          deep
## 6  196900192 196900527           0.9857143       shallow          deep
## 7  196900144 196900578           0.9714286       shallow          deep
## 8  196900144 196900337           0.9928571       shallow          deep
## 9  196900253 196900445           0.9928571       shallow          deep
## 10 196900208 196900323           0.9857143       shallow          deep
## 11 196900418 196900546           0.9714286       shallow          deep
## 12 196900196 196900236           0.9928571       shallow          deep
## 13 196900180 196900236           0.9785714       shallow          deep
## 14 196900284 196900658           0.9928571       shallow          deep
## 15 196900363 196900384           0.9857143       shallow          deep
## 16 196900213 196900242           0.9928571       shallow          deep
## 17 196900161 196900242           0.9857143       shallow          deep
## 18 196900307 196900537           0.9785714       shallow          deep
## 19 196900331 196900528           0.9857143       shallow          deep</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="microbiota.html#cb158-1"></a>dist_sf &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/sf_similarity.csv&quot;</span>)</span>
<span id="cb158-2"><a href="microbiota.html#cb158-2"></a>dist_sf<span class="op">$</span>Var1 &lt;-<span class="st"> </span><span class="kw">str_replace</span>(dist_sf<span class="op">$</span>Var1, <span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb158-3"><a href="microbiota.html#cb158-3"></a>dist_sf<span class="op">$</span>Var2 &lt;-<span class="st"> </span><span class="kw">str_replace</span>(dist_sf<span class="op">$</span>Var2, <span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb158-4"><a href="microbiota.html#cb158-4"></a><span class="kw">colnames</span>(dist_sf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU1&quot;</span>, <span class="st">&quot;OTU2&quot;</span>, <span class="st">&quot;sequence similarity&quot;</span>, <span class="st">&quot;category OTU1&quot;</span>, <span class="st">&quot;category OTU2&quot;</span>)</span>
<span id="cb158-5"><a href="microbiota.html#cb158-5"></a>dist_sf</span></code></pre></div>
<pre><code>##        OTU1      OTU2 sequence similarity category OTU1 category OTU2
## 1 196900137 196900337           0.9785714       shallow          deep
## 2 196900137 196900498           0.9714286       shallow          deep</code></pre>
<p>In the <em>G. barretti</em> prokaryotic community, there are 19 pairs of OTUs with a sequence similarity <span class="math inline">\(\geq\)</span> 97% and difference in abundance above/below 1000 m (<em>p</em> <sub>FDR</sub> <span class="math inline">\(\leq\)</span> 0.05). In the <em>S. fortis</em> prokaryotic community, there are 2 pairs of OTUs with a sequence similarity <span class="math inline">\(\geq\)</span> 97% and difference in abundance above/below 1000 m (<em>p</em> <sub>FDR</sub> <span class="math inline">\(\leq\)</span> 0.05). In the <em>W. bursa</em> prokaryotic community, none of the members have a significant different abundance in the two water masses.
We interpret these instances as ecotypes, that is, sister OTUs (closely related OTUs) adapted/affiliated to the two different water masses.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="microbiota.html#cb160-1"></a><span class="co">### For Ecotype/ sister OTU discussion</span></span>
<span id="cb160-2"><a href="microbiota.html#cb160-2"></a>gb_OTUs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_OTUs_overall_rabdc_annotated.csv&quot;</span>, <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb160-3"><a href="microbiota.html#cb160-3"></a>sf_OTUs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/sf_OTUs_overall_rabdc_annotated.csv&quot;</span>, <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb160-4"><a href="microbiota.html#cb160-4"></a></span>
<span id="cb160-5"><a href="microbiota.html#cb160-5"></a><span class="kw">rownames</span>(gb_OTUs) &lt;-<span class="st"> </span>gb_OTUs<span class="op">$</span>XOTU</span>
<span id="cb160-6"><a href="microbiota.html#cb160-6"></a>gb_OTUs[<span class="st">&quot;OTU_num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(gb_OTUs<span class="op">$</span>XOTU,<span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb160-7"><a href="microbiota.html#cb160-7"></a></span>
<span id="cb160-8"><a href="microbiota.html#cb160-8"></a><span class="kw">rownames</span>(sf_OTUs) &lt;-<span class="st"> </span>sf_OTUs<span class="op">$</span>XOTU</span>
<span id="cb160-9"><a href="microbiota.html#cb160-9"></a>sf_OTUs[<span class="st">&quot;OTU_num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(sf_OTUs<span class="op">$</span>XOTU,<span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb160-10"><a href="microbiota.html#cb160-10"></a></span>
<span id="cb160-11"><a href="microbiota.html#cb160-11"></a><span class="co">#gb_sis &lt;- read.csv(&quot;data/gb_similarity.csv&quot;, header = T, sep=&quot;,&quot;)</span></span>
<span id="cb160-12"><a href="microbiota.html#cb160-12"></a><span class="co">#sf_sis &lt;- read.csv(&quot;data/sf_similarity.csv&quot;, header = T, sep=&quot;,&quot;)</span></span>
<span id="cb160-13"><a href="microbiota.html#cb160-13"></a><span class="co">#unique(c(gb_sis$Var1, gb_sis$Var2)) %&gt;%</span></span>
<span id="cb160-14"><a href="microbiota.html#cb160-14"></a><span class="co">#  str_replace(&quot;196900&quot;,&quot;&quot;)  # 31 OTUs: &quot;323&quot; &quot;236&quot; &quot;280&quot; &quot;231&quot; &quot;589&quot; &quot;192&quot; &quot;144&quot; &quot;253&quot; &quot;208&quot; &quot;418&quot; &quot;196&quot; &quot;180&quot; &quot;284&quot; &quot;363&quot; &quot;213&quot; &quot;161&quot; &quot;307&quot; &quot;331&quot; &quot;310&quot; &quot;367&quot; #&quot;596&quot; &quot;527&quot; &quot;578&quot; &quot;337&quot; &quot;445&quot; &quot;546&quot; &quot;658&quot; &quot;384&quot; &quot;242&quot; &quot;537&quot; &quot;528&quot;</span></span>
<span id="cb160-15"><a href="microbiota.html#cb160-15"></a><span class="co">#unique(c(sf_sis$Var1, sf_sis$Var2)) %&gt;%</span></span>
<span id="cb160-16"><a href="microbiota.html#cb160-16"></a><span class="co">#  str_replace(&quot;196900&quot;,&quot;&quot;) # 3 OTUs: &quot;137&quot; &quot;337&quot; &quot;498&quot;</span></span>
<span id="cb160-17"><a href="microbiota.html#cb160-17"></a></span>
<span id="cb160-18"><a href="microbiota.html#cb160-18"></a>gb_sis &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_similarity.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb160-19"><a href="microbiota.html#cb160-19"></a>gb_sis<span class="op">$</span>Var1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">str_replace</span>(gb_sis<span class="op">$</span>Var1, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb160-20"><a href="microbiota.html#cb160-20"></a>gb_sis<span class="op">$</span>Var2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">str_replace</span>(gb_sis<span class="op">$</span>Var2, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb160-21"><a href="microbiota.html#cb160-21"></a>OTU_num_gb &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">unique</span>(<span class="kw">c</span>(gb_sis<span class="op">$</span>Var1, gb_sis<span class="op">$</span>Var2)))</span>
<span id="cb160-22"><a href="microbiota.html#cb160-22"></a><span class="kw">colnames</span>(OTU_num_gb) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sis&quot;</span>)</span>
<span id="cb160-23"><a href="microbiota.html#cb160-23"></a>OTU_num_gb[<span class="st">&quot;sis_gb&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gb&quot;</span>)</span>
<span id="cb160-24"><a href="microbiota.html#cb160-24"></a>gb_sis<span class="op">$</span>X &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb160-25"><a href="microbiota.html#cb160-25"></a></span>
<span id="cb160-26"><a href="microbiota.html#cb160-26"></a>sf_sis &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/sf_similarity.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb160-27"><a href="microbiota.html#cb160-27"></a>sf_sis<span class="op">$</span>Var1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">str_replace</span>(sf_sis<span class="op">$</span>Var1, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb160-28"><a href="microbiota.html#cb160-28"></a>sf_sis<span class="op">$</span>Var2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">str_replace</span>(sf_sis<span class="op">$</span>Var2, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb160-29"><a href="microbiota.html#cb160-29"></a>OTU_num_sf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">unique</span>(<span class="kw">c</span>(sf_sis<span class="op">$</span>Var1, sf_sis<span class="op">$</span>Var2)))</span>
<span id="cb160-30"><a href="microbiota.html#cb160-30"></a><span class="kw">colnames</span>(OTU_num_sf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sis&quot;</span>)</span>
<span id="cb160-31"><a href="microbiota.html#cb160-31"></a>OTU_num_sf[<span class="st">&quot;sis_sf&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb160-32"><a href="microbiota.html#cb160-32"></a>sf_sis<span class="op">$</span>X &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb160-33"><a href="microbiota.html#cb160-33"></a></span>
<span id="cb160-34"><a href="microbiota.html#cb160-34"></a>sisters &lt;-<span class="st"> </span><span class="kw">full_join</span>(OTU_num_gb, OTU_num_sf)</span>
<span id="cb160-35"><a href="microbiota.html#cb160-35"></a>sisters[<span class="st">&quot;combined&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>)</span>
<span id="cb160-36"><a href="microbiota.html#cb160-36"></a>sisters<span class="op">$</span>combined[<span class="kw">is.na</span>(sisters<span class="op">$</span>sis_sf)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gb&quot;</span>)</span>
<span id="cb160-37"><a href="microbiota.html#cb160-37"></a>sisters<span class="op">$</span>combined[<span class="kw">is.na</span>(sisters<span class="op">$</span>sis_gb)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb160-38"><a href="microbiota.html#cb160-38"></a></span>
<span id="cb160-39"><a href="microbiota.html#cb160-39"></a>gb_sis &lt;-<span class="st"> </span><span class="kw">left_join</span>(sisters, gb_OTUs, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;sis&quot;</span>=<span class="st">&quot;OTU_num&quot;</span>))</span>
<span id="cb160-40"><a href="microbiota.html#cb160-40"></a>gb_sis_m &lt;-<span class="st"> </span>gb_sis <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#instead of reshape2::melt</span></span>
<span id="cb160-41"><a href="microbiota.html#cb160-41"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb160-42"><a href="microbiota.html#cb160-42"></a>    <span class="dt">col=</span><span class="kw">starts_with</span>(<span class="st">&quot;Gb&quot;</span>)</span>
<span id="cb160-43"><a href="microbiota.html#cb160-43"></a>  )</span>
<span id="cb160-44"><a href="microbiota.html#cb160-44"></a></span>
<span id="cb160-45"><a href="microbiota.html#cb160-45"></a>gb_sis_m[<span class="st">&quot;order&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace</span>(gb_sis_m<span class="op">$</span>name, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb160-46"><a href="microbiota.html#cb160-46"></a><span class="kw">ggplot</span>(gb_sis_m, <span class="kw">aes</span>(<span class="dt">x=</span>order, <span class="dt">y=</span>value, <span class="dt">col=</span>combined))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">facet_wrap</span>(<span class="op">~</span>sis, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">4</span>)<span class="op">+</span><span class="kw">ggtitle</span>(<span class="st">&quot;Gb sister OTUs&quot;</span>)<span class="op">+</span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">10.5</span>)<span class="op">+</span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:sisterOTU-viz1"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/sisterOTU-viz-1.png" alt="Relative abundance of all sister OTUs shown for _G. barretti_ and _S.fortis_. " width="672" />
<p class="caption">
Figure 3.13: Relative abundance of all sister OTUs shown for <em>G. barretti</em> and <em>S.fortis</em>.
</p>
</div>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="microbiota.html#cb161-1"></a>sf_sis &lt;-<span class="st"> </span><span class="kw">left_join</span>(sisters, sf_OTUs, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;sis&quot;</span>=<span class="st">&quot;OTU_num&quot;</span>))</span>
<span id="cb161-2"><a href="microbiota.html#cb161-2"></a>sf_sis_m &lt;-<span class="st"> </span>sf_sis <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#instead of reshape2::melt</span></span>
<span id="cb161-3"><a href="microbiota.html#cb161-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb161-4"><a href="microbiota.html#cb161-4"></a>    <span class="dt">col=</span><span class="kw">starts_with</span>(<span class="st">&quot;Sf&quot;</span>)</span>
<span id="cb161-5"><a href="microbiota.html#cb161-5"></a>  )</span>
<span id="cb161-6"><a href="microbiota.html#cb161-6"></a></span>
<span id="cb161-7"><a href="microbiota.html#cb161-7"></a>sf_sis_m[<span class="st">&quot;order&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace</span>(sf_sis_m<span class="op">$</span>name, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb161-8"><a href="microbiota.html#cb161-8"></a><span class="kw">ggplot</span>(sf_sis_m, <span class="kw">aes</span>(<span class="dt">x=</span>order, <span class="dt">y=</span>value, <span class="dt">col=</span>combined))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">facet_wrap</span>(<span class="op">~</span>sis, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">4</span>)<span class="op">+</span><span class="kw">ggtitle</span>(<span class="st">&quot;Sf sister OTUs&quot;</span>)<span class="op">+</span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">8.5</span>)<span class="op">+</span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:sisterOTU-viz2"></span>
<img src="Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges_files/figure-html/sisterOTU-viz-2.png" alt="Relative abundance of all sister OTUs shown for _G. barretti_ and _S.fortis_. " width="672" />
<p class="caption">
Figure 3.14: Relative abundance of all sister OTUs shown for <em>G. barretti</em> and <em>S.fortis</em>.
</p>
</div>
<p>It is important to note that only the category â€œbothâ€ and the respective sponge host (gb or sf) are relevant for each plot. The OTUs classified as sister OTUs in the other sponge are added for comparison only. This is meant to allow comparison as an OTU might be increasing in one sponge and decreasing in the other as it occurrs e.g.Â in OTU192 and potentially also OTU208. It also illustrates the difficulties of adequately assigning and testing for ecotypes.
Which of these OTUs make up the pairs of correspnding ecotypes is displayed in the tables below for <em>G. barretti</em> and <em>S. fortis</em> respectively.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="microbiota.html#cb162-1"></a><span class="co">### ====================== Taxonomy table ================================</span></span>
<span id="cb162-2"><a href="microbiota.html#cb162-2"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb162-3"><a href="microbiota.html#cb162-3"></a>taxonomy[<span class="st">&quot;OTU_num&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace</span>(taxonomy<span class="op">$</span>OTU_ID, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb162-4"><a href="microbiota.html#cb162-4"></a>taxonomy &lt;-<span class="st"> </span>taxonomy[, <span class="kw">c</span>(<span class="st">&quot;OTU_num&quot;</span>, <span class="st">&quot;Kingdom&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>)]</span>
<span id="cb162-5"><a href="microbiota.html#cb162-5"></a></span>
<span id="cb162-6"><a href="microbiota.html#cb162-6"></a>OTU_num_gb<span class="op">$</span>sis_gb &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb162-7"><a href="microbiota.html#cb162-7"></a><span class="kw">colnames</span>(OTU_num_gb) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU_num&quot;</span>)</span>
<span id="cb162-8"><a href="microbiota.html#cb162-8"></a>OTU_num_gb<span class="op">$</span>OTU_num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(OTU_num_gb<span class="op">$</span>OTU_num))</span>
<span id="cb162-9"><a href="microbiota.html#cb162-9"></a>gb_sis_tax &lt;-<span class="st"> </span><span class="kw">left_join</span>(OTU_num_gb, taxonomy)</span>
<span id="cb162-10"><a href="microbiota.html#cb162-10"></a>gb_sis_tax</span></code></pre></div>
<pre><code>##    OTU_num  Kingdom            Phylum                     Class
## 1      323 Bacteria     Acidobacteria                Subgroup_6
## 2      236 Bacteria    Proteobacteria                     JTB23
## 3      280 Bacteria  Gemmatimonadetes  BD2-11_terrestrial_group
## 4      231 Bacteria       Chloroflexi              SAR202_clade
## 5      589 Bacteria       Chloroflexi              SAR202_clade
## 6      192 Bacteria       Chloroflexi                      TK10
## 7      144 Bacteria     Acidobacteria                Subgroup_9
## 8      253 Bacteria     Acidobacteria               Subgroup_15
## 9      208 Bacteria     Acidobacteria                Subgroup_6
## 10     418 Bacteria     Acidobacteria                Subgroup_6
## 11     196 Bacteria    Proteobacteria                     JTB23
## 12     180 Bacteria    Proteobacteria                     JTB23
## 13     284 Bacteria     Acidobacteria               Subgroup_26
## 14     363 Bacteria  Gemmatimonadetes  BD2-11_terrestrial_group
## 15     213 Bacteria  Gemmatimonadetes  BD2-11_terrestrial_group
## 16     161 Bacteria  Gemmatimonadetes  BD2-11_terrestrial_group
## 17     307     &lt;NA&gt;                                            
## 18     331 Bacteria       Chloroflexi              Anaerolineae
## 19     310 Bacteria    Proteobacteria                     JTB23
## 20     367 Bacteria       Chloroflexi              SAR202_clade
## 21     596 Bacteria       Chloroflexi              SAR202_clade
## 22     527 Bacteria       Chloroflexi                      TK10
## 23     578 Bacteria     Acidobacteria                Subgroup_9
## 24     337 Bacteria     Acidobacteria                Subgroup_9
## 25     445 Bacteria     Acidobacteria               Subgroup_15
## 26     546 Bacteria     Acidobacteria                Subgroup_6
## 27     658 Bacteria     Acidobacteria               Subgroup_26
## 28     384 Bacteria  Gemmatimonadetes  BD2-11_terrestrial_group
## 29     242 Bacteria  Gemmatimonadetes  BD2-11_terrestrial_group
## 30     537     &lt;NA&gt;                                            
## 31     528 Bacteria       Chloroflexi              Anaerolineae</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="microbiota.html#cb164-1"></a>OTU_num_sf<span class="op">$</span>sis_sf &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb164-2"><a href="microbiota.html#cb164-2"></a><span class="kw">colnames</span>(OTU_num_sf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OTU_num&quot;</span>)</span>
<span id="cb164-3"><a href="microbiota.html#cb164-3"></a>OTU_num_sf<span class="op">$</span>OTU_num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(OTU_num_sf<span class="op">$</span>OTU_num))</span>
<span id="cb164-4"><a href="microbiota.html#cb164-4"></a>sf_sis_tax &lt;-<span class="st"> </span><span class="kw">left_join</span>(OTU_num_sf, taxonomy)</span>
<span id="cb164-5"><a href="microbiota.html#cb164-5"></a>sf_sis_tax</span></code></pre></div>
<pre><code>##   OTU_num  Kingdom         Phylum       Class
## 1     137 Bacteria  Acidobacteria  Subgroup_9
## 2     337 Bacteria  Acidobacteria  Subgroup_9
## 3     498 Bacteria  Acidobacteria  Subgroup_9</code></pre>
</div>
<div id="annotated-phylogeny" class="section level2">
<h2><span class="header-section-number">3.8</span> Annotated phylogeny</h2>
<p>To combinethe different categories and classifications with the OTUs, we annotated a maximum likelihood phylogeny with the depth response, SpongeEMP enrichment and barettin correlation. The tree can also be accessed at <a href="https://itol.embl.de/shared_projects.cgi">iTol</a> under iTOL login karin_steffen.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="microbiota.html#cb166-1"></a><span class="co"># $ grep &#39;&gt;&#39; gb_420_mafft.fasta | cut -d &#39; &#39; -f 1 | sed &#39;s/&gt;//g&#39; &gt; gb_420_mafft_OTU.csv</span></span>
<span id="cb166-2"><a href="microbiota.html#cb166-2"></a>leaves &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_420_mafft_OTU.csv&quot;</span>, <span class="dt">header =</span> F, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb166-3"><a href="microbiota.html#cb166-3"></a><span class="co"># leaves$V1[leaves$V1==4] &lt;- c(&#39;004&#39;) leaves$V1[leaves$V1==97] &lt;- c(&#39;097&#39;)</span></span>
<span id="cb166-4"><a href="microbiota.html#cb166-4"></a>leaves[<span class="st">&quot;labels&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;OTU&quot;</span>, leaves<span class="op">$</span>V1)</span>
<span id="cb166-5"><a href="microbiota.html#cb166-5"></a><span class="co"># Labels write.csv(leaves, &#39;data/leave_labels.csv&#39;, row.names = F) # Then open in text editor and select the apropriate separator, i.e. &#39;SEPARATOR COMMA&#39; followed by &#39;DATA&#39;</span></span>
<span id="cb166-6"><a href="microbiota.html#cb166-6"></a></span>
<span id="cb166-7"><a href="microbiota.html#cb166-7"></a><span class="co"># Color range</span></span>
<span id="cb166-8"><a href="microbiota.html#cb166-8"></a></span>
<span id="cb166-9"><a href="microbiota.html#cb166-9"></a>taxonomy &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microbiome_taxonomy.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb166-10"><a href="microbiota.html#cb166-10"></a>taxonomy[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(taxonomy, str_trim)</span>
<span id="cb166-11"><a href="microbiota.html#cb166-11"></a>taxonomy[<span class="st">&quot;labels&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(taxonomy<span class="op">$</span>OTU_ID, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;OTU&quot;</span>)</span>
<span id="cb166-12"><a href="microbiota.html#cb166-12"></a>taxonomy<span class="op">$</span>Phylum[taxonomy<span class="op">$</span>Phylum <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unclassified&quot;</span>)</span>
<span id="cb166-13"><a href="microbiota.html#cb166-13"></a>leaves &lt;-<span class="st"> </span><span class="kw">left_join</span>(leaves, taxonomy)</span>
<span id="cb166-14"><a href="microbiota.html#cb166-14"></a><span class="kw">unique</span>(leaves<span class="op">$</span>Phylum)</span>
<span id="cb166-15"><a href="microbiota.html#cb166-15"></a>phyla_cols &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/phyla-hex-colour.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb166-16"><a href="microbiota.html#cb166-16"></a>phyla_cols[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(phyla_cols, str_trim)</span>
<span id="cb166-17"><a href="microbiota.html#cb166-17"></a>leaves &lt;-<span class="st"> </span><span class="kw">left_join</span>(leaves, phyla_cols)</span>
<span id="cb166-18"><a href="microbiota.html#cb166-18"></a>leaves &lt;-<span class="st"> </span>leaves[, <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;hex&quot;</span>)]</span>
<span id="cb166-19"><a href="microbiota.html#cb166-19"></a>leaves[<span class="st">&quot;label&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb166-20"><a href="microbiota.html#cb166-20"></a>leaves &lt;-<span class="st"> </span>leaves[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)]</span>
<span id="cb166-21"><a href="microbiota.html#cb166-21"></a><span class="kw">head</span>(leaves)</span>
<span id="cb166-22"><a href="microbiota.html#cb166-22"></a><span class="co"># Label color write.csv(leaves, &#39;data/leave_label-color.csv&#39;, row.names = F) # Then open in text editor and select the apropriate separator, i.e. &#39;SEPARATOR COMMA&#39; followed by</span></span>
<span id="cb166-23"><a href="microbiota.html#cb166-23"></a><span class="co"># &#39;DATA&#39;</span></span>
<span id="cb166-24"><a href="microbiota.html#cb166-24"></a></span>
<span id="cb166-25"><a href="microbiota.html#cb166-25"></a><span class="co"># Lines for sister OTUs/ecotypes</span></span>
<span id="cb166-26"><a href="microbiota.html#cb166-26"></a>gb_sis &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_similarity.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb166-27"><a href="microbiota.html#cb166-27"></a>gb_sis<span class="op">$</span>Var1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">str_replace</span>(gb_sis<span class="op">$</span>Var1, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb166-28"><a href="microbiota.html#cb166-28"></a>gb_sis<span class="op">$</span>Var2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">str_replace</span>(gb_sis<span class="op">$</span>Var2, <span class="st">&quot;196900&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb166-29"><a href="microbiota.html#cb166-29"></a></span>
<span id="cb166-30"><a href="microbiota.html#cb166-30"></a><span class="co"># For binary</span></span>
<span id="cb166-31"><a href="microbiota.html#cb166-31"></a></span>
<span id="cb166-32"><a href="microbiota.html#cb166-32"></a><span class="co"># depth</span></span>
<span id="cb166-33"><a href="microbiota.html#cb166-33"></a>gb_bin &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gb_OTUs_overall_rabdc_annotated.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb166-34"><a href="microbiota.html#cb166-34"></a><span class="kw">head</span>(gb_bin)</span>
<span id="cb166-35"><a href="microbiota.html#cb166-35"></a><span class="kw">colnames</span>(gb_bin)</span>
<span id="cb166-36"><a href="microbiota.html#cb166-36"></a></span>
<span id="cb166-37"><a href="microbiota.html#cb166-37"></a>gb_bin[<span class="st">&quot;ttest.fdr&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb166-38"><a href="microbiota.html#cb166-38"></a>gb_bin<span class="op">$</span>ttest.fdr[gb_bin<span class="op">$</span>ttest_fdr <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st"> </span>gb_bin<span class="op">$</span>shallow_mean <span class="op">&gt;</span><span class="st"> </span>gb_bin<span class="op">$</span>deep_mean] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>)  <span class="co"># shallow</span></span>
<span id="cb166-39"><a href="microbiota.html#cb166-39"></a>gb_bin<span class="op">$</span>ttest.fdr[gb_bin<span class="op">$</span>ttest_fdr <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st"> </span>gb_bin<span class="op">$</span>shallow_mean <span class="op">&lt;</span><span class="st"> </span>gb_bin<span class="op">$</span>deep_mean] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>)  <span class="co"># deep</span></span>
<span id="cb166-40"><a href="microbiota.html#cb166-40"></a></span>
<span id="cb166-41"><a href="microbiota.html#cb166-41"></a>gb_bin[<span class="st">&quot;cortest.p&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb166-42"><a href="microbiota.html#cb166-42"></a>gb_bin<span class="op">$</span>cortest.p[gb_bin<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;decreasing&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>)  <span class="co"># shallow</span></span>
<span id="cb166-43"><a href="microbiota.html#cb166-43"></a>gb_bin<span class="op">$</span>cortest.p[gb_bin<span class="op">$</span>classification <span class="op">==</span><span class="st"> &quot;increasing&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>)  <span class="co"># deep</span></span>
<span id="cb166-44"><a href="microbiota.html#cb166-44"></a></span>
<span id="cb166-45"><a href="microbiota.html#cb166-45"></a>gb_bin &lt;-<span class="st"> </span>gb_bin[, <span class="kw">c</span>(<span class="st">&quot;XOTU&quot;</span>, <span class="st">&quot;ttest.fdr&quot;</span>, <span class="st">&quot;cortest.p&quot;</span>)]</span>
<span id="cb166-46"><a href="microbiota.html#cb166-46"></a>gb_bin[<span class="st">&quot;OTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(gb_bin<span class="op">$</span>XOTU, <span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb166-47"><a href="microbiota.html#cb166-47"></a></span>
<span id="cb166-48"><a href="microbiota.html#cb166-48"></a><span class="co"># emp</span></span>
<span id="cb166-49"><a href="microbiota.html#cb166-49"></a>emp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/SpongeEMP.csv&quot;</span>, <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb166-50"><a href="microbiota.html#cb166-50"></a>emp[<span class="st">&quot;OTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(emp<span class="op">$</span>OTU_ID, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb166-51"><a href="microbiota.html#cb166-51"></a>emp[<span class="st">&quot;emp&quot;</span>] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb166-52"><a href="microbiota.html#cb166-52"></a>emp<span class="op">$</span>emp[emp<span class="op">$</span>spongeEMP_enriched <span class="op">==</span><span class="st"> &quot;yes&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb166-53"><a href="microbiota.html#cb166-53"></a>emp<span class="op">$</span>emp[emp<span class="op">$</span>spongeEMP_enriched <span class="op">==</span><span class="st"> &quot;no&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb166-54"><a href="microbiota.html#cb166-54"></a>emp &lt;-<span class="st"> </span>emp[emp<span class="op">$</span>sponge <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>, ]</span>
<span id="cb166-55"><a href="microbiota.html#cb166-55"></a>emp[, <span class="kw">c</span>(<span class="st">&quot;OTU_ID&quot;</span>, <span class="st">&quot;spongeEMP_enriched&quot;</span>, <span class="st">&quot;sponge&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb166-56"><a href="microbiota.html#cb166-56"></a></span>
<span id="cb166-57"><a href="microbiota.html#cb166-57"></a><span class="kw">str</span>(emp)</span>
<span id="cb166-58"><a href="microbiota.html#cb166-58"></a><span class="kw">str</span>(gb_bin)</span>
<span id="cb166-59"><a href="microbiota.html#cb166-59"></a><span class="kw">dim</span>(emp)</span>
<span id="cb166-60"><a href="microbiota.html#cb166-60"></a><span class="kw">dim</span>(gb_bin)</span>
<span id="cb166-61"><a href="microbiota.html#cb166-61"></a></span>
<span id="cb166-62"><a href="microbiota.html#cb166-62"></a>gb_bin &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_bin, emp)</span>
<span id="cb166-63"><a href="microbiota.html#cb166-63"></a>emp<span class="op">$</span>OTU</span>
<span id="cb166-64"><a href="microbiota.html#cb166-64"></a>gb_bin<span class="op">$</span>XOTU &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb166-65"><a href="microbiota.html#cb166-65"></a>gb_bin &lt;-<span class="st"> </span>gb_bin[, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)]</span>
<span id="cb166-66"><a href="microbiota.html#cb166-66"></a></span>
<span id="cb166-67"><a href="microbiota.html#cb166-67"></a><span class="co"># barettin correlation</span></span>
<span id="cb166-68"><a href="microbiota.html#cb166-68"></a>bar_cor &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/GB_OTU_barettin_correlation.csv&quot;</span>, <span class="dt">head =</span> T, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb166-69"><a href="microbiota.html#cb166-69"></a><span class="co"># negative, and not significant correlations need to be removed Summary Pearson pmcc &gt; 0 &amp; p &lt; 0.05 56 fdr &lt; 0.05 22 Spearman rho &gt; 0 &amp; p &lt; 0.05 42 fdr &lt; 0.05 1</span></span>
<span id="cb166-70"><a href="microbiota.html#cb166-70"></a></span>
<span id="cb166-71"><a href="microbiota.html#cb166-71"></a><span class="co"># bar_cor %&gt;% filter(barettin_estimate_P&gt;0) %&gt;% filter(barettin_p_val_P&lt;0.05)</span></span>
<span id="cb166-72"><a href="microbiota.html#cb166-72"></a></span>
<span id="cb166-73"><a href="microbiota.html#cb166-73"></a>bar_cor[<span class="st">&quot;OTU&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_replace</span>(bar_cor<span class="op">$</span>XOTU, <span class="st">&quot;X196900&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb166-74"><a href="microbiota.html#cb166-74"></a>bar_cor[<span class="st">&quot;bar_cat&quot;</span>] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb166-75"><a href="microbiota.html#cb166-75"></a>bar_cor<span class="op">$</span>bar_cat[bar_cor<span class="op">$</span>barettin_estimate_P <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb166-76"><a href="microbiota.html#cb166-76"></a>bar_cor<span class="op">$</span>bar_cat[bar_cor<span class="op">$</span>barettin_estimate_P <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>bar_cor<span class="op">$</span>barettin_p_val_P <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb166-77"><a href="microbiota.html#cb166-77"></a>bar_cor<span class="op">$</span>bar_cat[bar_cor<span class="op">$</span>barettin_estimate_P <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>bar_cor<span class="op">$</span>barettin_p_val_P <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb166-78"><a href="microbiota.html#cb166-78"></a>bar_cor &lt;-<span class="st"> </span>bar_cor[, <span class="kw">c</span>(<span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;bar_cat&quot;</span>)]</span>
<span id="cb166-79"><a href="microbiota.html#cb166-79"></a></span>
<span id="cb166-80"><a href="microbiota.html#cb166-80"></a>gb_bin &lt;-<span class="st"> </span><span class="kw">left_join</span>(gb_bin, bar_cor)</span>
<span id="cb166-81"><a href="microbiota.html#cb166-81"></a><span class="kw">head</span>(gb_bin)</span>
<span id="cb166-82"><a href="microbiota.html#cb166-82"></a></span>
<span id="cb166-83"><a href="microbiota.html#cb166-83"></a></span>
<span id="cb166-84"><a href="microbiota.html#cb166-84"></a></span>
<span id="cb166-85"><a href="microbiota.html#cb166-85"></a><span class="co"># write.csv(gb_bin, &#39;data/leaf_bin.csv&#39;, row.names = F)</span></span></code></pre></div>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="microbiota.html#cb167-1"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;data/annotated_tree.png&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:tree"></span>
<img src="data/annotated_tree.png" alt="Annotated ML phylogeny." width="1182" />
<p class="caption">
Figure 3.15: Annotated ML phylogeny.
</p>
</div>

<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="microbiota.html#cb168-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb168-2"><a href="microbiota.html#cb168-2"></a><span class="kw">library</span>(vegan)</span>
<span id="cb168-3"><a href="microbiota.html#cb168-3"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb168-4"><a href="microbiota.html#cb168-4"></a></span>
<span id="cb168-5"><a href="microbiota.html#cb168-5"></a><span class="co">############# FUNCTIONS #</span></span>
<span id="cb168-6"><a href="microbiota.html#cb168-6"></a></span>
<span id="cb168-7"><a href="microbiota.html#cb168-7"></a><span class="co"># Prepare dataframes aka &#39;data gymnastics&#39;. The output is a list with the three data set per experiment for the three different species gb, sf, wb</span></span>
<span id="cb168-8"><a href="microbiota.html#cb168-8"></a>gymnastics &lt;-<span class="st"> </span><span class="cf">function</span>(df, my_colnames) {</span>
<span id="cb168-9"><a href="microbiota.html#cb168-9"></a>    df[, <span class="kw">c</span>(<span class="st">&quot;df.1&quot;</span>, <span class="st">&quot;df&quot;</span>, <span class="st">&quot;mz&quot;</span>, <span class="st">&quot;mzmin&quot;</span>, <span class="st">&quot;mzmadf&quot;</span>, <span class="st">&quot;rt&quot;</span>, <span class="st">&quot;rtmin&quot;</span>, <span class="st">&quot;rtmadf&quot;</span>, <span class="st">&quot;npeaks&quot;</span>, <span class="st">&quot;Gb&quot;</span>, <span class="st">&quot;QC&quot;</span>, <span class="st">&quot;Sf&quot;</span>, <span class="st">&quot;Wb&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb168-10"><a href="microbiota.html#cb168-10"></a>    df[, <span class="kw">c</span>(<span class="st">&quot;isotopes&quot;</span>, <span class="st">&quot;adduct&quot;</span>, <span class="st">&quot;pcgroup&quot;</span>, <span class="st">&quot;SD&quot;</span>, <span class="st">&quot;MEAN&quot;</span>, <span class="st">&quot;CV&quot;</span>, <span class="st">&quot;fss&quot;</span>, <span class="st">&quot;df.M.H..&quot;</span>, <span class="st">&quot;raw_peaks.pcgroup&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb168-11"><a href="microbiota.html#cb168-11"></a>    df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(df))</span>
<span id="cb168-12"><a href="microbiota.html#cb168-12"></a>    df[<span class="st">&quot;ID&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rownames</span>(df)</span>
<span id="cb168-13"><a href="microbiota.html#cb168-13"></a>    df[<span class="st">&quot;unified_ID&quot;</span>] &lt;-<span class="st"> </span>masslynx<span class="op">$</span>unified_ID[<span class="kw">match</span>(df<span class="op">$</span>ID, masslynx[[my_colnames]])]</span>
<span id="cb168-14"><a href="microbiota.html#cb168-14"></a>    df &lt;-<span class="st"> </span><span class="kw">na.omit</span>(df)</span>
<span id="cb168-15"><a href="microbiota.html#cb168-15"></a>    df &lt;-<span class="st"> </span>df[<span class="kw">order</span>(df<span class="op">$</span>unified_ID), ]</span>
<span id="cb168-16"><a href="microbiota.html#cb168-16"></a>    <span class="kw">rownames</span>(df) &lt;-<span class="st"> </span>df<span class="op">$</span>unified_ID</span>
<span id="cb168-17"><a href="microbiota.html#cb168-17"></a>    df[<span class="st">&quot;spec&quot;</span>] &lt;-<span class="st"> </span><span class="kw">str_sub</span>(df<span class="op">$</span>unified_ID, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb168-18"><a href="microbiota.html#cb168-18"></a>    df &lt;-<span class="st"> </span>df[<span class="op">!</span>df<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;QC&quot;</span>, ]</span>
<span id="cb168-19"><a href="microbiota.html#cb168-19"></a>    df[, <span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb168-20"><a href="microbiota.html#cb168-20"></a>    df_gb &lt;-<span class="st"> </span>df[df<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>, ]</span>
<span id="cb168-21"><a href="microbiota.html#cb168-21"></a>    df_sf &lt;-<span class="st"> </span>df[df<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>, ]</span>
<span id="cb168-22"><a href="microbiota.html#cb168-22"></a>    df_wb &lt;-<span class="st"> </span>df[df<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>, ]</span>
<span id="cb168-23"><a href="microbiota.html#cb168-23"></a>    df_gb<span class="op">$</span>spec &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb168-24"><a href="microbiota.html#cb168-24"></a>    df_sf<span class="op">$</span>spec &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb168-25"><a href="microbiota.html#cb168-25"></a>    df_wb<span class="op">$</span>spec &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb168-26"><a href="microbiota.html#cb168-26"></a>    <span class="co"># ready for mantel</span></span>
<span id="cb168-27"><a href="microbiota.html#cb168-27"></a>    metabolome &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">gb =</span> df_gb, <span class="dt">sf =</span> df_sf, <span class="dt">wb =</span> df_wb)</span>
<span id="cb168-28"><a href="microbiota.html#cb168-28"></a>    <span class="kw">return</span>(metabolome)</span>
<span id="cb168-29"><a href="microbiota.html#cb168-29"></a>}</span>
<span id="cb168-30"><a href="microbiota.html#cb168-30"></a></span>
<span id="cb168-31"><a href="microbiota.html#cb168-31"></a><span class="co"># Prepares the microbiome data sets to match the metabolomes. The output is a list with all microbiomes and metabolomes</span></span>
<span id="cb168-32"><a href="microbiota.html#cb168-32"></a>congruency &lt;-<span class="st"> </span><span class="cf">function</span>(metabolomes) {</span>
<span id="cb168-33"><a href="microbiota.html#cb168-33"></a>    metabolome_gb &lt;-<span class="st"> </span>metabolomes<span class="op">$</span>gb</span>
<span id="cb168-34"><a href="microbiota.html#cb168-34"></a>    metabolome_sf &lt;-<span class="st"> </span>metabolomes<span class="op">$</span>sf</span>
<span id="cb168-35"><a href="microbiota.html#cb168-35"></a>    metabolome_wb &lt;-<span class="st"> </span>metabolomes<span class="op">$</span>wb</span>
<span id="cb168-36"><a href="microbiota.html#cb168-36"></a>    </span>
<span id="cb168-37"><a href="microbiota.html#cb168-37"></a>    micro_gb &lt;-<span class="st"> </span>micro[micro<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Gb&quot;</span>, ]</span>
<span id="cb168-38"><a href="microbiota.html#cb168-38"></a>    micro_sf &lt;-<span class="st"> </span>micro[micro<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Sf&quot;</span>, ]</span>
<span id="cb168-39"><a href="microbiota.html#cb168-39"></a>    micro_wb &lt;-<span class="st"> </span>micro[micro<span class="op">$</span>spec <span class="op">==</span><span class="st"> &quot;Wb&quot;</span>, ]</span>
<span id="cb168-40"><a href="microbiota.html#cb168-40"></a>    </span>
<span id="cb168-41"><a href="microbiota.html#cb168-41"></a>    micro_gb[, <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb168-42"><a href="microbiota.html#cb168-42"></a>    micro_sf[, <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb168-43"><a href="microbiota.html#cb168-43"></a>    micro_wb[, <span class="kw">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;unified_ID&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb168-44"><a href="microbiota.html#cb168-44"></a>    </span>
<span id="cb168-45"><a href="microbiota.html#cb168-45"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[, <span class="kw">colSums</span>(micro_gb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb168-46"><a href="microbiota.html#cb168-46"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[, <span class="kw">colSums</span>(micro_sf <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb168-47"><a href="microbiota.html#cb168-47"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[, <span class="kw">colSums</span>(micro_wb <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb168-48"><a href="microbiota.html#cb168-48"></a>    </span>
<span id="cb168-49"><a href="microbiota.html#cb168-49"></a>    micro_gb &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro_gb)</span>
<span id="cb168-50"><a href="microbiota.html#cb168-50"></a>    micro_sf &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro_sf)</span>
<span id="cb168-51"><a href="microbiota.html#cb168-51"></a>    micro_wb &lt;-<span class="st"> </span><span class="kw">sqrt</span>(micro_wb)</span>
<span id="cb168-52"><a href="microbiota.html#cb168-52"></a>    </span>
<span id="cb168-53"><a href="microbiota.html#cb168-53"></a>    micro_gb &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(micro_gb)</span>
<span id="cb168-54"><a href="microbiota.html#cb168-54"></a>    micro_sf &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(micro_sf)</span>
<span id="cb168-55"><a href="microbiota.html#cb168-55"></a>    micro_wb &lt;-<span class="st"> </span><span class="kw">wisconsin</span>(micro_wb)</span>
<span id="cb168-56"><a href="microbiota.html#cb168-56"></a>    </span>
<span id="cb168-57"><a href="microbiota.html#cb168-57"></a>    micro_gb &lt;-<span class="st"> </span>micro_gb[<span class="kw">rownames</span>(micro_gb) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(metabolome_gb), ]</span>
<span id="cb168-58"><a href="microbiota.html#cb168-58"></a>    metabolome_gb &lt;-<span class="st"> </span>metabolome_gb[<span class="kw">rownames</span>(metabolome_gb) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(micro_gb), ]</span>
<span id="cb168-59"><a href="microbiota.html#cb168-59"></a>    <span class="kw">all</span>(<span class="kw">rownames</span>(micro_gb) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(metabolome_gb))</span>
<span id="cb168-60"><a href="microbiota.html#cb168-60"></a>    </span>
<span id="cb168-61"><a href="microbiota.html#cb168-61"></a>    micro_sf &lt;-<span class="st"> </span>micro_sf[<span class="kw">rownames</span>(micro_sf) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(metabolome_sf), ]</span>
<span id="cb168-62"><a href="microbiota.html#cb168-62"></a>    metabolome_sf &lt;-<span class="st"> </span>metabolome_sf[<span class="kw">rownames</span>(metabolome_sf) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(micro_sf), ]</span>
<span id="cb168-63"><a href="microbiota.html#cb168-63"></a>    <span class="kw">all</span>(<span class="kw">rownames</span>(micro_sf) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(metabolome_sf))</span>
<span id="cb168-64"><a href="microbiota.html#cb168-64"></a>    </span>
<span id="cb168-65"><a href="microbiota.html#cb168-65"></a>    micro_wb &lt;-<span class="st"> </span>micro_wb[<span class="kw">rownames</span>(micro_wb) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(metabolome_wb), ]</span>
<span id="cb168-66"><a href="microbiota.html#cb168-66"></a>    metabolome_wb &lt;-<span class="st"> </span>metabolome_wb[<span class="kw">rownames</span>(metabolome_wb) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(micro_wb), ]</span>
<span id="cb168-67"><a href="microbiota.html#cb168-67"></a>    <span class="kw">all</span>(<span class="kw">rownames</span>(micro_wb) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(metabolome_wb))</span>
<span id="cb168-68"><a href="microbiota.html#cb168-68"></a>    </span>
<span id="cb168-69"><a href="microbiota.html#cb168-69"></a>    congruent_dfs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">micro_gb =</span> micro_gb, <span class="dt">micro_sf =</span> micro_sf, <span class="dt">micro_wb =</span> micro_wb, <span class="dt">metabolome_gb =</span> metabolome_gb, <span class="dt">metabolome_sf =</span> metabolome_sf, <span class="dt">metabolome_wb =</span> metabolome_wb)</span>
<span id="cb168-70"><a href="microbiota.html#cb168-70"></a>    <span class="kw">return</span>(congruent_dfs)</span>
<span id="cb168-71"><a href="microbiota.html#cb168-71"></a>}</span>
<span id="cb168-72"><a href="microbiota.html#cb168-72"></a></span>
<span id="cb168-73"><a href="microbiota.html#cb168-73"></a><span class="co"># MANTEL </span><span class="al">TEST</span><span class="co"> Generates distance matrices &#39;Bray-Curtis&#39; for microbiome, scaled &#39;euclidean&#39; for metabolomes, runs a Mantel test with Spearman correlation, and saves the parameters</span></span>
<span id="cb168-74"><a href="microbiota.html#cb168-74"></a><span class="co"># to a data frame.</span></span>
<span id="cb168-75"><a href="microbiota.html#cb168-75"></a>cloak &lt;-<span class="st"> </span><span class="cf">function</span>(congruent_dfs, experiment, filtering) {</span>
<span id="cb168-76"><a href="microbiota.html#cb168-76"></a>    gb_meta_dist &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">scale</span>(congruent_dfs<span class="op">$</span>metabolome_gb), <span class="st">&quot;euclid&quot;</span>)</span>
<span id="cb168-77"><a href="microbiota.html#cb168-77"></a>    micro_gb_dist &lt;-<span class="st"> </span><span class="kw">vegdist</span>(congruent_dfs<span class="op">$</span>micro_gb, <span class="dt">method =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb168-78"><a href="microbiota.html#cb168-78"></a>    </span>
<span id="cb168-79"><a href="microbiota.html#cb168-79"></a>    sf_meta_dist &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">scale</span>(congruent_dfs<span class="op">$</span>metabolome_sf), <span class="st">&quot;euclid&quot;</span>)</span>
<span id="cb168-80"><a href="microbiota.html#cb168-80"></a>    micro_sf_dist &lt;-<span class="st"> </span><span class="kw">vegdist</span>(congruent_dfs<span class="op">$</span>micro_sf, <span class="dt">method =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb168-81"><a href="microbiota.html#cb168-81"></a>    </span>
<span id="cb168-82"><a href="microbiota.html#cb168-82"></a>    wb_meta_dist &lt;-<span class="st"> </span><span class="kw">vegdist</span>(<span class="kw">scale</span>(congruent_dfs<span class="op">$</span>metabolome_wb), <span class="st">&quot;euclid&quot;</span>)</span>
<span id="cb168-83"><a href="microbiota.html#cb168-83"></a>    micro_wb_dist &lt;-<span class="st"> </span><span class="kw">vegdist</span>(congruent_dfs<span class="op">$</span>micro_wb, <span class="dt">method =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb168-84"><a href="microbiota.html#cb168-84"></a>    </span>
<span id="cb168-85"><a href="microbiota.html#cb168-85"></a>    m_gb &lt;-<span class="st"> </span><span class="kw">mantel</span>(micro_gb_dist, gb_meta_dist, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb168-86"><a href="microbiota.html#cb168-86"></a>    m_sf &lt;-<span class="st"> </span><span class="kw">mantel</span>(micro_sf_dist, sf_meta_dist, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb168-87"><a href="microbiota.html#cb168-87"></a>    m_wb &lt;-<span class="st"> </span><span class="kw">mantel</span>(micro_wb_dist, wb_meta_dist, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb168-88"><a href="microbiota.html#cb168-88"></a>    </span>
<span id="cb168-89"><a href="microbiota.html#cb168-89"></a>    micro_dim &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>micro_gb)))</span>
<span id="cb168-90"><a href="microbiota.html#cb168-90"></a>    micro_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>micro_sf))))</span>
<span id="cb168-91"><a href="microbiota.html#cb168-91"></a>    micro_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>micro_wb))))</span>
<span id="cb168-92"><a href="microbiota.html#cb168-92"></a>    <span class="kw">colnames</span>(micro_dim) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;micro_samples&quot;</span>, <span class="st">&quot;micro_OTUs&quot;</span>)</span>
<span id="cb168-93"><a href="microbiota.html#cb168-93"></a>    </span>
<span id="cb168-94"><a href="microbiota.html#cb168-94"></a>    meta_dim &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>metabolome_gb)))</span>
<span id="cb168-95"><a href="microbiota.html#cb168-95"></a>    meta_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(meta_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>metabolome_sf))))</span>
<span id="cb168-96"><a href="microbiota.html#cb168-96"></a>    meta_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(meta_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>metabolome_wb))))</span>
<span id="cb168-97"><a href="microbiota.html#cb168-97"></a>    <span class="kw">colnames</span>(meta_dim) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;meta_samples&quot;</span>, <span class="st">&quot;meta_features&quot;</span>)</span>
<span id="cb168-98"><a href="microbiota.html#cb168-98"></a>    </span>
<span id="cb168-99"><a href="microbiota.html#cb168-99"></a>    stats &lt;-<span class="st"> </span><span class="kw">data.frame</span>(m_gb<span class="op">$</span>statistic)</span>
<span id="cb168-100"><a href="microbiota.html#cb168-100"></a>    stats &lt;-<span class="st"> </span><span class="kw">rbind</span>(stats, m_sf<span class="op">$</span>statistic)</span>
<span id="cb168-101"><a href="microbiota.html#cb168-101"></a>    stats &lt;-<span class="st"> </span><span class="kw">rbind</span>(stats, m_wb<span class="op">$</span>statistic)</span>
<span id="cb168-102"><a href="microbiota.html#cb168-102"></a>    </span>
<span id="cb168-103"><a href="microbiota.html#cb168-103"></a>    signif &lt;-<span class="st"> </span><span class="kw">data.frame</span>(m_gb<span class="op">$</span>signif)</span>
<span id="cb168-104"><a href="microbiota.html#cb168-104"></a>    signif &lt;-<span class="st"> </span><span class="kw">rbind</span>(signif, m_sf<span class="op">$</span>signif)</span>
<span id="cb168-105"><a href="microbiota.html#cb168-105"></a>    signif &lt;-<span class="st"> </span><span class="kw">rbind</span>(signif, m_wb<span class="op">$</span>signif)</span>
<span id="cb168-106"><a href="microbiota.html#cb168-106"></a>    </span>
<span id="cb168-107"><a href="microbiota.html#cb168-107"></a>    <span class="kw">colnames</span>(stats) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;statistic&quot;</span>)</span>
<span id="cb168-108"><a href="microbiota.html#cb168-108"></a>    stats[<span class="st">&quot;signif&quot;</span>] &lt;-<span class="st"> </span>signif</span>
<span id="cb168-109"><a href="microbiota.html#cb168-109"></a>    stats[<span class="st">&quot;Sponge species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>, <span class="st">&quot;Stryphnus fortis&quot;</span>, <span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb168-110"><a href="microbiota.html#cb168-110"></a>    </span>
<span id="cb168-111"><a href="microbiota.html#cb168-111"></a>    stats &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(stats, micro_dim)</span>
<span id="cb168-112"><a href="microbiota.html#cb168-112"></a>    stats &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(stats, meta_dim)</span>
<span id="cb168-113"><a href="microbiota.html#cb168-113"></a>    stats[<span class="st">&quot;data set&quot;</span>] &lt;-<span class="st"> </span>filtering</span>
<span id="cb168-114"><a href="microbiota.html#cb168-114"></a>    stats[<span class="st">&quot;Experiment&quot;</span>] &lt;-<span class="st"> </span>experiment</span>
<span id="cb168-115"><a href="microbiota.html#cb168-115"></a>    <span class="kw">return</span>(stats)</span>
<span id="cb168-116"><a href="microbiota.html#cb168-116"></a>}</span>
<span id="cb168-117"><a href="microbiota.html#cb168-117"></a></span>
<span id="cb168-118"><a href="microbiota.html#cb168-118"></a><span class="co"># PROTEST NMDS ordination and protest</span></span>
<span id="cb168-119"><a href="microbiota.html#cb168-119"></a>ordination &lt;-<span class="st"> </span><span class="cf">function</span>(congruent_dfs, experiment, filtering) {</span>
<span id="cb168-120"><a href="microbiota.html#cb168-120"></a>    <span class="co"># If you do not have community data, you should probably set autotransform = FALSE. k: number of dimensions</span></span>
<span id="cb168-121"><a href="microbiota.html#cb168-121"></a>    gb_meta_mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(congruent_dfs<span class="op">$</span>metabolome_gb, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;euclid&quot;</span>, <span class="dt">autotransforme =</span> F)</span>
<span id="cb168-122"><a href="microbiota.html#cb168-122"></a>    micro_gb_mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(congruent_dfs<span class="op">$</span>micro_gb, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb168-123"><a href="microbiota.html#cb168-123"></a>    </span>
<span id="cb168-124"><a href="microbiota.html#cb168-124"></a>    sf_meta_mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(congruent_dfs<span class="op">$</span>metabolome_sf, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;euclid&quot;</span>, <span class="dt">autotransforme =</span> F)</span>
<span id="cb168-125"><a href="microbiota.html#cb168-125"></a>    micro_sf_mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(congruent_dfs<span class="op">$</span>micro_sf, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb168-126"><a href="microbiota.html#cb168-126"></a>    </span>
<span id="cb168-127"><a href="microbiota.html#cb168-127"></a>    wb_meta_mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(congruent_dfs<span class="op">$</span>metabolome_wb, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;euclid&quot;</span>, <span class="dt">autotransforme =</span> F)</span>
<span id="cb168-128"><a href="microbiota.html#cb168-128"></a>    micro_wb_mds &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(congruent_dfs<span class="op">$</span>micro_wb, <span class="dt">trymax =</span> <span class="dv">100</span>, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb168-129"><a href="microbiota.html#cb168-129"></a>    </span>
<span id="cb168-130"><a href="microbiota.html#cb168-130"></a>    gb_proc &lt;-<span class="st"> </span><span class="kw">procrustes</span>(micro_gb_mds, gb_meta_mds, <span class="dt">scores =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb168-131"><a href="microbiota.html#cb168-131"></a>    gb_prot &lt;-<span class="st"> </span><span class="kw">protest</span>(micro_gb_mds, gb_meta_mds, <span class="dt">scores =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb168-132"><a href="microbiota.html#cb168-132"></a>    </span>
<span id="cb168-133"><a href="microbiota.html#cb168-133"></a>    sf_proc &lt;-<span class="st"> </span><span class="kw">procrustes</span>(micro_sf_mds, sf_meta_mds, <span class="dt">scores =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb168-134"><a href="microbiota.html#cb168-134"></a>    sf_prot &lt;-<span class="st"> </span><span class="kw">protest</span>(micro_sf_mds, sf_meta_mds, <span class="dt">scores =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb168-135"><a href="microbiota.html#cb168-135"></a>    </span>
<span id="cb168-136"><a href="microbiota.html#cb168-136"></a>    wb_proc &lt;-<span class="st"> </span><span class="kw">procrustes</span>(micro_wb_mds, wb_meta_mds, <span class="dt">scores =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb168-137"><a href="microbiota.html#cb168-137"></a>    wb_prot &lt;-<span class="st"> </span><span class="kw">protest</span>(micro_wb_mds, wb_meta_mds, <span class="dt">scores =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb168-138"><a href="microbiota.html#cb168-138"></a>    </span>
<span id="cb168-139"><a href="microbiota.html#cb168-139"></a>    micro_dim &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>micro_gb)))</span>
<span id="cb168-140"><a href="microbiota.html#cb168-140"></a>    micro_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>micro_sf))))</span>
<span id="cb168-141"><a href="microbiota.html#cb168-141"></a>    micro_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(micro_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>micro_wb))))</span>
<span id="cb168-142"><a href="microbiota.html#cb168-142"></a>    <span class="kw">colnames</span>(micro_dim) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;micro_samples&quot;</span>, <span class="st">&quot;micro_OTUs&quot;</span>)</span>
<span id="cb168-143"><a href="microbiota.html#cb168-143"></a>    </span>
<span id="cb168-144"><a href="microbiota.html#cb168-144"></a>    meta_dim &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>metabolome_gb)))</span>
<span id="cb168-145"><a href="microbiota.html#cb168-145"></a>    meta_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(meta_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>metabolome_sf))))</span>
<span id="cb168-146"><a href="microbiota.html#cb168-146"></a>    meta_dim &lt;-<span class="st"> </span><span class="kw">rbind</span>(meta_dim, <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">dim</span>(congruent_dfs<span class="op">$</span>metabolome_wb))))</span>
<span id="cb168-147"><a href="microbiota.html#cb168-147"></a>    <span class="kw">colnames</span>(meta_dim) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;meta_samples&quot;</span>, <span class="st">&quot;meta_features&quot;</span>)</span>
<span id="cb168-148"><a href="microbiota.html#cb168-148"></a>    </span>
<span id="cb168-149"><a href="microbiota.html#cb168-149"></a>    pss &lt;-<span class="st"> </span><span class="kw">data.frame</span>(gb_prot<span class="op">$</span>ss)</span>
<span id="cb168-150"><a href="microbiota.html#cb168-150"></a>    pss &lt;-<span class="st"> </span><span class="kw">rbind</span>(pss, sf_prot<span class="op">$</span>ss)</span>
<span id="cb168-151"><a href="microbiota.html#cb168-151"></a>    pss &lt;-<span class="st"> </span><span class="kw">rbind</span>(pss, wb_prot<span class="op">$</span>ss)</span>
<span id="cb168-152"><a href="microbiota.html#cb168-152"></a>    <span class="kw">colnames</span>(pss) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Procrustes SS&quot;</span>)</span>
<span id="cb168-153"><a href="microbiota.html#cb168-153"></a>    </span>
<span id="cb168-154"><a href="microbiota.html#cb168-154"></a>    cor &lt;-<span class="st"> </span><span class="kw">data.frame</span>(gb_prot<span class="op">$</span>scale)</span>
<span id="cb168-155"><a href="microbiota.html#cb168-155"></a>    cor &lt;-<span class="st"> </span><span class="kw">rbind</span>(cor, sf_prot<span class="op">$</span>scale)</span>
<span id="cb168-156"><a href="microbiota.html#cb168-156"></a>    cor &lt;-<span class="st"> </span><span class="kw">rbind</span>(cor, wb_prot<span class="op">$</span>scale)</span>
<span id="cb168-157"><a href="microbiota.html#cb168-157"></a>    <span class="kw">colnames</span>(cor) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;correlation in sym. rotation&quot;</span>)</span>
<span id="cb168-158"><a href="microbiota.html#cb168-158"></a>    </span>
<span id="cb168-159"><a href="microbiota.html#cb168-159"></a>    signif &lt;-<span class="st"> </span><span class="kw">data.frame</span>(gb_prot<span class="op">$</span>signif)</span>
<span id="cb168-160"><a href="microbiota.html#cb168-160"></a>    signif &lt;-<span class="st"> </span><span class="kw">rbind</span>(signif, sf_prot<span class="op">$</span>signif)</span>
<span id="cb168-161"><a href="microbiota.html#cb168-161"></a>    signif &lt;-<span class="st"> </span><span class="kw">rbind</span>(signif, wb_prot<span class="op">$</span>signif)</span>
<span id="cb168-162"><a href="microbiota.html#cb168-162"></a>    <span class="kw">colnames</span>(signif) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;signif&quot;</span>)</span>
<span id="cb168-163"><a href="microbiota.html#cb168-163"></a>    </span>
<span id="cb168-164"><a href="microbiota.html#cb168-164"></a>    stats &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(pss, cor, signif, micro_dim, meta_dim)</span>
<span id="cb168-165"><a href="microbiota.html#cb168-165"></a>    stats[<span class="st">&quot;data set&quot;</span>] &lt;-<span class="st"> </span>filtering</span>
<span id="cb168-166"><a href="microbiota.html#cb168-166"></a>    stats[<span class="st">&quot;Experiment&quot;</span>] &lt;-<span class="st"> </span>experiment</span>
<span id="cb168-167"><a href="microbiota.html#cb168-167"></a>    stats[<span class="st">&quot;Sponge species&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Geodia barretti&quot;</span>, <span class="st">&quot;Stryphnus fortis&quot;</span>, <span class="st">&quot;Weberella bursa&quot;</span>)</span>
<span id="cb168-168"><a href="microbiota.html#cb168-168"></a>    <span class="kw">return</span>(stats)</span>
<span id="cb168-169"><a href="microbiota.html#cb168-169"></a>}</span></code></pre></div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-moitinho-silva_2017">
<p>Moitinho-Silva, L, G Steinert, S Nielsen, C C P Hardoim, Y-C Wu, G P McCormack, S LÃ³pez-Legentil, et al. 2017. â€œPredicting the Hma-Lma Status in Marine Sponges by Machine Learning.â€ <em>Frontiers in Microbiology</em> 8: 752. <a href="https://doi.org/10.3389/fmicb.2017.00752">https://doi.org/10.3389/fmicb.2017.00752</a>.</p>
</div>
<div id="ref-R-vegan">
<p>Oksanen, Jari, F. Guillaume Blanchet, Michael Friendly, Roeland Kindt, Pierre Legendre, Dan McGlinn, Peter R. Minchin, et al. 2019. <em>Vegan: Community Ecology Package</em>. <a href="https://CRAN.R-project.org/package=vegan">https://CRAN.R-project.org/package=vegan</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metabolomics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="inter-omics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.pdf", "Oceanographic-setting-influences-the-prokaryote-community-and-metabolome-in-deep-sea-sponges.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
